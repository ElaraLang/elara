<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Elara.Core.ToANF.html"><span class="hs-identifier">Elara.Core.ToANF</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Cont</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html"><span class="hs-identifier">Elara.AST.VarRef</span></a></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.html"><span class="hs-identifier">Elara.Core</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Core</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.ANF.html"><span class="hs-identifier">Elara.Core.ANF</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ANF</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.Analysis.html"><span class="hs-identifier">Elara.Core.Analysis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Analysis.html#guesstimateExprType"><span class="hs-identifier">guesstimateExprType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.Generic.html"><span class="hs-identifier">Elara.Core.Generic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#Bind"><span class="hs-identifier">Bind</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html"><span class="hs-identifier">Elara.Data.Pretty</span></a></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html"><span class="hs-identifier">Elara.Data.Unique.Effect</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Logging.html"><span class="hs-identifier">Elara.Logging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier">StructuredDebug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier">debug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#debugWith"><span class="hs-identifier">debugWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#traceFn"><span class="hs-identifier">traceFn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="annot"><span class="hs-comment">{- | Convert a Core expression to ANF
For example:
@let main = print (f (g (h 1)))@
becomes:
@ let main =
   let v1 = h 1 in
   let v2 = g v1 in
   let v3 = f v2 in
   print v3
@
-}</span></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-comment">-- toANF :: Core.CoreExpr -&gt; Sem r (ANF.Expr Core.Var)</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- toANF expr = (toANF' expr pure)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">type</span><span> </span><span id="ToANF"><span class="annot"><a href="Elara.Core.ToANF.html#ToANF"><span class="hs-identifier hs-var">ToANF</span></a></span></span><span> </span><span id="local-6989586621680035337"><span class="annot"><a href="#local-6989586621680035337"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#UniqueGen"><span class="hs-identifier hs-type">Elara.Data.Unique.Effect.UniqueGen</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680035337"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680035337"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Expr"><span class="hs-identifier hs-type">Core.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#AExpr"><span class="hs-identifier hs-type">ANF.AExpr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#CExpr"><span class="hs-identifier hs-type">ANF.CExpr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Expr"><span class="hs-identifier hs-type">ANF.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Type"><span class="hs-identifier hs-type">Core.Type</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span id="local-6989586621680035223"><span class="annot"><a href="Elara.Core.ToANF.html#toANF"><span class="hs-identifier hs-type">toANF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Core.ToANF.html#ToANF"><span class="hs-identifier hs-type">ToANF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035223"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">Core.CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680035223"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Expr"><span class="hs-identifier hs-type">ANF.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-42"></span><span id="toANF"><span class="annot"><span class="annottext">toANF :: forall (r :: [Effect]). ToANF r =&gt; CoreExpr -&gt; Eff r (Expr Var)
</span><a href="Elara.Core.ToANF.html#toANF"><span class="hs-identifier hs-var hs-var">toANF</span></a></span></span><span> </span><span id="local-6989586621680035353"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035353"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r (Expr Var) -&gt; Eff r (Expr Var)
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;toANF &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035353"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (Expr Var) -&gt; Eff r (Expr Var))
-&gt; Eff r (Expr Var) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><span class="annottext">CoreExpr
-&gt; (CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; Eff r (Expr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr
-&gt; (CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; Eff r (Expr Var)
</span><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-var">toANFRec</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035353"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall a. a -&gt; ContT (Expr Var) (Eff r) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Expr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; (CExpr Var -&gt; Expr Var)
-&gt; CExpr Var
-&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CExpr Var -&gt; Expr Var
forall b. CExpr b -&gt; Expr b
</span><a href="Elara.Core.ANF.html#CExpr"><span class="hs-identifier hs-var">ANF.CExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span id="local-6989586621680035267"><span class="annot"><a href="Elara.Core.ToANF.html#toANFCont"><span class="hs-identifier hs-type">toANFCont</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Core.ToANF.html#ToANF"><span class="hs-identifier hs-type">ToANF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035267"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">Core.CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Expr"><span class="hs-identifier hs-type">ANF.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680035267"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#AExpr"><span class="hs-identifier hs-type">ANF.AExpr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-47"></span><span id="toANFCont"><span class="annot"><span class="annottext">toANFCont :: forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr -&gt; ContT (Expr Var) (Eff r) (AExpr Var)
</span><a href="Elara.Core.ToANF.html#toANFCont"><span class="hs-identifier hs-var hs-var">toANFCont</span></a></span></span><span> </span><span id="local-6989586621680035361"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035361"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var))
-&gt; ContT (Expr Var) (Eff r) (AExpr Var)
forall {k} (r :: k) (m :: k -&gt; *) a.
((a -&gt; m r) -&gt; m r) -&gt; ContT r m a
</span><span class="hs-identifier hs-var">ContT</span></span><span> </span><span class="annot"><span class="annottext">(((AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var))
 -&gt; ContT (Expr Var) (Eff r) (AExpr Var))
-&gt; ((AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var))
-&gt; ContT (Expr Var) (Eff r) (AExpr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680035363"><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035363"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr -&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
</span><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-var">toANF'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035361"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035363"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="annot"><span class="hs-comment">{- | Convert a Core expression to an atomic expression in ANF,
accepting a continuation to handle the rest of the expression
-}</span></span><span>
</span><span id="line-52"></span><span id="local-6989586621680035274"><span class="annot"><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-type">toANF'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Elara.Core.ToANF.html#ToANF"><span class="hs-identifier hs-type">ToANF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035274"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">Core.CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#AExpr"><span class="hs-identifier hs-type">ANF.AExpr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680035274"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Expr"><span class="hs-identifier hs-type">ANF.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680035274"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Expr"><span class="hs-identifier hs-type">ANF.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-57"></span><span id="toANF%27"><span class="annot"><span class="annottext">toANF' :: forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr -&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
</span><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-var hs-var">toANF'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-type">Core.Lit</span></a></span><span> </span><span id="local-6989586621680035437"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621680035437"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035438"><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035438"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035438"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(AExpr Var -&gt; Eff r (Expr Var)) -&gt; AExpr Var -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; AExpr Var
forall b. Literal -&gt; AExpr b
</span><a href="Elara.Core.ANF.html#Lit"><span class="hs-identifier hs-var">ANF.Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621680035437"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-58"></span><span class="annot"><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-var">toANF'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span id="local-6989586621680035441"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035441"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035442"><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035442"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035442"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(AExpr Var -&gt; Eff r (Expr Var)) -&gt; AExpr Var -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; AExpr Var
forall b. b -&gt; AExpr b
</span><a href="Elara.Core.ANF.html#Var"><span class="hs-identifier hs-var">ANF.Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035441"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-59"></span><span class="annot"><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-var">toANF'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#TyApp"><span class="hs-identifier hs-type">Core.TyApp</span></a></span><span> </span><span id="local-6989586621680035445"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035445"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680035446"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680035446"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035447"><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035447"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr -&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
</span><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-var">toANF'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035445"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">((AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var))
-&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680035448"><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035448"><span class="hs-identifier hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035447"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(AExpr Var -&gt; Eff r (Expr Var)) -&gt; AExpr Var -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AExpr Var -&gt; Type -&gt; AExpr Var
forall b. AExpr b -&gt; Type -&gt; AExpr b
</span><a href="Elara.Core.ANF.html#TyApp"><span class="hs-identifier hs-var">ANF.TyApp</span></a></span><span> </span><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035448"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680035446"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-60"></span><span class="annot"><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-var">toANF'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#TyLam"><span class="hs-identifier hs-type">Core.TyLam</span></a></span><span> </span><span id="local-6989586621680035451"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680035451"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680035452"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035452"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035453"><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035453"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr -&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
</span><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-var">toANF'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035452"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">((AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var))
-&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680035454"><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035454"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035453"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(AExpr Var -&gt; Eff r (Expr Var)) -&gt; AExpr Var -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; AExpr Var -&gt; AExpr Var
forall b. Type -&gt; AExpr b -&gt; AExpr b
</span><a href="Elara.Core.ANF.html#TyLam"><span class="hs-identifier hs-var">ANF.TyLam</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680035451"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035454"><span class="hs-identifier hs-var">e'</span></a></span><span>
</span><span id="line-61"></span><span class="annot"><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-var">toANF'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lam"><span class="hs-identifier hs-type">Core.Lam</span></a></span><span> </span><span id="local-6989586621680035457"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035457"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680035458"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035458"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035459"><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035459"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall (m :: * -&gt; *) r. Monad m =&gt; ContT r m r -&gt; m r
</span><span class="hs-identifier hs-var">evalContT</span></span><span> </span><span class="annot"><span class="annottext">(ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var))
-&gt; ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-comment">-- convert the body to ANF, making sure to not lift it out too far</span><span>
</span><span id="line-63"></span><span>    </span><span id="local-6989586621680035461"><span class="annot"><a href="#local-6989586621680035461"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff r (Expr Var) -&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ContT (Expr Var) m a
forall (t :: Effect) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Eff r (Expr Var) -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; Eff r (Expr Var) -&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; (CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; Eff r (Expr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr
-&gt; (CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; Eff r (Expr Var)
</span><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-var">toANFRec</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035458"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall a. a -&gt; ContT (Expr Var) (Eff r) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Expr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; (CExpr Var -&gt; Expr Var)
-&gt; CExpr Var
-&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CExpr Var -&gt; Expr Var
forall b. CExpr b -&gt; Expr b
</span><a href="Elara.Core.ANF.html#CExpr"><span class="hs-identifier hs-var">ANF.CExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621680035459"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#Lam"><span class="hs-identifier hs-type">ANF.Lam</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035457"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035461"><span class="hs-identifier hs-type">e'</span></a></span><span>
</span><span id="line-65"></span><span class="annot"><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-var">toANF'</span></a></span><span> </span><span id="local-6989586621680035464"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035464"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span id="local-6989586621680035465"><span class="annot"><span class="annottext">AExpr Var -&gt; Eff r (Expr Var)
</span><a href="#local-6989586621680035465"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r (Expr Var) -&gt; Eff r (Expr Var)
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;toANF' &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035464"><span class="hs-identifier hs-var">other</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (Expr Var) -&gt; Eff r (Expr Var))
-&gt; Eff r (Expr Var) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall (m :: * -&gt; *) r. Monad m =&gt; ContT r m r -&gt; m r
</span><span class="hs-identifier hs-var">evalContT</span></span><span> </span><span class="annot"><span class="annottext">(ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var))
-&gt; ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-66"></span><span>    </span><span id="local-6989586621680035466"><span class="annot"><a href="#local-6989586621680035466"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff r (Unique Text) -&gt; ContT (Expr Var) (Eff r) (Unique Text)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ContT (Expr Var) m a
forall (t :: Effect) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Eff r (Unique Text) -&gt; ContT (Expr Var) (Eff r) (Unique Text))
-&gt; Eff r (Unique Text) -&gt; ContT (Expr Var) (Eff r) (Unique Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r (Unique Text)
forall (r :: [Effect]) a. (UniqueGen :&gt; r) =&gt; a -&gt; Eff r (Unique a)
</span><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier hs-var">Elara.Data.Unique.Effect.makeUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;var&quot;</span></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-type">toANFRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035464"><span class="hs-identifier hs-type">other</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680035468"><span class="annot"><span class="annottext">CExpr Var
</span><a href="#local-6989586621680035468"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-69"></span><span>        </span><span id="local-6989586621680035469"><span class="annot"><a href="#local-6989586621680035469"><span class="hs-identifier hs-var">exprType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff r Type -&gt; ContT (Expr Var) (Eff r) Type
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ContT (Expr Var) m a
forall (t :: Effect) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Eff r Type -&gt; ContT (Expr Var) (Eff r) Type)
-&gt; Eff r Type -&gt; ContT (Expr Var) (Eff r) Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TraceableFn &quot;guesstimateExprType&quot; CoreExpr Type
-&gt; CoreExpr -&gt; Eff r Type
forall (name :: Symbol) a b (r :: [Effect]).
(Pretty a, Pretty b, StructuredDebug :&gt; r, KnownSymbol name) =&gt;
TraceableFn name a b -&gt; a -&gt; Eff r b
</span><a href="Elara.Logging.html#traceFn"><span class="hs-identifier hs-var">traceFn</span></a></span><span> </span><span class="annot"><span class="annottext">TraceableFn &quot;guesstimateExprType&quot; CoreExpr Type
(HasCallStack, Pretty Type, Pretty CoreExpr) =&gt;
TraceableFn &quot;guesstimateExprType&quot; CoreExpr Type
</span><a href="Elara.Core.Analysis.html#guesstimateExprType"><span class="hs-identifier hs-var">guesstimateExprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFCExpr"><span class="hs-identifier hs-var">fromANFCExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CExpr Var
</span><a href="#local-6989586621680035468"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680035471"><span class="annot"><a href="#local-6989586621680035471"><span class="hs-identifier hs-var hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text -&gt; Type -&gt; Maybe DataCon -&gt; Var
</span><a href="Elara.Core.html#Id"><span class="hs-identifier hs-var">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
-&gt; UnlocatedVarRef Text
forall (c :: VarRefKind) n. VarRefImpl c (Unique n) -&gt; VarRef' c n
</span><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680035466"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680035469"><span class="hs-identifier hs-var">exprType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>        </span><span id="local-6989586621680035474"><span class="annot"><a href="#local-6989586621680035474"><span class="hs-identifier hs-var">l'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621680035465"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#Var"><span class="hs-identifier hs-type">ANF.Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035471"><span class="hs-identifier hs-type">id</span></a></span><span>
</span><span id="line-73"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Creating let &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035471"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035468"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; in &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035474"><span class="hs-identifier hs-type">l'</span></a></span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#Let"><span class="hs-identifier hs-type">ANF.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#NonRecursive"><span class="hs-identifier hs-type">NonRecursive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680035471"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680035468"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680035474"><span class="hs-identifier hs-type">l'</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span id="local-6989586621680035260"><span class="annot"><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-type">toANFRec</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="Elara.Core.ToANF.html#ToANF"><span class="hs-identifier hs-type">ToANF</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035260"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="Elara.Core.html#Expr"><span class="hs-identifier hs-type">Core.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#CExpr"><span class="hs-identifier hs-type">ANF.CExpr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Expr"><span class="hs-identifier hs-type">ANF.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680035260"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Expr"><span class="hs-identifier hs-type">ANF.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680035260"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Expr"><span class="hs-identifier hs-type">ANF.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-81"></span><span id="toANFRec"><span class="annot"><span class="annottext">toANFRec :: forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr
-&gt; (CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; Eff r (Expr Var)
</span><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-var hs-var">toANFRec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#App"><span class="hs-identifier hs-type">Core.App</span></a></span><span> </span><span id="local-6989586621680035550"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035550"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680035551"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035551"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035552"><span class="annot"><span class="annottext">CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var)
</span><a href="#local-6989586621680035552"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall (m :: * -&gt; *) r. Monad m =&gt; ContT r m r -&gt; m r
</span><span class="hs-identifier hs-var">evalContT</span></span><span> </span><span class="annot"><span class="annottext">(ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var))
-&gt; ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621680035553"><span class="annot"><a href="#local-6989586621680035553"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; ContT (Expr Var) (Eff r) (AExpr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr -&gt; ContT (Expr Var) (Eff r) (AExpr Var)
</span><a href="Elara.Core.ToANF.html#toANFCont"><span class="hs-identifier hs-var">toANFCont</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035550"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621680035554"><span class="annot"><a href="#local-6989586621680035554"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.Core.ToANF.html#toANFCont"><span class="hs-identifier hs-type">toANFCont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035551"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="#local-6989586621680035552"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#App"><span class="hs-identifier hs-type">ANF.App</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035553"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035554"><span class="hs-identifier hs-type">x'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="annot"><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-var">toANFRec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Match"><span class="hs-identifier hs-type">Core.Match</span></a></span><span> </span><span id="local-6989586621680035557"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035557"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621680035558"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680035558"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621680035559"><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621680035559"><span class="hs-identifier hs-var">cases</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035560"><span class="annot"><span class="annottext">CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var)
</span><a href="#local-6989586621680035560"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall (m :: * -&gt; *) r. Monad m =&gt; ContT r m r -&gt; m r
</span><span class="hs-identifier hs-var">evalContT</span></span><span> </span><span class="annot"><span class="annottext">(ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var))
-&gt; ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621680035561"><span class="annot"><a href="#local-6989586621680035561"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; ContT (Expr Var) (Eff r) (AExpr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr -&gt; ContT (Expr Var) (Eff r) (AExpr Var)
</span><a href="Elara.Core.ToANF.html#toANFCont"><span class="hs-identifier hs-var">toANFCont</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035557"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-comment">-- we need to take care here that we don't lift any expressions out too far from the match</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-comment">-- as this could lead to incorrect results as we strictly evaluate</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>    </span><span id="local-6989586621680035562"><span class="annot"><a href="#local-6989586621680035562"><span class="hs-identifier hs-var">cases'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">for</span></span><span> </span><span class="annot"><a href="#local-6989586621680035559"><span class="hs-identifier hs-type">cases</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680035564"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621680035564"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035565"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680035565"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035566"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035566"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-91"></span><span>        </span><span id="local-6989586621680035567"><span class="annot"><a href="#local-6989586621680035567"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff r (Expr Var) -&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ContT (Expr Var) m a
forall (t :: Effect) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Eff r (Expr Var) -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; Eff r (Expr Var) -&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
-&gt; (CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; Eff r (Expr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr
-&gt; (CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; Eff r (Expr Var)
</span><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-var">toANFRec</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035566"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall a. a -&gt; ContT (Expr Var) (Eff r) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Expr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; (CExpr Var -&gt; Expr Var)
-&gt; CExpr Var
-&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CExpr Var -&gt; Expr Var
forall b. CExpr b -&gt; Expr b
</span><a href="Elara.Core.ANF.html#CExpr"><span class="hs-identifier hs-var">ANF.CExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680035564"><span class="hs-identifier hs-type">con</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680035565"><span class="hs-identifier hs-type">bs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680035567"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="#local-6989586621680035560"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#Match"><span class="hs-identifier hs-type">ANF.Match</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035561"><span class="hs-identifier hs-type">bind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035558"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035562"><span class="hs-identifier hs-type">cases'</span></a></span><span>
</span><span id="line-94"></span><span class="annot"><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-var">toANFRec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Let"><span class="hs-identifier hs-type">Core.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#NonRecursive"><span class="hs-identifier hs-type">NonRecursive</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680035570"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035570"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035571"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035571"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035572"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035572"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035573"><span class="annot"><span class="annottext">CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var)
</span><a href="#local-6989586621680035573"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall (m :: * -&gt; *) r. Monad m =&gt; ContT r m r -&gt; m r
</span><span class="hs-identifier hs-var">evalContT</span></span><span> </span><span class="annot"><span class="annottext">(ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var))
-&gt; ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="annottext">Eff r () -&gt; ContT (Expr Var) (Eff r) ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ContT (Expr Var) m a
forall (t :: Effect) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(Eff r () -&gt; ContT (Expr Var) (Eff r) ())
-&gt; Eff r () -&gt; ContT (Expr Var) (Eff r) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r ()
forall (r :: [Effect]).
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r ()
</span><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; Eff r ()) -&gt; Doc AnsiStyle -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;ToANF-ing&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035570"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span id="local-6989586621680035574"><span class="annot"><a href="#local-6989586621680035574"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; ContT (Expr Var) (Eff r) (AExpr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr -&gt; ContT (Expr Var) (Eff r) (AExpr Var)
</span><a href="Elara.Core.ToANF.html#toANFCont"><span class="hs-identifier hs-var">toANFCont</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035571"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621680035575"><span class="annot"><a href="#local-6989586621680035575"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-type">toANFRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035572"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035573"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Let &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035570"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; = &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035574"><span class="hs-identifier hs-type">e'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; in &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035575"><span class="hs-identifier hs-type">body'</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#Let"><span class="hs-identifier hs-type">ANF.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#NonRecursive"><span class="hs-identifier hs-type">NonRecursive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680035570"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#AExpr"><span class="hs-identifier hs-type">ANF.AExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035574"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680035575"><span class="hs-identifier hs-type">body'</span></a></span><span>
</span><span id="line-100"></span><span class="annot"><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-var">toANFRec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Let"><span class="hs-identifier hs-type">Core.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#Recursive"><span class="hs-identifier hs-type">Recursive</span></a></span><span> </span><span id="local-6989586621680035578"><span class="annot"><span class="annottext">[(Var, CoreExpr)]
</span><a href="#local-6989586621680035578"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035579"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035579"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall (m :: * -&gt; *) r. Monad m =&gt; ContT r m r -&gt; m r
</span><span class="hs-identifier hs-var">evalContT</span></span><span> </span><span class="annot"><span class="annottext">(ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var))
-&gt; ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-101"></span><span>    </span><span id="local-6989586621680035580"><span class="annot"><a href="#local-6989586621680035580"><span class="hs-identifier hs-var">bs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Var, CoreExpr)]
-&gt; ((Var, CoreExpr) -&gt; ContT (Expr Var) (Eff r) (Var, CExpr Var))
-&gt; ContT (Expr Var) (Eff r) [(Var, CExpr Var)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[(Var, CoreExpr)]
</span><a href="#local-6989586621680035578"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">(((Var, CoreExpr) -&gt; ContT (Expr Var) (Eff r) (Var, CExpr Var))
 -&gt; ContT (Expr Var) (Eff r) [(Var, CExpr Var)])
-&gt; ((Var, CoreExpr) -&gt; ContT (Expr Var) (Eff r) (Var, CExpr Var))
-&gt; ContT (Expr Var) (Eff r) [(Var, CExpr Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680035581"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035581"><span class="hs-identifier hs-var">bindVar</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035582"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035582"><span class="hs-identifier hs-var">bindValue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>        </span><span id="local-6989586621680035583"><span class="annot"><a href="#local-6989586621680035583"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; ContT (Expr Var) (Eff r) (AExpr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr -&gt; ContT (Expr Var) (Eff r) (AExpr Var)
</span><a href="Elara.Core.ToANF.html#toANFCont"><span class="hs-identifier hs-var">toANFCont</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035582"><span class="hs-identifier hs-var">bindValue</span></a></span><span>
</span><span id="line-103"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680035581"><span class="hs-identifier hs-type">bindVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#AExpr"><span class="hs-identifier hs-type">ANF.AExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035583"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621680035584"><span class="annot"><a href="#local-6989586621680035584"><span class="hs-identifier hs-var">body'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-type">toANFRec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035579"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#CExpr"><span class="hs-identifier hs-type">ANF.CExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#Let"><span class="hs-identifier hs-type">ANF.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#Recursive"><span class="hs-identifier hs-type">Recursive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680035580"><span class="hs-identifier hs-type">bs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680035584"><span class="hs-identifier hs-type">body'</span></a></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Elara.Core.ToANF.html#toANFRec"><span class="hs-identifier hs-var">toANFRec</span></a></span><span> </span><span id="local-6989586621680035585"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035585"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span id="local-6989586621680035586"><span class="annot"><span class="annottext">CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var)
</span><a href="#local-6989586621680035586"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-comment">-- DANGER of infinite loop!!! make sure all cases are covered</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
forall (r :: [Effect]).
ToANF r =&gt;
CoreExpr -&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
</span><a href="Elara.Core.ToANF.html#toANF%27"><span class="hs-identifier hs-var">toANF'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680035585"><span class="hs-identifier hs-var">other</span></a></span><span> </span><span class="annot"><span class="annottext">((AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var))
-&gt; (AExpr Var -&gt; Eff r (Expr Var)) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680035587"><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035587"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall (m :: * -&gt; *) r. Monad m =&gt; ContT r m r -&gt; m r
</span><span class="hs-identifier hs-var">evalContT</span></span><span> </span><span class="annot"><span class="annottext">(ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var))
-&gt; ContT (Expr Var) (Eff r) (Expr Var) -&gt; Eff r (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var)
</span><a href="#local-6989586621680035586"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var))
-&gt; CExpr Var -&gt; ContT (Expr Var) (Eff r) (Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AExpr Var -&gt; CExpr Var
forall b. AExpr b -&gt; CExpr b
</span><a href="Elara.Core.ANF.html#AExpr"><span class="hs-identifier hs-var">ANF.AExpr</span></a></span><span> </span><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035587"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANF"><span class="hs-identifier hs-type">fromANF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#Expr"><span class="hs-identifier hs-type">ANF.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">Core.CoreExpr</span></a></span><span>
</span><span id="line-111"></span><span id="fromANF"><span class="annot"><span class="annottext">fromANF :: Expr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANF"><span class="hs-identifier hs-var hs-var">fromANF</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Let"><span class="hs-identifier hs-type">ANF.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#NonRecursive"><span class="hs-identifier hs-type">NonRecursive</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680035593"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035593"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035594"><span class="annot"><span class="annottext">CExpr Var
</span><a href="#local-6989586621680035594"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035595"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680035595"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind Var Expr -&gt; CoreExpr -&gt; CoreExpr
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="Elara.Core.html#Let"><span class="hs-identifier hs-var">Core.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, CoreExpr) -&gt; Bind Var Expr
forall b (expr :: * -&gt; *). (b, expr b) -&gt; Bind b expr
</span><a href="Elara.Core.Generic.html#NonRecursive"><span class="hs-identifier hs-var">NonRecursive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035593"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFCExpr"><span class="hs-identifier hs-var">fromANFCExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CExpr Var
</span><a href="#local-6989586621680035594"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANF"><span class="hs-identifier hs-var">fromANF</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680035595"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-112"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANF"><span class="hs-identifier hs-var">fromANF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Let"><span class="hs-identifier hs-type">ANF.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#Recursive"><span class="hs-identifier hs-type">Recursive</span></a></span><span> </span><span id="local-6989586621680035596"><span class="annot"><span class="annottext">[(Var, CExpr Var)]
</span><a href="#local-6989586621680035596"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680035597"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680035597"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bind Var Expr -&gt; CoreExpr -&gt; CoreExpr
forall b. Bind b -&gt; Expr b -&gt; Expr b
</span><a href="Elara.Core.html#Let"><span class="hs-identifier hs-var">Core.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Var, CoreExpr)] -&gt; Bind Var Expr
forall b (expr :: * -&gt; *). [(b, expr b)] -&gt; Bind b expr
</span><a href="Elara.Core.Generic.html#Recursive"><span class="hs-identifier hs-var">Recursive</span></a></span><span> </span><span class="annot"><span class="annottext">([(Var, CoreExpr)] -&gt; Bind Var Expr)
-&gt; [(Var, CoreExpr)] -&gt; Bind Var Expr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFCExpr"><span class="hs-identifier hs-var">fromANFCExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(CExpr Var -&gt; CoreExpr) -&gt; [(Var, CExpr Var)] -&gt; [(Var, CoreExpr)]
forall (f :: * -&gt; *) (g :: * -&gt; *) a b.
(Functor f, Functor g) =&gt;
(a -&gt; b) -&gt; f (g a) -&gt; f (g b)
</span><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Var, CExpr Var)]
</span><a href="#local-6989586621680035596"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANF"><span class="hs-identifier hs-var">fromANF</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680035597"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-113"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANF"><span class="hs-identifier hs-var">fromANF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#CExpr"><span class="hs-identifier hs-type">ANF.CExpr</span></a></span><span> </span><span id="local-6989586621680035599"><span class="annot"><span class="annottext">CExpr Var
</span><a href="#local-6989586621680035599"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFCExpr"><span class="hs-identifier hs-var">fromANFCExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CExpr Var
</span><a href="#local-6989586621680035599"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANFCExpr"><span class="hs-identifier hs-type">fromANFCExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#CExpr"><span class="hs-identifier hs-type">ANF.CExpr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">Core.CoreExpr</span></a></span><span>
</span><span id="line-116"></span><span id="fromANFCExpr"><span class="annot"><span class="annottext">fromANFCExpr :: CExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFCExpr"><span class="hs-identifier hs-var hs-var">fromANFCExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#App"><span class="hs-identifier hs-type">ANF.App</span></a></span><span> </span><span id="local-6989586621680035601"><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035601"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680035602"><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035602"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="Elara.Core.html#App"><span class="hs-identifier hs-var">Core.App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var">fromANFAtom</span></a></span><span> </span><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035601"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var">fromANFAtom</span></a></span><span> </span><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035602"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANFCExpr"><span class="hs-identifier hs-var">fromANFCExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Match"><span class="hs-identifier hs-type">ANF.Match</span></a></span><span> </span><span id="local-6989586621680035604"><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035604"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680035605"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680035605"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680035606"><span class="annot"><span class="annottext">[(AltCon, [Var], Expr Var)]
</span><a href="#local-6989586621680035606"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; Maybe Var -&gt; [Alt Var] -&gt; CoreExpr
forall b. Expr b -&gt; Maybe b -&gt; [Alt b] -&gt; Expr b
</span><a href="Elara.Core.html#Match"><span class="hs-identifier hs-var">Core.Match</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var">fromANFAtom</span></a></span><span> </span><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035604"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680035605"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">([Alt Var] -&gt; CoreExpr) -&gt; [Alt Var] -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><span class="annottext">((AltCon, [Var], Expr Var) -&gt; Alt Var)
-&gt; [(AltCon, [Var], Expr Var)] -&gt; [Alt Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680035607"><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621680035607"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035608"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680035608"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680035609"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680035609"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon
</span><a href="#local-6989586621680035607"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680035608"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANF"><span class="hs-identifier hs-var">fromANF</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680035609"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(AltCon, [Var], Expr Var)]
</span><a href="#local-6989586621680035606"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANFCExpr"><span class="hs-identifier hs-var">fromANFCExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#AExpr"><span class="hs-identifier hs-type">ANF.AExpr</span></a></span><span> </span><span id="local-6989586621680035610"><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035610"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var">fromANFAtom</span></a></span><span> </span><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035610"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-type">fromANFAtom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Core.ANF.html#AExpr"><span class="hs-identifier hs-type">ANF.AExpr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#Expr"><span class="hs-identifier hs-type">Core.Expr</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span>
</span><span id="line-123"></span><span id="fromANFAtom"><span class="annot"><span class="annottext">fromANFAtom :: AExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var hs-var">fromANFAtom</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Lit"><span class="hs-identifier hs-type">ANF.Lit</span></a></span><span> </span><span id="local-6989586621680035611"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621680035611"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-var">Core.Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621680035611"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-124"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var">fromANFAtom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Var"><span class="hs-identifier hs-type">ANF.Var</span></a></span><span> </span><span id="local-6989586621680035612"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035612"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; CoreExpr
forall b. b -&gt; Expr b
</span><a href="Elara.Core.html#Var"><span class="hs-identifier hs-var">Core.Var</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035612"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-125"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var">fromANFAtom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#Lam"><span class="hs-identifier hs-type">ANF.Lam</span></a></span><span> </span><span id="local-6989586621680035613"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035613"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680035614"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680035614"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; CoreExpr -&gt; CoreExpr
forall b. b -&gt; Expr b -&gt; Expr b
</span><a href="Elara.Core.html#Lam"><span class="hs-identifier hs-var">Core.Lam</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680035613"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Expr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANF"><span class="hs-identifier hs-var">fromANF</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680035614"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var">fromANFAtom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#TyLam"><span class="hs-identifier hs-type">ANF.TyLam</span></a></span><span> </span><span id="local-6989586621680035615"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680035615"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680035616"><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035616"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CoreExpr -&gt; CoreExpr
forall b. Type -&gt; Expr b -&gt; Expr b
</span><a href="Elara.Core.html#TyLam"><span class="hs-identifier hs-var">Core.TyLam</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680035615"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; CoreExpr -&gt; CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var">fromANFAtom</span></a></span><span> </span><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035616"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-127"></span><span class="annot"><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var">fromANFAtom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.ANF.html#TyApp"><span class="hs-identifier hs-type">ANF.TyApp</span></a></span><span> </span><span id="local-6989586621680035617"><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035617"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680035618"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680035618"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Type -&gt; CoreExpr
forall b. Expr b -&gt; Type -&gt; Expr b
</span><a href="Elara.Core.html#TyApp"><span class="hs-identifier hs-var">Core.TyApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AExpr Var -&gt; CoreExpr
</span><a href="Elara.Core.ToANF.html#fromANFAtom"><span class="hs-identifier hs-var">fromANFAtom</span></a></span><span> </span><span class="annot"><span class="annottext">AExpr Var
</span><a href="#local-6989586621680035617"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680035618"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-128"></span></pre></body></html>