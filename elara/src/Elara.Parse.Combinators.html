<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Elara.Parse.Combinators.html"><span class="hs-identifier">Elara.Parse.Combinators</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Parse.Combinators.html#sepBy1%27"><span class="hs-identifier">sepBy1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Parse.Combinators.html#sepEndBy1%27"><span class="hs-identifier">sepEndBy1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Parse.Combinators.html#liftedBinary"><span class="hs-identifier">liftedBinary</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Region.html"><span class="hs-identifier">Elara.AST.Region</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier">Located</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier">Located</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#enclosingRegion%27"><span class="hs-identifier">enclosingRegion'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier">sourceRegion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Parse.Primitives.html"><span class="hs-identifier">Elara.Parse.Primitives</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Parse.Primitives.html#Parser"><span class="hs-identifier">Parser</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Megaparsec</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">try</span></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Safe version of [sepBy1] that backtracks if the parser after the separator fails.</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Could also be considered a lazy version of [sepBy1]</span><span>
</span><span id="line-9"></span><span id="local-6989586621680017094"><span id="local-6989586621680017096"><span class="annot"><a href="Elara.Parse.Combinators.html#sepBy1%27"><span class="hs-identifier hs-type">sepBy1'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Parse.Primitives.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680017094"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Parse.Primitives.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680017096"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Parse.Primitives.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621680017094"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-10"></span><span id="sepBy1%27"><span class="annot"><span class="annottext">sepBy1' :: forall a sep. Parser a -&gt; Parser sep -&gt; Parser (NonEmpty a)
</span><a href="Elara.Parse.Combinators.html#sepBy1%27"><span class="hs-identifier hs-var hs-var">sepBy1'</span></a></span></span><span> </span><span id="local-6989586621680017215"><span class="annot"><span class="annottext">Parser a
</span><a href="#local-6989586621680017215"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680017216"><span class="annot"><span class="annottext">Parser sep
</span><a href="#local-6989586621680017216"><span class="hs-identifier hs-var">sep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-11"></span><span>    </span><span id="local-6989586621680017217"><span class="annot"><a href="#local-6989586621680017217"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Parser a
</span><a href="#local-6989586621680017215"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">x</span></span><span> </span><span class="annot"><span class="hs-operator">:|</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">many</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680017216"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">*&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680017215"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Safe version of @sepEndBy1@ that backtracks if the parser after the separator fails.</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- Could also be considered a lazy version of [sepBy1]</span><span>
</span><span id="line-16"></span><span id="local-6989586621680017221"><span id="local-6989586621680017222"><span class="annot"><a href="Elara.Parse.Combinators.html#sepEndBy1%27"><span class="hs-identifier hs-type">sepEndBy1'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Parse.Primitives.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680017221"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Parse.Primitives.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680017222"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Parse.Primitives.html#Parser"><span class="hs-identifier hs-type">Parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621680017221"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-17"></span><span id="sepEndBy1%27"><span class="annot"><span class="annottext">sepEndBy1' :: forall a sep. Parser a -&gt; Parser sep -&gt; Parser (NonEmpty a)
</span><a href="Elara.Parse.Combinators.html#sepEndBy1%27"><span class="hs-identifier hs-var hs-var">sepEndBy1'</span></a></span></span><span> </span><span id="local-6989586621680017234"><span class="annot"><span class="annottext">Parser a
</span><a href="#local-6989586621680017234"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680017235"><span class="annot"><span class="annottext">Parser sep
</span><a href="#local-6989586621680017235"><span class="hs-identifier hs-var">sep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-18"></span><span>    </span><span id="local-6989586621680017236"><span class="annot"><a href="#local-6989586621680017236"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Parser a
</span><a href="#local-6989586621680017234"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">x</span></span><span> </span><span class="annot"><span class="hs-operator">:|</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- at least one</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">many</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">try</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680017235"><span class="hs-identifier hs-type">sep</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">*&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680017234"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- many</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">&lt;*</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">optional</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">try</span></span><span> </span><span class="annot"><a href="#local-6989586621680017235"><span class="hs-identifier hs-type">sep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- optional ending</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">-- Lift a binary operator to work on `Expr` instead of `FrontendExpr`. Probably not the best way to do this, but it works</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span id="liftedBinary"><span class="annot"><span class="annottext">liftedBinary :: m t
-&gt; (t -&gt; a -&gt; a -&gt; a)
-&gt; Optic k NoIx a a (Located a) (Located a)
-&gt; m (a -&gt; a -&gt; a)
</span><a href="Elara.Parse.Combinators.html#liftedBinary"><span class="hs-identifier hs-var hs-var">liftedBinary</span></a></span></span><span> </span><span id="local-6989586621680017272"><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621680017272"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621680017273"><span class="annot"><span class="annottext">t -&gt; a -&gt; a -&gt; a
</span><a href="#local-6989586621680017273"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680017274"><span class="annot"><span class="annottext">Optic k NoIx a a (Located a) (Located a)
</span><a href="#local-6989586621680017274"><span class="hs-identifier hs-var">_Expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-26"></span><span>    </span><span id="local-6989586621680017275"><span class="annot"><a href="#local-6989586621680017275"><span class="hs-identifier hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m t
</span><a href="#local-6989586621680017272"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680017276"><span class="annot"><a href="#local-6989586621680017276"><span class="hs-identifier hs-var hs-var">create</span></a></span></span><span> </span><span id="local-6989586621680017277"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680017277"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680017278"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680017278"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-28"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680017279"><span class="annot"><span class="annottext">region :: SourceRegion
</span><a href="#local-6989586621680017279"><span class="hs-identifier hs-var hs-var">region</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; SourceRegion -&gt; SourceRegion -&gt; SourceRegion
SourceRegion -&gt; SourceRegion -&gt; SourceRegion
</span><a href="Elara.AST.Region.html#enclosingRegion%27"><span class="hs-identifier hs-var">enclosingRegion'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680017277"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Optic' k NoIx a SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic k NoIx a a (Located a) (Located a)
</span><a href="#local-6989586621680017274"><span class="hs-identifier hs-var">_Expr</span></a></span><span> </span><span class="annot"><span class="annottext">Optic k NoIx a a (Located a) (Located a)
-&gt; Optic
     A_Lens NoIx (Located a) (Located a) SourceRegion SourceRegion
-&gt; Optic' k NoIx a SourceRegion
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic A_Lens NoIx (Located a) (Located a) SourceRegion SourceRegion
forall a. HasSourceRegion a =&gt; Lens' a SourceRegion
</span><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-var">sourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680017278"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Optic' k NoIx a SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic k NoIx a a (Located a) (Located a)
</span><a href="#local-6989586621680017274"><span class="hs-identifier hs-var">_Expr</span></a></span><span> </span><span class="annot"><span class="annottext">Optic k NoIx a a (Located a) (Located a)
-&gt; Optic
     A_Lens NoIx (Located a) (Located a) SourceRegion SourceRegion
-&gt; Optic' k NoIx a SourceRegion
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic A_Lens NoIx (Located a) (Located a) SourceRegion SourceRegion
forall a. HasSourceRegion a =&gt; Lens' a SourceRegion
</span><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-var">sourceRegion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SourceRegion -&gt; a -&gt; Located a
forall a. SourceRegion -&gt; a -&gt; Located a
</span><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-var">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680017279"><span class="hs-identifier hs-var">region</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; a -&gt; a -&gt; a
</span><a href="#local-6989586621680017273"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680017275"><span class="hs-identifier hs-var">op'</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680017277"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680017278"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Located a -&gt; Optic' (ReversedOptic k) NoIx (Located a) a -&gt; a
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic k NoIx a a (Located a) (Located a)
-&gt; Optic' (ReversedOptic k) NoIx (Located a) a
forall (is :: IxList) s t a b.
AcceptsEmptyIndices &quot;re&quot; is =&gt;
Optic k is s t a b -&gt; Optic (ReversedOptic k) is b a t s
forall k (is :: IxList) s t a b.
(ReversibleOptic k, AcceptsEmptyIndices &quot;re&quot; is) =&gt;
Optic k is s t a b -&gt; Optic (ReversedOptic k) is b a t s
</span><span class="hs-identifier hs-var">re</span></span><span> </span><span class="annot"><span class="annottext">Optic k NoIx a a (Located a) (Located a)
</span><a href="#local-6989586621680017274"><span class="hs-identifier hs-var">_Expr</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680017276"><span class="hs-identifier hs-type">create</span></a></span><span>
</span><span id="line-31"></span></pre></body></html>