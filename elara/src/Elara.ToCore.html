<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | Converts typed AST to Core</span></span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Elara.ToCore.html"><span class="hs-identifier">Elara.ToCore</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Product</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Sum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AsAny</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_As</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Wrapped</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Graph</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SCC</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">flattenSCC</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stronglyConnComp</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.Error.Static</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.State.Static.Local</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.html"><span class="hs-identifier">Elara.AST.Generic</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AST</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Common.html"><span class="hs-identifier">Elara.AST.Generic.Common</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier">NoFieldValue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Module.html"><span class="hs-identifier">Elara.AST.Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Module.html#Module"><span class="hs-identifier">Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Module.html#Module"><span class="hs-identifier">Module</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Name.html"><span class="hs-identifier">Elara.AST.Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#ModuleName"><span class="hs-identifier">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Name"><span class="hs-identifier">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#NameLike"><span class="hs-identifier">NameLike</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier">Qualified</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier">TypeName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier">VarName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Region.html"><span class="hs-identifier">Elara.AST.Region</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier">Located</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier">Located</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier">SourceRegion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Select.html"><span class="hs-identifier">Elara.AST.Select</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Select.html#LocatedAST"><span class="hs-identifier">LocatedAST</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Select.html#Typed"><span class="hs-identifier">Typed</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.StripLocation.html"><span class="hs-identifier">Elara.AST.StripLocation</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html"><span class="hs-identifier">Elara.AST.Typed</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html"><span class="hs-identifier">Elara.AST.VarRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#VarRef%27"><span class="hs-identifier">VarRef'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier">Global</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier">Local</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html#varRefVal"><span class="hs-identifier">varRefVal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.html"><span class="hs-identifier">Elara.Core</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Core</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.Generic.html"><span class="hs-identifier">Elara.Core.Generic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#Bind"><span class="hs-identifier">Bind</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.Module.html"><span class="hs-identifier">Elara.Core.Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreDeclaration"><span class="hs-identifier">CoreDeclaration</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreModule"><span class="hs-identifier">CoreModule</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeDecl"><span class="hs-identifier">CoreTypeDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeDeclBody"><span class="hs-identifier">CoreTypeDeclBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreDataDecl"><span class="hs-identifier">CoreDataDecl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.Pretty.html"><span class="hs-identifier">Elara.Core.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Kind.html"><span class="hs-identifier">Elara.Data.Kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Kind.html#ElaraKind"><span class="hs-identifier">ElaraKind</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html"><span class="hs-identifier">Elara.Data.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">vcat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;+&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.TopologicalGraph.html"><span class="hs-identifier">Elara.Data.TopologicalGraph</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html"><span class="hs-identifier">Elara.Data.Unique.Effect</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Error.html"><span class="hs-identifier">Elara.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Error.html#ReportableError"><span class="hs-identifier">ReportableError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier">runErrorOrReport</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier">writeReport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Logging.html"><span class="hs-identifier">Elara.Logging</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Prim.html"><span class="hs-identifier">Elara.Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Prim.html#mkPrimQual"><span class="hs-identifier">mkPrimQual</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Prim.Core.html"><span class="hs-identifier">Elara.Prim.Core</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Query.html"><span class="hs-identifier">Elara.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html"><span class="hs-identifier">Elara.Query.Effects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier">ConsQueryEffects</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html#QueryEffects"><span class="hs-identifier">QueryEffects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.ToCore.Match.html"><span class="hs-identifier">Elara.ToCore.Match</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Match</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html"><span class="hs-identifier">Elara.TypeInfer.Type</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Utils.html"><span class="hs-identifier">Elara.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Utils.html#uncurry3"><span class="hs-identifier">uncurry3</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Error.Diagnose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Report</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Optics</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Rock.html"><span class="hs-identifier">Rock</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="TODO.html"><span class="hs-identifier">TODO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="TODO.html#todo"><span class="hs-identifier">todo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">data</span><span> </span><span id="ToCoreError"><span class="annot"><a href="Elara.ToCore.html#ToCoreError"><span class="hs-identifier hs-var">ToCoreError</span></a></span></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="LetInTopLevel"><span class="annot"><a href="Elara.ToCore.html#LetInTopLevel"><span class="hs-identifier hs-var">LetInTopLevel</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnknownConstructor"><span class="annot"><a href="Elara.ToCore.html#UnknownConstructor"><span class="hs-identifier hs-var">UnknownConstructor</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-type">CtorSymbolTable</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnknownPrimConstructor"><span class="annot"><a href="Elara.ToCore.html#UnknownPrimConstructor"><span class="hs-identifier hs-var">UnknownPrimConstructor</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnknownTypeConstructor"><span class="annot"><a href="Elara.ToCore.html#UnknownTypeConstructor"><span class="hs-identifier hs-var">UnknownTypeConstructor</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-type">CtorSymbolTable</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnknownLambdaType"><span class="annot"><a href="Elara.ToCore.html#UnknownLambdaType"><span class="hs-identifier hs-var">UnknownLambdaType</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier hs-type">Type.Type</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnsolvedTypeSnuckIn"><span class="annot"><a href="Elara.ToCore.html#UnsolvedTypeSnuckIn"><span class="hs-identifier hs-var">UnsolvedTypeSnuckIn</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier hs-type">Type.Type</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnknownVariable"><span class="annot"><a href="Elara.ToCore.html#UnknownVariable"><span class="hs-identifier hs-var">UnknownVariable</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680069390"><span id="local-6989586621680069420"><span id="local-6989586621680069424"><span class="annot"><span class="annottext">Int -&gt; ToCoreError -&gt; ShowS
[ToCoreError] -&gt; ShowS
ToCoreError -&gt; String
(Int -&gt; ToCoreError -&gt; ShowS)
-&gt; (ToCoreError -&gt; String)
-&gt; ([ToCoreError] -&gt; ShowS)
-&gt; Show ToCoreError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ToCoreError -&gt; ShowS
showsPrec :: Int -&gt; ToCoreError -&gt; ShowS
$cshow :: ToCoreError -&gt; String
show :: ToCoreError -&gt; String
$cshowList :: [ToCoreError] -&gt; ShowS
showList :: [ToCoreError] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680069521"><span id="local-6989586621680069525"><span class="annot"><a href="Elara.Error.html#ReportableError"><span class="hs-identifier hs-type">ReportableError</span></a></span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreError"><span class="hs-identifier hs-type">ToCoreError</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>    </span><span id="local-6989586621680069590"><span class="annot"><span class="annottext">report :: forall (r :: [Effect]).
(DiagnosticWriter (Doc AnsiStyle) :&gt; r) =&gt;
ToCoreError -&gt; Eff r ()
</span><a href="#local-6989586621680069590"><span class="hs-identifier hs-var hs-var hs-var">report</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.ToCore.html#LetInTopLevel"><span class="hs-identifier hs-type">LetInTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Report (Doc AnsiStyle) -&gt; Eff r ()
forall t (es :: [Effect]).
(HasCallStack, DiagnosticWriter t :&gt; es) =&gt;
Report t -&gt; Eff es ()
</span><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier hs-var">writeReport</span></a></span><span> </span><span class="annot"><span class="annottext">(Report (Doc AnsiStyle) -&gt; Eff r ())
-&gt; Report (Doc AnsiStyle) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
-&gt; Doc AnsiStyle
-&gt; [(Position, Marker (Doc AnsiStyle))]
-&gt; [Note (Doc AnsiStyle)]
-&gt; Report (Doc AnsiStyle)
forall msg.
Maybe msg
-&gt; msg -&gt; [(Position, Marker msg)] -&gt; [Note msg] -&gt; Report msg
</span><span class="hs-identifier hs-var">Err</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Maybe (Doc AnsiStyle)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;LetInTopLevel&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;TODO&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="Elara.Error.html#report"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.ToCore.html#UnknownConstructor"><span class="hs-identifier hs-type">UnknownConstructor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680069593"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680069593"><span class="hs-identifier hs-var">qn</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680069594"><span class="annot"><span class="annottext">CtorSymbolTable
</span><a href="#local-6989586621680069594"><span class="hs-identifier hs-var">syms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><span class="annottext">Report (Doc AnsiStyle) -&gt; Eff r ()
forall t (es :: [Effect]).
(HasCallStack, DiagnosticWriter t :&gt; es) =&gt;
Report t -&gt; Eff es ()
</span><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier hs-var">writeReport</span></a></span><span> </span><span class="annot"><span class="annottext">(Report (Doc AnsiStyle) -&gt; Eff r ())
-&gt; Report (Doc AnsiStyle) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-57"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
-&gt; Doc AnsiStyle
-&gt; [(Position, Marker (Doc AnsiStyle))]
-&gt; [Note (Doc AnsiStyle)]
-&gt; Report (Doc AnsiStyle)
forall msg.
Maybe msg
-&gt; msg -&gt; [(Position, Marker msg)] -&gt; [Note msg] -&gt; Report msg
</span><span class="hs-identifier hs-var">Err</span></span><span>
</span><span id="line-58"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Maybe (Doc AnsiStyle)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;UnknownDataConstructor&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Doc AnsiStyle] -&gt; Doc AnsiStyle
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vcat</span></span><span>
</span><span id="line-60"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Qualified TypeName -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680069593"><span class="hs-identifier hs-var">qn</span></a></span><span>
</span><span id="line-61"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Known constructors:&quot;</span></span><span>
</span><span id="line-62"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Doc AnsiStyle] -&gt; Doc AnsiStyle
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vcat</span></span><span> </span><span class="annot"><span class="annottext">([Doc AnsiStyle] -&gt; Doc AnsiStyle)
-&gt; [Doc AnsiStyle] -&gt; Doc AnsiStyle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Qualified Text -&gt; Doc AnsiStyle)
-&gt; [Qualified Text] -&gt; [Doc AnsiStyle]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map (Qualified Text) DataCon -&gt; [Qualified Text]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">M.keys</span></span><span> </span><span class="annot"><span class="annottext">CtorSymbolTable
</span><a href="#local-6989586621680069594"><span class="hs-identifier hs-var">syms</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">dataCons</span><span>
</span><span id="line-63"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-64"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-66"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><a href="Elara.Error.html#report"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.ToCore.html#UnknownPrimConstructor"><span class="hs-identifier hs-type">UnknownPrimConstructor</span></a></span><span> </span><span id="local-6989586621680069598"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680069598"><span class="hs-identifier hs-var">qn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Report (Doc AnsiStyle) -&gt; Eff r ()
forall t (es :: [Effect]).
(HasCallStack, DiagnosticWriter t :&gt; es) =&gt;
Report t -&gt; Eff es ()
</span><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier hs-var">writeReport</span></a></span><span> </span><span class="annot"><span class="annottext">(Report (Doc AnsiStyle) -&gt; Eff r ())
-&gt; Report (Doc AnsiStyle) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
-&gt; Doc AnsiStyle
-&gt; [(Position, Marker (Doc AnsiStyle))]
-&gt; [Note (Doc AnsiStyle)]
-&gt; Report (Doc AnsiStyle)
forall msg.
Maybe msg
-&gt; msg -&gt; [(Position, Marker msg)] -&gt; [Note msg] -&gt; Report msg
</span><span class="hs-identifier hs-var">Err</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Maybe (Doc AnsiStyle)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;UnknownPrimConstructor&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified TypeName -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680069598"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><a href="Elara.Error.html#report"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.ToCore.html#UnknownTypeConstructor"><span class="hs-identifier hs-type">UnknownTypeConstructor</span></a></span><span> </span><span id="local-6989586621680069599"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680069599"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span id="local-6989586621680069600"><span class="annot"><span class="annottext">CtorSymbolTable
</span><a href="#local-6989586621680069600"><span class="hs-identifier hs-var">syms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><span class="annottext">Report (Doc AnsiStyle) -&gt; Eff r ()
forall t (es :: [Effect]).
(HasCallStack, DiagnosticWriter t :&gt; es) =&gt;
Report t -&gt; Eff es ()
</span><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier hs-var">writeReport</span></a></span><span> </span><span class="annot"><span class="annottext">(Report (Doc AnsiStyle) -&gt; Eff r ())
-&gt; Report (Doc AnsiStyle) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-70"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
-&gt; Doc AnsiStyle
-&gt; [(Position, Marker (Doc AnsiStyle))]
-&gt; [Note (Doc AnsiStyle)]
-&gt; Report (Doc AnsiStyle)
forall msg.
Maybe msg
-&gt; msg -&gt; [(Position, Marker msg)] -&gt; [Note msg] -&gt; Report msg
</span><span class="hs-identifier hs-var">Err</span></span><span>
</span><span id="line-71"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Maybe (Doc AnsiStyle)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;UnknownTypeConstructor&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Doc AnsiStyle] -&gt; Doc AnsiStyle
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vcat</span></span><span>
</span><span id="line-73"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680069599"><span class="hs-identifier hs-var">qn</span></a></span><span>
</span><span id="line-74"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Known constructors:&quot;</span></span><span>
</span><span id="line-75"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Doc AnsiStyle] -&gt; Doc AnsiStyle
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vcat</span></span><span> </span><span class="annot"><span class="annottext">([Doc AnsiStyle] -&gt; Doc AnsiStyle)
-&gt; [Doc AnsiStyle] -&gt; Doc AnsiStyle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Qualified Text -&gt; Doc AnsiStyle)
-&gt; [Qualified Text] -&gt; [Doc AnsiStyle]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map (Qualified Text) TyCon -&gt; [Qualified Text]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">M.keys</span></span><span> </span><span class="annot"><span class="annottext">CtorSymbolTable
</span><a href="#local-6989586621680069600"><span class="hs-identifier hs-var">syms</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">tyCons</span><span>
</span><span id="line-76"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-77"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-79"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="Elara.Error.html#report"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.ToCore.html#UnknownLambdaType"><span class="hs-identifier hs-type">UnknownLambdaType</span></a></span><span> </span><span id="local-6989586621680069601"><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680069601"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Report (Doc AnsiStyle) -&gt; Eff r ()
forall t (es :: [Effect]).
(HasCallStack, DiagnosticWriter t :&gt; es) =&gt;
Report t -&gt; Eff es ()
</span><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier hs-var">writeReport</span></a></span><span> </span><span class="annot"><span class="annottext">(Report (Doc AnsiStyle) -&gt; Eff r ())
-&gt; Report (Doc AnsiStyle) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
-&gt; Doc AnsiStyle
-&gt; [(Position, Marker (Doc AnsiStyle))]
-&gt; [Note (Doc AnsiStyle)]
-&gt; Report (Doc AnsiStyle)
forall msg.
Maybe msg
-&gt; msg -&gt; [(Position, Marker msg)] -&gt; [Note msg] -&gt; Report msg
</span><span class="hs-identifier hs-var">Err</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Maybe (Doc AnsiStyle)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;UnknownLambdaType&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
forall a. HasCallStack =&gt; a
</span><a href="TODO.html#todo"><span class="hs-identifier hs-var">todo</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="Elara.Error.html#report"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.ToCore.html#UnsolvedTypeSnuckIn"><span class="hs-identifier hs-type">UnsolvedTypeSnuckIn</span></a></span><span> </span><span id="local-6989586621680069602"><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680069602"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>        </span><span class="annot"><span class="annottext">Report (Doc AnsiStyle) -&gt; Eff r ()
forall t (es :: [Effect]).
(HasCallStack, DiagnosticWriter t :&gt; es) =&gt;
Report t -&gt; Eff es ()
</span><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier hs-var">writeReport</span></a></span><span> </span><span class="annot"><span class="annottext">(Report (Doc AnsiStyle) -&gt; Eff r ())
-&gt; Report (Doc AnsiStyle) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-83"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
-&gt; Doc AnsiStyle
-&gt; [(Position, Marker (Doc AnsiStyle))]
-&gt; [Note (Doc AnsiStyle)]
-&gt; Report (Doc AnsiStyle)
forall msg.
Maybe msg
-&gt; msg -&gt; [(Position, Marker msg)] -&gt; [Note msg] -&gt; Report msg
</span><span class="hs-identifier hs-var">Err</span></span><span>
</span><span id="line-84"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Maybe (Doc AnsiStyle)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;UnsolvedTypeSnuckIn&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Doc AnsiStyle] -&gt; Doc AnsiStyle
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vcat</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Doc AnsiStyle
forall a. HasCallStack =&gt; a
</span><a href="TODO.html#todo"><span class="hs-identifier hs-var">todo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Doc AnsiStyle) -&gt; String -&gt; Doc AnsiStyle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; String
</span><span class="hs-identifier hs-var">prettyCallStack</span></span><span> </span><span class="annot"><span class="annottext">CallStack
HasCallStack =&gt; CallStack
</span><span class="hs-identifier hs-var">callStack</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Position, Marker (Doc AnsiStyle))
forall a. HasCallStack =&gt; a
</span><a href="TODO.html#todo"><span class="hs-identifier hs-var">todo</span></a></span><span>
</span><span id="line-87"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-88"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><a href="Elara.Error.html#report"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.ToCore.html#UnknownVariable"><span class="hs-identifier hs-type">UnknownVariable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680069605"><span class="annot"><span class="annottext">Qualified Name
</span><a href="#local-6989586621680069605"><span class="hs-identifier hs-var">qn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Report (Doc AnsiStyle) -&gt; Eff r ()
forall t (es :: [Effect]).
(HasCallStack, DiagnosticWriter t :&gt; es) =&gt;
Report t -&gt; Eff es ()
</span><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier hs-var">writeReport</span></a></span><span> </span><span class="annot"><span class="annottext">(Report (Doc AnsiStyle) -&gt; Eff r ())
-&gt; Report (Doc AnsiStyle) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
-&gt; Doc AnsiStyle
-&gt; [(Position, Marker (Doc AnsiStyle))]
-&gt; [Note (Doc AnsiStyle)]
-&gt; Report (Doc AnsiStyle)
forall msg.
Maybe msg
-&gt; msg -&gt; [(Position, Marker msg)] -&gt; [Note msg] -&gt; Report msg
</span><span class="hs-identifier hs-var">Err</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Maybe (Doc AnsiStyle)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;UnknownVariable&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Name -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Name
</span><a href="#local-6989586621680069605"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-keyword">data</span><span> </span><span id="CtorSymbolTable"><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-var">CtorSymbolTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CtorSymbolTable"><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-var">CtorSymbolTable</span></a></span></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="dataCons"><span class="annot"><span class="annottext">CtorSymbolTable -&gt; Map (Qualified Text) DataCon
</span><a href="Elara.ToCore.html#dataCons"><span class="hs-identifier hs-var hs-var">dataCons</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tyCons"><span class="annot"><span class="annottext">CtorSymbolTable -&gt; Map (Qualified Text) TyCon
</span><a href="Elara.ToCore.html#tyCons"><span class="hs-identifier hs-var hs-var">tyCons</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.Core.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680069610"><span id="local-6989586621680069619"><span id="local-6989586621680069622"><span class="annot"><span class="annottext">Int -&gt; CtorSymbolTable -&gt; ShowS
[CtorSymbolTable] -&gt; ShowS
CtorSymbolTable -&gt; String
(Int -&gt; CtorSymbolTable -&gt; ShowS)
-&gt; (CtorSymbolTable -&gt; String)
-&gt; ([CtorSymbolTable] -&gt; ShowS)
-&gt; Show CtorSymbolTable
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CtorSymbolTable -&gt; ShowS
showsPrec :: Int -&gt; CtorSymbolTable -&gt; ShowS
$cshow :: CtorSymbolTable -&gt; String
show :: CtorSymbolTable -&gt; String
$cshowList :: [CtorSymbolTable] -&gt; ShowS
showList :: [CtorSymbolTable] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="Elara.ToCore.html#primCtorSymbolTable"><span class="hs-identifier hs-type">primCtorSymbolTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-type">CtorSymbolTable</span></a></span><span>
</span><span id="line-98"></span><span id="primCtorSymbolTable"><span class="annot"><span class="annottext">primCtorSymbolTable :: CtorSymbolTable
</span><a href="Elara.ToCore.html#primCtorSymbolTable"><span class="hs-identifier hs-var hs-var">primCtorSymbolTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">Map (Qualified Text) DataCon
-&gt; Map (Qualified Text) TyCon -&gt; CtorSymbolTable
</span><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-var">CtorSymbolTable</span></a></span><span>
</span><span id="line-100"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Item (Map (Qualified Text) DataCon)]
-&gt; Map (Qualified Text) DataCon
forall l. IsList l =&gt; [Item l] -&gt; l
</span><span class="hs-identifier hs-var">fromList</span></span><span>
</span><span id="line-101"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Text
</span><a href="Elara.Prim.Core.html#trueCtorName"><span class="hs-identifier hs-var">trueCtorName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="Elara.Prim.Core.html#trueCtor"><span class="hs-identifier hs-var">trueCtor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Text
</span><a href="Elara.Prim.Core.html#falseCtorName"><span class="hs-identifier hs-var">falseCtorName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="Elara.Prim.Core.html#falseCtor"><span class="hs-identifier hs-var">falseCtor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Item (Map (Qualified Text) TyCon)] -&gt; Map (Qualified Text) TyCon
forall l. IsList l =&gt; [Item l] -&gt; l
</span><span class="hs-identifier hs-var">fromList</span></span><span>
</span><span id="line-106"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Qualified Text
forall c. c -&gt; Qualified c
</span><a href="Elara.Prim.html#mkPrimQual"><span class="hs-identifier hs-var">mkPrimQual</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;IO&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Elara.Prim.Core.html#ioCon"><span class="hs-identifier hs-var">ioCon</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-107"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span id="local-6989586621680068599"><span class="annot"><a href="Elara.ToCore.html#lookupCtor"><span class="hs-identifier hs-type">lookupCtor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreC"><span class="hs-identifier hs-type">ToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068599"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068599"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span></span><span>
</span><span id="line-110"></span><span id="lookupCtor"><span class="annot"><span class="annottext">lookupCtor :: forall (r :: [Effect]).
ToCoreC r =&gt;
Located (Qualified TypeName) -&gt; Eff r DataCon
</span><a href="Elara.ToCore.html#lookupCtor"><span class="hs-identifier hs-var hs-var">lookupCtor</span></a></span></span><span> </span><span id="local-6989586621680069693"><span class="annot"><span class="annottext">Located (Qualified TypeName)
</span><a href="#local-6989586621680069693"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621680069694"><span class="annot"><a href="#local-6989586621680069694"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
Eff es s
</span><span class="hs-identifier hs-var">get</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-type">CtorSymbolTable</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069696"><span class="annot"><a href="#local-6989586621680069696"><span class="hs-identifier hs-var hs-var">plainName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Text
forall name. NameLike name =&gt; name -&gt; Text
</span><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-var">nameText</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeName -&gt; Text) -&gt; Qualified TypeName -&gt; Qualified Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Located (Qualified TypeName)
</span><a href="#local-6989586621680069693"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Qualified TypeName)
-&gt; Optic'
     A_Lens NoIx (Located (Qualified TypeName)) (Qualified TypeName)
-&gt; Qualified TypeName
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  A_Lens NoIx (Located (Qualified TypeName)) (Qualified TypeName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621680069696"><span class="hs-identifier hs-type">plainName</span></a></span><span> </span><span class="annot"><span class="hs-identifier">table</span></span><span class="hs-operator">.</span><span class="hs-identifier">dataCons</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680069700"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680069700"><span class="hs-identifier hs-var">ctor</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Eff r DataCon
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680069700"><span class="hs-identifier hs-var">ctor</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) (Maybe DataCon)
-&gt; Eff r (Maybe DataCon)
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified TypeName
-&gt; Query (Rock Query : ConsQueryEffects '[]) (Maybe DataCon)
</span><a href="Elara.Query.html#GetDataCon"><span class="hs-identifier hs-var">Elara.Query.GetDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located (Qualified TypeName)
</span><a href="#local-6989586621680069693"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Qualified TypeName)
-&gt; Optic'
     A_Lens NoIx (Located (Qualified TypeName)) (Qualified TypeName)
-&gt; Qualified TypeName
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  A_Lens NoIx (Located (Qualified TypeName)) (Qualified TypeName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eff r (Maybe DataCon) -&gt; Eff r DataCon -&gt; Eff r DataCon
forall (m :: * -&gt; *) b. Monad m =&gt; m (Maybe b) -&gt; m b -&gt; m b
</span><a href="Prelude.html#%3F%3A%21"><span class="hs-operator hs-var">?:!</span></a></span><span> </span><span class="annot"><span class="annottext">ToCoreError -&gt; Eff r DataCon
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located (Qualified TypeName) -&gt; CtorSymbolTable -&gt; ToCoreError
</span><a href="Elara.ToCore.html#UnknownConstructor"><span class="hs-identifier hs-var">UnknownConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Qualified TypeName)
</span><a href="#local-6989586621680069693"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">CtorSymbolTable
</span><a href="#local-6989586621680069694"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span id="local-6989586621680068655"><span class="annot"><a href="Elara.ToCore.html#registerCtor"><span class="hs-identifier hs-type">registerCtor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreC"><span class="hs-identifier hs-type">ToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068655"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068655"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-118"></span><span id="registerCtor"><span class="annot"><span class="annottext">registerCtor :: forall (r :: [Effect]). ToCoreC r =&gt; DataCon -&gt; Eff r ()
</span><a href="Elara.ToCore.html#registerCtor"><span class="hs-identifier hs-var hs-var">registerCtor</span></a></span></span><span> </span><span id="local-6989586621680069751"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680069751"><span class="hs-identifier hs-var">ctor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CtorSymbolTable -&gt; CtorSymbolTable) -&gt; Eff r ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680069753"><span class="annot"><span class="annottext">CtorSymbolTable
</span><a href="#local-6989586621680069753"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtorSymbolTable
</span><a href="#local-6989586621680069753"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.ToCore.html#dataCons"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680069751"><span class="hs-identifier hs-type">ctor</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">field</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;name&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680069751"><span class="hs-identifier hs-type">ctor</span></a></span><span> </span><span class="annot"><span class="hs-identifier">s</span></span><span class="hs-operator">.</span><span class="hs-identifier">dataCons</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span id="local-6989586621680068723"><span class="annot"><a href="Elara.ToCore.html#registerTyCon"><span class="hs-identifier hs-type">registerTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreC"><span class="hs-identifier hs-type">ToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068723"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068723"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-121"></span><span id="registerTyCon"><span class="annot"><span class="annottext">registerTyCon :: forall (r :: [Effect]). ToCoreC r =&gt; TyCon -&gt; Eff r ()
</span><a href="Elara.ToCore.html#registerTyCon"><span class="hs-identifier hs-var hs-var">registerTyCon</span></a></span></span><span> </span><span id="local-6989586621680069765"><span class="annot"><span class="annottext">ctor :: TyCon
</span><a href="#local-6989586621680069765"><span class="hs-identifier hs-var">ctor</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span id="local-6989586621680069767"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680069767"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyConDetails
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CtorSymbolTable -&gt; CtorSymbolTable) -&gt; Eff r ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680069768"><span class="annot"><span class="annottext">CtorSymbolTable
</span><a href="#local-6989586621680069768"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CtorSymbolTable
</span><a href="#local-6989586621680069768"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.ToCore.html#tyCons"><span class="hs-identifier hs-var">tyCons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680069767"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069765"><span class="hs-identifier hs-type">ctor</span></a></span><span> </span><span class="annot"><span class="hs-identifier">s</span></span><span class="hs-operator">.</span><span class="hs-identifier">tyCons</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span id="local-6989586621680068726"><span class="annot"><a href="Elara.ToCore.html#lookupPrimCtor"><span class="hs-identifier hs-type">lookupPrimCtor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreC"><span class="hs-identifier hs-type">ToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068726"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068726"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span></span><span>
</span><span id="line-124"></span><span id="lookupPrimCtor"><span class="annot"><span class="annottext">lookupPrimCtor :: forall (r :: [Effect]).
ToCoreC r =&gt;
Qualified TypeName -&gt; Eff r DataCon
</span><a href="Elara.ToCore.html#lookupPrimCtor"><span class="hs-identifier hs-var hs-var">lookupPrimCtor</span></a></span></span><span> </span><span id="local-6989586621680069810"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680069810"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621680069811"><span class="annot"><a href="#local-6989586621680069811"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
Eff es s
</span><span class="hs-identifier hs-var">get</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-type">CtorSymbolTable</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-type">nameText</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680069810"><span class="hs-identifier hs-type">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier">table</span></span><span class="hs-operator">.</span><span class="hs-identifier">dataCons</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680069812"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680069812"><span class="hs-identifier hs-var">ctor</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Eff r DataCon
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680069812"><span class="hs-identifier hs-var">ctor</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) (Maybe DataCon)
-&gt; Eff r (Maybe DataCon)
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified TypeName
-&gt; Query (Rock Query : ConsQueryEffects '[]) (Maybe DataCon)
</span><a href="Elara.Query.html#GetDataCon"><span class="hs-identifier hs-var">Elara.Query.GetDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680069810"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eff r (Maybe DataCon) -&gt; Eff r DataCon -&gt; Eff r DataCon
forall (m :: * -&gt; *) b. Monad m =&gt; m (Maybe b) -&gt; m b -&gt; m b
</span><a href="Prelude.html#%3F%3A%21"><span class="hs-operator hs-var">?:!</span></a></span><span> </span><span class="annot"><span class="annottext">ToCoreError -&gt; Eff r DataCon
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified TypeName -&gt; ToCoreError
</span><a href="Elara.ToCore.html#UnknownPrimConstructor"><span class="hs-identifier hs-var">UnknownPrimConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680069810"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span id="local-6989586621680068728"><span class="annot"><a href="Elara.ToCore.html#lookupTyCon"><span class="hs-identifier hs-type">lookupTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreC"><span class="hs-identifier hs-type">ToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068728"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068728"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span></span><span>
</span><span id="line-131"></span><span id="lookupTyCon"><span class="annot"><span class="annottext">lookupTyCon :: forall (r :: [Effect]).
(HasCallStack, ToCoreC r) =&gt;
Qualified Text -&gt; Eff r TyCon
</span><a href="Elara.ToCore.html#lookupTyCon"><span class="hs-identifier hs-var hs-var">lookupTyCon</span></a></span></span><span> </span><span id="local-6989586621680069861"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680069861"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r TyCon -&gt; Eff r TyCon
forall (r :: [Effect]) a.
(StructuredDebug :&gt; r, Pretty a) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier hs-var">debugWithResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;lookupTyCon: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680069861"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r TyCon -&gt; Eff r TyCon) -&gt; Eff r TyCon -&gt; Eff r TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621680069863"><span class="annot"><a href="#local-6989586621680069863"><span class="hs-identifier hs-var">table</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
Eff es s
</span><span class="hs-identifier hs-var">get</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-type">CtorSymbolTable</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621680069861"><span class="hs-identifier hs-type">qn</span></a></span><span> </span><span class="annot"><span class="hs-identifier">table</span></span><span class="hs-operator">.</span><span class="hs-identifier">tyCons</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680069864"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680069864"><span class="hs-identifier hs-var">ctor</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Eff r TyCon
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680069864"><span class="hs-identifier hs-var">ctor</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="annottext">Maybe TyCon
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>            </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) (Maybe TyCon)
-&gt; Eff r (Maybe TyCon)
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Text
-&gt; Query (Rock Query : ConsQueryEffects '[]) (Maybe TyCon)
</span><a href="Elara.Query.html#GetTyCon"><span class="hs-identifier hs-var">Elara.Query.GetTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680069861"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eff r (Maybe TyCon) -&gt; Eff r TyCon -&gt; Eff r TyCon
forall (m :: * -&gt; *) b. Monad m =&gt; m (Maybe b) -&gt; m b -&gt; m b
</span><a href="Prelude.html#%3F%3A%21"><span class="hs-operator hs-var">?:!</span></a></span><span> </span><span class="annot"><span class="annottext">ToCoreError -&gt; Eff r TyCon
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Text -&gt; CtorSymbolTable -&gt; ToCoreError
</span><a href="Elara.ToCore.html#UnknownTypeConstructor"><span class="hs-identifier hs-var">UnknownTypeConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680069861"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">CtorSymbolTable
</span><a href="#local-6989586621680069863"><span class="hs-identifier hs-var">table</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="Elara.ToCore.html#runGetDataConQuery"><span class="hs-identifier hs-type">runGetDataConQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span id="runGetDataConQuery"><span class="annot"><span class="annottext">runGetDataConQuery :: Qualified TypeName
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe DataCon)
</span><a href="Elara.ToCore.html#runGetDataConQuery"><span class="hs-identifier hs-var hs-var">runGetDataConQuery</span></a></span></span><span> </span><span id="local-6989586621680070172"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680070172"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe DataCon)
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe DataCon)
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;runGetTyConQuery: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680070172"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff (ConsQueryEffects '[Rock Query]) (Maybe DataCon)
 -&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe DataCon))
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe DataCon)
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe DataCon)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621680070174"><span class="annot"><a href="#local-6989586621680070174"><span class="hs-identifier hs-var">coreModule</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) (CoreModule CoreBind)
-&gt; Eff (ConsQueryEffects '[Rock Query]) (CoreModule CoreBind)
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
-&gt; Query (Rock Query : ConsQueryEffects '[]) (CoreModule CoreBind)
</span><a href="Elara.Query.html#GetCoreModule"><span class="hs-identifier hs-var">Elara.Query.GetCoreModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified TypeName -&gt; ModuleName
forall name. Qualified name -&gt; ModuleName
</span><a href="Elara.AST.Name.html#qualifier"><span class="hs-identifier hs-var">qualifier</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680070172"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680070177"><span class="annot"><a href="#local-6989586621680070177"><span class="hs-identifier hs-var hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreModule CoreBind
</span><a href="#local-6989586621680070174"><span class="hs-identifier hs-var">coreModule</span></a></span><span> </span><span class="annot"><span class="annottext">CoreModule CoreBind
-&gt; Optic'
     A_Traversal (Int : Int : NoIx) (CoreModule CoreBind) DataCon
-&gt; [DataCon]
forall k s (is :: IxList) a.
Is k A_Fold =&gt;
s -&gt; Optic' k is s a -&gt; [a]
</span><span class="hs-operator hs-var">^..</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;declarations&quot;</span></span><span> </span><span class="annot"><span class="annottext">Lens
  (CoreModule CoreBind)
  (CoreModule CoreBind)
  [CoreDeclaration CoreBind]
  [CoreDeclaration CoreBind]
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     [CoreDeclaration CoreBind]
     [CoreDeclaration CoreBind]
     (CoreDeclaration CoreBind)
     (CoreDeclaration CoreBind)
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (CoreModule CoreBind)
     (CoreModule CoreBind)
     (CoreDeclaration CoreBind)
     (CoreDeclaration CoreBind)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  [CoreDeclaration CoreBind]
  [CoreDeclaration CoreBind]
  (CoreDeclaration CoreBind)
  (CoreDeclaration CoreBind)
forall i s t a b. Each i s t a b =&gt; IxTraversal i s t a b
</span><span class="hs-identifier hs-var">each</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (CoreModule CoreBind)
  (CoreModule CoreBind)
  (CoreDeclaration CoreBind)
  (CoreDeclaration CoreBind)
-&gt; Optic
     A_Prism
     NoIx
     (CoreDeclaration CoreBind)
     (CoreDeclaration CoreBind)
     CoreTypeDecl
     CoreTypeDecl
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (CoreModule CoreBind)
     (CoreModule CoreBind)
     CoreTypeDecl
     CoreTypeDecl
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (sel :: k) a s. AsAny sel a s =&gt; Prism s s a a
forall (sel :: Symbol) a s. AsAny sel a s =&gt; Prism s s a a
</span><span class="hs-identifier hs-var">_As</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;CoreType&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (CoreModule CoreBind)
  (CoreModule CoreBind)
  CoreTypeDecl
  CoreTypeDecl
-&gt; Optic
     A_Lens
     NoIx
     CoreTypeDecl
     CoreTypeDecl
     CoreTypeDeclBody
     CoreTypeDeclBody
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (CoreModule CoreBind)
     (CoreModule CoreBind)
     CoreTypeDeclBody
     CoreTypeDeclBody
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s t a b.
HasField field s t a b =&gt;
Lens s t a b
</span><span class="hs-identifier hs-var">field</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;typeBody&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (CoreModule CoreBind)
  (CoreModule CoreBind)
  CoreTypeDeclBody
  CoreTypeDeclBody
-&gt; Optic
     A_Prism
     NoIx
     CoreTypeDeclBody
     CoreTypeDeclBody
     (TyCon, [DataCon])
     (TyCon, [DataCon])
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (CoreModule CoreBind)
     (CoreModule CoreBind)
     (TyCon, [DataCon])
     (TyCon, [DataCon])
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (sel :: k) a s. AsAny sel a s =&gt; Prism s s a a
forall (sel :: Symbol) a s. AsAny sel a s =&gt; Prism s s a a
</span><span class="hs-identifier hs-var">_As</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;CoreDataDecl&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (CoreModule CoreBind)
  (CoreModule CoreBind)
  (TyCon, [DataCon])
  (TyCon, [DataCon])
-&gt; Optic
     A_Lens
     NoIx
     (TyCon, [DataCon])
     (TyCon, [DataCon])
     [DataCon]
     [DataCon]
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (CoreModule CoreBind)
     (CoreModule CoreBind)
     [DataCon]
     [DataCon]
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (TyCon, [DataCon])
  (TyCon, [DataCon])
  [DataCon]
  [DataCon]
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (CoreModule CoreBind)
  (CoreModule CoreBind)
  [DataCon]
  [DataCon]
-&gt; Optic
     A_Traversal (Int : NoIx) [DataCon] [DataCon] DataCon DataCon
-&gt; Optic'
     A_Traversal (Int : Int : NoIx) (CoreModule CoreBind) DataCon
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic A_Traversal (Int : NoIx) [DataCon] [DataCon] DataCon DataCon
forall i s t a b. Each i s t a b =&gt; IxTraversal i s t a b
</span><span class="hs-identifier hs-var">each</span></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680070183"><span class="annot"><a href="#local-6989586621680070183"><span class="hs-identifier hs-var hs-var">matchingDataCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; Bool) -&gt; [DataCon] -&gt; Maybe DataCon
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span id="local-6989586621680070186"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680070186"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680070186"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">(TypeName -&gt; Text) -&gt; Qualified TypeName -&gt; Qualified Text
forall a b. (a -&gt; b) -&gt; Qualified a -&gt; Qualified b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Text
forall name. NameLike name =&gt; name -&gt; Text
</span><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-var">nameText</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680070172"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621680070177"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680070183"><span class="hs-identifier hs-type">matchingDataCon</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><a href="Elara.ToCore.html#runGetTyConQuery"><span class="hs-identifier hs-type">runGetTyConQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Elara.Core.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span id="runGetTyConQuery"><span class="annot"><span class="annottext">runGetTyConQuery :: Qualified Text
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe TyCon)
</span><a href="Elara.ToCore.html#runGetTyConQuery"><span class="hs-identifier hs-var hs-var">runGetTyConQuery</span></a></span></span><span> </span><span id="local-6989586621680070555"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680070555"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe TyCon)
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe TyCon)
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;runGetTyConQuery: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680070555"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff (ConsQueryEffects '[Rock Query]) (Maybe TyCon)
 -&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe TyCon))
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe TyCon)
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Maybe TyCon)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621680070556"><span class="annot"><a href="#local-6989586621680070556"><span class="hs-identifier hs-var">coreModule</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) (CoreModule CoreBind)
-&gt; Eff (ConsQueryEffects '[Rock Query]) (CoreModule CoreBind)
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
-&gt; Query (Rock Query : ConsQueryEffects '[]) (CoreModule CoreBind)
</span><a href="Elara.Query.html#GetCoreModule"><span class="hs-identifier hs-var">Elara.Query.GetCoreModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Text -&gt; ModuleName
forall name. Qualified name -&gt; ModuleName
</span><a href="Elara.AST.Name.html#qualifier"><span class="hs-identifier hs-var">qualifier</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680070555"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680070557"><span class="annot"><a href="#local-6989586621680070557"><span class="hs-identifier hs-var hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreModule CoreBind
</span><a href="#local-6989586621680070556"><span class="hs-identifier hs-var">coreModule</span></a></span><span> </span><span class="annot"><span class="annottext">CoreModule CoreBind
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (CoreModule CoreBind)
     (CoreModule CoreBind)
     CoreTypeDecl
     CoreTypeDecl
-&gt; [CoreTypeDecl]
forall k s (is :: IxList) a.
Is k A_Fold =&gt;
s -&gt; Optic' k is s a -&gt; [a]
</span><span class="hs-operator hs-var">^..</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;declarations&quot;</span></span><span> </span><span class="annot"><span class="annottext">Lens
  (CoreModule CoreBind)
  (CoreModule CoreBind)
  [CoreDeclaration CoreBind]
  [CoreDeclaration CoreBind]
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     [CoreDeclaration CoreBind]
     [CoreDeclaration CoreBind]
     (CoreDeclaration CoreBind)
     (CoreDeclaration CoreBind)
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (CoreModule CoreBind)
     (CoreModule CoreBind)
     (CoreDeclaration CoreBind)
     (CoreDeclaration CoreBind)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  [CoreDeclaration CoreBind]
  [CoreDeclaration CoreBind]
  (CoreDeclaration CoreBind)
  (CoreDeclaration CoreBind)
forall i s t a b. Each i s t a b =&gt; IxTraversal i s t a b
</span><span class="hs-identifier hs-var">each</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (CoreModule CoreBind)
  (CoreModule CoreBind)
  (CoreDeclaration CoreBind)
  (CoreDeclaration CoreBind)
-&gt; Optic
     A_Prism
     NoIx
     (CoreDeclaration CoreBind)
     (CoreDeclaration CoreBind)
     CoreTypeDecl
     CoreTypeDecl
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (CoreModule CoreBind)
     (CoreModule CoreBind)
     CoreTypeDecl
     CoreTypeDecl
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (sel :: k) a s. AsAny sel a s =&gt; Prism s s a a
forall (sel :: Symbol) a s. AsAny sel a s =&gt; Prism s s a a
</span><span class="hs-identifier hs-var">_As</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;CoreType&quot;</span></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680070558"><span class="annot"><a href="#local-6989586621680070558"><span class="hs-identifier hs-var hs-var">matchingDataCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreTypeDecl -&gt; Bool) -&gt; [CoreTypeDecl] -&gt; Maybe CoreTypeDecl
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680070559"><span class="annot"><span class="annottext">CoreTypeDecl
</span><a href="#local-6989586621680070559"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreTypeDecl
</span><a href="#local-6989586621680070559"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">ctdName</span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680070555"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CoreTypeDecl]
</span><a href="#local-6989586621680070557"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Found TyCon: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680070558"><span class="hs-identifier hs-type">matchingDataCon</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; from decls: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680070557"><span class="hs-identifier hs-type">decls</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Module: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680070556"><span class="hs-identifier hs-type">coreModule</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^..</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;declarations&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">%</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">each</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">%</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">_As</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;CoreType&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">%</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">field</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;typeBody&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680070561"><span class="annot"><a href="#local-6989586621680070561"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe CoreTypeDecl
</span><a href="#local-6989586621680070558"><span class="hs-identifier hs-var">matchingDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CoreTypeDecl
-&gt; Optic' An_AffineTraversal NoIx (Maybe CoreTypeDecl) TyCon
-&gt; Maybe TyCon
forall k s (is :: IxList) a.
Is k An_AffineFold =&gt;
s -&gt; Optic' k is s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">Prism
  (Maybe CoreTypeDecl) (Maybe CoreTypeDecl) CoreTypeDecl CoreTypeDecl
forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">Prism
  (Maybe CoreTypeDecl) (Maybe CoreTypeDecl) CoreTypeDecl CoreTypeDecl
-&gt; Optic
     A_Lens
     NoIx
     CoreTypeDecl
     CoreTypeDecl
     CoreTypeDeclBody
     CoreTypeDeclBody
-&gt; Optic
     An_AffineTraversal
     NoIx
     (Maybe CoreTypeDecl)
     (Maybe CoreTypeDecl)
     CoreTypeDeclBody
     CoreTypeDeclBody
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s t a b.
HasField field s t a b =&gt;
Lens s t a b
</span><span class="hs-identifier hs-var">field</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;typeBody&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_AffineTraversal
  NoIx
  (Maybe CoreTypeDecl)
  (Maybe CoreTypeDecl)
  CoreTypeDeclBody
  CoreTypeDeclBody
-&gt; Optic
     A_Prism
     NoIx
     CoreTypeDeclBody
     CoreTypeDeclBody
     (TyCon, [DataCon])
     (TyCon, [DataCon])
-&gt; Optic
     An_AffineTraversal
     NoIx
     (Maybe CoreTypeDecl)
     (Maybe CoreTypeDecl)
     (TyCon, [DataCon])
     (TyCon, [DataCon])
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (sel :: k) a s. AsAny sel a s =&gt; Prism s s a a
forall (sel :: Symbol) a s. AsAny sel a s =&gt; Prism s s a a
</span><span class="hs-identifier hs-var">_As</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;CoreDataDecl&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_AffineTraversal
  NoIx
  (Maybe CoreTypeDecl)
  (Maybe CoreTypeDecl)
  (TyCon, [DataCon])
  (TyCon, [DataCon])
-&gt; Optic
     A_Lens NoIx (TyCon, [DataCon]) (TyCon, [DataCon]) TyCon TyCon
-&gt; Optic' An_AffineTraversal NoIx (Maybe CoreTypeDecl) TyCon
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic A_Lens NoIx (TyCon, [DataCon]) (TyCon, [DataCon]) TyCon TyCon
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680070561"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-keyword">type</span><span> </span><span id="VariableTable"><span class="annot"><a href="Elara.ToCore.html#VariableTable"><span class="hs-identifier hs-var">VariableTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier hs-type">Type.Type</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-keyword">type</span><span> </span><span id="ToCoreEffects"><span class="annot"><a href="Elara.ToCore.html#ToCoreEffects"><span class="hs-identifier hs-var">ToCoreEffects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-type">CtorSymbolTable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreError"><span class="hs-identifier hs-type">ToCoreError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#UniqueGen"><span class="hs-identifier hs-type">UniqueGen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-keyword">type</span><span> </span><span id="InnerToCoreEffects"><span class="annot"><a href="Elara.ToCore.html#InnerToCoreEffects"><span class="hs-identifier hs-var">InnerToCoreEffects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-type">CtorSymbolTable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreError"><span class="hs-identifier hs-type">ToCoreError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#UniqueGen"><span class="hs-identifier hs-type">UniqueGen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-keyword">type</span><span> </span><span id="ToCoreC"><span class="annot"><a href="Elara.ToCore.html#ToCoreC"><span class="hs-identifier hs-var">ToCoreC</span></a></span></span><span> </span><span id="local-6989586621680070568"><span class="annot"><a href="#local-6989586621680070568"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-type">CtorSymbolTable</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680070568"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreError"><span class="hs-identifier hs-type">ToCoreError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680070568"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#UniqueGen"><span class="hs-identifier hs-type">UniqueGen</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680070568"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680070568"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html#QueryEffects"><span class="hs-identifier hs-type">QueryEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680070568"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680070568"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-keyword">type</span><span> </span><span id="InnerToCoreC"><span class="annot"><a href="Elara.ToCore.html#InnerToCoreC"><span class="hs-identifier hs-var">InnerToCoreC</span></a></span></span><span> </span><span id="local-6989586621680070569"><span class="annot"><a href="#local-6989586621680070569"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#CtorSymbolTable"><span class="hs-identifier hs-type">CtorSymbolTable</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680070569"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreError"><span class="hs-identifier hs-type">ToCoreError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680070569"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#UniqueGen"><span class="hs-identifier hs-type">UniqueGen</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680070569"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680070569"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html#QueryEffects"><span class="hs-identifier hs-type">QueryEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680070569"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680070569"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-comment">-- runToCorePipeline :: IsPipeline r =&gt; Eff (EffectsAsPrefixOf ToCoreEffects r) a -&gt; Eff r a</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- runToCorePipeline =</span><span>
</span><span id="line-183"></span><span class="hs-comment">--     inject</span><span>
</span><span id="line-184"></span><span class="hs-comment">--         . uniqueGenToGlobalIO</span><span>
</span><span id="line-185"></span><span class="hs-comment">--         . runErrorOrReport</span><span>
</span><span id="line-186"></span><span class="hs-comment">--         . evalState primCtorSymbolTable</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="annot"><a href="Elara.ToCore.html#runGetCoreModuleQuery"><span class="hs-identifier hs-type">runGetCoreModuleQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><a href="Elara.AST.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span id="runGetCoreModuleQuery"><span class="annot"><span class="annottext">runGetCoreModuleQuery :: ModuleName
-&gt; Eff (ConsQueryEffects '[Rock Query]) (CoreModule CoreBind)
</span><a href="Elara.ToCore.html#runGetCoreModuleQuery"><span class="hs-identifier hs-var hs-var">runGetCoreModuleQuery</span></a></span></span><span> </span><span id="local-6989586621680070657"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680070657"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621680070658"><span class="annot"><a href="#local-6989586621680070658"><span class="hs-identifier hs-var">typedModule</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) (Module 'Typed)
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Module 'Typed)
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
-&gt; Query (Rock Query : ConsQueryEffects '[]) (Module 'Typed)
</span><a href="Elara.Query.html#TypeCheckedModule"><span class="hs-identifier hs-var">Elara.Query.TypeCheckedModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680070657"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-type">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.ToCore.html#ToCoreError"><span class="hs-identifier hs-type">ToCoreError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">evalState</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#primCtorSymbolTable"><span class="hs-identifier hs-type">primCtorSymbolTable</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-194"></span><span>            </span><span class="annot"><a href="Elara.ToCore.html#moduleToCore"><span class="hs-identifier hs-type">moduleToCore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680070658"><span class="hs-identifier hs-type">typedModule</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span id="local-6989586621680068962"><span class="annot"><a href="Elara.ToCore.html#sccToCore"><span class="hs-identifier hs-type">sccToCore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreC"><span class="hs-identifier hs-type">ToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068962"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SCC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068962"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreDeclaration"><span class="hs-identifier hs-type">CoreDeclaration</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-197"></span><span id="sccToCore"><span class="annot"><span class="annottext">sccToCore :: forall (r :: [Effect]).
ToCoreC r =&gt;
SCC (Qualified VarName, TypedExpr)
-&gt; Eff r (CoreDeclaration CoreBind)
</span><a href="Elara.ToCore.html#sccToCore"><span class="hs-identifier hs-var hs-var">sccToCore</span></a></span></span><span> </span><span id="local-6989586621680070753"><span class="annot"><span class="annottext">SCC (Qualified VarName, TypedExpr)
</span><a href="#local-6989586621680070753"><span class="hs-identifier hs-var">scc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SCC (Qualified VarName, TypedExpr)
</span><a href="#local-6989586621680070753"><span class="hs-identifier hs-var">scc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">AcyclicSCC</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680070755"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680070755"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680070756"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680070756"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (CoreDeclaration CoreBind)
-&gt; Eff r (CoreDeclaration CoreBind)
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;sccToCore: AcyclicSCC &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680070755"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (CoreDeclaration CoreBind)
 -&gt; Eff r (CoreDeclaration CoreBind))
-&gt; Eff r (CoreDeclaration CoreBind)
-&gt; Eff r (CoreDeclaration CoreBind)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>            </span><span id="local-6989586621680070757"><span class="annot"><a href="#local-6989586621680070757"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; Eff r CoreExpr
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-var">toCore</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680070756"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-201"></span><span>            </span><span id="local-6989586621680070759"><span class="annot"><a href="#local-6989586621680070759"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-type">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680070756"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">_Unwrapped</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">%</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">_2</span></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680070762"><span class="annot"><a href="#local-6989586621680070762"><span class="hs-identifier hs-var hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text -&gt; Type -&gt; Maybe DataCon -&gt; Var
</span><a href="Elara.Core.html#Id"><span class="hs-identifier hs-var">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
-&gt; UnlocatedVarRef Text
forall (c :: VarRefKind) n.
VarRefImpl c (Qualified n) -&gt; VarRef' c n
</span><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-var">Global</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; Text
forall name. NameLike name =&gt; name -&gt; Text
</span><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-var">nameText</span></a></span><span> </span><span class="annot"><span class="annottext">(VarName -&gt; Text) -&gt; Qualified VarName -&gt; Qualified Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680070755"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680070759"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-203"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreValue"><span class="hs-identifier hs-type">CoreValue</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.Generic.html#NonRecursive"><span class="hs-identifier hs-type">NonRecursive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680070762"><span class="hs-identifier hs-type">var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680070757"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">CyclicSCC</span></span><span> </span><span id="local-6989586621680070767"><span class="annot"><span class="annottext">[(Qualified VarName, TypedExpr)]
</span><a href="#local-6989586621680070767"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (CoreDeclaration CoreBind)
-&gt; Eff r (CoreDeclaration CoreBind)
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;sccToCore: CyclicSCC &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Qualified VarName] -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Qualified VarName, TypedExpr) -&gt; Qualified VarName)
-&gt; [(Qualified VarName, TypedExpr)] -&gt; [Qualified VarName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Qualified VarName, TypedExpr) -&gt; Qualified VarName
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Qualified VarName, TypedExpr)]
</span><a href="#local-6989586621680070767"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (CoreDeclaration CoreBind)
 -&gt; Eff r (CoreDeclaration CoreBind))
-&gt; Eff r (CoreDeclaration CoreBind)
-&gt; Eff r (CoreDeclaration CoreBind)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>            </span><span id="local-6989586621680070769"><span class="annot"><a href="#local-6989586621680070769"><span class="hs-identifier hs-var">binds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Qualified VarName, TypedExpr)]
-&gt; ((Qualified VarName, TypedExpr) -&gt; Eff r (Var, CoreExpr))
-&gt; Eff r [(Var, CoreExpr)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[(Qualified VarName, TypedExpr)]
</span><a href="#local-6989586621680070767"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">(((Qualified VarName, TypedExpr) -&gt; Eff r (Var, CoreExpr))
 -&gt; Eff r [(Var, CoreExpr)])
-&gt; ((Qualified VarName, TypedExpr) -&gt; Eff r (Var, CoreExpr))
-&gt; Eff r [(Var, CoreExpr)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680070771"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680070771"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680070772"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680070772"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>                </span><span id="local-6989586621680070773"><span class="annot"><a href="#local-6989586621680070773"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; Eff r CoreExpr
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-var">toCore</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680070772"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-208"></span><span>                </span><span id="local-6989586621680070774"><span class="annot"><a href="#local-6989586621680070774"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-type">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680070772"><span class="hs-identifier hs-type">expr</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">_Unwrapped</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">%</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">_2</span></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680070775"><span class="annot"><a href="#local-6989586621680070775"><span class="hs-identifier hs-var hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text -&gt; Type -&gt; Maybe DataCon -&gt; Var
</span><a href="Elara.Core.html#Id"><span class="hs-identifier hs-var">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
-&gt; UnlocatedVarRef Text
forall (c :: VarRefKind) n.
VarRefImpl c (Qualified n) -&gt; VarRef' c n
</span><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-var">Global</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; Text
forall name. NameLike name =&gt; name -&gt; Text
</span><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-var">nameText</span></a></span><span> </span><span class="annot"><span class="annottext">(VarName -&gt; Text) -&gt; Qualified VarName -&gt; Qualified Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680070771"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680070774"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-210"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680070775"><span class="hs-identifier hs-type">var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680070773"><span class="hs-identifier hs-type">expr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreValue"><span class="hs-identifier hs-type">CoreValue</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.Generic.html#Recursive"><span class="hs-identifier hs-type">Recursive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680070769"><span class="hs-identifier hs-type">binds'</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-comment">-- Build module-level SCCs once (no duplicates)</span><span>
</span><span id="line-214"></span><span id="local-6989586621680069022"><span class="annot"><a href="Elara.ToCore.html#buildModuleSCCs"><span class="hs-identifier hs-type">buildModuleSCCs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreC"><span class="hs-identifier hs-type">ToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069022"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Module.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Elara.AST.Select.html#Typed"><span class="hs-identifier hs-type">Typed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680069022"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SCC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-215"></span><span id="buildModuleSCCs"><span class="annot"><span class="annottext">buildModuleSCCs :: forall (r :: [Effect]).
ToCoreC r =&gt;
Module 'Typed -&gt; Eff r [SCC (Qualified VarName)]
</span><a href="Elara.ToCore.html#buildModuleSCCs"><span class="hs-identifier hs-var hs-var">buildModuleSCCs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Module.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680071030"><span class="annot"><span class="annottext">Module' 'Typed
</span><a href="#local-6989586621680071030"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680071031"><span class="annot"><span class="annottext">modName :: ModuleName
</span><a href="#local-6989586621680071031"><span class="hs-identifier hs-var hs-var hs-var">modName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module' 'Typed
</span><a href="#local-6989586621680071030"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Module' 'Typed
-&gt; Optic' A_Lens NoIx (Module' 'Typed) ModuleName -&gt; ModuleName
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;name&quot;</span></span><span> </span><span class="annot"><span class="annottext">Lens
  (Module' 'Typed)
  (Module' 'Typed)
  (Located ModuleName)
  (Located ModuleName)
-&gt; Optic
     A_Lens
     NoIx
     (Located ModuleName)
     (Located ModuleName)
     ModuleName
     ModuleName
-&gt; Optic' A_Lens NoIx (Module' 'Typed) ModuleName
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Located ModuleName)
  (Located ModuleName)
  ModuleName
  ModuleName
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680071032"><span class="annot"><span class="annottext">tops :: [Qualified VarName]
</span><a href="#local-6989586621680071032"><span class="hs-identifier hs-var hs-var hs-var">tops</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-218"></span><span>            </span><span class="annot"><span class="annottext">Module' 'Typed
</span><a href="#local-6989586621680071030"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-219"></span><span>                </span><span class="annot"><span class="annottext">Module' 'Typed
-&gt; Optic'
     A_Traversal (Int : NoIx) (Module' 'Typed) (Qualified VarName)
-&gt; [Qualified VarName]
forall k s (is :: IxList) a.
Is k A_Fold =&gt;
s -&gt; Optic' k is s a -&gt; [a]
</span><span class="hs-operator hs-var">^..</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;declarations&quot;</span></span><span>
</span><span id="line-220"></span><span>                </span><span class="annot"><span class="annottext">Lens
  (Module' 'Typed)
  (Module' 'Typed)
  [Declaration 'Typed]
  [Declaration 'Typed]
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     [Declaration 'Typed]
     [Declaration 'Typed]
     (Declaration 'Typed)
     (Declaration 'Typed)
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (Module' 'Typed)
     (Module' 'Typed)
     (Declaration 'Typed)
     (Declaration 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  [Declaration 'Typed]
  [Declaration 'Typed]
  (Declaration 'Typed)
  (Declaration 'Typed)
forall i s t a b. Each i s t a b =&gt; IxTraversal i s t a b
</span><span class="hs-identifier hs-var">each</span></span><span>
</span><span id="line-221"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (Module' 'Typed)
  (Module' 'Typed)
  (Declaration 'Typed)
  (Declaration 'Typed)
-&gt; Optic
     An_Iso
     NoIx
     (Declaration 'Typed)
     (Declaration 'Typed)
     (Located (Declaration' 'Typed))
     (Located (Declaration' 'Typed))
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (Module' 'Typed)
     (Module' 'Typed)
     (Located (Declaration' 'Typed))
     (Located (Declaration' 'Typed))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  NoIx
  (Declaration 'Typed)
  (Declaration 'Typed)
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span>
</span><span id="line-222"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (Module' 'Typed)
  (Module' 'Typed)
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
-&gt; Optic
     A_Lens
     NoIx
     (Located (Declaration' 'Typed))
     (Located (Declaration' 'Typed))
     (Declaration' 'Typed)
     (Declaration' 'Typed)
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (Module' 'Typed)
     (Module' 'Typed)
     (Declaration' 'Typed)
     (Declaration' 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
  (Declaration' 'Typed)
  (Declaration' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-223"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (Module' 'Typed)
  (Module' 'Typed)
  (Declaration' 'Typed)
  (Declaration' 'Typed)
-&gt; Optic
     A_Lens
     NoIx
     (Declaration' 'Typed)
     (Declaration' 'Typed)
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (Module' 'Typed)
     (Module' 'Typed)
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span>
</span><span id="line-224"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (Module' 'Typed)
  (Module' 'Typed)
  (DeclarationBody 'Typed)
  (DeclarationBody 'Typed)
-&gt; Optic
     An_Iso
     NoIx
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (Module' 'Typed)
     (Module' 'Typed)
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  NoIx
  (DeclarationBody 'Typed)
  (DeclarationBody 'Typed)
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span>
</span><span id="line-225"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (Module' 'Typed)
  (Module' 'Typed)
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
-&gt; Optic
     A_Lens
     NoIx
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
     (DeclarationBody' 'Typed)
     (DeclarationBody' 'Typed)
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (Module' 'Typed)
     (Module' 'Typed)
     (DeclarationBody' 'Typed)
     (DeclarationBody' 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
  (DeclarationBody' 'Typed)
  (DeclarationBody' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-226"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (Module' 'Typed)
  (Module' 'Typed)
  (DeclarationBody' 'Typed)
  (DeclarationBody' 'Typed)
-&gt; Optic
     A_Prism
     NoIx
     (DeclarationBody' 'Typed)
     (DeclarationBody' 'Typed)
     (Located (Qualified VarName), TypedExpr, NoFieldValue,
      Type SourceRegion, ValueDeclAnnotations 'Typed)
     (Located (Qualified VarName), TypedExpr, NoFieldValue,
      Type SourceRegion, ValueDeclAnnotations 'Typed)
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (Module' 'Typed)
     (Module' 'Typed)
     (Located (Qualified VarName), TypedExpr, NoFieldValue,
      Type SourceRegion, ValueDeclAnnotations 'Typed)
     (Located (Qualified VarName), TypedExpr, NoFieldValue,
      Type SourceRegion, ValueDeclAnnotations 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (ctor :: Symbol) s a.
AsConstructor' ctor s a =&gt;
Prism s s a a
</span><span class="hs-identifier hs-var">_Ctor'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;Value&quot;</span></span><span>
</span><span id="line-227"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (Module' 'Typed)
  (Module' 'Typed)
  (Located (Qualified VarName), TypedExpr, NoFieldValue,
   Type SourceRegion, ValueDeclAnnotations 'Typed)
  (Located (Qualified VarName), TypedExpr, NoFieldValue,
   Type SourceRegion, ValueDeclAnnotations 'Typed)
-&gt; Optic
     A_Lens
     NoIx
     (Located (Qualified VarName), TypedExpr, NoFieldValue,
      Type SourceRegion, ValueDeclAnnotations 'Typed)
     (Located (Qualified VarName), TypedExpr, NoFieldValue,
      Type SourceRegion, ValueDeclAnnotations 'Typed)
     (Located (Qualified VarName))
     (Located (Qualified VarName))
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (Module' 'Typed)
     (Module' 'Typed)
     (Located (Qualified VarName))
     (Located (Qualified VarName))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Located (Qualified VarName), TypedExpr, NoFieldValue,
   Type SourceRegion, ValueDeclAnnotations 'Typed)
  (Located (Qualified VarName), TypedExpr, NoFieldValue,
   Type SourceRegion, ValueDeclAnnotations 'Typed)
  (Located (Qualified VarName))
  (Located (Qualified VarName))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span>
</span><span id="line-228"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (Module' 'Typed)
  (Module' 'Typed)
  (Located (Qualified VarName))
  (Located (Qualified VarName))
-&gt; Optic
     A_Lens
     NoIx
     (Located (Qualified VarName))
     (Located (Qualified VarName))
     (Qualified VarName)
     (Qualified VarName)
-&gt; Optic'
     A_Traversal (Int : NoIx) (Module' 'Typed) (Qualified VarName)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Located (Qualified VarName))
  (Located (Qualified VarName))
  (Qualified VarName)
  (Qualified VarName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-229"></span><span>    </span><span id="local-6989586621680071034"><span class="annot"><a href="#local-6989586621680071034"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Qualified VarName]
-&gt; (Qualified VarName
    -&gt; Eff
         r (Qualified VarName, Qualified VarName, [Qualified VarName]))
-&gt; Eff
     r [(Qualified VarName, Qualified VarName, [Qualified VarName])]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[Qualified VarName]
</span><a href="#local-6989586621680071032"><span class="hs-identifier hs-var">tops</span></a></span><span> </span><span class="annot"><span class="annottext">((Qualified VarName
  -&gt; Eff
       r (Qualified VarName, Qualified VarName, [Qualified VarName]))
 -&gt; Eff
      r [(Qualified VarName, Qualified VarName, [Qualified VarName])])
-&gt; (Qualified VarName
    -&gt; Eff
         r (Qualified VarName, Qualified VarName, [Qualified VarName]))
-&gt; Eff
     r [(Qualified VarName, Qualified VarName, [Qualified VarName])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680071035"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680071035"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>        </span><span id="local-6989586621680071036"><span class="annot"><a href="#local-6989586621680071036"><span class="hs-identifier hs-var">depsAll</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Query
  (Rock Query : ConsQueryEffects '[]) (HashSet (Qualified VarName))
-&gt; Eff r (HashSet (Qualified VarName))
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified VarName
-&gt; Query
     (Rock Query : ConsQueryEffects '[]) (HashSet (Qualified VarName))
</span><a href="Elara.Query.html#FreeVarsOf"><span class="hs-identifier hs-var">Elara.Query.FreeVarsOf</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680071035"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680071038"><span class="annot"><a href="#local-6989586621680071038"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Qualified VarName -&gt; Bool)
-&gt; [Qualified VarName] -&gt; [Qualified VarName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680071031"><span class="hs-identifier hs-var">modName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; Bool)
-&gt; (Qualified VarName -&gt; ModuleName) -&gt; Qualified VarName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; ModuleName
forall name. Qualified name -&gt; ModuleName
</span><a href="Elara.AST.Name.html#qualifier"><span class="hs-identifier hs-var">qualifier</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet (Qualified VarName) -&gt; [Qualified VarName]
forall a. HashSet a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680071036"><span class="hs-identifier hs-var">depsAll</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680071035"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680071035"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680071038"><span class="hs-identifier hs-type">deps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">stronglyConnComp</span></span><span> </span><span class="annot"><a href="#local-6989586621680071034"><span class="hs-identifier hs-type">nodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span id="local-6989586621680068961"><span class="annot"><a href="Elara.ToCore.html#moduleToCore"><span class="hs-identifier hs-type">moduleToCore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.ToCore.html#ToCoreC"><span class="hs-identifier hs-type">ToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068961"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Module.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Elara.AST.Select.html#Typed"><span class="hs-identifier hs-type">Typed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068961"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-236"></span><span id="moduleToCore"><span class="annot"><span class="annottext">moduleToCore :: forall (r :: [Effect]).
(HasCallStack, ToCoreC r) =&gt;
Module 'Typed -&gt; Eff r (CoreModule CoreBind)
</span><a href="Elara.ToCore.html#moduleToCore"><span class="hs-identifier hs-var hs-var">moduleToCore</span></a></span></span><span> </span><span id="local-6989586621680071599"><span class="annot"><span class="annottext">m' :: Module 'Typed
</span><a href="#local-6989586621680071599"><span class="hs-identifier hs-var">m'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Module.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680071600"><span class="annot"><span class="annottext">Module' 'Typed
</span><a href="#local-6989586621680071600"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (CoreModule CoreBind) -&gt; Eff r (CoreModule CoreBind)
forall (r :: [Effect]) a.
(StructuredDebug :&gt; r, Pretty a) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier hs-var">debugWithResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Converting module: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Located ModuleName -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module' 'Typed
</span><a href="#local-6989586621680071600"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Module' 'Typed
-&gt; Lens
     (Module' 'Typed)
     (Module' 'Typed)
     (Located ModuleName)
     (Located ModuleName)
-&gt; Located ModuleName
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;name&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (CoreModule CoreBind) -&gt; Eff r (CoreModule CoreBind))
-&gt; Eff r (CoreModule CoreBind) -&gt; Eff r (CoreModule CoreBind)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680071601"><span class="annot"><span class="annottext">name :: ModuleName
</span><a href="#local-6989586621680071601"><span class="hs-identifier hs-var hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module' 'Typed
</span><a href="#local-6989586621680071600"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Module' 'Typed
-&gt; Optic' A_Lens NoIx (Module' 'Typed) ModuleName -&gt; ModuleName
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;name&quot;</span></span><span> </span><span class="annot"><span class="annottext">Lens
  (Module' 'Typed)
  (Module' 'Typed)
  (Located ModuleName)
  (Located ModuleName)
-&gt; Optic
     A_Lens
     NoIx
     (Located ModuleName)
     (Located ModuleName)
     ModuleName
     ModuleName
-&gt; Optic' A_Lens NoIx (Module' 'Typed) ModuleName
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Located ModuleName)
  (Located ModuleName)
  ModuleName
  ModuleName
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680071602"><span class="annot"><span class="annottext">declGraph :: TopologicalGraph (Declaration 'Typed)
</span><a href="#local-6989586621680071602"><span class="hs-identifier hs-var hs-var hs-var">declGraph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Declaration 'Typed] -&gt; TopologicalGraph (Declaration 'Typed)
forall a. HasDependencies a =&gt; [a] -&gt; TopologicalGraph a
</span><a href="Elara.Data.TopologicalGraph.html#createGraph"><span class="hs-identifier hs-var">createGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module' 'Typed
</span><a href="#local-6989586621680071600"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Module' 'Typed
-&gt; Lens
     (Module' 'Typed)
     (Module' 'Typed)
     [Declaration 'Typed]
     [Declaration 'Typed]
-&gt; [Declaration 'Typed]
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;declarations&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>    </span><span id="local-6989586621680071604"><span class="annot"><a href="#local-6989586621680071604"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([[CoreDeclaration CoreBind]] -&gt; [CoreDeclaration CoreBind])
-&gt; Eff r [[CoreDeclaration CoreBind]]
-&gt; Eff r [CoreDeclaration CoreBind]
forall a b. (a -&gt; b) -&gt; Eff r a -&gt; Eff r b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[[CoreDeclaration CoreBind]] -&gt; [CoreDeclaration CoreBind]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">(Eff r [[CoreDeclaration CoreBind]]
 -&gt; Eff r [CoreDeclaration CoreBind])
-&gt; Eff r [[CoreDeclaration CoreBind]]
-&gt; Eff r [CoreDeclaration CoreBind]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Declaration 'Typed]
-&gt; (Declaration 'Typed -&gt; Eff r [CoreDeclaration CoreBind])
-&gt; Eff r [[CoreDeclaration CoreBind]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopologicalGraph (Declaration 'Typed) -&gt; [Declaration 'Typed]
forall m. Ord m =&gt; TopologicalGraph m -&gt; [m]
</span><a href="Elara.Data.TopologicalGraph.html#allEntriesRevTopologically"><span class="hs-identifier hs-var">allEntriesRevTopologically</span></a></span><span> </span><span class="annot"><span class="annottext">TopologicalGraph (Declaration 'Typed)
</span><a href="#local-6989586621680071602"><span class="hs-identifier hs-var">declGraph</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Declaration 'Typed -&gt; Eff r [CoreDeclaration CoreBind])
 -&gt; Eff r [[CoreDeclaration CoreBind]])
-&gt; (Declaration 'Typed -&gt; Eff r [CoreDeclaration CoreBind])
-&gt; Eff r [[CoreDeclaration CoreBind]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680071607"><span class="annot"><span class="annottext">Declaration 'Typed
</span><a href="#local-6989586621680071607"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Declaration 'Typed
</span><a href="#local-6989586621680071607"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">Declaration 'Typed
-&gt; Optic'
     A_Lens NoIx (Declaration 'Typed) (DeclarationBody' 'Typed)
-&gt; DeclarationBody' 'Typed
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  NoIx
  (Declaration 'Typed)
  (Declaration 'Typed)
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  NoIx
  (Declaration 'Typed)
  (Declaration 'Typed)
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
-&gt; Optic
     A_Lens
     NoIx
     (Located (Declaration' 'Typed))
     (Located (Declaration' 'Typed))
     (Declaration' 'Typed)
     (Declaration' 'Typed)
-&gt; Optic
     A_Lens
     NoIx
     (Declaration 'Typed)
     (Declaration 'Typed)
     (Declaration' 'Typed)
     (Declaration' 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
  (Declaration' 'Typed)
  (Declaration' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Declaration 'Typed)
  (Declaration 'Typed)
  (Declaration' 'Typed)
  (Declaration' 'Typed)
-&gt; Optic
     A_Lens
     NoIx
     (Declaration' 'Typed)
     (Declaration' 'Typed)
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
-&gt; Optic
     A_Lens
     NoIx
     (Declaration 'Typed)
     (Declaration 'Typed)
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Declaration 'Typed)
  (Declaration 'Typed)
  (DeclarationBody 'Typed)
  (DeclarationBody 'Typed)
-&gt; Optic
     An_Iso
     NoIx
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
-&gt; Optic
     A_Lens
     NoIx
     (Declaration 'Typed)
     (Declaration 'Typed)
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  NoIx
  (DeclarationBody 'Typed)
  (DeclarationBody 'Typed)
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Declaration 'Typed)
  (Declaration 'Typed)
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
-&gt; Optic
     A_Lens
     NoIx
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
     (DeclarationBody' 'Typed)
     (DeclarationBody' 'Typed)
-&gt; Optic'
     A_Lens NoIx (Declaration 'Typed) (DeclarationBody' 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
  (DeclarationBody' 'Typed)
  (DeclarationBody' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-242"></span><span>            </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CoreDeclaration CoreBind] -&gt; Eff r [CoreDeclaration CoreBind]
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-243"></span><span>            </span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypeDeclaration"><span class="hs-identifier hs-type">TypeDeclaration</span></a></span><span> </span><span id="local-6989586621680071610"><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Typed (Select &quot;TypeName&quot; 'Typed))
</span><a href="#local-6989586621680071610"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680071611"><span class="annot"><span class="annottext">[ASTLocate 'Typed (Select &quot;TypeVar&quot; 'Typed)]
</span><a href="#local-6989586621680071611"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#ADT"><span class="hs-identifier hs-type">ADT</span></a></span><span> </span><span id="local-6989586621680071613"><span class="annot"><span class="annottext">NonEmpty
  (CleanupLocated
     (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
   [Select &quot;ADTParam&quot; 'Typed])
</span><a href="#local-6989586621680071613"><span class="hs-identifier hs-var">ctors</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypeDeclAnnotations"><span class="hs-identifier hs-type">TypeDeclAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InfixDeclaration 'Typed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680071615"><span class="annot"><span class="annottext">Select &quot;KindAnnotation&quot; 'Typed
</span><a href="#local-6989586621680071615"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r [CoreDeclaration CoreBind]
-&gt; Eff r [CoreDeclaration CoreBind]
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Type decl: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Typed (Select &quot;TypeName&quot; 'Typed))
-&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Typed (Select &quot;TypeName&quot; 'Typed))
</span><a href="#local-6989586621680071610"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r [CoreDeclaration CoreBind]
 -&gt; Eff r [CoreDeclaration CoreBind])
-&gt; Eff r [CoreDeclaration CoreBind]
-&gt; Eff r [CoreDeclaration CoreBind]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-244"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680071616"><span class="annot"><span class="annottext">cleanedTypeDeclName :: Qualified Text
</span><a href="#local-6989586621680071616"><span class="hs-identifier hs-var hs-var hs-var">cleanedTypeDeclName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Text
forall name. NameLike name =&gt; name -&gt; Text
</span><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-var">nameText</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeName -&gt; Text) -&gt; Qualified TypeName -&gt; Qualified Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located (Qualified TypeName)
CleanupLocated (ASTLocate' 'Typed (Select &quot;TypeName&quot; 'Typed))
</span><a href="#local-6989586621680071610"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Qualified TypeName)
-&gt; Optic'
     A_Lens NoIx (Located (Qualified TypeName)) (Qualified TypeName)
-&gt; Qualified TypeName
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  A_Lens NoIx (Located (Qualified TypeName)) (Qualified TypeName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680071617"><span class="annot"><span class="annottext">tyCon :: TyCon
</span><a href="#local-6989586621680071617"><span class="hs-identifier hs-var hs-var hs-var">tyCon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-246"></span><span>                        </span><span class="annot"><span class="annottext">Qualified Text -&gt; TyConDetails -&gt; TyCon
</span><a href="Elara.Core.html#TyCon"><span class="hs-identifier hs-var">TyCon</span></a></span><span>
</span><span id="line-247"></span><span>                            </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680071616"><span class="hs-identifier hs-var">cleanedTypeDeclName</span></a></span><span>
</span><span id="line-248"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Qualified Text] -&gt; TyConDetails
</span><a href="Elara.Core.html#TyADT"><span class="hs-identifier hs-var">TyADT</span></a></span><span>
</span><span id="line-249"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty
  (CleanupLocated
     (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
   [Select &quot;ADTParam&quot; 'Typed])
</span><a href="#local-6989586621680071613"><span class="hs-identifier hs-var">ctors</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (CleanupLocated
     (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
   [Select &quot;ADTParam&quot; 'Typed])
-&gt; Optic'
     A_Fold
     (Int : NoIx)
     (NonEmpty
        (CleanupLocated
           (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
         [Select &quot;ADTParam&quot; 'Typed]))
     (Qualified Text)
-&gt; [Qualified Text]
forall k s (is :: IxList) a.
Is k A_Fold =&gt;
s -&gt; Optic' k is s a -&gt; [a]
</span><span class="hs-operator hs-var">^..</span></span><span> </span><span class="annot"><span class="annottext">IxTraversal
  Int
  (NonEmpty
     (CleanupLocated
        (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
      [Select &quot;ADTParam&quot; 'Typed]))
  (NonEmpty
     (CleanupLocated
        (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
      [Select &quot;ADTParam&quot; 'Typed]))
  (Located (Qualified TypeName),
   [(Monotype SourceRegion, ElaraKind)])
  (Located (Qualified TypeName),
   [(Monotype SourceRegion, ElaraKind)])
forall i s t a b. Each i s t a b =&gt; IxTraversal i s t a b
</span><span class="hs-identifier hs-var">each</span></span><span> </span><span class="annot"><span class="annottext">IxTraversal
  Int
  (NonEmpty
     (CleanupLocated
        (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
      [Select &quot;ADTParam&quot; 'Typed]))
  (NonEmpty
     (CleanupLocated
        (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
      [Select &quot;ADTParam&quot; 'Typed]))
  (Located (Qualified TypeName),
   [(Monotype SourceRegion, ElaraKind)])
  (Located (Qualified TypeName),
   [(Monotype SourceRegion, ElaraKind)])
-&gt; Optic
     A_Lens
     NoIx
     (Located (Qualified TypeName),
      [(Monotype SourceRegion, ElaraKind)])
     (Located (Qualified TypeName),
      [(Monotype SourceRegion, ElaraKind)])
     (Located (Qualified TypeName))
     (Located (Qualified TypeName))
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (NonEmpty
        (CleanupLocated
           (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
         [Select &quot;ADTParam&quot; 'Typed]))
     (NonEmpty
        (CleanupLocated
           (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
         [Select &quot;ADTParam&quot; 'Typed]))
     (Located (Qualified TypeName))
     (Located (Qualified TypeName))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Located (Qualified TypeName),
   [(Monotype SourceRegion, ElaraKind)])
  (Located (Qualified TypeName),
   [(Monotype SourceRegion, ElaraKind)])
  (Located (Qualified TypeName))
  (Located (Qualified TypeName))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (NonEmpty
     (CleanupLocated
        (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
      [Select &quot;ADTParam&quot; 'Typed]))
  (NonEmpty
     (CleanupLocated
        (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
      [Select &quot;ADTParam&quot; 'Typed]))
  (Located (Qualified TypeName))
  (Located (Qualified TypeName))
-&gt; Optic'
     A_Lens NoIx (Located (Qualified TypeName)) (Qualified TypeName)
-&gt; Optic
     A_Traversal
     (Int : NoIx)
     (NonEmpty
        (CleanupLocated
           (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
         [Select &quot;ADTParam&quot; 'Typed]))
     (NonEmpty
        (CleanupLocated
           (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
         [Select &quot;ADTParam&quot; 'Typed]))
     (Qualified TypeName)
     (Qualified TypeName)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  A_Lens NoIx (Located (Qualified TypeName)) (Qualified TypeName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  (Int : NoIx)
  (NonEmpty
     (CleanupLocated
        (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
      [Select &quot;ADTParam&quot; 'Typed]))
  (NonEmpty
     (CleanupLocated
        (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
      [Select &quot;ADTParam&quot; 'Typed]))
  (Qualified TypeName)
  (Qualified TypeName)
-&gt; Optic
     A_Getter
     NoIx
     (Qualified TypeName)
     (Qualified TypeName)
     (Qualified Text)
     (Qualified Text)
-&gt; Optic'
     A_Fold
     (Int : NoIx)
     (NonEmpty
        (CleanupLocated
           (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
         [Select &quot;ADTParam&quot; 'Typed]))
     (Qualified Text)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">(Qualified TypeName -&gt; Qualified Text)
-&gt; Optic
     A_Getter
     NoIx
     (Qualified TypeName)
     (Qualified TypeName)
     (Qualified Text)
     (Qualified Text)
forall s a. (s -&gt; a) -&gt; Getter s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeName -&gt; Text) -&gt; Qualified TypeName -&gt; Qualified Text
forall a b. (a -&gt; b) -&gt; Qualified a -&gt; Qualified b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">TypeName -&gt; Text
forall name. NameLike name =&gt; name -&gt; Text
</span><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-var">nameText</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>                </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r ()
forall (r :: [Effect]).
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r ()
</span><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680071617"><span class="hs-identifier hs-var">tyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>                </span><span class="annot"><span class="annottext">TyCon -&gt; Eff r ()
forall (r :: [Effect]). ToCoreC r =&gt; TyCon -&gt; Eff r ()
</span><a href="Elara.ToCore.html#registerTyCon"><span class="hs-identifier hs-var">registerTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680071617"><span class="hs-identifier hs-var">tyCon</span></a></span><span>
</span><span id="line-253"></span><span>                </span><span id="local-6989586621680071620"><span class="annot"><a href="#local-6989586621680071620"><span class="hs-identifier hs-var">ctors'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (Located (Qualified TypeName),
   [(Monotype SourceRegion, ElaraKind)])
-&gt; ((Located (Qualified TypeName),
     [(Monotype SourceRegion, ElaraKind)])
    -&gt; Eff r (Qualified Text, Type, TyCon))
-&gt; Eff r (NonEmpty (Qualified Text, Type, TyCon))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty
  (Located (Qualified TypeName),
   [(Monotype SourceRegion, ElaraKind)])
NonEmpty
  (CleanupLocated
     (ASTLocate' 'Typed (Select &quot;ConstructorName&quot; 'Typed)),
   [Select &quot;ADTParam&quot; 'Typed])
</span><a href="#local-6989586621680071613"><span class="hs-identifier hs-var">ctors</span></a></span><span> </span><span class="annot"><span class="annottext">(((Located (Qualified TypeName),
   [(Monotype SourceRegion, ElaraKind)])
  -&gt; Eff r (Qualified Text, Type, TyCon))
 -&gt; Eff r (NonEmpty (Qualified Text, Type, TyCon)))
-&gt; ((Located (Qualified TypeName),
     [(Monotype SourceRegion, ElaraKind)])
    -&gt; Eff r (Qualified Text, Type, TyCon))
-&gt; Eff r (NonEmpty (Qualified Text, Type, TyCon))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680071621"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680071621"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680071622"><span class="annot"><span class="annottext">[(Monotype SourceRegion, ElaraKind)]
</span><a href="#local-6989586621680071622"><span class="hs-identifier hs-var">ctorArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-254"></span><span>                    </span><span id="local-6989586621680071623"><span class="annot"><a href="#local-6989586621680071623"><span class="hs-identifier hs-var">ctorArgs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Monotype SourceRegion, ElaraKind) -&gt; Eff r Type)
-&gt; [(Monotype SourceRegion, ElaraKind)] -&gt; Eff r [Type]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Monotype SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">(Monotype SourceRegion -&gt; Eff r Type)
-&gt; ((Monotype SourceRegion, ElaraKind) -&gt; Monotype SourceRegion)
-&gt; (Monotype SourceRegion, ElaraKind)
-&gt; Eff r Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Monotype SourceRegion, ElaraKind) -&gt; Monotype SourceRegion
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Monotype SourceRegion, ElaraKind)]
</span><a href="#local-6989586621680071622"><span class="hs-identifier hs-var">ctorArgs</span></a></span><span>
</span><span id="line-255"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680071625"><span class="annot"><a href="#local-6989586621680071625"><span class="hs-identifier hs-var hs-var">ctorType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>                            </span><span class="annot"><span class="annottext">(Located UniqueTyVar -&gt; Type -&gt; Type)
-&gt; Type -&gt; [Located UniqueTyVar] -&gt; Type
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span>
</span><span id="line-257"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeVariable -&gt; Type -&gt; Type
</span><a href="Elara.Core.html#ForAllTy"><span class="hs-identifier hs-var">Core.ForAllTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeVariable -&gt; Type -&gt; Type)
-&gt; (Located UniqueTyVar -&gt; TypeVariable)
-&gt; Located UniqueTyVar
-&gt; Type
-&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
Select &quot;TypeVar&quot; 'Typed -&gt; TypeVariable
</span><a href="Elara.ToCore.html#mkTypeVar"><span class="hs-identifier hs-var">mkTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; TypeVariable)
-&gt; (Located UniqueTyVar -&gt; UniqueTyVar)
-&gt; Located UniqueTyVar
-&gt; TypeVariable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx (Located UniqueTyVar) UniqueTyVar
-&gt; Located UniqueTyVar -&gt; UniqueTyVar
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx (Located UniqueTyVar) UniqueTyVar
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; Type -&gt; [Type] -&gt; Type
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span>
</span><span id="line-259"></span><span>                                    </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="Elara.Core.html#FuncTy"><span class="hs-identifier hs-var">Core.FuncTy</span></a></span><span>
</span><span id="line-260"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Located UniqueTyVar -&gt; Type -&gt; Type)
-&gt; Type -&gt; [Located UniqueTyVar] -&gt; Type
forall (f :: * -&gt; *) a b.
Foldable f =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; f a -&gt; b
</span><span class="hs-identifier hs-var">flipfoldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; Type -&gt; Type -&gt; Type
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="Elara.Core.html#AppTy"><span class="hs-identifier hs-var">Core.AppTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type)
-&gt; (Located UniqueTyVar -&gt; Type)
-&gt; Located UniqueTyVar
-&gt; Type
-&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeVariable -&gt; Type
</span><a href="Elara.Core.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeVariable -&gt; Type)
-&gt; (Located UniqueTyVar -&gt; TypeVariable)
-&gt; Located UniqueTyVar
-&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
Select &quot;TypeVar&quot; 'Typed -&gt; TypeVariable
</span><a href="Elara.ToCore.html#mkTypeVar"><span class="hs-identifier hs-var">mkTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; TypeVariable)
-&gt; (Located UniqueTyVar -&gt; UniqueTyVar)
-&gt; Located UniqueTyVar
-&gt; TypeVariable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx (Located UniqueTyVar) UniqueTyVar
-&gt; Located UniqueTyVar -&gt; UniqueTyVar
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx (Located UniqueTyVar) UniqueTyVar
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="Elara.Core.html#ConTy"><span class="hs-identifier hs-var">ConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621680071617"><span class="hs-identifier hs-var">tyCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Located UniqueTyVar]
[ASTLocate 'Typed (Select &quot;TypeVar&quot; 'Typed)]
</span><a href="#local-6989586621680071611"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>                                    </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680071623"><span class="hs-identifier hs-var">ctorArgs'</span></a></span><span>
</span><span id="line-262"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>                                </span><span class="annot"><span class="annottext">[Located UniqueTyVar]
[ASTLocate 'Typed (Select &quot;TypeVar&quot; 'Typed)]
</span><a href="#local-6989586621680071611"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-264"></span><span>                    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Ctor: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071621"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; with type: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071625"><span class="hs-identifier hs-type">ctorType</span></a></span><span>
</span><span id="line-265"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-type">nameText</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680071621"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680071625"><span class="hs-identifier hs-type">ctorType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680071617"><span class="hs-identifier hs-type">tyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680071636"><span class="annot"><a href="#local-6989586621680071636"><span class="hs-identifier hs-var hs-var">ctors''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Qualified Text, Type, TyCon) -&gt; DataCon)
-&gt; NonEmpty (Qualified Text, Type, TyCon) -&gt; NonEmpty DataCon
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Qualified Text -&gt; Type -&gt; TyCon -&gt; DataCon)
-&gt; (Qualified Text, Type, TyCon) -&gt; DataCon
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; (a, b, c) -&gt; d
</span><a href="Elara.Utils.html#uncurry3"><span class="hs-identifier hs-var">uncurry3</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Type -&gt; TyCon -&gt; DataCon
</span><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-var">DataCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Qualified Text, Type, TyCon)
</span><a href="#local-6989586621680071620"><span class="hs-identifier hs-var">ctors'</span></a></span><span>
</span><span id="line-267"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">traverse_</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#registerCtor"><span class="hs-identifier hs-type">registerCtor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071636"><span class="hs-identifier hs-type">ctors''</span></a></span><span>
</span><span id="line-268"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-269"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreType"><span class="hs-identifier hs-type">CoreType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-270"></span><span>                        </span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeDecl"><span class="hs-identifier hs-type">CoreTypeDecl</span></a></span><span>
</span><span id="line-271"></span><span>                            </span><span class="annot"><a href="#local-6989586621680071616"><span class="hs-identifier hs-type">cleanedTypeDeclName</span></a></span><span>
</span><span id="line-272"></span><span>                            </span><span class="annot"><a href="#local-6989586621680071615"><span class="hs-identifier hs-type">kind</span></a></span><span>
</span><span id="line-273"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680071611"><span class="hs-identifier hs-type">tvs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^..</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">each</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">%</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-type">unlocated</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">%</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">to</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#mkTypeVar"><span class="hs-identifier hs-type">mkTypeVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreDataDecl"><span class="hs-identifier hs-type">CoreDataDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071617"><span class="hs-identifier hs-type">tyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">toList</span></span><span> </span><span class="annot"><a href="#local-6989586621680071636"><span class="hs-identifier hs-type">ctors''</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-276"></span><span>            </span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypeDeclaration"><span class="hs-identifier hs-type">TypeDeclaration</span></a></span><span> </span><span id="local-6989586621680071640"><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Typed (Select &quot;TypeName&quot; 'Typed))
</span><a href="#local-6989586621680071640"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680071641"><span class="annot"><span class="annottext">[ASTLocate 'Typed (Select &quot;TypeVar&quot; 'Typed)]
</span><a href="#local-6989586621680071641"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Alias"><span class="hs-identifier hs-type">Alias</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680071643"><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680071643"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ElaraKind
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypeDeclAnnotations"><span class="hs-identifier hs-type">TypeDeclAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InfixDeclaration 'Typed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680071644"><span class="annot"><span class="annottext">Select &quot;KindAnnotation&quot; 'Typed
</span><a href="#local-6989586621680071644"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-277"></span><span>                </span><span class="annot"><a href="TODO.html#todo"><span class="hs-identifier hs-type">todo</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>    </span><span id="local-6989586621680071645"><span class="annot"><a href="#local-6989586621680071645"><span class="hs-identifier hs-var">sccs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.html#buildModuleSCCs"><span class="hs-identifier hs-type">buildModuleSCCs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071599"><span class="hs-identifier hs-type">m'</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621680071646"><span class="annot"><a href="#local-6989586621680071646"><span class="hs-identifier hs-var">valueDecls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">for</span></span><span> </span><span class="annot"><a href="#local-6989586621680071645"><span class="hs-identifier hs-type">sccs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680071647"><span class="annot"><span class="annottext">SCC (Qualified VarName)
</span><a href="#local-6989586621680071647"><span class="hs-identifier hs-var">scc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>        </span><span id="local-6989586621680071648"><span class="annot"><a href="#local-6989586621680071648"><span class="hs-identifier hs-var">members</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SCC (Qualified VarName)
-&gt; (Qualified VarName -&gt; Eff r (Qualified VarName, TypedExpr))
-&gt; Eff r (SCC (Qualified VarName, TypedExpr))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">SCC (Qualified VarName)
</span><a href="#local-6989586621680071647"><span class="hs-identifier hs-var">scc</span></a></span><span> </span><span class="annot"><span class="annottext">((Qualified VarName -&gt; Eff r (Qualified VarName, TypedExpr))
 -&gt; Eff r (SCC (Qualified VarName, TypedExpr)))
-&gt; (Qualified VarName -&gt; Eff r (Qualified VarName, TypedExpr))
-&gt; Eff r (SCC (Qualified VarName, TypedExpr))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680071649"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680071649"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680071649"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypedExpr -&gt; (Qualified VarName, TypedExpr))
-&gt; Eff r TypedExpr -&gt; Eff r (Qualified VarName, TypedExpr)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) TypedExpr
-&gt; Eff r TypedExpr
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified VarName
-&gt; Query (Rock Query : ConsQueryEffects '[]) TypedExpr
</span><a href="Elara.Query.html#TypeCheckedExpr"><span class="hs-identifier hs-var">Elara.Query.TypeCheckedExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680071649"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><a href="Elara.ToCore.html#sccToCore"><span class="hs-identifier hs-type">sccToCore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071648"><span class="hs-identifier hs-type">members</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071601"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680071604"><span class="hs-identifier hs-type">decls</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680071646"><span class="hs-identifier hs-type">valueDecls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="annot"><a href="Elara.ToCore.html#mkTypeVar"><span class="hs-identifier hs-type">mkTypeVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Select"><span class="hs-identifier hs-type">Select</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TypeVar&quot;</span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Elara.AST.Select.html#Typed"><span class="hs-identifier hs-type">Typed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#TypeVariable"><span class="hs-identifier hs-type">Core.TypeVariable</span></a></span><span>
</span><span id="line-286"></span><span id="mkTypeVar"><span class="annot"><span class="annottext">mkTypeVar :: Select &quot;TypeVar&quot; 'Typed -&gt; TypeVariable
</span><a href="Elara.ToCore.html#mkTypeVar"><span class="hs-identifier hs-var hs-var">mkTypeVar</span></a></span></span><span> </span><span id="local-6989586621680071652"><span class="annot"><span class="annottext">Select &quot;TypeVar&quot; 'Typed
</span><a href="#local-6989586621680071652"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; ElaraKind -&gt; TypeVariable
</span><a href="Elara.Core.html#TypeVariable"><span class="hs-identifier hs-var">TypeVariable</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
Select &quot;TypeVar&quot; 'Typed
</span><a href="#local-6989586621680071652"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">ElaraKind
</span><a href="Elara.Data.Kind.html#TypeKind"><span class="hs-identifier hs-var">TypeKind</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span id="local-6989586621680069218"><span class="annot"><a href="Elara.ToCore.html#polytypeToCore"><span class="hs-identifier hs-type">polytypeToCore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.ToCore.html#InnerToCoreC"><span class="hs-identifier hs-type">InnerToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069218"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Type.Polytype</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680069218"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Type"><span class="hs-identifier hs-type">Core.Type</span></a></span></span><span>
</span><span id="line-289"></span><span id="polytypeToCore"><span class="annot"><span class="annottext">polytypeToCore :: forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Polytype SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#polytypeToCore"><span class="hs-identifier hs-var hs-var">polytypeToCore</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Forall"><span class="hs-identifier hs-type">Type.Forall</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680071666"><span class="annot"><span class="annottext">[UniqueTyVar]
</span><a href="#local-6989586621680071666"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621680071667"><span class="annot"><span class="annottext">Constraint SourceRegion
</span><a href="#local-6989586621680071667"><span class="hs-identifier hs-var">constraints</span></a></span></span><span> </span><span id="local-6989586621680071668"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680071668"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>    </span><span id="local-6989586621680071669"><span class="annot"><a href="#local-6989586621680071669"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Monotype SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680071668"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680071670"><span class="annot"><a href="#local-6989586621680071670"><span class="hs-identifier hs-var hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; TypeVariable) -&gt; [UniqueTyVar] -&gt; [TypeVariable]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
Select &quot;TypeVar&quot; 'Typed -&gt; TypeVariable
</span><a href="Elara.ToCore.html#mkTypeVar"><span class="hs-identifier hs-var">mkTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">[UniqueTyVar]
</span><a href="#local-6989586621680071666"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="annot"><a href="Elara.Core.html#ForAllTy"><span class="hs-identifier hs-type">Core.ForAllTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071669"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071670"><span class="hs-identifier hs-type">tvs'</span></a></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span id="local-6989586621680069222"><span class="annot"><a href="Elara.ToCore.html#eitherTypeToCore"><span class="hs-identifier hs-type">eitherTypeToCore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.ToCore.html#InnerToCoreC"><span class="hs-identifier hs-type">InnerToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069222"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier hs-type">Type.Type</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680069222"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Type"><span class="hs-identifier hs-type">Core.Type</span></a></span></span><span>
</span><span id="line-295"></span><span id="eitherTypeToCore"><span class="annot"><span class="annottext">eitherTypeToCore :: forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Type SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#eitherTypeToCore"><span class="hs-identifier hs-var hs-var">eitherTypeToCore</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Type.Polytype</span></a></span><span> </span><span id="local-6989586621680071681"><span class="annot"><span class="annottext">Polytype SourceRegion
</span><a href="#local-6989586621680071681"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Polytype SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Polytype SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#polytypeToCore"><span class="hs-identifier hs-var">polytypeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">Polytype SourceRegion
</span><a href="#local-6989586621680071681"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-296"></span><span class="annot"><a href="Elara.ToCore.html#eitherTypeToCore"><span class="hs-identifier hs-var">eitherTypeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-type">Type.Lifted</span></a></span><span> </span><span id="local-6989586621680071683"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680071683"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Monotype SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680071683"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span id="local-6989586621680069001"><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-type">typeToCore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.ToCore.html#InnerToCoreC"><span class="hs-identifier hs-type">InnerToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069001"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Type.Monotype</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680069001"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Type"><span class="hs-identifier hs-type">Core.Type</span></a></span></span><span>
</span><span id="line-299"></span><span id="typeToCore"><span class="annot"><span class="annottext">typeToCore :: forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Monotype SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var hs-var">typeToCore</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">Type.TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#SkolemVar"><span class="hs-identifier hs-type">Type.SkolemVar</span></a></span><span> </span><span id="local-6989586621680071745"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680071745"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Eff r Type
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Eff r Type) -&gt; Type -&gt; Eff r Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeVariable -&gt; Type
</span><a href="Elara.Core.html#TyVarTy"><span class="hs-identifier hs-var">Core.TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeVariable -&gt; Type) -&gt; TypeVariable -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; ElaraKind -&gt; TypeVariable
</span><a href="Elara.Core.html#TypeVariable"><span class="hs-identifier hs-var">TypeVariable</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680071745"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ElaraKind
</span><a href="Elara.Data.Kind.html#TypeKind"><span class="hs-identifier hs-var">TypeKind</span></a></span><span>
</span><span id="line-300"></span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">Type.TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-type">Type.UnificationVar</span></a></span><span> </span><span id="local-6989586621680071747"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680071747"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Eff r Type
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Eff r Type) -&gt; Type -&gt; Eff r Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeVariable -&gt; Type
</span><a href="Elara.Core.html#TyVarTy"><span class="hs-identifier hs-var">Core.TyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeVariable -&gt; Type) -&gt; TypeVariable -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; ElaraKind -&gt; TypeVariable
</span><a href="Elara.Core.html#TypeVariable"><span class="hs-identifier hs-var">TypeVariable</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680071747"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">ElaraKind
</span><a href="Elara.Data.Kind.html#TypeKind"><span class="hs-identifier hs-var">TypeKind</span></a></span><span>
</span><span id="line-301"></span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Type.Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarInt"><span class="hs-identifier hs-var">Type.ScalarInt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Eff r Type
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Eff r Type) -&gt; Type -&gt; Eff r Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="Elara.Core.html#ConTy"><span class="hs-identifier hs-var">Core.ConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Elara.Prim.Core.html#intCon"><span class="hs-identifier hs-var">intCon</span></a></span><span>
</span><span id="line-302"></span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Type.Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarFloat"><span class="hs-identifier hs-var">Type.ScalarFloat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Eff r Type
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Eff r Type) -&gt; Type -&gt; Eff r Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="Elara.Core.html#ConTy"><span class="hs-identifier hs-var">Core.ConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Elara.Prim.Core.html#floatCon"><span class="hs-identifier hs-var">floatCon</span></a></span><span>
</span><span id="line-303"></span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Type.Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarString"><span class="hs-identifier hs-var">Type.ScalarString</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Eff r Type
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Eff r Type) -&gt; Type -&gt; Eff r Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="Elara.Core.html#ConTy"><span class="hs-identifier hs-var">Core.ConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Elara.Prim.Core.html#stringCon"><span class="hs-identifier hs-var">stringCon</span></a></span><span>
</span><span id="line-304"></span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Type.Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarChar"><span class="hs-identifier hs-var">Type.ScalarChar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Eff r Type
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Eff r Type) -&gt; Type -&gt; Eff r Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="Elara.Core.html#ConTy"><span class="hs-identifier hs-var">Core.ConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Elara.Prim.Core.html#charCon"><span class="hs-identifier hs-var">charCon</span></a></span><span>
</span><span id="line-305"></span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Type.Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarUnit"><span class="hs-identifier hs-var">Type.ScalarUnit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Eff r Type
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Eff r Type) -&gt; Type -&gt; Eff r Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="Elara.Core.html#ConTy"><span class="hs-identifier hs-var">Core.ConTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="Elara.Prim.Core.html#unitCon"><span class="hs-identifier hs-var">unitCon</span></a></span><span>
</span><span id="line-306"></span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Function"><span class="hs-identifier hs-type">Type.Function</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680071760"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680071760"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621680071761"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680071761"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="Elara.Core.html#FuncTy"><span class="hs-identifier hs-var">Core.FuncTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; Eff r Type -&gt; Eff r (Type -&gt; Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Monotype SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680071760"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Eff r (Type -&gt; Type) -&gt; Eff r Type -&gt; Eff r Type
forall a b. Eff r (a -&gt; b) -&gt; Eff r a -&gt; Eff r b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Monotype SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680071761"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-307"></span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeConstructor"><span class="hs-identifier hs-type">Type.TypeConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680071763"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680071763"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span id="local-6989586621680071764"><span class="annot"><span class="annottext">[Monotype SourceRegion]
</span><a href="#local-6989586621680071764"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r Type -&gt; Eff r Type
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Type constructor: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680071763"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot; with args: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Monotype SourceRegion] -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">[Monotype SourceRegion]
</span><a href="#local-6989586621680071764"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r Type -&gt; Eff r Type) -&gt; Eff r Type -&gt; Eff r Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621680071765"><span class="annot"><a href="#local-6989586621680071765"><span class="hs-identifier hs-var">tyCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Eff r TyCon
forall (r :: [Effect]).
(HasCallStack, ToCoreC r) =&gt;
Qualified Text -&gt; Eff r TyCon
</span><a href="Elara.ToCore.html#lookupTyCon"><span class="hs-identifier hs-var">lookupTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeName -&gt; Text) -&gt; Qualified TypeName -&gt; Qualified Text
forall a b. (a -&gt; b) -&gt; Qualified a -&gt; Qualified b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic' An_Iso NoIx TypeName Text -&gt; TypeName -&gt; Text
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Optic' An_Iso NoIx TypeName Text
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680071763"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>    </span><span id="local-6989586621680071766"><span class="annot"><a href="#local-6989586621680071766"><span class="hs-identifier hs-var">ts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-type">typeToCore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071764"><span class="hs-identifier hs-type">ts</span></a></span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldl'</span></span><span> </span><span class="annot"><a href="Elara.Core.html#AppTy"><span class="hs-identifier hs-type">Core.AppTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#ConTy"><span class="hs-identifier hs-type">Core.ConTy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680071765"><span class="hs-identifier hs-type">tyCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680071766"><span class="hs-identifier hs-type">ts'</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span class="annot"><a href="Elara.ToCore.html#conToVar"><span class="hs-identifier hs-type">conToVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span>
</span><span id="line-313"></span><span id="conToVar"><span class="annot"><span class="annottext">conToVar :: DataCon -&gt; Var
</span><a href="Elara.ToCore.html#conToVar"><span class="hs-identifier hs-var hs-var">conToVar</span></a></span></span><span> </span><span id="local-6989586621680071769"><span class="annot"><span class="annottext">dc :: DataCon
</span><a href="#local-6989586621680071769"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">Core.DataCon</span></a></span><span> </span><span id="local-6989586621680071770"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680071770"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680071771"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680071771"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text -&gt; Type -&gt; Maybe DataCon -&gt; Var
</span><a href="Elara.Core.html#Id"><span class="hs-identifier hs-var">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
-&gt; UnlocatedVarRef Text
forall (c :: VarRefKind) n.
VarRefImpl c (Qualified n) -&gt; VarRef' c n
</span><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-var">Global</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680071770"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680071771"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Maybe DataCon
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680071769"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span id="local-6989586621680068999"><span class="annot"><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-type">toCore</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.ToCore.html#InnerToCoreC"><span class="hs-identifier hs-type">InnerToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068999"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068999"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span></span><span>
</span><span id="line-316"></span><span id="toCore"><span class="annot"><span class="annottext">toCore :: forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-var hs-var">toCore</span></a></span></span><span> </span><span id="local-6989586621680071776"><span class="annot"><span class="annottext">le :: TypedExpr
</span><a href="#local-6989586621680071776"><span class="hs-identifier hs-var">le</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680071778"><span class="annot"><span class="annottext">Expr' 'Typed
</span><a href="#local-6989586621680071778"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Select &quot;ExprType&quot; 'Typed
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621680071779"><span class="hs-identifier hs-var">moveTypeApplications</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; CoreExpr) -&gt; Eff r CoreExpr -&gt; Eff r CoreExpr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr' 'Typed -&gt; Eff r CoreExpr
forall (r :: [Effect]).
InnerToCoreC r =&gt;
Expr' 'Typed -&gt; Eff r CoreExpr
</span><a href="#local-6989586621680071780"><span class="hs-identifier hs-var">toCore'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr' 'Typed
</span><a href="#local-6989586621680071778"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-comment">-- \| Move type applications to the left, eg '(f x) @Int' becomes 'f @Int x'</span><span>
</span><span id="line-319"></span><span>    </span><span class="annot"><a href="#local-6989586621680071779"><span class="hs-identifier hs-type">moveTypeApplications</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621680071779"><span class="annot"><span class="annottext">moveTypeApplications :: CoreExpr -&gt; CoreExpr
</span><a href="#local-6989586621680071779"><span class="hs-identifier hs-var hs-var">moveTypeApplications</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#TyApp"><span class="hs-identifier hs-type">Core.TyApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#App"><span class="hs-identifier hs-type">Core.App</span></a></span><span> </span><span id="local-6989586621680071783"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680071783"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680071784"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680071784"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680071785"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680071785"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; CoreExpr -&gt; CoreExpr
forall b. Expr b -&gt; Expr b -&gt; Expr b
</span><a href="Elara.Core.html#App"><span class="hs-identifier hs-var">Core.App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Type -&gt; CoreExpr
forall b. Expr b -&gt; Type -&gt; Expr b
</span><a href="Elara.Core.html#TyApp"><span class="hs-identifier hs-var">Core.TyApp</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680071783"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680071785"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680071784"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="annot"><a href="#local-6989586621680071779"><span class="hs-identifier hs-var">moveTypeApplications</span></a></span><span> </span><span id="local-6989586621680071786"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680071786"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680071786"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621680069233"><span class="annot"><a href="#local-6989586621680071780"><span class="hs-identifier hs-type">toCore'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.ToCore.html#InnerToCoreC"><span class="hs-identifier hs-type">InnerToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069233"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr%27"><span class="hs-identifier hs-type">TypedExpr'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680069233"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span></span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621680071780"><span class="annot"><span class="annottext">toCore' :: forall (r :: [Effect]).
InnerToCoreC r =&gt;
Expr' 'Typed -&gt; Eff r CoreExpr
</span><a href="#local-6989586621680071780"><span class="hs-identifier hs-var hs-var">toCore'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-325"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Int"><span class="hs-identifier hs-type">AST.Int</span></a></span><span> </span><span id="local-6989586621680072571"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680072571"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r CoreExpr
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; Eff r CoreExpr) -&gt; CoreExpr -&gt; Eff r CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="Elara.Core.html#Int"><span class="hs-identifier hs-var">Core.Int</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680072571"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Float"><span class="hs-identifier hs-type">AST.Float</span></a></span><span> </span><span id="local-6989586621680072575"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680072575"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r CoreExpr
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; Eff r CoreExpr) -&gt; CoreExpr -&gt; Eff r CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Literal
</span><a href="Elara.Core.html#Double"><span class="hs-identifier hs-var">Core.Double</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680072575"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#String"><span class="hs-identifier hs-type">AST.String</span></a></span><span> </span><span id="local-6989586621680072578"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680072578"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r CoreExpr
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; Eff r CoreExpr) -&gt; CoreExpr -&gt; Eff r CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Literal
</span><a href="Elara.Core.html#String"><span class="hs-identifier hs-var">Core.String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680072578"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Char"><span class="hs-identifier hs-type">AST.Char</span></a></span><span> </span><span id="local-6989586621680072581"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680072581"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r CoreExpr
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; Eff r CoreExpr) -&gt; CoreExpr -&gt; Eff r CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Literal
</span><a href="Elara.Core.html#Char"><span class="hs-identifier hs-var">Core.Char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680072581"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">Expr' 'Typed
</span><a href="Elara.AST.Generic.Types.html#Unit"><span class="hs-identifier hs-var">AST.Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r CoreExpr
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CoreExpr -&gt; Eff r CoreExpr) -&gt; CoreExpr -&gt; Eff r CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; CoreExpr
forall b. Literal -&gt; Expr b
</span><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-var">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="Elara.Core.html#Unit"><span class="hs-identifier hs-var">Core.Unit</span></a></span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Var"><span class="hs-identifier hs-type">AST.Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680072586"><span class="annot"><span class="annottext">vr :: VarRef VarName
</span><a href="#local-6989586621680072586"><span class="hs-identifier hs-var">vr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span class="annot"><span class="annottext">VarRefImpl LocatedVarRefKind (Qualified VarName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680072587"><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680072587"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>            </span><span id="local-6989586621680072588"><span class="annot"><a href="#local-6989586621680072588"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Type SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#eitherTypeToCore"><span class="hs-identifier hs-var">eitherTypeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680072587"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-type">nameText</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Elara.AST.StripLocation.html#stripLocation"><span class="hs-identifier hs-type">stripLocation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072586"><span class="hs-identifier hs-type">vr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680072588"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Var"><span class="hs-identifier hs-type">AST.Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680072591"><span class="annot"><span class="annottext">v :: VarRef VarName
</span><a href="#local-6989586621680072591"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span class="annot"><span class="annottext">VarRefImpl LocatedVarRefKind (Unique VarName)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680072592"><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680072592"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>            </span><span id="local-6989586621680072593"><span class="annot"><a href="#local-6989586621680072593"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Type SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#eitherTypeToCore"><span class="hs-identifier hs-var">eitherTypeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680072592"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-336"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-type">nameText</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Elara.AST.StripLocation.html#stripLocation"><span class="hs-identifier hs-type">stripLocation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072591"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680072593"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Constructor"><span class="hs-identifier hs-type">AST.Constructor</span></a></span><span> </span><span id="local-6989586621680072595"><span class="annot"><span class="annottext">ASTLocate 'Typed (Select &quot;ConRef&quot; 'Typed)
</span><a href="#local-6989586621680072595"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-338"></span><span>            </span><span id="local-6989586621680072596"><span class="annot"><a href="#local-6989586621680072596"><span class="hs-identifier hs-var">ctor</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Located (Qualified TypeName) -&gt; Eff r DataCon
forall (r :: [Effect]).
ToCoreC r =&gt;
Located (Qualified TypeName) -&gt; Eff r DataCon
</span><a href="Elara.ToCore.html#lookupCtor"><span class="hs-identifier hs-var">lookupCtor</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Qualified TypeName)
ASTLocate 'Typed (Select &quot;ConRef&quot; 'Typed)
</span><a href="#local-6989586621680072595"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-339"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.ToCore.html#conToVar"><span class="hs-identifier hs-type">conToVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072596"><span class="hs-identifier hs-type">ctor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Lambda"><span class="hs-identifier hs-type">AST.Lambda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypedLambdaParam"><span class="hs-identifier hs-type">TypedLambdaParam</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680072599"><span class="annot"><span class="annottext">Unique VarName
</span><a href="#local-6989586621680072599"><span class="hs-identifier hs-var">vn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680072600"><span class="annot"><span class="annottext">Select &quot;PatternType&quot; 'Typed
</span><a href="#local-6989586621680072600"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680072601"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072601"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span>            </span><span id="local-6989586621680072602"><span class="annot"><a href="#local-6989586621680072602"><span class="hs-identifier hs-var">t''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Monotype SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
Select &quot;PatternType&quot; 'Typed
</span><a href="#local-6989586621680072600"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>            </span><span class="annot"><a href="Elara.Core.html#Lam"><span class="hs-identifier hs-type">Core.Lam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-type">nameText</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680072599"><span class="hs-identifier hs-type">vn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680072602"><span class="hs-identifier hs-type">t''</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-type">toCore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072601"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-344"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#FunctionCall"><span class="hs-identifier hs-type">AST.FunctionCall</span></a></span><span> </span><span id="local-6989586621680072605"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072605"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680072606"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072606"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>            </span><span id="local-6989586621680072607"><span class="annot"><a href="#local-6989586621680072607"><span class="hs-identifier hs-var">e1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; Eff r CoreExpr
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-var">toCore</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072605"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-346"></span><span>            </span><span id="local-6989586621680072608"><span class="annot"><a href="#local-6989586621680072608"><span class="hs-identifier hs-var">e2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-type">toCore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072606"><span class="hs-identifier hs-type">e2</span></a></span><span>
</span><span id="line-347"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072607"><span class="hs-identifier hs-type">e1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072608"><span class="hs-identifier hs-type">e2'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypeApplication"><span class="hs-identifier hs-type">AST.TypeApplication</span></a></span><span> </span><span id="local-6989586621680072610"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072610"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680072611"><span class="annot"><span class="annottext">Select &quot;TypeApplication&quot; 'Typed
</span><a href="#local-6989586621680072611"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>            </span><span id="local-6989586621680072612"><span class="annot"><a href="#local-6989586621680072612"><span class="hs-identifier hs-var">e1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; Eff r CoreExpr
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-var">toCore</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072610"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-350"></span><span>            </span><span id="local-6989586621680072613"><span class="annot"><a href="#local-6989586621680072613"><span class="hs-identifier hs-var">t1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-type">typeToCore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072611"><span class="hs-identifier hs-type">t1</span></a></span><span>
</span><span id="line-351"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#TyApp"><span class="hs-identifier hs-type">Core.TyApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072612"><span class="hs-identifier hs-type">e1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072613"><span class="hs-identifier hs-type">t1'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#If"><span class="hs-identifier hs-type">AST.If</span></a></span><span> </span><span id="local-6989586621680072615"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072615"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621680072616"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072616"><span class="hs-identifier hs-var">ifTrue</span></a></span></span><span> </span><span id="local-6989586621680072617"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072617"><span class="hs-identifier hs-var">ifFalse</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>            </span><span id="local-6989586621680072618"><span class="annot"><a href="#local-6989586621680072618"><span class="hs-identifier hs-var">cond'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; Eff r CoreExpr
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-var">toCore</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072615"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-354"></span><span>            </span><span id="local-6989586621680072619"><span class="annot"><a href="#local-6989586621680072619"><span class="hs-identifier hs-var">ifTrue'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-type">toCore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072616"><span class="hs-identifier hs-type">ifTrue</span></a></span><span>
</span><span id="line-355"></span><span>            </span><span id="local-6989586621680072620"><span class="annot"><a href="#local-6989586621680072620"><span class="hs-identifier hs-var">ifFalse'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-type">toCore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072617"><span class="hs-identifier hs-type">ifFalse</span></a></span><span>
</span><span id="line-356"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-357"></span><span>                </span><span class="annot"><a href="Elara.Core.html#Match"><span class="hs-identifier hs-type">Core.Match</span></a></span><span>
</span><span id="line-358"></span><span>                    </span><span class="annot"><a href="#local-6989586621680072618"><span class="hs-identifier hs-type">cond'</span></a></span><span>
</span><span id="line-359"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-360"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataAlt"><span class="hs-identifier hs-type">Core.DataAlt</span></a></span><span> </span><span class="annot"><a href="Elara.Prim.Core.html#trueCtor"><span class="hs-identifier hs-type">trueCtor</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680072619"><span class="hs-identifier hs-type">ifTrue'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataAlt"><span class="hs-identifier hs-type">Core.DataAlt</span></a></span><span> </span><span class="annot"><a href="Elara.Prim.Core.html#falseCtor"><span class="hs-identifier hs-type">falseCtor</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680072620"><span class="hs-identifier hs-type">ifFalse'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-363"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Match"><span class="hs-identifier hs-type">AST.Match</span></a></span><span> </span><span id="local-6989586621680072624"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072624"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680072625"><span class="annot"><span class="annottext">[(Pattern 'Typed, TypedExpr)]
</span><a href="#local-6989586621680072625"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; [(Pattern 'Typed, TypedExpr)] -&gt; Eff r CoreExpr
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; [(Pattern 'Typed, TypedExpr)] -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#desugarMatch"><span class="hs-identifier hs-var">desugarMatch</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072624"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">[(Pattern 'Typed, TypedExpr)]
</span><a href="#local-6989586621680072625"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Let"><span class="hs-identifier hs-type">AST.Let</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ToCoreError -&gt; Eff r CoreExpr
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedExpr -&gt; ToCoreError
</span><a href="Elara.ToCore.html#LetInTopLevel"><span class="hs-identifier hs-var">LetInTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680071776"><span class="hs-identifier hs-var">le</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#LetIn"><span class="hs-identifier hs-type">AST.LetIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680072629"><span class="annot"><span class="annottext">Unique VarName
</span><a href="#local-6989586621680072629"><span class="hs-identifier hs-var">vn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoFieldValue
Select &quot;LetPattern&quot; 'Typed
</span><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier hs-var">NoFieldValue</span></a></span><span> </span><span id="local-6989586621680072631"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072631"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680072632"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072632"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>            </span><span id="local-6989586621680072633"><span class="annot"><a href="#local-6989586621680072633"><span class="hs-identifier hs-var">e1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; Eff r CoreExpr
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-var">toCore</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072631"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-367"></span><span>            </span><span id="local-6989586621680072634"><span class="annot"><a href="#local-6989586621680072634"><span class="hs-identifier hs-var">e2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-type">toCore</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072632"><span class="hs-identifier hs-type">e2</span></a></span><span>
</span><span id="line-368"></span><span>            </span><span class="hs-comment">-- TODO: we need to detect mutually recursive bindings</span><span>
</span><span id="line-369"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680072635"><span class="annot"><a href="#local-6989586621680072635"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
-&gt; UnlocatedVarRef Text
forall (c :: VarRefKind) n. VarRefImpl c (Unique n) -&gt; VarRef' c n
</span><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; Text
forall name. NameLike name =&gt; name -&gt; Text
</span><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-var">nameText</span></a></span><span> </span><span class="annot"><span class="annottext">(VarName -&gt; Text) -&gt; Unique VarName -&gt; Unique Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Unique VarName
</span><a href="#local-6989586621680072629"><span class="hs-identifier hs-var">vn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>            </span><span id="local-6989586621680072636"><span class="annot"><a href="#local-6989586621680072636"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-type">typeToCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#typeOf"><span class="hs-identifier hs-type">typeOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072631"><span class="hs-identifier hs-type">e1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>            </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Let-binding&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072629"><span class="hs-identifier hs-type">vn</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#typeOf"><span class="hs-identifier hs-type">typeOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072631"><span class="hs-identifier hs-type">e1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072633"><span class="hs-identifier hs-type">e1'</span></a></span><span>
</span><span id="line-372"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680072638"><span class="annot"><a href="#local-6989586621680072638"><span class="hs-identifier hs-var hs-var">bindingIsRecursive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique VarName
-&gt; TypedExpr
-&gt; Optic
     An_AffineTraversal
     NoIx
     (VarRef VarName, Type SourceRegion)
     (VarRef VarName, Type SourceRegion)
     (Unique VarName)
     (Unique VarName)
-&gt; Bool
forall {v} {v} {v} {k} {l} {u} {v} {a} {is :: IxList}.
(ErrorUnlessOnlyOne v (Rep v),
 Defined (Rep v) (TypeError ...) (() :: Constraint),
 ErrorUnless &quot;Var&quot; v (HasCtorP &quot;Var&quot; (Rep v)), Is k A_Fold,
 JoinKinds A_Fold l k, GPlate v v, GWrapped (Rep v) (Rep v) u v,
 UnifyHead v v, Field1 u v (Located v) (Located v), Generic v,
 Generic v,
 GAsConstructor &quot;Var&quot; (Rep v) (Rep v) (Located v) (Located v),
 Eq a) =&gt;
a -&gt; v -&gt; Optic l is v v a a -&gt; Bool
</span><a href="Elara.ToCore.html#isRecursive"><span class="hs-identifier hs-var">isRecursive</span></a></span><span> </span><span class="annot"><span class="annottext">Unique VarName
</span><a href="#local-6989586621680072629"><span class="hs-identifier hs-var">vn</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072631"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens
  (VarRef VarName, Type SourceRegion)
  (VarRef VarName, Type SourceRegion)
  (VarRef VarName)
  (VarRef VarName)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Lens
  (VarRef VarName, Type SourceRegion)
  (VarRef VarName, Type SourceRegion)
  (VarRef VarName)
  (VarRef VarName)
-&gt; Optic
     A_Prism
     NoIx
     (VarRef VarName)
     (VarRef VarName)
     (Located (Unique VarName))
     (Located (Unique VarName))
-&gt; Optic
     An_AffineTraversal
     NoIx
     (VarRef VarName, Type SourceRegion)
     (VarRef VarName, Type SourceRegion)
     (Located (Unique VarName))
     (Located (Unique VarName))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (ctor :: Symbol) s a.
AsConstructor' ctor s a =&gt;
Prism s s a a
</span><span class="hs-identifier hs-var">_Ctor'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;Local&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_AffineTraversal
  NoIx
  (VarRef VarName, Type SourceRegion)
  (VarRef VarName, Type SourceRegion)
  (Located (Unique VarName))
  (Located (Unique VarName))
-&gt; Optic
     A_Lens
     NoIx
     (Located (Unique VarName))
     (Located (Unique VarName))
     (Unique VarName)
     (Unique VarName)
-&gt; Optic
     An_AffineTraversal
     NoIx
     (VarRef VarName, Type SourceRegion)
     (VarRef VarName, Type SourceRegion)
     (Unique VarName)
     (Unique VarName)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  NoIx
  (Located (Unique VarName))
  (Located (Unique VarName))
  (Unique VarName)
  (Unique VarName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>            </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Recursive?&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072638"><span class="hs-identifier hs-type">bindingIsRecursive</span></a></span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-375"></span><span>                </span><span class="annot"><a href="Elara.Core.html#Let"><span class="hs-identifier hs-type">Core.Let</span></a></span><span>
</span><span id="line-376"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621680072638"><span class="hs-identifier hs-type">bindingIsRecursive</span></a></span><span>
</span><span id="line-377"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Elara.Core.Generic.html#Recursive"><span class="hs-identifier hs-type">Recursive</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072635"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072636"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680072633"><span class="hs-identifier hs-type">e1'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-378"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Elara.Core.Generic.html#NonRecursive"><span class="hs-identifier hs-type">NonRecursive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072635"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072636"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680072633"><span class="hs-identifier hs-type">e1'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>                    </span><span class="annot"><a href="#local-6989586621680072634"><span class="hs-identifier hs-type">e2'</span></a></span><span>
</span><span id="line-381"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Block"><span class="hs-identifier hs-type">AST.Block</span></a></span><span> </span><span id="local-6989586621680072642"><span class="annot"><span class="annottext">NonEmpty TypedExpr
</span><a href="#local-6989586621680072642"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty TypedExpr -&gt; Eff r CoreExpr
forall (r :: [Effect]).
InnerToCoreC r =&gt;
NonEmpty TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#desugarBlock"><span class="hs-identifier hs-var">desugarBlock</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty TypedExpr
</span><a href="#local-6989586621680072642"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="annot"><span class="hs-comment">{- | Check if a variable is recursive in an expression
Takes the name of the variable, the expression, and a lens to the variable name (Local or Global usually)
-}</span></span><span>
</span><span id="line-386"></span><span id="isRecursive"><span class="annot"><span class="annottext">isRecursive :: a -&gt; v -&gt; Optic l is v v a a -&gt; Bool
</span><a href="Elara.ToCore.html#isRecursive"><span class="hs-identifier hs-var hs-var">isRecursive</span></a></span></span><span> </span><span id="local-6989586621680072707"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680072707"><span class="hs-identifier hs-var">vn</span></a></span></span><span> </span><span id="local-6989586621680072708"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680072708"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680072709"><span class="annot"><span class="annottext">Optic l is v v a a
</span><a href="#local-6989586621680072709"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><span class="annottext">Optic' k is v a -&gt; (a -&gt; Bool) -&gt; v -&gt; Bool
forall k (is :: IxList) s a.
Is k A_Fold =&gt;
Optic' k is s a -&gt; (a -&gt; Bool) -&gt; s -&gt; Bool
</span><span class="hs-identifier hs-var">anyOf</span></span><span>
</span><span id="line-388"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic' A_Traversal NoIx v v -&gt; Fold v v
forall k (is :: IxList) a.
Is k A_Fold =&gt;
Optic' k is a a -&gt; Fold a a
</span><span class="hs-identifier hs-var">cosmosOf</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Traversal NoIx v v
forall a s. GPlate a s =&gt; Traversal' s a
</span><span class="hs-identifier hs-var">gplate</span></span><span> </span><span class="annot"><span class="annottext">Fold v v -&gt; Optic An_Iso NoIx v v u v -&gt; Optic A_Fold NoIx v v u v
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic An_Iso NoIx v v u v
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Optic A_Fold NoIx v v u v
-&gt; Optic A_Lens NoIx u v (Located v) (Located v)
-&gt; Optic A_Fold NoIx v v (Located v) (Located v)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic A_Lens NoIx u v (Located v) (Located v)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Optic A_Fold NoIx v v (Located v) (Located v)
-&gt; Optic A_Lens NoIx (Located v) (Located v) v v
-&gt; Optic A_Fold NoIx v v v v
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic A_Lens NoIx (Located v) (Located v) v v
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Optic A_Fold NoIx v v v v
-&gt; Optic A_Prism NoIx v v (Located v) (Located v)
-&gt; Optic A_Fold NoIx v v (Located v) (Located v)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (ctor :: Symbol) s a.
AsConstructor' ctor s a =&gt;
Prism s s a a
</span><span class="hs-identifier hs-var">_Ctor'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;Var&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic A_Fold NoIx v v (Located v) (Located v)
-&gt; Optic A_Lens NoIx (Located v) (Located v) v v
-&gt; Optic A_Fold NoIx v v v v
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic A_Lens NoIx (Located v) (Located v) v v
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Optic A_Fold NoIx v v v v -&gt; Optic l is v v a a -&gt; Optic' k is v a
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic l is v v a a
</span><a href="#local-6989586621680072709"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680072707"><span class="hs-identifier hs-var">vn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>        </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680072708"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span id="local-6989586621680069305"><span class="annot"><a href="Elara.ToCore.html#desugarMatch"><span class="hs-identifier hs-type">desugarMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.ToCore.html#InnerToCoreC"><span class="hs-identifier hs-type">InnerToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069305"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Typed.html#TypedPattern"><span class="hs-identifier hs-type">TypedPattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680069305"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span></span><span>
</span><span id="line-393"></span><span id="desugarMatch"><span class="annot"><span class="annottext">desugarMatch :: forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; [(Pattern 'Typed, TypedExpr)] -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#desugarMatch"><span class="hs-identifier hs-var hs-var">desugarMatch</span></a></span></span><span> </span><span id="local-6989586621680072785"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072785"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680072786"><span class="annot"><span class="annottext">[(Pattern 'Typed, TypedExpr)]
</span><a href="#local-6989586621680072786"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-comment">-- Scrutinee to Core and bind it to a fresh local, as Core.Match expects.</span><span>
</span><span id="line-395"></span><span>    </span><span id="local-6989586621680072787"><span class="annot"><a href="#local-6989586621680072787"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; Eff r CoreExpr
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-var">toCore</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072785"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;e': &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072787"><span class="hs-identifier hs-type">e'</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621680072788"><span class="annot"><a href="#local-6989586621680072788"><span class="hs-identifier hs-var">s0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.html#mkBindName"><span class="hs-identifier hs-type">mkBindName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072785"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-398"></span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-comment">-- Compile RHSs first; build a 1-column matrix from (pattern, rhsCore).</span><span>
</span><span id="line-400"></span><span>    </span><span id="local-6989586621680072790"><span class="annot"><a href="#local-6989586621680072790"><span class="hs-identifier hs-var">branches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">for</span></span><span> </span><span class="annot"><a href="#local-6989586621680072786"><span class="hs-identifier hs-type">pats</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680072791"><span class="annot"><span class="annottext">Pattern 'Typed
</span><a href="#local-6989586621680072791"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680072792"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072792"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-401"></span><span>        </span><span id="local-6989586621680072793"><span class="annot"><a href="#local-6989586621680072793"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; Eff r CoreExpr
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-var">toCore</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072792"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-402"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680072791"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680072793"><span class="hs-identifier hs-type">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Branches: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072790"><span class="hs-identifier hs-type">branches</span></a></span><span>
</span><span id="line-405"></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680072794"><span class="annot"><a href="#local-6989586621680072794"><span class="hs-identifier hs-var hs-var">matrix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Pattern 'Typed, CoreExpr)] -&gt; PMatrix CoreExpr
forall a. [(Pattern 'Typed, a)] -&gt; PMatrix a
</span><a href="Elara.ToCore.Match.html#buildMatrix1"><span class="hs-identifier hs-var">Match.buildMatrix1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Pattern 'Typed, CoreExpr)]
</span><a href="#local-6989586621680072790"><span class="hs-identifier hs-var">branches</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-comment">-- Fresh locals used for constructor field binders within the matrix compiler.</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680072809"><span class="annot"><a href="#local-6989586621680072809"><span class="hs-identifier hs-var hs-var">freshLocal</span></a></span></span><span> </span><span id="local-6989586621680072810"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680072810"><span class="hs-identifier hs-var">base</span></a></span></span><span> </span><span id="local-6989586621680072811"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680072811"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r Var -&gt; Eff r Var
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;freshLocal: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Text, Type) -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680072810"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680072811"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r Var -&gt; Eff r Var) -&gt; Eff r Var -&gt; Eff r Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>            </span><span id="local-6989586621680072812"><span class="annot"><a href="#local-6989586621680072812"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r (Unique Text)
forall (r :: [Effect]) a. (UniqueGen :&gt; r) =&gt; a -&gt; Eff r (Unique a)
</span><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier hs-var">makeUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680072810"><span class="hs-identifier hs-var">base</span></a></span><span>
</span><span id="line-411"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072812"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680072811"><span class="hs-identifier hs-type">ty</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>    </span><span id="local-6989586621680072814"><span class="annot"><a href="#local-6989586621680072814"><span class="hs-identifier hs-var">compiled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.ToCore.Match.html#compileMatrix"><span class="hs-identifier hs-type">Match.compileMatrix</span></a></span><span> </span><span class="annot"><a href="Elara.ToCore.html#lookupPrimCtor"><span class="hs-identifier hs-type">lookupPrimCtor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072809"><span class="hs-identifier hs-type">freshLocal</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680072788"><span class="hs-identifier hs-type">s0</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680072794"><span class="hs-identifier hs-type">matrix</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-comment">-- Bind the scrutinee to s0 before the compiled match to avoid a redundant DEFAULT match.</span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Core.html#Let"><span class="hs-identifier hs-type">Core.Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#NonRecursive"><span class="hs-identifier hs-type">NonRecursive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680072788"><span class="hs-identifier hs-type">s0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680072787"><span class="hs-identifier hs-type">e'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680072814"><span class="hs-identifier hs-type">compiled</span></a></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span id="local-6989586621680069346"><span class="annot"><a href="Elara.ToCore.html#mkBindName"><span class="hs-identifier hs-type">mkBindName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.ToCore.html#InnerToCoreC"><span class="hs-identifier hs-type">InnerToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069346"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680069346"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span></span><span>
</span><span id="line-419"></span><span id="mkBindName"><span class="annot"><span class="annottext">mkBindName :: forall (r :: [Effect]). InnerToCoreC r =&gt; TypedExpr -&gt; Eff r Var
</span><a href="Elara.ToCore.html#mkBindName"><span class="hs-identifier hs-var hs-var">mkBindName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Var"><span class="hs-identifier hs-type">AST.Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680072838"><span class="annot"><span class="annottext">VarRef VarName
</span><a href="#local-6989586621680072838"><span class="hs-identifier hs-var">vn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680072839"><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680072839"><span class="hs-identifier hs-var">varType</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680072840"><span class="annot"><span class="annottext">Select &quot;ExprType&quot; 'Typed
</span><a href="#local-6989586621680072840"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-420"></span><span>    </span><span id="local-6989586621680072841"><span class="annot"><a href="#local-6989586621680072841"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Type SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#eitherTypeToCore"><span class="hs-identifier hs-var">eitherTypeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680072839"><span class="hs-identifier hs-var">varType</span></a></span><span>
</span><span id="line-421"></span><span>    </span><span id="local-6989586621680072842"><span class="annot"><a href="#local-6989586621680072842"><span class="hs-identifier hs-var">unique</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier hs-type">makeUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-type">nameText</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html#varRefVal"><span class="hs-identifier hs-type">varRefVal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072838"><span class="hs-identifier hs-type">vn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072842"><span class="hs-identifier hs-type">unique</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680072841"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span class="annot"><a href="Elara.ToCore.html#mkBindName"><span class="hs-identifier hs-var">mkBindName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Expr"><span class="hs-identifier hs-type">AST.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASTLocate 'Typed (Expr' 'Typed)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680072843"><span class="annot"><span class="annottext">Select &quot;ExprType&quot; 'Typed
</span><a href="#local-6989586621680072843"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>    </span><span id="local-6989586621680072844"><span class="annot"><a href="#local-6989586621680072844"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Eff r Type
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
Monotype SourceRegion -&gt; Eff r Type
</span><a href="Elara.ToCore.html#typeToCore"><span class="hs-identifier hs-var">typeToCore</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
Select &quot;ExprType&quot; 'Typed
</span><a href="#local-6989586621680072843"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621680072845"><span class="annot"><a href="#local-6989586621680072845"><span class="hs-identifier hs-var">unique</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier hs-type">makeUnique</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;bind&quot;</span></span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680072845"><span class="hs-identifier hs-type">unique</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680072844"><span class="hs-identifier hs-type">t'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span id="local-6989586621680069318"><span class="annot"><a href="Elara.ToCore.html#desugarBlock"><span class="hs-identifier hs-type">desugarBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.ToCore.html#InnerToCoreC"><span class="hs-identifier hs-type">InnerToCoreC</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069318"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680069318"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span></span><span>
</span><span id="line-429"></span><span id="desugarBlock"><span class="annot"><span class="annottext">desugarBlock :: forall (r :: [Effect]).
InnerToCoreC r =&gt;
NonEmpty TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#desugarBlock"><span class="hs-identifier hs-var hs-var">desugarBlock</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680072857"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072857"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; Eff r CoreExpr
forall (r :: [Effect]).
(HasCallStack, InnerToCoreC r) =&gt;
TypedExpr -&gt; Eff r CoreExpr
</span><a href="Elara.ToCore.html#toCore"><span class="hs-identifier hs-var">toCore</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680072857"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-430"></span><span class="annot"><a href="Elara.ToCore.html#desugarBlock"><span class="hs-identifier hs-var">desugarBlock</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty TypedExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r CoreExpr
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;todo&quot;</span></span><span>
</span><span id="line-431"></span></pre></body></html>