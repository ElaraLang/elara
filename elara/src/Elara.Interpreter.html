<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | Simple interpreter for the Core language</span></span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Elara.Interpreter.html"><span class="hs-identifier">Elara.Interpreter</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.Error.Static</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Effectful.State.Extra.html"><span class="hs-identifier">Effectful.State.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Effectful.State.Extra.html#scoped"><span class="hs-identifier">scoped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.State.Static.Local</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Name.html"><span class="hs-identifier">Elara.AST.Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#ModuleName"><span class="hs-identifier">ModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier">Qualified</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html"><span class="hs-identifier">Elara.AST.VarRef</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.html"><span class="hs-identifier">Elara.Core</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Literal"><span class="hs-identifier">Literal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.html"><span class="hs-identifier">Elara.Core</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Core</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.Generic.html"><span class="hs-identifier">Elara.Core.Generic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#Bind"><span class="hs-identifier">Bind</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.Module.html"><span class="hs-identifier">Elara.Core.Module</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html"><span class="hs-identifier">Elara.Data.Pretty</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.Styles.html"><span class="hs-identifier">Elara.Data.Pretty.Styles</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Style</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Unique.html"><span class="hs-identifier">Elara.Data.Unique</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Error.html"><span class="hs-identifier">Elara.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Error.html#ReportableError"><span class="hs-identifier">ReportableError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier">runErrorOrReport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Logging.html"><span class="hs-identifier">Elara.Logging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier">StructuredDebug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier">debug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#debugWith"><span class="hs-identifier">debugWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#ignoreStructuredDebug"><span class="hs-identifier">ignoreStructuredDebug</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Prim.Core.html"><span class="hs-identifier">Elara.Prim.Core</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Prim.Core.html#consCtorName"><span class="hs-identifier">consCtorName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Prim.Core.html#emptyListCtorName"><span class="hs-identifier">emptyListCtorName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Prim.Core.html#falseCtor"><span class="hs-identifier">falseCtor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Prim.Core.html#fetchPrimitiveName"><span class="hs-identifier">fetchPrimitiveName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Prim.Core.html#trueCtor"><span class="hs-identifier">trueCtor</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Prim.Core.html#tuple2CtorName"><span class="hs-identifier">tuple2CtorName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Prim.Core.html#unitCtor"><span class="hs-identifier">unitCtor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Query.html"><span class="hs-identifier">Elara.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html"><span class="hs-identifier">Elara.Query.Effects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier">ConsQueryEffects</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html#QueryEffects"><span class="hs-identifier">QueryEffects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Rock.html"><span class="hs-identifier">Rock</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">force</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">type</span><span> </span><span id="Interpreter"><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-var">Interpreter</span></a></span></span><span> </span><span id="local-6989586621680064386"><span class="annot"><a href="#local-6989586621680064386"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#ElaraState"><span class="hs-identifier hs-type">ElaraState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680064386"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#InterpreterError"><span class="hs-identifier hs-type">InterpreterError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680064386"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html#QueryEffects"><span class="hs-identifier hs-type">QueryEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064386"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680064386"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680064386"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOE</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680064386"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">type</span><span> </span><span id="InterpreterEffects"><span class="annot"><a href="Elara.Interpreter.html#InterpreterEffects"><span class="hs-identifier hs-var">InterpreterEffects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#ElaraState"><span class="hs-identifier hs-type">ElaraState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#InterpreterError"><span class="hs-identifier hs-type">InterpreterError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IOE</span></span><span class="hs-special">]</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">data</span><span> </span><span id="ElaraState"><span class="annot"><a href="Elara.Interpreter.html#ElaraState"><span class="hs-identifier hs-var">ElaraState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ElaraState"><span class="annot"><a href="Elara.Interpreter.html#ElaraState"><span class="hs-identifier hs-var">ElaraState</span></a></span></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="globalBindings"><span class="annot"><span class="annottext">ElaraState -&gt; Map (Qualified Text) Value
</span><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var hs-var">globalBindings</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="localBindings"><span class="annot"><span class="annottext">ElaraState -&gt; Map (Unique Text) Value
</span><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var hs-var">localBindings</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="loadedModules"><span class="annot"><span class="annottext">ElaraState -&gt; Set ModuleName
</span><a href="Elara.Interpreter.html#loadedModules"><span class="hs-identifier hs-var hs-var">loadedModules</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="stateSource"><span class="annot"><span class="annottext">ElaraState -&gt; StateSource
</span><a href="Elara.Interpreter.html#stateSource"><span class="hs-identifier hs-var hs-var">stateSource</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#StateSource"><span class="hs-identifier hs-type">StateSource</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680064393"><span id="local-6989586621680064395"><span class="annot"><span class="annottext">(forall x. ElaraState -&gt; Rep ElaraState x)
-&gt; (forall x. Rep ElaraState x -&gt; ElaraState) -&gt; Generic ElaraState
forall x. Rep ElaraState x -&gt; ElaraState
forall x. ElaraState -&gt; Rep ElaraState x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. ElaraState -&gt; Rep ElaraState x
from :: forall x. ElaraState -&gt; Rep ElaraState x
$cto :: forall x. Rep ElaraState x -&gt; ElaraState
to :: forall x. Rep ElaraState x -&gt; ElaraState
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680064401"><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#ElaraState"><span class="hs-identifier hs-type">ElaraState</span></a></span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">data</span><span> </span><span id="StateSource"><span class="annot"><a href="Elara.Interpreter.html#StateSource"><span class="hs-identifier hs-var">StateSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FromGlobal"><span class="annot"><a href="Elara.Interpreter.html#FromGlobal"><span class="hs-identifier hs-var">FromGlobal</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="FromClosure"><span class="annot"><a href="Elara.Interpreter.html#FromClosure"><span class="hs-identifier hs-var">FromClosure</span></a></span></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680064477"><span id="local-6989586621680064479"><span class="annot"><span class="annottext">(forall x. StateSource -&gt; Rep StateSource x)
-&gt; (forall x. Rep StateSource x -&gt; StateSource)
-&gt; Generic StateSource
forall x. Rep StateSource x -&gt; StateSource
forall x. StateSource -&gt; Rep StateSource x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. StateSource -&gt; Rep StateSource x
from :: forall x. StateSource -&gt; Rep StateSource x
$cto :: forall x. Rep StateSource x -&gt; StateSource
to :: forall x. Rep StateSource x -&gt; StateSource
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680064482"><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#StateSource"><span class="hs-identifier hs-type">StateSource</span></a></span></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">data</span><span> </span><span id="InterpreterError"><span class="annot"><a href="Elara.Interpreter.html#InterpreterError"><span class="hs-identifier hs-var">InterpreterError</span></a></span></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="UnboundVariable"><span class="annot"><a href="Elara.Interpreter.html#UnboundVariable"><span class="hs-identifier hs-var">UnboundVariable</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#UnlocatedVarRef"><span class="hs-identifier hs-type">UnlocatedVarRef</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#ElaraState"><span class="hs-identifier hs-type">ElaraState</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NotAFunction"><span class="annot"><a href="Elara.Interpreter.html#NotAFunction"><span class="hs-identifier hs-var">NotAFunction</span></a></span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnknownPrimitive"><span class="annot"><a href="Elara.Interpreter.html#UnknownPrimitive"><span class="hs-identifier hs-var">UnknownPrimitive</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnhandledExpr"><span class="annot"><a href="Elara.Interpreter.html#UnhandledExpr"><span class="hs-identifier hs-var">UnhandledExpr</span></a></span></span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NonExhaustiveMatch"><span class="annot"><a href="Elara.Interpreter.html#NonExhaustiveMatch"><span class="hs-identifier hs-var">NonExhaustiveMatch</span></a></span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.Core.html#Alt"><span class="hs-identifier hs-type">Core.Alt</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NoMainFound"><span class="annot"><a href="Elara.Interpreter.html#NoMainFound"><span class="hs-identifier hs-var">NoMainFound</span></a></span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#ElaraState"><span class="hs-identifier hs-type">ElaraState</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TypeMismatch"><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a></span></span><span>
</span><span id="line-60"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="expected"><span class="annot"><span class="annottext">InterpreterError -&gt; Text
</span><a href="Elara.Interpreter.html#expected"><span class="hs-identifier hs-var hs-var">expected</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-61"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="actual"><span class="annot"><span class="annottext">InterpreterError -&gt; Value
</span><a href="Elara.Interpreter.html#actual"><span class="hs-identifier hs-var hs-var">actual</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-62"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CodeThrewError"><span class="annot"><a href="Elara.Interpreter.html#CodeThrewError"><span class="hs-identifier hs-var">CodeThrewError</span></a></span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="RecursiveValueDetected"><span class="annot"><a href="Elara.Interpreter.html#RecursiveValueDetected"><span class="hs-identifier hs-var">RecursiveValueDetected</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680064512"><span id="local-6989586621680064514"><span class="annot"><span class="annottext">(forall x. InterpreterError -&gt; Rep InterpreterError x)
-&gt; (forall x. Rep InterpreterError x -&gt; InterpreterError)
-&gt; Generic InterpreterError
forall x. Rep InterpreterError x -&gt; InterpreterError
forall x. InterpreterError -&gt; Rep InterpreterError x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. InterpreterError -&gt; Rep InterpreterError x
from :: forall x. InterpreterError -&gt; Rep InterpreterError x
$cto :: forall x. Rep InterpreterError x -&gt; InterpreterError
to :: forall x. Rep InterpreterError x -&gt; InterpreterError
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">data</span><span> </span><span id="ThunkState"><span class="annot"><a href="Elara.Interpreter.html#ThunkState"><span class="hs-identifier hs-var">ThunkState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Unevaluated"><span class="annot"><a href="Elara.Interpreter.html#Unevaluated"><span class="hs-identifier hs-var">Unevaluated</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Evaluating"><span class="annot"><a href="Elara.Interpreter.html#Evaluating"><span class="hs-identifier hs-var">Evaluating</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Evaluated"><span class="annot"><a href="Elara.Interpreter.html#Evaluated"><span class="hs-identifier hs-var">Evaluated</span></a></span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680064520"><span id="local-6989586621680064522"><span class="annot"><span class="annottext">(forall x. ThunkState -&gt; Rep ThunkState x)
-&gt; (forall x. Rep ThunkState x -&gt; ThunkState) -&gt; Generic ThunkState
forall x. Rep ThunkState x -&gt; ThunkState
forall x. ThunkState -&gt; Rep ThunkState x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. ThunkState -&gt; Rep ThunkState x
from :: forall x. ThunkState -&gt; Rep ThunkState x
$cto :: forall x. Rep ThunkState x -&gt; ThunkState
to :: forall x. Rep ThunkState x -&gt; ThunkState
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#InterpreterError"><span class="hs-identifier hs-type">InterpreterError</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621680064625"><span class="annot"><span class="annottext">pretty :: InterpreterError -&gt; Doc AnsiStyle
</span><a href="#local-6989586621680064625"><span class="hs-identifier hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a></span><span> </span><span id="local-6989586621680064627"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064627"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span id="local-6989586621680064628"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064628"><span class="hs-identifier hs-var">actual</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Type mismatch: expected&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.Styles.html#bold"><span class="hs-identifier hs-var">Style.bold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064627"><span class="hs-identifier hs-var">expected</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;but got&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.Styles.html#bold"><span class="hs-identifier hs-var">Style.bold</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
</span><a href="Elara.Interpreter.html#prettyValueWithType"><span class="hs-identifier hs-var">prettyValueWithType</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064628"><span class="hs-identifier hs-var">actual</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span id="local-6989586621680064632"><span class="annot"><span class="annottext">InterpreterError
</span><a href="#local-6989586621680064632"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Doc AnsiStyle
forall a. (Generic a, GPretty (Rep a)) =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#gpretty"><span class="hs-identifier hs-var">gpretty</span></a></span><span> </span><span class="annot"><span class="annottext">InterpreterError
</span><a href="#local-6989586621680064632"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680064635"><span id="local-6989586621680064639"><span id="local-6989586621680064642"><span class="annot"><a href="Elara.Error.html#ReportableError"><span class="hs-identifier hs-type">ReportableError</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#InterpreterError"><span class="hs-identifier hs-type">InterpreterError</span></a></span></span></span></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">data</span><span> </span><span id="Value"><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-var">Value</span></a></span></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Int"><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-var">Int</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="String"><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-var">String</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Char"><span class="annot"><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-var">Char</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Double"><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-var">Double</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Data constructor invocation</span></span><span>
</span><span id="line-82"></span><span>      </span><span id="Ctor"><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-var">Ctor</span></a></span></span><span> </span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Closure"><span class="annot"><a href="Elara.Interpreter.html#Closure"><span class="hs-identifier hs-var">Closure</span></a></span></span><span>
</span><span id="line-84"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="env"><span class="annot"><span class="annottext">Value -&gt; Map (Unique Text) Value
</span><a href="Elara.Interpreter.html#env"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-comment">-- Captured environment, locals only</span><span>
</span><span id="line-85"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="param"><span class="annot"><span class="annottext">Value -&gt; Unique Text
</span><a href="Elara.Interpreter.html#param"><span class="hs-identifier hs-var hs-var">param</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-comment">-- Parameter name</span><span>
</span><span id="line-86"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="body"><span class="annot"><span class="annottext">Value -&gt; CoreExpr
</span><a href="Elara.Interpreter.html#body"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-comment">-- Function body</span><span>
</span><span id="line-87"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="RecClosure"><span class="annot"><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-var">RecClosure</span></a></span></span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="recEnv"><span class="annot"><span class="annottext">Value -&gt; Map (Unique Text) Value
</span><a href="Elara.Interpreter.html#recEnv"><span class="hs-identifier hs-var hs-var">recEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-comment">-- Captured environment, locals only</span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="name"><span class="annot"><span class="annottext">Value -&gt; UnlocatedVarRef Text
</span><a href="Elara.Interpreter.html#name"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html#UnlocatedVarRef"><span class="hs-identifier hs-type">UnlocatedVarRef</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-comment">-- This function's name</span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="param"><span class="annot"><a href="Elara.Interpreter.html#param"><span class="hs-identifier hs-var">param</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-comment">-- Parameter</span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="body"><span class="annot"><a href="Elara.Interpreter.html#body"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="PrimOp"><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-var">PrimOp</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="PartialApplication"><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-var">PartialApplication</span></a></span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="IOAction"><span class="annot"><a href="Elara.Interpreter.html#IOAction"><span class="hs-identifier hs-var">IOAction</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#InterpreterEffects"><span class="hs-identifier hs-type">InterpreterEffects</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Thunk"><span class="annot"><a href="Elara.Interpreter.html#Thunk"><span class="hs-identifier hs-var">Thunk</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#ThunkState"><span class="hs-identifier hs-type">ThunkState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#InterpreterEffects"><span class="hs-identifier hs-type">InterpreterEffects</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680064665"><span id="local-6989586621680064667"><span class="annot"><span class="annottext">(forall x. Value -&gt; Rep Value x)
-&gt; (forall x. Rep Value x -&gt; Value) -&gt; Generic Value
forall x. Rep Value x -&gt; Value
forall x. Value -&gt; Rep Value x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Value -&gt; Rep Value x
from :: forall x. Value -&gt; Rep Value x
$cto :: forall x. Rep Value x -&gt; Value
to :: forall x. Rep Value x -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680064671"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680064691"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680064691"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680064692"><span class="annot"><span class="annottext">== :: Value -&gt; Value -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680064693"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680064693"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680064691"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680064693"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621680064694"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064694"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621680064695"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064695"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064694"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064695"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span> </span><span id="local-6989586621680064696"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680064696"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span> </span><span id="local-6989586621680064697"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680064697"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680064696"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680064697"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680064698"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680064698"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680064699"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680064699"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680064698"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680064699"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span id="local-6989586621680064700"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680064700"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680064701"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680064701"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span id="local-6989586621680064702"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680064702"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680064703"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680064703"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680064700"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680064702"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680064701"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; [Value] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680064703"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span id="local-6989586621680064705"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064705"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span id="local-6989586621680064706"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064706"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064705"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064706"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-type">PartialApplication</span></a></span><span> </span><span id="local-6989586621680064707"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064707"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680064708"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064708"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-type">PartialApplication</span></a></span><span> </span><span id="local-6989586621680064709"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064709"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680064710"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064710"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064707"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064709"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064708"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064710"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#IOAction"><span class="hs-identifier hs-type">IOAction</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#IOAction"><span class="hs-identifier hs-type">IOAction</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- bit of a hack</span><span>
</span><span id="line-113"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680064165"><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#InterpreterEffects"><span class="hs-identifier hs-type">InterpreterEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064165"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-114"></span><span>    </span><span id="local-6989586621680064714"><span class="annot"><span class="annottext">pretty :: Eff InterpreterEffects a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;&lt;IO&gt;&quot;</span></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#ThunkState"><span class="hs-identifier hs-type">ThunkState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-117"></span><span>    </span><span id="local-6989586621680064718"><span class="annot"><span class="annottext">pretty :: IORef ThunkState -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="annot"><span class="annottext">IORef ThunkState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;&lt;Thunk&gt;&quot;</span></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621680064885"><span class="annot"><span class="annottext">pretty :: Value -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680064886"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680064886"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Closure accepting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680064886"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-type">RecClosure</span></a></span><span> </span><span id="local-6989586621680064887"><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680064887"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680064888"><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680064888"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680064889"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680064889"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;RecClosure&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680064888"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;accepting&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680064889"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;with env&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680064887"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680064890"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680064890"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680064890"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621680064891"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064891"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&quot;'</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064891"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&quot;'</span></span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span> </span><span id="local-6989586621680064892"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680064892"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680064892"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680064893"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680064893"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680064893"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span id="local-6989586621680064895"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680064895"><span class="hs-identifier hs-var">listName</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680064895"><span class="hs-identifier hs-var">listName</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text
forall s. IsString s =&gt; Qualified s
</span><a href="Elara.Prim.Core.html#emptyListCtorName"><span class="hs-identifier hs-var">emptyListCtorName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;[]&quot;</span></span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span id="local-6989586621680064896"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680064896"><span class="hs-identifier hs-var">listName</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680064897"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064897"><span class="hs-identifier hs-var">head'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680064898"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064898"><span class="hs-identifier hs-var">tail'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680064896"><span class="hs-identifier hs-var">listName</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text
forall s. IsString s =&gt; Qualified s
</span><a href="Elara.Prim.Core.html#consCtorName"><span class="hs-identifier hs-var">consCtorName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;[&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Doc AnsiStyle
</span><a href="#local-6989586621680064899"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064897"><span class="hs-identifier hs-var">head'</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064898"><span class="hs-identifier hs-var">tail'</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;]&quot;</span></span><span>
</span><span id="line-128"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>        </span><span id="local-6989586621680064899"><span class="annot"><span class="annottext">go :: Value -&gt; Value -&gt; Doc AnsiStyle
</span><a href="#local-6989586621680064899"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680064915"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064915"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span id="local-6989586621680064916"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680064916"><span class="hs-identifier hs-var">listName'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680064916"><span class="hs-identifier hs-var">listName'</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text
forall s. IsString s =&gt; Qualified s
</span><a href="Elara.Prim.Core.html#emptyListCtorName"><span class="hs-identifier hs-var">emptyListCtorName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064915"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><a href="#local-6989586621680064899"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680064917"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064917"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span id="local-6989586621680064918"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680064918"><span class="hs-identifier hs-var">listName'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680064919"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064919"><span class="hs-identifier hs-var">h'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680064920"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064920"><span class="hs-identifier hs-var">t'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680064918"><span class="hs-identifier hs-var">listName'</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text
forall s. IsString s =&gt; Qualified s
</span><a href="Elara.Prim.Core.html#consCtorName"><span class="hs-identifier hs-var">consCtorName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064917"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Doc AnsiStyle
</span><a href="#local-6989586621680064899"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064919"><span class="hs-identifier hs-var">h'</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064920"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><a href="#local-6989586621680064899"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680064921"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064921"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621680064922"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064922"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064921"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064922"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span id="local-6989586621680064923"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680064923"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680064923"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">name</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span id="local-6989586621680064924"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680064924"><span class="hs-identifier hs-var">tuple2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680064925"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064925"><span class="hs-identifier hs-var">arg1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680064926"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064926"><span class="hs-identifier hs-var">arg2</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680064924"><span class="hs-identifier hs-var">tuple2</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="Elara.Prim.Core.html#tuple2CtorName"><span class="hs-identifier hs-var">tuple2CtorName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann
</span><span class="hs-identifier hs-var">parens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064925"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
ErrorCode
</span><span class="hs-identifier hs-var">comma</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064926"><span class="hs-identifier hs-var">arg2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span id="local-6989586621680064929"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680064929"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680064930"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680064930"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann
</span><span class="hs-identifier hs-var">parens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680064929"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">name</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Doc AnsiStyle] -&gt; Doc AnsiStyle
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">hsep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Doc AnsiStyle) -&gt; [Value] -&gt; [Doc AnsiStyle]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680064930"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ThunkState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;&lt;Thunk&gt;&quot;</span></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span id="local-6989586621680064933"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064933"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. (Generic a, GPretty (Rep a)) =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#gpretty"><span class="hs-identifier hs-var">gpretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064933"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span id="prettyValueWithType"><span class="annot"><span class="annottext">prettyValueWithType :: Value -&gt; Doc AnsiStyle
</span><a href="Elara.Interpreter.html#prettyValueWithType"><span class="hs-identifier hs-var hs-var">prettyValueWithType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680064955"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680064955"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680064955"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;:: Int&quot;</span></span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621680064956"><span class="annot"><span class="annottext">s :: Value
</span><a href="#local-6989586621680064956"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064956"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;:: String&quot;</span></span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621680064957"><span class="annot"><span class="annottext">c :: Value
</span><a href="#local-6989586621680064957"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064957"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;:: Char&quot;</span></span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621680064958"><span class="annot"><span class="annottext">d :: Value
</span><a href="#local-6989586621680064958"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064958"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;:: Double&quot;</span></span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621680064959"><span class="annot"><span class="annottext">ctor :: Value
</span><a href="#local-6989586621680064959"><span class="hs-identifier hs-var">ctor</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span id="local-6989586621680064960"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680064960"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064959"><span class="hs-identifier hs-var">ctor</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;::&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680064960"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">dataConType</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Closure&quot;</span></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-type">RecClosure</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;RecClosure&quot;</span></span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span id="local-6989586621680064961"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064961"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Primitive operation&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680064961"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-type">PartialApplication</span></a></span><span> </span><span id="local-6989586621680064962"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064962"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680064963"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064963"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Partial application of&quot;</span></span><span>
</span><span id="line-149"></span><span>            </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
</span><a href="Elara.Interpreter.html#prettyValueWithType"><span class="hs-identifier hs-var">prettyValueWithType</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064962"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-150"></span><span>            </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;to&quot;</span></span><span>
</span><span id="line-151"></span><span>            </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
</span><a href="Elara.Interpreter.html#prettyValueWithType"><span class="hs-identifier hs-var">prettyValueWithType</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680064963"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#IOAction"><span class="hs-identifier hs-type">IOAction</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;&lt;IO&gt;&quot;</span></span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span class="annot"><span class="annottext">IORef ThunkState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;&lt;Thunk&gt;&quot;</span></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span id="primOps"><span class="annot"><span class="annottext">primOps :: Map Text Integer
</span><a href="Elara.Interpreter.html#primOps"><span class="hs-identifier hs-var hs-var">primOps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="annottext">[(Text, Integer)] -&gt; Map Text Integer
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;==&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&gt;&gt;=&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;stringCons&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;compare&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;debugWithMsg&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><a href="Elara.Interpreter.html#boolValue"><span class="hs-identifier hs-type">boolValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-167"></span><span id="boolValue"><span class="annot"><span class="annottext">boolValue :: Bool -&gt; Value
</span><a href="Elara.Interpreter.html#boolValue"><span class="hs-identifier hs-var hs-var">boolValue</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Value] -&gt; Value
</span><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-var">Ctor</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="Elara.Prim.Core.html#trueCtor"><span class="hs-identifier hs-var">trueCtor</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-168"></span><span class="annot"><a href="Elara.Interpreter.html#boolValue"><span class="hs-identifier hs-var">boolValue</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Value] -&gt; Value
</span><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-var">Ctor</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="Elara.Prim.Core.html#falseCtor"><span class="hs-identifier hs-var">falseCtor</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-comment">-- Force a value once (for thunks); detects recursive value loops</span><span>
</span><span id="line-171"></span><span id="local-6989586621680064182"><span class="annot"><a href="Elara.Interpreter.html#force"><span class="hs-identifier hs-type">force</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064182"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064182"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span></span><span>
</span><span id="line-172"></span><span id="force"><span class="annot"><span class="annottext">force :: forall (r :: [Effect]). Interpreter r =&gt; Value -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#force"><span class="hs-identifier hs-var hs-var">force</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span id="local-6989586621680065038"><span class="annot"><span class="annottext">IORef ThunkState
</span><a href="#local-6989586621680065038"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621680065039"><span class="annot"><span class="annottext">Eff InterpreterEffects Value
</span><a href="#local-6989586621680065039"><span class="hs-identifier hs-var">act</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621680065040"><span class="annot"><a href="#local-6989586621680065040"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ThunkState -&gt; Eff r ThunkState
forall a. IO a -&gt; Eff r a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef ThunkState -&gt; IO ThunkState
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; m a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef ThunkState
</span><a href="#local-6989586621680065038"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680065040"><span class="hs-identifier hs-type">st</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-175"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#Evaluated"><span class="hs-identifier hs-type">Evaluated</span></a></span><span> </span><span id="local-6989586621680065043"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065043"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065043"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="annot"><span class="annottext">ThunkState
</span><a href="Elara.Interpreter.html#Evaluating"><span class="hs-identifier hs-var">Evaluating</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><span class="annottext">(InterpreterError -&gt; Eff r Value)
-&gt; InterpreterError -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#CodeThrewError"><span class="hs-identifier hs-var">CodeThrewError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Recursive value detected&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>        </span><span class="annot"><span class="annottext">ThunkState
</span><a href="Elara.Interpreter.html#Unevaluated"><span class="hs-identifier hs-var">Unevaluated</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Eff r ()
forall a. IO a -&gt; Eff r a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef ThunkState -&gt; ThunkState -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IORef a -&gt; a -&gt; m ()
</span><span class="hs-identifier hs-var">writeIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef ThunkState
</span><a href="#local-6989586621680065038"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">ThunkState
</span><a href="Elara.Interpreter.html#Evaluating"><span class="hs-identifier hs-var">Evaluating</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>            </span><span id="local-6989586621680065046"><span class="annot"><a href="#local-6989586621680065046"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value -&gt; Eff r Value
forall (subEs :: [Effect]) (es :: [Effect]) a.
Subset subEs es =&gt;
Eff subEs a -&gt; Eff es a
</span><span class="hs-identifier hs-var">inject</span></span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value
</span><a href="#local-6989586621680065039"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-180"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">writeIORef</span></span><span> </span><span class="annot"><a href="#local-6989586621680065038"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Evaluated"><span class="hs-identifier hs-type">Evaluated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065046"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680065046"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-182"></span><span class="annot"><a href="Elara.Interpreter.html#force"><span class="hs-identifier hs-var">force</span></a></span><span> </span><span id="local-6989586621680065048"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065048"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065048"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span id="local-6989586621680064234"><span class="annot"><a href="Elara.Interpreter.html#mkThunk"><span class="hs-identifier hs-type">mkThunk</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064234"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#InterpreterEffects"><span class="hs-identifier hs-type">InterpreterEffects</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064234"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span></span><span>
</span><span id="line-185"></span><span id="mkThunk"><span class="annot"><span class="annottext">mkThunk :: forall (r :: [Effect]).
Interpreter r =&gt;
Eff InterpreterEffects Value -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#mkThunk"><span class="hs-identifier hs-var hs-var">mkThunk</span></a></span></span><span> </span><span id="local-6989586621680065056"><span class="annot"><span class="annottext">Eff InterpreterEffects Value
</span><a href="#local-6989586621680065056"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621680065057"><span class="annot"><a href="#local-6989586621680065057"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef ThunkState) -&gt; Eff r (IORef ThunkState)
forall a. IO a -&gt; Eff r a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThunkState -&gt; IO (IORef ThunkState)
forall (m :: * -&gt; *) a. MonadIO m =&gt; a -&gt; m (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">ThunkState
</span><a href="Elara.Interpreter.html#Unevaluated"><span class="hs-identifier hs-var">Unevaluated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Thunk"><span class="hs-identifier hs-type">Thunk</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065057"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065056"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span id="local-6989586621680064238"><span id="local-6989586621680064239"><span class="annot"><a href="Elara.Interpreter.html#scopedOverLocals"><span class="hs-identifier hs-type">scopedOverLocals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064238"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064238"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064239"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064238"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064239"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-190"></span><span id="scopedOverLocals"><span class="annot"><span class="annottext">scopedOverLocals :: forall (r :: [Effect]) a. Interpreter r =&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Interpreter.html#scopedOverLocals"><span class="hs-identifier hs-var hs-var">scopedOverLocals</span></a></span></span><span> </span><span id="local-6989586621680065073"><span class="annot"><span class="annottext">Eff r a
</span><a href="#local-6989586621680065073"><span class="hs-identifier hs-var">eff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>    </span><span id="local-6989586621680065074"><span class="annot"><a href="#local-6989586621680065074"><span class="hs-identifier hs-var">oldLocals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ElaraState -&gt; Map (Unique Text) Value)
-&gt; Eff r (Map (Unique Text) Value)
forall s (es :: [Effect]) a.
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; a) -&gt; Eff es a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ElaraState -&gt; Map (Unique Text) Value
</span><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621680065076"><span class="annot"><a href="#local-6989586621680065076"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621680065073"><span class="hs-identifier hs-type">eff</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680065078"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065078"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065078"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680065074"><span class="hs-identifier hs-type">oldLocals</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680065076"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span id="local-6989586621680064247"><span class="annot"><a href="Elara.Interpreter.html#lookupVar"><span class="hs-identifier hs-type">lookupVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064247"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html#UnlocatedVarRef"><span class="hs-identifier hs-type">UnlocatedVarRef</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064247"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span></span><span>
</span><span id="line-197"></span><span id="lookupVar"><span class="annot"><span class="annottext">lookupVar :: forall (r :: [Effect]).
Interpreter r =&gt;
UnlocatedVarRef Text -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#lookupVar"><span class="hs-identifier hs-var hs-var">lookupVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680065168"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065168"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621680065169"><span class="annot"><a href="#local-6989586621680065169"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff r ElaraState
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
Eff es s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621680065168"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065169"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680065172"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065172"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065172"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnlocatedVarRef Text -&gt; ElaraState -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#UnboundVariable"><span class="hs-identifier hs-var">UnboundVariable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
-&gt; UnlocatedVarRef Text
forall (c :: VarRefKind) n. VarRefImpl c (Unique n) -&gt; VarRef' c n
</span><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065168"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065169"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span class="annot"><a href="Elara.Interpreter.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680065174"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065174"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r Value -&gt; Eff r Value
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;lookupVar: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065174"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r Value -&gt; Eff r Value) -&gt; Eff r Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621680065175"><span class="annot"><a href="#local-6989586621680065175"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff r ElaraState
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
Eff es s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621680065174"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065175"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680065176"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065176"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065176"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065174"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-207"></span><span>            </span><span id="local-6989586621680065177"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065177"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>                </span><span id="local-6989586621680065178"><span class="annot"><a href="#local-6989586621680065178"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff (StructuredDebug : r) (CoreModule CoreBind)
-&gt; Eff r (CoreModule CoreBind)
forall (r :: [Effect]) a. Eff (StructuredDebug : r) a -&gt; Eff r a
</span><a href="Elara.Logging.html#ignoreStructuredDebug"><span class="hs-identifier hs-var">ignoreStructuredDebug</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff (StructuredDebug : r) (CoreModule CoreBind)
 -&gt; Eff r (CoreModule CoreBind))
-&gt; Eff (StructuredDebug : r) (CoreModule CoreBind)
-&gt; Eff r (CoreModule CoreBind)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) (CoreModule CoreBind)
-&gt; Eff (StructuredDebug : r) (CoreModule CoreBind)
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
-&gt; Query (Rock Query : ConsQueryEffects '[]) (CoreModule CoreBind)
</span><a href="Elara.Query.html#GetFinalisedCoreModule"><span class="hs-identifier hs-var">Elara.Query.GetFinalisedCoreModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Text -&gt; ModuleName
forall name. Qualified name -&gt; ModuleName
</span><a href="Elara.AST.Name.html#qualifier"><span class="hs-identifier hs-var">qualifier</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065177"><span class="hs-identifier hs-var">qn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#loadModule"><span class="hs-identifier hs-type">loadModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065178"><span class="hs-identifier hs-type">mod</span></a></span><span>
</span><span id="line-210"></span><span>                </span><span id="local-6989586621680065183"><span class="annot"><a href="#local-6989586621680065183"><span class="hs-identifier hs-var">newS</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">get</span></span><span>
</span><span id="line-211"></span><span>                </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;After loading &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#qualifier"><span class="hs-identifier hs-var">qualifier</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065177"><span class="hs-identifier hs-type">qn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;, bindings: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065183"><span class="hs-identifier hs-type">newS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621680065174"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065183"><span class="hs-identifier hs-type">newS</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-213"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680065184"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065184"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065184"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-214"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnlocatedVarRef Text -&gt; ElaraState -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#UnboundVariable"><span class="hs-identifier hs-var">UnboundVariable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
-&gt; UnlocatedVarRef Text
forall (c :: VarRefKind) n.
VarRefImpl c (Qualified n) -&gt; VarRef' c n
</span><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-var">Global</span></a></span><span> </span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065174"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065183"><span class="hs-identifier hs-var">newS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-type">interpretExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680064278"><span class="annot"><a href="#local-6989586621680064278"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064278"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064278"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-217"></span><span id="interpretExpr"><span class="annot"><span class="annottext">interpretExpr :: forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var hs-var">interpretExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Int"><span class="hs-identifier hs-type">Core.Int</span></a></span><span> </span><span id="local-6989586621680065536"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065536"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-var">Int</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065536"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-218"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#String"><span class="hs-identifier hs-type">Core.String</span></a></span><span> </span><span id="local-6989586621680065538"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065538"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065538"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-219"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Char"><span class="hs-identifier hs-type">Core.Char</span></a></span><span> </span><span id="local-6989586621680065540"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680065540"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Value
</span><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-var">Char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680065540"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-220"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Double"><span class="hs-identifier hs-type">Core.Double</span></a></span><span> </span><span id="local-6989586621680065542"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065542"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Value
</span><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-var">Double</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065542"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-221"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="Elara.Core.html#Unit"><span class="hs-identifier hs-var">Core.Unit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Value] -&gt; Value
</span><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-var">Ctor</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="Elara.Prim.Core.html#unitCtor"><span class="hs-identifier hs-var">unitCtor</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-222"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680065547"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065547"><span class="hs-identifier hs-var">primName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#String"><span class="hs-identifier hs-type">Core.String</span></a></span><span> </span><span id="local-6989586621680065548"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065548"><span class="hs-identifier hs-var">primArg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified Text
VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065547"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="Elara.Prim.Core.html#fetchPrimitiveName"><span class="hs-identifier hs-var">fetchPrimitiveName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-var">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065548"><span class="hs-identifier hs-var">primArg</span></a></span><span>
</span><span id="line-224"></span><span class="hs-comment">-- elaraPrimitive should be called with a tyapp - i.e. `elaraPrimitive @T &quot;f&quot;`</span><span>
</span><span id="line-225"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#TyApp"><span class="hs-identifier hs-type">TyApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680065550"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065550"><span class="hs-identifier hs-var">primName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-type">Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#String"><span class="hs-identifier hs-type">Core.String</span></a></span><span> </span><span id="local-6989586621680065551"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065551"><span class="hs-identifier hs-var">primArg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified Text
VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065550"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="Elara.Prim.Core.html#fetchPrimitiveName"><span class="hs-identifier hs-var">fetchPrimitiveName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-var">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065551"><span class="hs-identifier hs-var">primArg</span></a></span><span>
</span><span id="line-227"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span id="local-6989586621680065552"><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680065552"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text -&gt; Eff r Value
forall (r :: [Effect]).
Interpreter r =&gt;
UnlocatedVarRef Text -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#lookupVar"><span class="hs-identifier hs-var">lookupVar</span></a></span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680065552"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-228"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621680065554"><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621680065554"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span id="local-6989586621680065555"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065555"><span class="hs-identifier hs-var">in'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r Value -&gt; Eff r Value
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;interpretExpr: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">CoreBind -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621680065554"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r Value -&gt; Eff r Value) -&gt; Eff r Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Eff r Value -&gt; Eff r Value
forall (r :: [Effect]) a. Interpreter r =&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Interpreter.html#scopedOverLocals"><span class="hs-identifier hs-var">scopedOverLocals</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff r Value -&gt; Eff r Value) -&gt; Eff r Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="annottext">CoreBind -&gt; Eff r ()
forall (r :: [Effect]). Interpreter r =&gt; CoreBind -&gt; Eff r ()
</span><a href="Elara.Interpreter.html#interpretBinding"><span class="hs-identifier hs-var">interpretBinding</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621680065554"><span class="hs-identifier hs-var">bind</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065555"><span class="hs-identifier hs-var">in'</span></a></span><span>
</span><span id="line-231"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680065558"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065558"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680065559"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065559"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621680065560"><span class="annot"><a href="#local-6989586621680065560"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff r ElaraState
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
Eff es s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065560"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680065558"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065559"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-234"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#App"><span class="hs-identifier hs-type">App</span></a></span><span> </span><span id="local-6989586621680065561"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065561"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680065562"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065562"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621680065563"><span class="annot"><a href="#local-6989586621680065563"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065561"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621680065564"><span class="annot"><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-type">interpretExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065562"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680065563"><span class="hs-identifier hs-type">f'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-238"></span><span>        </span><span id="local-6989586621680065565"><span class="annot"><span class="annottext">rec :: Value
</span><a href="#local-6989586621680065565"><span class="hs-identifier hs-var">rec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-type">RecClosure</span></a></span><span> </span><span id="local-6989586621680065566"><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065566"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680065567"><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680065567"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680065568"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065568"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680065569"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065569"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-239"></span><span>            </span><span class="hs-comment">-- add the argument to the env</span><span>
</span><span id="line-240"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065570"><span class="annot"><span class="annottext">env'' :: Map (Unique Text) Value
</span><a href="#local-6989586621680065570"><span class="hs-identifier hs-var hs-var">env''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique Text
-&gt; Value -&gt; Map (Unique Text) Value -&gt; Map (Unique Text) Value
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065568"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065566"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>            </span><span class="annot"><span class="annottext">Eff r Value -&gt; Eff r Value
forall (r :: [Effect]) a. Interpreter r =&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Interpreter.html#scopedOverLocals"><span class="hs-identifier hs-var">scopedOverLocals</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff r Value -&gt; Eff r Value) -&gt; Eff r Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>                </span><span class="annot"><span class="annottext">(ElaraState -&gt; ElaraState) -&gt; Eff r ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span>
</span><span id="line-244"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680065572"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065572"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-245"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680065567"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-246"></span><span>                            </span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680065573"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065573"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-247"></span><span>                                </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065572"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-248"></span><span>                                    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680065573"><span class="hs-identifier hs-type">n'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065565"><span class="hs-identifier hs-type">rec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680065570"><span class="hs-identifier hs-type">env''</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065572"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- add itself to the env</span><span>
</span><span id="line-249"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#stateSource"><span class="hs-identifier hs-var">stateSource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#FromClosure"><span class="hs-identifier hs-type">FromClosure</span></a></span><span>
</span><span id="line-250"></span><span>                                    </span><span class="hs-special">}</span><span>
</span><span id="line-251"></span><span>                            </span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680065574"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065574"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-252"></span><span>                                </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065572"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-253"></span><span>                                    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680065574"><span class="hs-identifier hs-type">n'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065565"><span class="hs-identifier hs-type">rec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065572"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- add itself to the env</span><span>
</span><span id="line-254"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680065570"><span class="hs-identifier hs-type">env''</span></a></span><span>
</span><span id="line-255"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#stateSource"><span class="hs-identifier hs-var">stateSource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#FromClosure"><span class="hs-identifier hs-type">FromClosure</span></a></span><span>
</span><span id="line-256"></span><span>                                    </span><span class="hs-special">}</span><span>
</span><span id="line-257"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>                </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065569"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span id="local-6989586621680065575"><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065575"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680065576"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065576"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680065577"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065577"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065578"><span class="annot"><span class="annottext">env' :: Map (Unique Text) Value
</span><a href="#local-6989586621680065578"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique Text
-&gt; Value -&gt; Map (Unique Text) Value -&gt; Map (Unique Text) Value
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065576"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065575"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-262"></span><span>            </span><span class="annot"><span class="annottext">Eff r Value -&gt; Eff r Value
forall (r :: [Effect]) a. Interpreter r =&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Interpreter.html#scopedOverLocals"><span class="hs-identifier hs-var">scopedOverLocals</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff r Value -&gt; Eff r Value) -&gt; Eff r Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>                </span><span class="annot"><span class="annottext">(ElaraState -&gt; ElaraState) -&gt; Eff r ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680065579"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065579"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065579"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680065578"><span class="hs-identifier hs-type">env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#stateSource"><span class="hs-identifier hs-var">stateSource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#FromClosure"><span class="hs-identifier hs-type">FromClosure</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>                </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065577"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-265"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;toString&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065580"><span class="annot"><span class="annottext">asText :: Text
</span><a href="#local-6989586621680065580"><span class="hs-identifier hs-var hs-var">asText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-267"></span><span>                    </span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Tuple2&quot;</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680065582"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065582"><span class="hs-identifier hs-var">arg1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680065583"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065583"><span class="hs-identifier hs-var">arg2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-268"></span><span>                        </span><span class="annot"><span class="annottext">(Value, Value) -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Elara.Data.Pretty.html#prettyToText"><span class="hs-identifier hs-var">prettyToText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065582"><span class="hs-identifier hs-var">arg1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065583"><span class="hs-identifier hs-var">arg2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>                    </span><span id="local-6989586621680065585"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065585"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Elara.Data.Pretty.html#prettyToText"><span class="hs-identifier hs-var">prettyToText</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065585"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-270"></span><span>            </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065580"><span class="hs-identifier hs-var">asText</span></a></span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;error&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-272"></span><span>            </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><span class="annottext">(InterpreterError -&gt; Eff r Value)
-&gt; InterpreterError -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#CodeThrewError"><span class="hs-identifier hs-var">CodeThrewError</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;println&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>            </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value -&gt; Value
</span><a href="Elara.Interpreter.html#IOAction"><span class="hs-identifier hs-var">IOAction</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff InterpreterEffects Value -&gt; Value)
-&gt; Eff InterpreterEffects Value -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065586"><span class="annot"><span class="annottext">asString :: Text
</span><a href="#local-6989586621680065586"><span class="hs-identifier hs-var hs-var hs-var">asString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-276"></span><span>                        </span><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621680065587"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065587"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065587"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-277"></span><span>                        </span><span id="local-6989586621680065588"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065588"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Elara.Data.Pretty.html#prettyToText"><span class="hs-identifier hs-var">prettyToText</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065588"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-278"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; Eff InterpreterEffects ()
forall (m :: * -&gt; *). MonadIO m =&gt; Text -&gt; m ()
</span><span class="hs-identifier hs-var">putTextLn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065586"><span class="hs-identifier hs-var">asString</span></a></span><span>
</span><span id="line-279"></span><span>                </span><span class="annot"><span class="annottext">Value -&gt; Eff InterpreterEffects Value
forall a. a -&gt; Eff InterpreterEffects a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [Value] -&gt; Value
</span><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-var">Ctor</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="Elara.Prim.Core.html#unitCtor"><span class="hs-identifier hs-var">unitCtor</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;negate&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-282"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680065590"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065590"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-var">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065590"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680065591"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065591"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Value
</span><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-var">Double</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065591"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>                </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">expected :: Text
</span><a href="Elara.Interpreter.html#expected"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Int or Double&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">actual :: Value
</span><a href="Elara.Interpreter.html#actual"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-285"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;stringIsEmpty&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-287"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621680065592"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065592"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Value
</span><a href="Elara.Interpreter.html#boolValue"><span class="hs-identifier hs-var">boolValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">Text.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065592"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>                </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">expected :: Text
</span><a href="Elara.Interpreter.html#expected"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;String&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">actual :: Value
</span><a href="Elara.Interpreter.html#actual"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;stringHead&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-291"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621680065594"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065594"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Value
</span><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-var">Char</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Char
Text -&gt; Char
</span><span class="hs-identifier hs-var">Text.head</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065594"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>                </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">expected :: Text
</span><a href="Elara.Interpreter.html#expected"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;String&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">actual :: Value
</span><a href="Elara.Interpreter.html#actual"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;stringTail&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-294"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-295"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621680065596"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065596"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text
Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.tail</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065596"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>                </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">expected :: Text
</span><a href="Elara.Interpreter.html#expected"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;String&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">actual :: Value
</span><a href="Elara.Interpreter.html#actual"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>        </span><span class="hs-comment">-- stringCons fst a'</span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-type">PartialApplication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;stringCons&quot;</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680065598"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065598"><span class="hs-identifier hs-var">fst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-300"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065598"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-301"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span> </span><span id="local-6989586621680065599"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680065599"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621680065600"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065600"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">Text.cons</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680065599"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065600"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>                </span><span class="annot"><span class="annottext">(Value, Value)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">expected :: Text
</span><a href="Elara.Interpreter.html#expected"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Char and String&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">actual :: Value
</span><a href="Elara.Interpreter.html#actual"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-303"></span><span>        </span><span class="hs-comment">-- (==) fst a'</span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-type">PartialApplication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;==&quot;</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680065602"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065602"><span class="hs-identifier hs-var">fst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-305"></span><span>            </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Value
</span><a href="Elara.Interpreter.html#boolValue"><span class="hs-identifier hs-var">boolValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065602"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-type">PartialApplication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+&quot;</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680065603"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065603"><span class="hs-identifier hs-var">fst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-307"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065603"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-308"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680065604"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065604"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680065605"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065605"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-var">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065604"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065605"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680065607"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065607"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680065608"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065608"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Value
</span><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-var">Double</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065607"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065608"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>                </span><span class="annot"><span class="annottext">(Value, Value)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">expected :: Text
</span><a href="Elara.Interpreter.html#expected"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(+): Int or Double&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">actual :: Value
</span><a href="Elara.Interpreter.html#actual"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-311"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-type">PartialApplication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;*&quot;</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680065609"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065609"><span class="hs-identifier hs-var">fst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065609"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-313"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680065610"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065610"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680065611"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065611"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-var">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065610"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065611"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680065613"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065613"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680065614"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065614"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Value
</span><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-var">Double</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065613"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065614"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>                </span><span class="annot"><span class="annottext">(Value, Value)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">expected :: Text
</span><a href="Elara.Interpreter.html#expected"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(*): Int or Double&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">actual :: Value
</span><a href="Elara.Interpreter.html#actual"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-316"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-type">PartialApplication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;compare&quot;</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680065615"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065615"><span class="hs-identifier hs-var">fst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065620"><span class="annot"><span class="annottext">orderingToInt :: Ordering -&gt; Integer
</span><a href="#local-6989586621680065620"><span class="hs-identifier hs-var hs-var">orderingToInt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-318"></span><span>                    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-319"></span><span>                    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-320"></span><span>                    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-321"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065615"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-322"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680065621"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065621"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680065622"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065622"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-var">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ordering -&gt; Integer
</span><a href="#local-6989586621680065620"><span class="hs-identifier hs-var">orderingToInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065621"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065622"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680065624"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065624"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680065625"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065625"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-var">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ordering -&gt; Integer
</span><a href="#local-6989586621680065620"><span class="hs-identifier hs-var">orderingToInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065624"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065625"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span> </span><span id="local-6989586621680065626"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680065626"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span> </span><span id="local-6989586621680065627"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680065627"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-var">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ordering -&gt; Integer
</span><a href="#local-6989586621680065620"><span class="hs-identifier hs-var">orderingToInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680065626"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680065627"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>                </span><span class="annot"><span class="annottext">(Value, Value)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">expected :: Text
</span><a href="Elara.Interpreter.html#expected"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(compare): Int or Double or Char&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">actual :: Value
</span><a href="Elara.Interpreter.html#actual"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-type">PartialApplication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;debugWithMsg&quot;</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680065628"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065628"><span class="hs-identifier hs-var">fst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>            </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r ()
forall (r :: [Effect]).
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r ()
</span><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; Eff r ()) -&gt; Doc AnsiStyle -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Source Code Debug  (&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065628"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;):  &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-328"></span><span>            </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-type">PartialApplication</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&gt;&gt;=&quot;</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680065629"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065629"><span class="hs-identifier hs-var">fst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065629"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-331"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#IOAction"><span class="hs-identifier hs-type">IOAction</span></a></span><span> </span><span id="local-6989586621680065630"><span class="annot"><span class="annottext">Eff InterpreterEffects Value
</span><a href="#local-6989586621680065630"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-332"></span><span>                    </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value -&gt; Value
</span><a href="Elara.Interpreter.html#IOAction"><span class="hs-identifier hs-var">IOAction</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff InterpreterEffects Value -&gt; Value)
-&gt; Eff InterpreterEffects Value -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-333"></span><span>                        </span><span id="local-6989586621680065631"><span class="annot"><a href="#local-6989586621680065631"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value
</span><a href="#local-6989586621680065630"><span class="hs-identifier hs-var">io</span></a></span><span>
</span><span id="line-334"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680065564"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- this sucks</span><span>
</span><span id="line-335"></span><span>                            </span><span class="annot"><a href="Elara.Interpreter.html#Closure"><span class="hs-identifier hs-type">Closure</span></a></span><span> </span><span id="local-6989586621680065632"><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065632"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680065633"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065633"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680065634"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065634"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-336"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065635"><span class="annot"><span class="annottext">env' :: Map (Unique Text) Value
</span><a href="#local-6989586621680065635"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique Text
-&gt; Value -&gt; Map (Unique Text) Value -&gt; Map (Unique Text) Value
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065633"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065631"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065632"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-337"></span><span>                                </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value -&gt; Eff InterpreterEffects Value
forall (r :: [Effect]) a. Interpreter r =&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Interpreter.html#scopedOverLocals"><span class="hs-identifier hs-var">scopedOverLocals</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff InterpreterEffects Value -&gt; Eff InterpreterEffects Value)
-&gt; Eff InterpreterEffects Value -&gt; Eff InterpreterEffects Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-338"></span><span>                                    </span><span class="annot"><span class="annottext">(ElaraState -&gt; ElaraState) -&gt; Eff InterpreterEffects ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680065636"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065636"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065636"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680065635"><span class="hs-identifier hs-type">env'</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>                                    </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff InterpreterEffects Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065634"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-340"></span><span>                            </span><span class="annot"><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-type">RecClosure</span></a></span><span> </span><span id="local-6989586621680065637"><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065637"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621680065638"><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680065638"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680065639"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065639"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680065640"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065640"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065641"><span class="annot"><span class="annottext">env' :: Map (Unique Text) Value
</span><a href="#local-6989586621680065641"><span class="hs-identifier hs-var hs-var">env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique Text
-&gt; Value -&gt; Map (Unique Text) Value -&gt; Map (Unique Text) Value
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065639"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065631"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065637"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>                                </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value -&gt; Eff InterpreterEffects Value
forall (r :: [Effect]) a. Interpreter r =&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Interpreter.html#scopedOverLocals"><span class="hs-identifier hs-var">scopedOverLocals</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff InterpreterEffects Value -&gt; Eff InterpreterEffects Value)
-&gt; Eff InterpreterEffects Value -&gt; Eff InterpreterEffects Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-344"></span><span>                                    </span><span class="annot"><span class="annottext">(ElaraState -&gt; ElaraState) -&gt; Eff InterpreterEffects ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span>
</span><span id="line-345"></span><span>                                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680065642"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065642"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680065638"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-346"></span><span>                                            </span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680065643"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065643"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-347"></span><span>                                                </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065642"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-348"></span><span>                                                    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680065643"><span class="hs-identifier hs-type">n'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-type">RecClosure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065641"><span class="hs-identifier hs-type">env'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065638"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065639"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065640"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065642"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>                                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680065641"><span class="hs-identifier hs-type">env'</span></a></span><span>
</span><span id="line-350"></span><span>                                                    </span><span class="hs-special">}</span><span>
</span><span id="line-351"></span><span>                                            </span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680065644"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065644"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-352"></span><span>                                                </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065642"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-353"></span><span>                                                    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680065644"><span class="hs-identifier hs-type">n'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-type">RecClosure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065641"><span class="hs-identifier hs-type">env'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065638"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065639"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065640"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065642"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-354"></span><span>                                                    </span><span class="hs-special">}</span><span>
</span><span id="line-355"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>                                    </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff InterpreterEffects Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065640"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-357"></span><span>                            </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff InterpreterEffects Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><span class="annottext">(InterpreterError -&gt; Eff InterpreterEffects Value)
-&gt; InterpreterError -&gt; Eff InterpreterEffects Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#NotAFunction"><span class="hs-identifier hs-var">NotAFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-358"></span><span>                </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">expected :: Text
</span><a href="Elara.Interpreter.html#expected"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;IO&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">actual :: Value
</span><a href="Elara.Interpreter.html#actual"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a></span><span> </span><span id="local-6989586621680065645"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065645"><span class="hs-identifier hs-var">primName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-360"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Integer -&gt; Maybe Integer
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065645"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Integer
</span><a href="Elara.Interpreter.html#primOps"><span class="hs-identifier hs-var">primOps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-361"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r Value
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;1-arg primop Should be handled here&quot;</span></span><span>
</span><span id="line-362"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
</span><a href="Elara.Interpreter.html#PartialApplication"><span class="hs-identifier hs-var">PartialApplication</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065563"><span class="hs-identifier hs-var">f'</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-363"></span><span>                </span><span class="annot"><span class="annottext">Maybe Integer
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><span class="annottext">(InterpreterError -&gt; Eff r Value)
-&gt; InterpreterError -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#UnknownPrimitive"><span class="hs-identifier hs-var">UnknownPrimitive</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065645"><span class="hs-identifier hs-var">primName</span></a></span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span id="local-6989586621680065647"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680065647"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680065648"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680065648"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Int
</span><a href="Elara.Core.html#typeArity"><span class="hs-identifier hs-var">typeArity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680065647"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">dataConType</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680065648"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-365"></span><span>            </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><span class="annottext">(InterpreterError -&gt; Eff r Value)
-&gt; InterpreterError -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#NotAFunction"><span class="hs-identifier hs-var">NotAFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065563"><span class="hs-identifier hs-var">f'</span></a></span><span>
</span><span id="line-366"></span><span>        </span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span id="local-6989586621680065652"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680065652"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680065653"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680065653"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>            </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Eff r Value) -&gt; Value -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Value] -&gt; Value
</span><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-var">Ctor</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680065652"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680065653"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; [Value] -&gt; [Value]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065564"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>        </span><span id="local-6989586621680065654"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065654"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><span class="annottext">(InterpreterError -&gt; Eff r Value)
-&gt; InterpreterError -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#NotAFunction"><span class="hs-identifier hs-var">NotAFunction</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065654"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-369"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span id="local-6989586621680065656"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065656"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680065657"><span class="annot"><span class="annottext">Maybe Var
</span><a href="#local-6989586621680065657"><span class="hs-identifier hs-var">of'</span></a></span></span><span> </span><span id="local-6989586621680065658"><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621680065658"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-370"></span><span>    </span><span id="local-6989586621680065659"><span class="annot"><a href="#local-6989586621680065659"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065656"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Eff r Value -&gt; (Value -&gt; Eff r Value) -&gt; Eff r Value
forall a b. Eff r a -&gt; (a -&gt; Eff r b) -&gt; Eff r b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; Value -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#force"><span class="hs-identifier hs-var">force</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;forced match scrutinee to&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065659"><span class="hs-identifier hs-type">e'</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">whenJust</span></span><span> </span><span class="annot"><a href="#local-6989586621680065657"><span class="hs-identifier hs-type">of'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680065661"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065661"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-373"></span><span>        </span><span class="annot"><span class="annottext">(ElaraState -&gt; ElaraState) -&gt; Eff r ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680065662"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065662"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065662"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680065661"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065659"><span class="hs-identifier hs-type">e'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065662"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680065663"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.Core.html#Alt"><span class="hs-identifier hs-type">Core.Alt</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064278"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-376"></span><span>        </span><span id="local-6989586621680065663"><span class="annot"><a href="#local-6989586621680065663"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><span class="annottext">(InterpreterError -&gt; Eff r Value)
-&gt; InterpreterError -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; [Alt Var] -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#NonExhaustiveMatch"><span class="hs-identifier hs-var">NonExhaustiveMatch</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065659"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621680065658"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-377"></span><span>        </span><span class="annot"><a href="#local-6989586621680065663"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataAlt"><span class="hs-identifier hs-type">DataAlt</span></a></span><span> </span><span id="local-6989586621680065665"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680065665"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680065666"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680065666"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680065667"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065667"><span class="hs-identifier hs-var">branchBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680065668"><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621680065668"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-378"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065659"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-379"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span id="local-6989586621680065669"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680065669"><span class="hs-identifier hs-var">c'</span></a></span></span><span> </span><span id="local-6989586621680065670"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621680065670"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680065665"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; DataCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680065669"><span class="hs-identifier hs-var">c'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-380"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065671"><span class="annot"><span class="annottext">vs' :: [Unique Text]
</span><a href="#local-6989586621680065671"><span class="hs-identifier hs-var hs-var hs-var">vs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680065672"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065672"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Unique Text
VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065672"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; Unique Text) -&gt; [Var] -&gt; [Unique Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621680065666"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-381"></span><span>                    </span><span class="annot"><span class="annottext">(ElaraState -&gt; ElaraState) -&gt; Eff r ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680065673"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065673"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065673"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">uncurry</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065673"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip</span></span><span> </span><span class="annot"><a href="#local-6989586621680065671"><span class="hs-identifier hs-type">vs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065670"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>                    </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065667"><span class="hs-identifier hs-var">branchBody</span></a></span><span>
</span><span id="line-383"></span><span>                </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Alt Var] -&gt; Eff r Value
</span><a href="#local-6989586621680065663"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621680065668"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-384"></span><span>        </span><span class="annot"><a href="#local-6989586621680065663"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#LitAlt"><span class="hs-identifier hs-type">LitAlt</span></a></span><span> </span><span id="local-6989586621680065677"><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621680065677"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680065678"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065678"><span class="hs-identifier hs-var">branchBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680065679"><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621680065679"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-385"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065659"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-386"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680065680"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065680"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621680065677"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Literal -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Literal
</span><a href="Elara.Core.html#Int"><span class="hs-identifier hs-var">Core.Int</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680065680"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065678"><span class="hs-identifier hs-var">branchBody</span></a></span><span>
</span><span id="line-387"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621680065681"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065681"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621680065677"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Literal -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Literal
</span><a href="Elara.Core.html#String"><span class="hs-identifier hs-var">Core.String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680065681"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065678"><span class="hs-identifier hs-var">branchBody</span></a></span><span>
</span><span id="line-388"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span> </span><span id="local-6989586621680065682"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680065682"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621680065677"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Literal -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Literal
</span><a href="Elara.Core.html#Char"><span class="hs-identifier hs-var">Core.Char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680065682"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065678"><span class="hs-identifier hs-var">branchBody</span></a></span><span>
</span><span id="line-389"></span><span>                </span><span class="annot"><a href="Elara.Interpreter.html#Double"><span class="hs-identifier hs-type">Double</span></a></span><span> </span><span id="local-6989586621680065683"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065683"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Literal
</span><a href="#local-6989586621680065677"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Literal -&gt; Literal -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Literal
</span><a href="Elara.Core.html#Double"><span class="hs-identifier hs-var">Core.Double</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680065683"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065678"><span class="hs-identifier hs-var">branchBody</span></a></span><span>
</span><span id="line-390"></span><span>                </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Alt Var] -&gt; Eff r Value
</span><a href="#local-6989586621680065663"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[Alt Var]
</span><a href="#local-6989586621680065679"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-391"></span><span>        </span><span class="annot"><a href="#local-6989586621680065663"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">AltCon
</span><a href="Elara.Core.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680065685"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065685"><span class="hs-identifier hs-var">branchBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Alt Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065685"><span class="hs-identifier hs-var">branchBody</span></a></span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><a href="#local-6989586621680065663"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065658"><span class="hs-identifier hs-type">alts</span></a></span><span>
</span><span id="line-393"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#TyApp"><span class="hs-identifier hs-type">TyApp</span></a></span><span> </span><span id="local-6989586621680065686"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065686"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065686"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- lol</span><span>
</span><span id="line-394"></span><span class="annot"><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span id="local-6989586621680065687"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065687"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r Value
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><span class="annottext">(InterpreterError -&gt; Eff r Value)
-&gt; InterpreterError -&gt; Eff r Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#UnhandledExpr"><span class="hs-identifier hs-var">UnhandledExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065687"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span id="local-6989586621680064291"><span class="annot"><a href="Elara.Interpreter.html#interpretBinding"><span class="hs-identifier hs-type">interpretBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064291"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064291"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-397"></span><span id="interpretBinding"><span class="annot"><span class="annottext">interpretBinding :: forall (r :: [Effect]). Interpreter r =&gt; CoreBind -&gt; Eff r ()
</span><a href="Elara.Interpreter.html#interpretBinding"><span class="hs-identifier hs-var hs-var">interpretBinding</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#NonRecursive"><span class="hs-identifier hs-type">NonRecursive</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span id="local-6989586621680065833"><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680065833"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680065834"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065834"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r () -&gt; Eff r ()
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;interpretBinding: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680065833"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r () -&gt; Eff r ()) -&gt; Eff r () -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-398"></span><span>    </span><span id="local-6989586621680065835"><span class="annot"><a href="#local-6989586621680065835"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065834"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680065833"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-400"></span><span>        </span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680065836"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065836"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ElaraState -&gt; ElaraState) -&gt; Eff r ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680065837"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065837"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065837"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680065836"><span class="hs-identifier hs-type">qn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065835"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065837"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>        </span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680065838"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065838"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ElaraState -&gt; ElaraState) -&gt; Eff r ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680065839"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065839"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065839"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680065838"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065835"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065839"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span class="hs-comment">-- Tie-the-knot letrec with thunks for non-functions, RecClosure for functions</span><span>
</span><span id="line-403"></span><span class="annot"><a href="Elara.Interpreter.html#interpretBinding"><span class="hs-identifier hs-var">interpretBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Generic.html#Recursive"><span class="hs-identifier hs-type">Recursive</span></a></span><span> </span><span id="local-6989586621680065841"><span class="annot"><span class="annottext">[(Var, CoreExpr)]
</span><a href="#local-6989586621680065841"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r () -&gt; Eff r ()
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;interpretBinding Rec: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var, CoreExpr) -&gt; Var
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Var, CoreExpr) -&gt; Var) -&gt; [(Var, CoreExpr)] -&gt; [Var]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Var, CoreExpr)]
</span><a href="#local-6989586621680065841"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r () -&gt; Eff r ()) -&gt; Eff r () -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-404"></span><span>    </span><span id="local-6989586621680065843"><span class="annot"><a href="#local-6989586621680065843"><span class="hs-identifier hs-var">curLocals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ElaraState -&gt; Map (Unique Text) Value)
-&gt; Eff r (Map (Unique Text) Value)
forall s (es :: [Effect]) a.
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; a) -&gt; Eff es a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ElaraState -&gt; Map (Unique Text) Value
</span><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-comment">-- Split bindings by Local/Global to avoid partial pattern matches</span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680065844"><span class="annot"><a href="#local-6989586621680065844"><span class="hs-identifier hs-var">localBs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680065845"><span class="annot"><a href="#local-6989586621680065845"><span class="hs-identifier hs-var">globalBs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-407"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">partitionEithers</span></span><span>
</span><span id="line-408"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680065847"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-409"></span><span>                    </span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680065848"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065848"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Unique Text, CoreExpr)
-&gt; Either (Unique Text, CoreExpr) (Qualified Text, CoreExpr)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique Text
VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065848"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065849"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>                    </span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680065850"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065850"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Qualified Text, CoreExpr)
-&gt; Either (Unique Text, CoreExpr) (Qualified Text, CoreExpr)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Text
VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065850"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065849"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span id="local-6989586621680065847"><span class="annot"><a href="#local-6989586621680065847"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680065849"><span class="annot"><a href="#local-6989586621680065849"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621680065841"><span class="hs-identifier hs-type">bs</span></a></span><span>
</span><span id="line-412"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-comment">-- Placeholders for all bindings</span><span>
</span><span id="line-415"></span><span>    </span><span id="local-6989586621680065851"><span class="annot"><a href="#local-6989586621680065851"><span class="hs-identifier hs-var">placeholdersLocal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-416"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Map.fromList</span></span><span>
</span><span id="line-417"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span>
</span><span id="line-418"></span><span>                </span><span class="annot"><a href="#local-6989586621680065844"><span class="hs-identifier hs-type">localBs</span></a></span><span>
</span><span id="line-419"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680065853"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065853"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680065854"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065854"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065853"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-420"></span><span>                    </span><span id="local-6989586621680065855"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065855"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-421"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065854"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-422"></span><span>                            </span><span class="annot"><a href="Elara.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680065856"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065856"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680065857"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065857"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Unique Text, Value) -&gt; Eff r (Unique Text, Value)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065855"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
-&gt; UnlocatedVarRef Text -&gt; Unique Text -&gt; CoreExpr -&gt; Value
</span><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-var">RecClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
-&gt; UnlocatedVarRef Text
forall (c :: VarRefKind) n. VarRefImpl c (Unique n) -&gt; VarRef' c n
</span><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-var">Local</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065855"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unique Text
VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065856"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065857"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>                            </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680065859"><span class="annot"><a href="#local-6989586621680065859"><span class="hs-identifier hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value -&gt; Eff r Value
forall (r :: [Effect]).
Interpreter r =&gt;
Eff InterpreterEffects Value -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#mkThunk"><span class="hs-identifier hs-var">mkThunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff InterpreterEffects Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065854"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680065855"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680065859"><span class="hs-identifier hs-type">th</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621680065860"><span class="annot"><a href="#local-6989586621680065860"><span class="hs-identifier hs-var">placeholdersGlobal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-426"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Map.fromList</span></span><span>
</span><span id="line-427"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span>
</span><span id="line-428"></span><span>                </span><span class="annot"><a href="#local-6989586621680065845"><span class="hs-identifier hs-type">globalBs</span></a></span><span>
</span><span id="line-429"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680065861"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680065861"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680065862"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065862"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680065861"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-430"></span><span>                    </span><span id="local-6989586621680065863"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680065863"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-431"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065862"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-432"></span><span>                            </span><span class="annot"><a href="Elara.Core.html#Lam"><span class="hs-identifier hs-type">Lam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680065864"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065864"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680065865"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065865"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Qualified Text, Value) -&gt; Eff r (Qualified Text, Value)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680065863"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
-&gt; UnlocatedVarRef Text -&gt; Unique Text -&gt; CoreExpr -&gt; Value
</span><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-var">RecClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
-&gt; UnlocatedVarRef Text
forall (c :: VarRefKind) n.
VarRefImpl c (Qualified n) -&gt; VarRef' c n
</span><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-var">Global</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680065863"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unique Text
VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680065864"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065865"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>                            </span><span class="annot"><span class="annottext">CoreExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621680065866"><span class="annot"><a href="#local-6989586621680065866"><span class="hs-identifier hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value -&gt; Eff r Value
forall (r :: [Effect]).
Interpreter r =&gt;
Eff InterpreterEffects Value -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#mkThunk"><span class="hs-identifier hs-var">mkThunk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; Eff InterpreterEffects Value
forall (r :: [Effect]). Interpreter r =&gt; CoreExpr -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#interpretExpr"><span class="hs-identifier hs-var">interpretExpr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065862"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680065863"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680065866"><span class="hs-identifier hs-type">th</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-comment">-- Final env captured by recursive functions (locals only)</span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065867"><span class="annot"><a href="#local-6989586621680065867"><span class="hs-identifier hs-var hs-var">finalLocalEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
-&gt; Map (Unique Text) Value -&gt; Map (Unique Text) Value
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.union</span></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065851"><span class="hs-identifier hs-var">placeholdersLocal</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065843"><span class="hs-identifier hs-var">curLocals</span></a></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-comment">-- Update RecClosures to capture finalLocalEnv</span><span>
</span><span id="line-440"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065869"><span class="annot"><a href="#local-6989586621680065869"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-441"></span><span>            </span><span class="annot"><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-type">RecClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680065870"><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680065870"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680065871"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065871"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621680065872"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065872"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
-&gt; UnlocatedVarRef Text -&gt; Unique Text -&gt; CoreExpr -&gt; Value
</span><a href="Elara.Interpreter.html#RecClosure"><span class="hs-identifier hs-var">RecClosure</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065867"><span class="hs-identifier hs-var">finalLocalEnv</span></a></span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680065870"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680065871"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621680065872"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-442"></span><span>            </span><span id="local-6989586621680065873"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065873"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680065873"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-443"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680065874"><span class="annot"><a href="#local-6989586621680065874"><span class="hs-identifier hs-var hs-var">updatedLocals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value)
-&gt; Map (Unique Text) Value -&gt; Map (Unique Text) Value
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="#local-6989586621680065869"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
</span><a href="#local-6989586621680065851"><span class="hs-identifier hs-var">placeholdersLocal</span></a></span><span>
</span><span id="line-444"></span><span>        </span><span id="local-6989586621680065876"><span class="annot"><a href="#local-6989586621680065876"><span class="hs-identifier hs-var hs-var">updatedGlobals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value)
-&gt; Map (Qualified Text) Value -&gt; Map (Qualified Text) Value
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="#local-6989586621680065869"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Qualified Text) Value
</span><a href="#local-6989586621680065860"><span class="hs-identifier hs-var">placeholdersGlobal</span></a></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-comment">-- Install all placeholders (functions and thunks) so RHS can refer mutually</span><span>
</span><span id="line-447"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">modify</span></span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680065877"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065877"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-449"></span><span>            </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065877"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-450"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.union</span></span><span> </span><span class="annot"><a href="#local-6989586621680065874"><span class="hs-identifier hs-type">updatedLocals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065877"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.union</span></span><span> </span><span class="annot"><a href="#local-6989586621680065876"><span class="hs-identifier hs-type">updatedGlobals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065877"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-453"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="annot"><span class="hs-comment">-- | Load a module into the interpreter</span></span><span>
</span><span id="line-456"></span><span id="local-6989586621680064276"><span class="annot"><a href="Elara.Interpreter.html#loadModule"><span class="hs-identifier hs-type">loadModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064276"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064276"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-457"></span><span id="loadModule"><span class="annot"><span class="annottext">loadModule :: forall (r :: [Effect]).
Interpreter r =&gt;
CoreModule CoreBind -&gt; Eff r ()
</span><a href="Elara.Interpreter.html#loadModule"><span class="hs-identifier hs-var hs-var">loadModule</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a></span><span> </span><span id="local-6989586621680065937"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680065937"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680065938"><span class="annot"><span class="annottext">[CoreDeclaration CoreBind]
</span><a href="#local-6989586621680065938"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r () -&gt; Eff r ()
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;loadModule:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680065937"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r () -&gt; Eff r ()) -&gt; Eff r () -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621680065939"><span class="annot"><a href="#local-6989586621680065939"><span class="hs-identifier hs-var">loaded</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ElaraState -&gt; Set ModuleName) -&gt; Eff r (Set ModuleName)
forall s (es :: [Effect]) a.
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; a) -&gt; Eff es a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ElaraState -&gt; Set ModuleName
</span><a href="Elara.Interpreter.html#loadedModules"><span class="hs-identifier hs-var">loadedModules</span></a></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.member</span></span><span> </span><span class="annot"><a href="#local-6989586621680065937"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065939"><span class="hs-identifier hs-type">loaded</span></a></span><span>
</span><span id="line-460"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Module&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065937"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;already loaded, skipping&quot;</span></span><span>
</span><span id="line-461"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-462"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680065941"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065941"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065941"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.Interpreter.html#loadedModules"><span class="hs-identifier hs-var">loadedModules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680065937"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#loadedModules"><span class="hs-identifier hs-var">loadedModules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065941"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>            </span><span id="local-6989586621680065943"><span class="annot"><a href="#local-6989586621680065943"><span class="hs-identifier hs-var">oldBindings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">gets</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span>
</span><span id="line-464"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">for_</span></span><span>
</span><span id="line-465"></span><span>                </span><span class="annot"><a href="#local-6989586621680065938"><span class="hs-identifier hs-type">decls</span></a></span><span>
</span><span id="line-466"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-467"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreValue"><span class="hs-identifier hs-type">CoreValue</span></a></span><span> </span><span id="local-6989586621680065946"><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621680065946"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Eff r () -&gt; Eff r ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Eff r () -&gt; Eff r ()) -&gt; Eff r () -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CoreBind -&gt; Eff r ()
forall (r :: [Effect]). Interpreter r =&gt; CoreBind -&gt; Eff r ()
</span><a href="Elara.Interpreter.html#interpretBinding"><span class="hs-identifier hs-var">interpretBinding</span></a></span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621680065946"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-468"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreType"><span class="hs-identifier hs-type">CoreType</span></a></span><span> </span><span id="local-6989586621680065949"><span class="annot"><span class="annottext">CoreTypeDecl
</span><a href="#local-6989586621680065949"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreTypeDecl -&gt; Eff r ()
forall (r :: [Effect]). Interpreter r =&gt; CoreTypeDecl -&gt; Eff r ()
</span><a href="Elara.Interpreter.html#loadTypeDecl"><span class="hs-identifier hs-var">loadTypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTypeDecl
</span><a href="#local-6989586621680065949"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-469"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>            </span><span id="local-6989586621680065951"><span class="annot"><a href="#local-6989586621680065951"><span class="hs-identifier hs-var">newEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">gets</span></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span>
</span><span id="line-471"></span><span>            </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Loaded module&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065937"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;with bindings&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.difference</span></span><span> </span><span class="annot"><a href="#local-6989586621680065951"><span class="hs-identifier hs-type">newEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065943"><span class="hs-identifier hs-type">oldBindings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span id="local-6989586621680064345"><span class="annot"><a href="Elara.Interpreter.html#loadTypeDecl"><span class="hs-identifier hs-type">loadTypeDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064345"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeDecl"><span class="hs-identifier hs-type">CoreTypeDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064345"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-474"></span><span id="loadTypeDecl"><span class="annot"><span class="annottext">loadTypeDecl :: forall (r :: [Effect]). Interpreter r =&gt; CoreTypeDecl -&gt; Eff r ()
</span><a href="Elara.Interpreter.html#loadTypeDecl"><span class="hs-identifier hs-var hs-var">loadTypeDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeDecl"><span class="hs-identifier hs-type">CoreTypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ElaraKind
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeVariable]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreDataDecl"><span class="hs-identifier hs-type">CoreDataDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680065966"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621680065966"><span class="hs-identifier hs-var">cons</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-475"></span><span>    </span><span class="annot"><span class="annottext">[DataCon] -&gt; (DataCon -&gt; Eff r ()) -&gt; Eff r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621680065966"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="annot"><span class="annottext">((DataCon -&gt; Eff r ()) -&gt; Eff r ())
-&gt; (DataCon -&gt; Eff r ()) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680065967"><span class="annot"><span class="annottext">con :: DataCon
</span><a href="#local-6989586621680065967"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span id="local-6989586621680065968"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680065968"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>        </span><span class="annot"><span class="annottext">(ElaraState -&gt; ElaraState) -&gt; Eff r ()
forall s (es :: [Effect]).
(HasCallStack, State s :&gt; es) =&gt;
(s -&gt; s) -&gt; Eff es ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680065969"><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065969"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680065969"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680065968"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Ctor"><span class="hs-identifier hs-type">Ctor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065967"><span class="hs-identifier hs-type">con</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065969"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span class="annot"><a href="Elara.Interpreter.html#loadTypeDecl"><span class="hs-identifier hs-var">loadTypeDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeDecl"><span class="hs-identifier hs-type">CoreTypeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ElaraKind
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeVariable]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeAlias"><span class="hs-identifier hs-type">CoreTypeAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Eff r ()
forall (f :: * -&gt; *). Applicative f =&gt; f ()
</span><span class="hs-identifier hs-var">pass</span></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span id="local-6989586621680065972"><span class="annot"><a href="Elara.Interpreter.html#evalIO"><span class="hs-identifier hs-type">evalIO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680065972"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680065972"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.Interpreter.html#Value"><span class="hs-identifier hs-type">Value</span></a></span></span><span>
</span><span id="line-480"></span><span id="evalIO"><span class="annot"><span class="annottext">evalIO :: forall (r :: [Effect]). Interpreter r =&gt; Value -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#evalIO"><span class="hs-identifier hs-var hs-var">evalIO</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#IOAction"><span class="hs-identifier hs-type">IOAction</span></a></span><span> </span><span id="local-6989586621680066007"><span class="annot"><span class="annottext">Eff InterpreterEffects Value
</span><a href="#local-6989586621680066007"><span class="hs-identifier hs-var">io</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-481"></span><span>    </span><span id="local-6989586621680066008"><span class="annot"><a href="#local-6989586621680066008"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value -&gt; Eff r Value
forall (subEs :: [Effect]) (es :: [Effect]) a.
Subset subEs es =&gt;
Eff subEs a -&gt; Eff es a
</span><span class="hs-identifier hs-var">inject</span></span><span> </span><span class="annot"><span class="annottext">Eff InterpreterEffects Value
</span><a href="#local-6989586621680066007"><span class="hs-identifier hs-var">io</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#evalIO"><span class="hs-identifier hs-type">evalIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680066008"><span class="hs-identifier hs-type">val</span></a></span><span>
</span><span id="line-483"></span><span class="annot"><a href="Elara.Interpreter.html#evalIO"><span class="hs-identifier hs-var">evalIO</span></a></span><span> </span><span id="local-6989586621680066009"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680066009"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680066009"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="annot"><span class="hs-comment">-- | Looks for a value Main.main in the bindings and runs it</span></span><span>
</span><span id="line-486"></span><span id="local-6989586621680064355"><span class="annot"><a href="Elara.Interpreter.html#run"><span class="hs-identifier hs-type">run</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Interpreter.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064355"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html#QueryEffects"><span class="hs-identifier hs-type">QueryEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680064355"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680064355"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680064355"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-487"></span><span id="run"><span class="annot"><span class="annottext">run :: forall (r :: [Effect]).
(Interpreter r, QueryEffects r, Rock Query :&gt; r) =&gt;
Eff r ()
</span><a href="Elara.Interpreter.html#run"><span class="hs-identifier hs-var hs-var">run</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-488"></span><span>    </span><span id="local-6989586621680066061"><span class="annot"><a href="#local-6989586621680066061"><span class="hs-identifier hs-var">mainModule</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) (CoreModule CoreBind)
-&gt; Eff r (CoreModule CoreBind)
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
-&gt; Query (Rock Query : ConsQueryEffects '[]) (CoreModule CoreBind)
</span><a href="Elara.Query.html#GetFinalisedCoreModule"><span class="hs-identifier hs-var">Elara.Query.GetFinalisedCoreModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty Text -&gt; ModuleName
</span><a href="Elara.AST.Name.html#ModuleName"><span class="hs-identifier hs-var">ModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Main&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; NonEmpty Text
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><a href="Elara.Interpreter.html#loadModule"><span class="hs-identifier hs-type">loadModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680066061"><span class="hs-identifier hs-type">mainModule</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span id="local-6989586621680066064"><span class="annot"><a href="#local-6989586621680066064"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">get</span></span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;main&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Main&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier">s</span></span><span class="hs-operator">.</span><span class="hs-identifier">globalBindings</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-492"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680066065"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680066065"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>            </span><span class="annot"><span class="annottext">Value -&gt; Eff r Value
forall (r :: [Effect]). Interpreter r =&gt; Value -&gt; Eff r Value
</span><a href="Elara.Interpreter.html#evalIO"><span class="hs-identifier hs-var">evalIO</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680066065"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-494"></span><span>            </span><span class="annot"><span class="annottext">Eff r ()
forall (f :: * -&gt; *). Applicative f =&gt; f ()
</span><span class="hs-identifier hs-var">pass</span></span><span>
</span><span id="line-495"></span><span>        </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InterpreterError -&gt; Eff r ()
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError_</span></span><span> </span><span class="annot"><span class="annottext">(InterpreterError -&gt; Eff r ()) -&gt; InterpreterError -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ElaraState -&gt; InterpreterError
</span><a href="Elara.Interpreter.html#NoMainFound"><span class="hs-identifier hs-var">NoMainFound</span></a></span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680066064"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span id="runInterpreter"><span class="annot"><span class="annottext">runInterpreter :: Eff (State ElaraState : Error InterpreterError : es) a -&gt; Eff es a
</span><a href="Elara.Interpreter.html#runInterpreter"><span class="hs-identifier hs-var hs-var">runInterpreter</span></a></span></span><span> </span><span id="local-6989586621680066080"><span class="annot"><span class="annottext">Eff (State ElaraState : Error InterpreterError : es) a
</span><a href="#local-6989586621680066080"><span class="hs-identifier hs-var">eff</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680066081"><span class="annot"><span class="annottext">s :: ElaraState
</span><a href="#local-6989586621680066081"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Elara.Interpreter.html#ElaraState"><span class="hs-identifier hs-type">ElaraState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">localBindings :: Map (Unique Text) Value
</span><a href="Elara.Interpreter.html#localBindings"><span class="hs-identifier hs-var">localBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Unique Text) Value
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">globalBindings :: Map (Qualified Text) Value
</span><a href="Elara.Interpreter.html#globalBindings"><span class="hs-identifier hs-var">globalBindings</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Qualified Text) Value
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loadedModules :: Set ModuleName
</span><a href="Elara.Interpreter.html#loadedModules"><span class="hs-identifier hs-var">loadedModules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set ModuleName
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stateSource :: StateSource
</span><a href="Elara.Interpreter.html#stateSource"><span class="hs-identifier hs-var">stateSource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateSource
</span><a href="Elara.Interpreter.html#FromGlobal"><span class="hs-identifier hs-var">FromGlobal</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-499"></span><span>    </span><span class="annot"><span class="annottext">Eff es a -&gt; Eff es a
forall (subEs :: [Effect]) (es :: [Effect]) a.
Subset subEs es =&gt;
Eff subEs a -&gt; Eff es a
</span><span class="hs-identifier hs-var">inject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall e (r :: [Effect]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Interpreter.html#InterpreterError"><span class="hs-identifier hs-type">InterpreterError</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff (Error InterpreterError : es) a -&gt; Eff es a)
-&gt; Eff (Error InterpreterError : es) a -&gt; Eff es a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ElaraState
-&gt; Eff (State ElaraState : Error InterpreterError : es) a
-&gt; Eff (Error InterpreterError : es) a
forall s (es :: [Effect]) a.
HasCallStack =&gt;
s -&gt; Eff (State s : es) a -&gt; Eff es a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="annot"><span class="annottext">ElaraState
</span><a href="#local-6989586621680066081"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Eff (State ElaraState : Error InterpreterError : es) a
</span><a href="#local-6989586621680066080"><span class="hs-identifier hs-var">eff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span></pre></body></html>