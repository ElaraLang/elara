<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.html"><span class="hs-identifier">Elara.JVM.Lower</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.Lower.html#lowerModule"><span class="hs-identifier">lowerModule</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Name.html"><span class="hs-identifier">Elara.AST.Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#NameLike"><span class="hs-identifier">NameLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier">nameText</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#unqualified"><span class="hs-identifier">unqualified</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html"><span class="hs-identifier">Elara.AST.VarRef</span></a></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.html"><span class="hs-identifier">Elara.Core</span></a></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.html"><span class="hs-identifier">Elara.Core</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Core</span></span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.Generic.html"><span class="hs-identifier">Elara.Core.Generic</span></a></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.Module.html"><span class="hs-identifier">Elara.Core.Module</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Core.Pretty.html"><span class="hs-identifier">Elara.Core.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Unique.html"><span class="hs-identifier">Elara.Data.Unique</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html"><span class="hs-identifier">Elara.Data.Unique.Effect</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier">makeUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html"><span class="hs-identifier">Elara.JVM.IR</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IR</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.ADT.html"><span class="hs-identifier">Elara.JVM.Lower.ADT</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Expr.html"><span class="hs-identifier">Elara.JVM.Lower.Expr</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Function.html"><span class="hs-identifier">Elara.JVM.Lower.Function</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Monad.html"><span class="hs-identifier">Elara.JVM.Lower.Monad</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Util.html"><span class="hs-identifier">Elara.JVM.Lower.Util</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Prim.html"><span class="hs-identifier">Elara.Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Prim.html#fetchPrimitiveName"><span class="hs-identifier">fetchPrimitiveName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Prim.html#mkPrimQual"><span class="hs-identifier">mkPrimQual</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.Descriptor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ReturnDescriptor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TypeReturn</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.Descriptor</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">JVM</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.Type</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">JVM</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Convert</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Print.html"><span class="hs-identifier">Print</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Print.html#showPretty"><span class="hs-identifier">showPretty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span id="local-6989586621680177196"><span class="annot"><a href="Elara.JVM.Lower.html#lowerModule"><span class="hs-identifier hs-type">lowerModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Monad.html#Lower"><span class="hs-identifier hs-type">Lower</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177196"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a></span><span> </span><span class="annot"><a href="Elara.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680177196"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Module"><span class="hs-identifier hs-type">IR.Module</span></a></span></span><span>
</span><span id="line-27"></span><span id="lowerModule"><span class="annot"><span class="annottext">lowerModule :: forall (r :: [Effect]).
Lower r =&gt;
CoreModule CoreBind -&gt; Eff r Module
</span><a href="Elara.JVM.Lower.html#lowerModule"><span class="hs-identifier hs-var hs-var">lowerModule</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreModule"><span class="hs-identifier hs-type">CoreModule</span></a></span><span> </span><span id="local-6989586621680177383"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680177383"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680177384"><span class="annot"><span class="annottext">[CoreDeclaration CoreBind]
</span><a href="#local-6989586621680177384"><span class="hs-identifier hs-var">decls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177385"><span class="annot"><span class="annottext">moduleClassName :: QualifiedClassName
</span><a href="#local-6989586621680177385"><span class="hs-identifier hs-var hs-var hs-var">moduleClassName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; QualifiedClassName
</span><a href="Elara.JVM.Lower.Util.html#moduleNameToQualifiedClassName"><span class="hs-identifier hs-var">moduleNameToQualifiedClassName</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680177383"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680177387"><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621680177387"><span class="hs-identifier hs-var hs-var">valueDecls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680177388"><span class="annot"><span class="annottext">[CoreTypeDecl]
</span><a href="#local-6989586621680177388"><span class="hs-identifier hs-var hs-var">typeDecls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreDeclaration CoreBind] -&gt; ([CoreBind], [CoreTypeDecl])
forall bind. [CoreDeclaration bind] -&gt; ([bind], [CoreTypeDecl])
</span><a href="#local-6989586621680177389"><span class="hs-identifier hs-var">partitionDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreDeclaration CoreBind]
</span><a href="#local-6989586621680177384"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span id="local-6989586621680177390"><span class="annot"><a href="#local-6989586621680177390"><span class="hs-identifier hs-var">methods</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[Method]] -&gt; [Method]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[Method]] -&gt; [Method]) -&gt; Eff r [[Method]] -&gt; Eff r [Method]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(CoreBind -&gt; Eff r [Method]) -&gt; [CoreBind] -&gt; Eff r [[Method]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">CoreBind -&gt; Eff r [Method]
forall (r :: [Effect]). Lower r =&gt; CoreBind -&gt; Eff r [Method]
</span><a href="Elara.JVM.Lower.html#lowerBindToMethod"><span class="hs-identifier hs-var">lowerBindToMethod</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreBind]
</span><a href="#local-6989586621680177387"><span class="hs-identifier hs-var">valueDecls</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177395"><span class="annot"><a href="#local-6989586621680177395"><span class="hs-identifier hs-var hs-var">mainClass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-32"></span><span>            </span><span class="annot"><a href="Elara.JVM.IR.html#Class"><span class="hs-identifier hs-type">IR.Class</span></a></span><span>
</span><span id="line-33"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">className :: QualifiedClassName
</span><a href="Elara.JVM.IR.html#className"><span class="hs-identifier hs-var">IR.className</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680177385"><span class="hs-identifier hs-var">moduleClassName</span></a></span><span>
</span><span id="line-34"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">classSuper :: QualifiedClassName
</span><a href="Elara.JVM.IR.html#classSuper"><span class="hs-identifier hs-var">IR.classSuper</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-identifier hs-var">jloName</span></span><span>
</span><span id="line-35"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">classFields :: [Field]
</span><a href="Elara.JVM.IR.html#classFields"><span class="hs-identifier hs-var">IR.classFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-36"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">classMethods :: [Method]
</span><a href="Elara.JVM.IR.html#classMethods"><span class="hs-identifier hs-var">IR.classMethods</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Method]
</span><a href="#local-6989586621680177390"><span class="hs-identifier hs-var">methods</span></a></span><span>
</span><span id="line-37"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">classConstructors :: [Constructor]
</span><a href="Elara.JVM.IR.html#classConstructors"><span class="hs-identifier hs-var">IR.classConstructors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-38"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>    </span><span id="local-6989586621680177403"><span class="annot"><a href="#local-6989586621680177403"><span class="hs-identifier hs-var">dataClasses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="Elara.JVM.Lower.html#lowerTypeDecl"><span class="hs-identifier hs-type">lowerTypeDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177388"><span class="hs-identifier hs-type">typeDecls</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Module"><span class="hs-identifier hs-type">IR.Module</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177385"><span class="hs-identifier hs-type">moduleClassName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680177395"><span class="hs-identifier hs-type">mainClass</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621680177403"><span class="hs-identifier hs-type">dataClasses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-44"></span><span>    </span><span id="local-6989586621680177210"><span class="annot"><a href="#local-6989586621680177389"><span class="hs-identifier hs-type">partitionDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.Core.Module.html#CoreDeclaration"><span class="hs-identifier hs-type">CoreDeclaration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177210"><span class="hs-identifier hs-type">bind</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680177210"><span class="hs-identifier hs-type">bind</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeDecl"><span class="hs-identifier hs-type">CoreTypeDecl</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-45"></span><span>    </span><span id="local-6989586621680177389"><span class="annot"><span class="annottext">partitionDecls :: forall bind. [CoreDeclaration bind] -&gt; ([bind], [CoreTypeDecl])
</span><a href="#local-6989586621680177389"><span class="hs-identifier hs-var hs-var">partitionDecls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CoreDeclaration bind
 -&gt; ([bind], [CoreTypeDecl]) -&gt; ([bind], [CoreTypeDecl]))
-&gt; ([bind], [CoreTypeDecl])
-&gt; [CoreDeclaration bind]
-&gt; ([bind], [CoreTypeDecl])
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">CoreDeclaration bind
-&gt; ([bind], [CoreTypeDecl]) -&gt; ([bind], [CoreTypeDecl])
forall {a}.
CoreDeclaration a -&gt; ([a], [CoreTypeDecl]) -&gt; ([a], [CoreTypeDecl])
</span><a href="#local-6989586621680177408"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-47"></span><span>        </span><span id="local-6989586621680177408"><span class="annot"><span class="annottext">step :: CoreDeclaration a -&gt; ([a], [CoreTypeDecl]) -&gt; ([a], [CoreTypeDecl])
</span><a href="#local-6989586621680177408"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreValue"><span class="hs-identifier hs-type">CoreValue</span></a></span><span> </span><span id="local-6989586621680177410"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680177410"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680177411"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680177411"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680177412"><span class="annot"><span class="annottext">[CoreTypeDecl]
</span><a href="#local-6989586621680177412"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680177410"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680177411"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CoreTypeDecl]
</span><a href="#local-6989586621680177412"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>        </span><span class="annot"><a href="#local-6989586621680177408"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreType"><span class="hs-identifier hs-type">CoreType</span></a></span><span> </span><span id="local-6989586621680177414"><span class="annot"><span class="annottext">CoreTypeDecl
</span><a href="#local-6989586621680177414"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680177415"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680177415"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680177416"><span class="annot"><span class="annottext">[CoreTypeDecl]
</span><a href="#local-6989586621680177416"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680177415"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreTypeDecl
</span><a href="#local-6989586621680177414"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">CoreTypeDecl -&gt; [CoreTypeDecl] -&gt; [CoreTypeDecl]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[CoreTypeDecl]
</span><a href="#local-6989586621680177416"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span id="local-6989586621680177221"><span class="annot"><a href="Elara.JVM.Lower.html#lowerBindToMethod"><span class="hs-identifier hs-type">lowerBindToMethod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Monad.html#Lower"><span class="hs-identifier hs-type">Lower</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177221"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680177221"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.JVM.IR.html#Method"><span class="hs-identifier hs-type">IR.Method</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-51"></span><span id="lowerBindToMethod"><span class="annot"><span class="annottext">lowerBindToMethod :: forall (r :: [Effect]). Lower r =&gt; CoreBind -&gt; Eff r [Method]
</span><a href="Elara.JVM.Lower.html#lowerBindToMethod"><span class="hs-identifier hs-var hs-var">lowerBindToMethod</span></a></span></span><span> </span><span id="local-6989586621680177424"><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621680177424"><span class="hs-identifier hs-var">bind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreBind
</span><a href="#local-6989586621680177424"><span class="hs-identifier hs-var">bind</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Elara.Core.Generic.html#NonRecursive"><span class="hs-identifier hs-type">NonRecursive</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680177426"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680177426"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680177427"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177427"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-53"></span><span>        </span><span id="local-6989586621680177428"><span class="annot"><a href="#local-6989586621680177428"><span class="hs-identifier hs-var">method</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Expr Var -&gt; Eff r Method
forall (r :: [Effect]). Lower r =&gt; Var -&gt; Expr Var -&gt; Eff r Method
</span><a href="Elara.JVM.Lower.html#lowerSingleBind"><span class="hs-identifier hs-var">lowerSingleBind</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680177426"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177427"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680177428"><span class="hs-identifier hs-type">method</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-comment">-- recursive bindings are easy on the jvm :)</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="Elara.Core.Generic.html#Recursive"><span class="hs-identifier hs-type">Recursive</span></a></span><span> </span><span id="local-6989586621680177431"><span class="annot"><span class="annottext">[(Var, Expr Var)]
</span><a href="#local-6989586621680177431"><span class="hs-identifier hs-var">bindings</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><span class="annottext">((Var, Expr Var) -&gt; Eff r Method)
-&gt; [(Var, Expr Var)] -&gt; Eff r [Method]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Var -&gt; Expr Var -&gt; Eff r Method)
-&gt; (Var, Expr Var) -&gt; Eff r Method
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Expr Var -&gt; Eff r Method
forall (r :: [Effect]). Lower r =&gt; Var -&gt; Expr Var -&gt; Eff r Method
</span><a href="Elara.JVM.Lower.html#lowerSingleBind"><span class="hs-identifier hs-var">lowerSingleBind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Var, Expr Var)]
</span><a href="#local-6989586621680177431"><span class="hs-identifier hs-var">bindings</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="annot"><span class="hs-comment">-- | Helper function to build a static method</span></span><span>
</span><span id="line-61"></span><span class="annot"><a href="Elara.JVM.Lower.html#buildStaticMethod"><span class="hs-identifier hs-type">buildStaticMethod</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Method name</span></span><span>
</span><span id="line-63"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Arguments (name and type)</span></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JVM.FieldType</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-66"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Return type</span></span><span>
</span><span id="line-67"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">JVM.FieldType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Method body</span></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Elara.JVM.IR.html#Block"><span class="hs-identifier hs-type">IR.Block</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#Method"><span class="hs-identifier hs-type">IR.Method</span></a></span><span>
</span><span id="line-71"></span><span id="buildStaticMethod"><span class="annot"><span class="annottext">buildStaticMethod :: Text
-&gt; [(Unique Text, FieldType)] -&gt; FieldType -&gt; [Block] -&gt; Method
</span><a href="Elara.JVM.Lower.html#buildStaticMethod"><span class="hs-identifier hs-var hs-var">buildStaticMethod</span></a></span></span><span> </span><span id="local-6989586621680177434"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680177434"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680177435"><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177435"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621680177436"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680177436"><span class="hs-identifier hs-var">retType</span></a></span></span><span> </span><span id="local-6989586621680177437"><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680177437"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#Method"><span class="hs-identifier hs-type">IR.Method</span></a></span><span>
</span><span id="line-73"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">methodName :: Text
</span><a href="Elara.JVM.IR.html#methodName"><span class="hs-identifier hs-var">IR.methodName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680177434"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">methodDesc :: MethodDescriptor
</span><a href="Elara.JVM.IR.html#methodDesc"><span class="hs-identifier hs-var">IR.methodDesc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">JVM.MethodDescriptor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Unique Text, FieldType) -&gt; FieldType)
-&gt; [(Unique Text, FieldType)] -&gt; [FieldType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Unique Text, FieldType) -&gt; FieldType
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177435"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680177436"><span class="hs-identifier hs-var">retType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">methodArgs :: [(Unique Text, FieldType)]
</span><a href="Elara.JVM.IR.html#methodArgs"><span class="hs-identifier hs-var">IR.methodArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177435"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">methodBody :: [Block]
</span><a href="Elara.JVM.IR.html#methodBody"><span class="hs-identifier hs-var">IR.methodBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680177437"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">methodIsStatic :: Bool
</span><a href="Elara.JVM.IR.html#methodIsStatic"><span class="hs-identifier hs-var">IR.methodIsStatic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><span class="hs-comment">-- | Lower a single binding to a method</span></span><span>
</span><span id="line-81"></span><span id="local-6989586621680177241"><span class="annot"><a href="Elara.JVM.Lower.html#lowerSingleBind"><span class="hs-identifier hs-type">lowerSingleBind</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="Elara.JVM.Lower.Monad.html#Lower"><span class="hs-identifier hs-type">Lower</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177241"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680177241"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Method"><span class="hs-identifier hs-type">IR.Method</span></a></span></span><span>
</span><span id="line-86"></span><span id="lowerSingleBind"><span class="annot"><span class="annottext">lowerSingleBind :: forall (r :: [Effect]). Lower r =&gt; Var -&gt; Expr Var -&gt; Eff r Method
</span><a href="Elara.JVM.Lower.html#lowerSingleBind"><span class="hs-identifier hs-var hs-var">lowerSingleBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#TyVar"><span class="hs-identifier hs-type">Core.TyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; Eff r Method
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Type variable cannot be bound to a method&quot;</span></span><span>
</span><span id="line-88"></span><span class="annot"><a href="Elara.JVM.Lower.html#lowerSingleBind"><span class="hs-identifier hs-var">lowerSingleBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span id="local-6989586621680177514"><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680177514"><span class="hs-identifier hs-var">varRef</span></a></span></span><span> </span><span id="local-6989586621680177515"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680177515"><span class="hs-identifier hs-var">type_</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680177516"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177516"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177517"><span class="annot"><span class="annottext">methodName :: Text
</span><a href="#local-6989586621680177517"><span class="hs-identifier hs-var hs-var hs-var">methodName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnlocatedVarRef Text
</span><a href="#local-6989586621680177514"><span class="hs-identifier hs-var">varRef</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-90"></span><span>            </span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680177519"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680177519"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Qualified Text
VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680177519"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Optic' A_Lens NoIx (Qualified Text) Text -&gt; Text
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx (Qualified Text) Text
forall name. Lens' (Qualified name) name
</span><a href="Elara.AST.Name.html#unqualified"><span class="hs-identifier hs-var">unqualified</span></a></span><span>
</span><span id="line-91"></span><span>            </span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680177522"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680177522"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Unique Text -&gt; Text
forall a. (a -&gt; Text) -&gt; Unique a -&gt; Text
</span><a href="Elara.Data.Unique.html#uniqueToText"><span class="hs-identifier hs-var">uniqueToText</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. a -&gt; a
</span><a href="Prelude.html#identity"><span class="hs-identifier hs-var">identity</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680177522"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621680177525"><span class="annot"><a href="#local-6989586621680177525"><span class="hs-identifier hs-var">mPrim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Type -&gt; Expr Var -&gt; Eff r (Maybe Method)
forall (r :: [Effect]).
Lower r =&gt;
Text -&gt; Type -&gt; Expr Var -&gt; Eff r (Maybe Method)
</span><a href="Elara.JVM.Lower.html#lowerPrimitiveBinding"><span class="hs-identifier hs-var">lowerPrimitiveBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680177517"><span class="hs-identifier hs-var">methodName</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680177515"><span class="hs-identifier hs-var">type_</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177516"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680177525"><span class="hs-identifier hs-type">mPrim</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-95"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680177527"><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621680177527"><span class="hs-identifier hs-var">primMethod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Method -&gt; Eff r Method
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Method
</span><a href="#local-6989586621680177527"><span class="hs-identifier hs-var">primMethod</span></a></span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><span class="annottext">Maybe Method
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680177528"><span class="annot"><a href="#local-6989586621680177528"><span class="hs-identifier hs-var">lambdaArgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680177529"><span class="annot"><a href="#local-6989586621680177529"><span class="hs-identifier hs-var">lambdaBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Var -&gt; Eff r ([(Unique Text, FieldType)], Expr Var)
forall (r :: [Effect]).
Lower r =&gt;
Expr Var -&gt; Eff r ([(Unique Text, FieldType)], Expr Var)
</span><a href="Elara.JVM.Lower.html#flattenLambda"><span class="hs-identifier hs-var">flattenLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177516"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-98"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177531"><span class="annot"><a href="#local-6989586621680177531"><span class="hs-identifier hs-var hs-var">typeArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type]
</span><a href="Elara.Core.html#functionTypeArgs"><span class="hs-identifier hs-var">functionTypeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680177515"><span class="hs-identifier hs-var">type_</span></a></span><span>
</span><span id="line-99"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177533"><span class="annot"><a href="#local-6989586621680177533"><span class="hs-identifier hs-var hs-var">retType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; FieldType
</span><a href="Elara.JVM.Lower.Util.html#lowerType"><span class="hs-identifier hs-var">lowerType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="Elara.Core.html#functionTypeResult"><span class="hs-identifier hs-var">functionTypeResult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680177515"><span class="hs-identifier hs-var">type_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Function.html#analyzeCallStrategy"><span class="hs-identifier hs-type">analyzeCallStrategy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621680177528"><span class="hs-identifier hs-type">lambdaArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621680177531"><span class="hs-identifier hs-type">typeArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-102"></span><span>                </span><span class="annot"><span class="annottext">CallStrategy
</span><a href="Elara.JVM.Lower.Function.html#DirectCall"><span class="hs-identifier hs-var">DirectCall</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-103"></span><span>                    </span><span class="hs-comment">-- Fully saturated: lower body directly</span><span>
</span><span id="line-104"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680177539"><span class="annot"><a href="#local-6989586621680177539"><span class="hs-identifier hs-var">resultExpr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680177540"><span class="annot"><a href="#local-6989586621680177540"><span class="hs-identifier hs-var">mainInstrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680177541"><span class="annot"><a href="#local-6989586621680177541"><span class="hs-identifier hs-var">extraBlocks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff (Writer ([Instruction], [Block]) : r) Expr
-&gt; Eff r (Expr, ([Instruction], [Block]))
forall (r :: [Effect]) a.
Eff (Writer ([Instruction], [Block]) : r) a
-&gt; Eff r (a, ([Instruction], [Block]))
</span><a href="Elara.JVM.Lower.Util.html#captureInstructions"><span class="hs-identifier hs-var">captureInstructions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr Var -&gt; Eff (Writer ([Instruction], [Block]) : r) Expr
forall (r :: [Effect]). InnerLower r =&gt; Expr Var -&gt; Eff r Expr
</span><a href="Elara.JVM.Lower.Expr.html#lowerExpr"><span class="hs-identifier hs-var">lowerExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177529"><span class="hs-identifier hs-var">lambdaBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>                    </span><span id="local-6989586621680177544"><span class="annot"><a href="#local-6989586621680177544"><span class="hs-identifier hs-var">entryLabel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier hs-type">makeUnique</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;entry&quot;</span></span><span>
</span><span id="line-106"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177545"><span class="annot"><a href="#local-6989586621680177545"><span class="hs-identifier hs-var hs-var">blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; [Instruction] -&gt; [Block] -&gt; Instruction -&gt; [Block]
</span><a href="Elara.JVM.Lower.html#buildMethodBody"><span class="hs-identifier hs-var">buildMethodBody</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680177544"><span class="hs-identifier hs-var">entryLabel</span></a></span><span> </span><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680177540"><span class="hs-identifier hs-var">mainInstrs</span></a></span><span> </span><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680177541"><span class="hs-identifier hs-var">extraBlocks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Expr -&gt; Instruction
</span><a href="Elara.JVM.IR.html#Return"><span class="hs-identifier hs-var">IR.Return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Maybe Expr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680177539"><span class="hs-identifier hs-var">resultExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.JVM.Lower.html#buildStaticMethod"><span class="hs-identifier hs-type">buildStaticMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177517"><span class="hs-identifier hs-type">methodName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177528"><span class="hs-identifier hs-type">lambdaArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177533"><span class="hs-identifier hs-type">retType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177545"><span class="hs-identifier hs-type">blocks</span></a></span><span>
</span><span id="line-108"></span><span>                </span><span class="annot"><span class="annottext">CallStrategy
</span><a href="Elara.JVM.Lower.Function.html#CreateClosure"><span class="hs-identifier hs-var">CreateClosure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>                    </span><span class="hs-comment">-- create a closure that takes the remaining args</span><span>
</span><span id="line-110"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177549"><span class="annot"><span class="annottext">remainingArgTys :: [Type]
</span><a href="#local-6989586621680177549"><span class="hs-identifier hs-var hs-var hs-var">remainingArgTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Type] -&gt; [Type]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Unique Text, FieldType)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177528"><span class="hs-identifier hs-var">lambdaArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680177531"><span class="hs-identifier hs-var">typeArgs</span></a></span><span>
</span><span id="line-111"></span><span>                    </span><span id="local-6989586621680177551"><span class="annot"><a href="#local-6989586621680177551"><span class="hs-identifier hs-var">newArgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; (Type -&gt; Eff r (Unique Text, FieldType))
-&gt; Eff r [(Unique Text, FieldType)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680177549"><span class="hs-identifier hs-var">remainingArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">((Type -&gt; Eff r (Unique Text, FieldType))
 -&gt; Eff r [(Unique Text, FieldType)])
-&gt; (Type -&gt; Eff r (Unique Text, FieldType))
-&gt; Eff r [(Unique Text, FieldType)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680177553"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680177553"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>                        </span><span id="local-6989586621680177554"><span class="annot"><a href="#local-6989586621680177554"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r (Unique Text)
forall (r :: [Effect]) a. (UniqueGen :&gt; r) =&gt; a -&gt; Eff r (Unique a)
</span><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier hs-var">makeUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;arg&quot;</span></span><span>
</span><span id="line-113"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680177554"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Util.html#lowerType"><span class="hs-identifier hs-type">lowerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177553"><span class="hs-identifier hs-type">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177555"><span class="annot"><a href="#local-6989586621680177555"><span class="hs-identifier hs-var hs-var">allArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177528"><span class="hs-identifier hs-var">lambdaArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
-&gt; [(Unique Text, FieldType)] -&gt; [(Unique Text, FieldType)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177551"><span class="hs-identifier hs-var">newArgs</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>                    </span><span class="hs-comment">-- Lower body and call closure with the new args</span><span>
</span><span id="line-117"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680177556"><span class="annot"><a href="#local-6989586621680177556"><span class="hs-identifier hs-var">finalExpr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680177557"><span class="annot"><a href="#local-6989586621680177557"><span class="hs-identifier hs-var">mainInstrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680177558"><span class="annot"><a href="#local-6989586621680177558"><span class="hs-identifier hs-var">extraBlocks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Util.html#captureInstructions"><span class="hs-identifier hs-type">captureInstructions</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>                        </span><span id="local-6989586621680177559"><span class="annot"><a href="#local-6989586621680177559"><span class="hs-identifier hs-var">funExpr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Expr.html#lowerExpr"><span class="hs-identifier hs-type">lowerExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177529"><span class="hs-identifier hs-type">lambdaBody</span></a></span><span>
</span><span id="line-119"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621680177551"><span class="hs-identifier hs-type">newArgs</span></a></span><span>
</span><span id="line-120"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680177559"><span class="hs-identifier hs-type">funExpr</span></a></span><span>
</span><span id="line-121"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177561"><span class="annot"><a href="#local-6989586621680177561"><span class="hs-identifier hs-var hs-var">argExprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique Text -&gt; FieldType -&gt; Expr
</span><a href="Elara.JVM.IR.html#LocalVar"><span class="hs-identifier hs-var">IR.LocalVar</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680177563"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680177564"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680177563"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680177563"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680177564"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680177564"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177551"><span class="hs-identifier hs-var">newArgs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-123"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177565"><span class="annot"><a href="#local-6989586621680177565"><span class="hs-identifier hs-var hs-var">callable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>                                        </span><span class="annot"><a href="Elara.JVM.Lower.Function.html#CallableInfo"><span class="hs-identifier hs-type">CallableInfo</span></a></span><span>
</span><span id="line-125"></span><span>                                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">callableTarget :: CallableTarget
</span><a href="Elara.JVM.Lower.Function.html#callableTarget"><span class="hs-identifier hs-var">callableTarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; MethodDescriptor -&gt; CallableTarget
</span><a href="Elara.JVM.Lower.Function.html#InstanceMethod"><span class="hs-identifier hs-var">InstanceMethod</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680177559"><span class="hs-identifier hs-var">funExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; MethodDescriptor
</span><a href="Elara.JVM.Lower.Util.html#erasedMethodDescriptor"><span class="hs-identifier hs-var">erasedMethodDescriptor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Unique Text, FieldType)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177551"><span class="hs-identifier hs-var">newArgs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">callableReturnType :: FieldType
</span><a href="Elara.JVM.Lower.Function.html#callableReturnType"><span class="hs-identifier hs-var">callableReturnType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680177533"><span class="hs-identifier hs-var">retType</span></a></span><span>
</span><span id="line-127"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">callableArity :: Int
</span><a href="Elara.JVM.Lower.Function.html#callableArity"><span class="hs-identifier hs-var">callableArity</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177551"><span class="hs-identifier hs-var">newArgs</span></a></span><span>
</span><span id="line-128"></span><span>                                            </span><span class="hs-special">}</span><span>
</span><span id="line-129"></span><span>                                </span><span class="annot"><a href="Elara.JVM.Lower.Function.html#lowerCallable"><span class="hs-identifier hs-type">lowerCallable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177565"><span class="hs-identifier hs-type">callable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177561"><span class="hs-identifier hs-type">argExprs</span></a></span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Function.html#AsCall"><span class="hs-identifier hs-type">AsCall</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>                    </span><span id="local-6989586621680177574"><span class="annot"><a href="#local-6989586621680177574"><span class="hs-identifier hs-var">entryLabel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier hs-type">makeUnique</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;entry&quot;</span></span><span>
</span><span id="line-132"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177575"><span class="annot"><a href="#local-6989586621680177575"><span class="hs-identifier hs-var hs-var">blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; [Instruction] -&gt; [Block] -&gt; Instruction -&gt; [Block]
</span><a href="Elara.JVM.Lower.html#buildMethodBody"><span class="hs-identifier hs-var">buildMethodBody</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680177574"><span class="hs-identifier hs-var">entryLabel</span></a></span><span> </span><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680177557"><span class="hs-identifier hs-var">mainInstrs</span></a></span><span> </span><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680177558"><span class="hs-identifier hs-var">extraBlocks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Expr -&gt; Instruction
</span><a href="Elara.JVM.IR.html#Return"><span class="hs-identifier hs-var">IR.Return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Maybe Expr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680177556"><span class="hs-identifier hs-var">finalExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.JVM.Lower.html#buildStaticMethod"><span class="hs-identifier hs-type">buildStaticMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177517"><span class="hs-identifier hs-type">methodName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177555"><span class="hs-identifier hs-type">allArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177533"><span class="hs-identifier hs-type">retType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177575"><span class="hs-identifier hs-type">blocks</span></a></span><span>
</span><span id="line-134"></span><span>                </span><span class="annot"><span class="annottext">CallStrategy
</span><a href="Elara.JVM.Lower.Function.html#OverApplication"><span class="hs-identifier hs-var">OverApplication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-135"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Eff r Method
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Eff r Method) -&gt; Text -&gt; Eff r Method
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;More lambdas than type arguments for &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680177517"><span class="hs-identifier hs-var">methodName</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><span class="hs-comment">{- | Create blocks for method body, ensuring the entry block is correctly set up.
If there are extra blocks, the entry block will jump to the first extra block.

As an example, given:
    mainInstrs = [inst1, inst2]
    extraBlocks = [blockA, blockB]
    returnInstr = returnInst

This will produce:
    [ Block entryLabel [inst1, inst2, Jump blockALabel]
    , blockA
    , Block blockBLabel [ ... , returnInst ]
-}</span></span><span>
</span><span id="line-150"></span><span class="annot"><a href="Elara.JVM.Lower.html#buildMethodBody"><span class="hs-identifier hs-type">buildMethodBody</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Label for the entry block</span></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Main instructions for the entry block</span></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Elara.JVM.IR.html#Instruction"><span class="hs-identifier hs-type">IR.Instruction</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Extra blocks</span></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Elara.JVM.IR.html#Block"><span class="hs-identifier hs-type">IR.Block</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Return instruction</span></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#Instruction"><span class="hs-identifier hs-type">IR.Instruction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Resulting blocks</span></span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Elara.JVM.IR.html#Block"><span class="hs-identifier hs-type">IR.Block</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-161"></span><span id="buildMethodBody"><span class="annot"><span class="annottext">buildMethodBody :: Unique Text -&gt; [Instruction] -&gt; [Block] -&gt; Instruction -&gt; [Block]
</span><a href="Elara.JVM.Lower.html#buildMethodBody"><span class="hs-identifier hs-var hs-var">buildMethodBody</span></a></span></span><span> </span><span id="local-6989586621680177583"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680177583"><span class="hs-identifier hs-var">entryLabel</span></a></span></span><span> </span><span id="local-6989586621680177584"><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680177584"><span class="hs-identifier hs-var">mainInstrs</span></a></span></span><span> </span><span id="local-6989586621680177585"><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680177585"><span class="hs-identifier hs-var">extraBlocks</span></a></span></span><span> </span><span id="local-6989586621680177586"><span class="annot"><span class="annottext">Instruction
</span><a href="#local-6989586621680177586"><span class="hs-identifier hs-var">returnInstr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177587"><span class="annot"><span class="annottext">entryBlock :: Block
</span><a href="#local-6989586621680177587"><span class="hs-identifier hs-var hs-var">entryBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; [Instruction] -&gt; Block
</span><a href="Elara.JVM.IR.html#Block"><span class="hs-identifier hs-var">IR.Block</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680177583"><span class="hs-identifier hs-var">entryLabel</span></a></span><span> </span><span class="annot"><span class="annottext">([Instruction] -&gt; Block) -&gt; [Instruction] -&gt; Block
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680177585"><span class="hs-identifier hs-var">extraBlocks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-163"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680177584"><span class="hs-identifier hs-var">mainInstrs</span></a></span><span> </span><span class="annot"><span class="annottext">[Instruction] -&gt; [Instruction] -&gt; [Instruction]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Instruction
</span><a href="#local-6989586621680177586"><span class="hs-identifier hs-var">returnInstr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680177589"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680177589"><span class="hs-identifier hs-var">first</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Block]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Instruction] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680177584"><span class="hs-identifier hs-var">mainInstrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique Text -&gt; Instruction
</span><a href="Elara.JVM.IR.html#Jump"><span class="hs-identifier hs-var">IR.Jump</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block -&gt; Unique Text
</span><a href="Elara.JVM.IR.html#blockLabel"><span class="hs-identifier hs-var">IR.blockLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680177589"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-166"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680177584"><span class="hs-identifier hs-var">mainInstrs</span></a></span><span>
</span><span id="line-167"></span><span>        </span><span id="local-6989586621680177592"><span class="annot"><span class="annottext">appendReturn :: Block -&gt; Block
</span><a href="#local-6989586621680177592"><span class="hs-identifier hs-var hs-var">appendReturn</span></a></span></span><span> </span><span id="local-6989586621680177593"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680177593"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680177593"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.JVM.IR.html#instrs"><span class="hs-identifier hs-var">IR.instrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#instrs"><span class="hs-identifier hs-var">IR.instrs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177593"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680177586"><span class="hs-identifier hs-type">returnInstr</span></a></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-168"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Block] -&gt; Maybe (NonEmpty Block)
forall a. [a] -&gt; Maybe (NonEmpty a)
</span><span class="hs-identifier hs-var">nonEmpty</span></span><span> </span><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680177585"><span class="hs-identifier hs-var">extraBlocks</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>            </span><span class="annot"><span class="annottext">Maybe (NonEmpty Block)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680177587"><span class="hs-identifier hs-var">entryBlock</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-170"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680177596"><span class="annot"><span class="annottext">NonEmpty Block
</span><a href="#local-6989586621680177596"><span class="hs-identifier hs-var">neBlocks</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680177587"><span class="hs-identifier hs-var">entryBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; [Block] -&gt; [Block]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Block -&gt; [Block]
forall (f :: * -&gt; *) a. IsNonEmpty f a [a] &quot;init&quot; =&gt; f a -&gt; [a]
</span><span class="hs-identifier hs-var">init</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Block
</span><a href="#local-6989586621680177596"><span class="hs-identifier hs-var">neBlocks</span></a></span><span> </span><span class="annot"><span class="annottext">[Block] -&gt; [Block] -&gt; [Block]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Block -&gt; Block
</span><a href="#local-6989586621680177592"><span class="hs-identifier hs-var">appendReturn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty Block -&gt; Block
forall (f :: * -&gt; *) a. IsNonEmpty f a a &quot;last&quot; =&gt; f a -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Block
</span><a href="#local-6989586621680177596"><span class="hs-identifier hs-var">neBlocks</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><span class="hs-comment">-- | Lower a primitive binding into a method if applicable</span></span><span>
</span><span id="line-173"></span><span id="local-6989586621680177301"><span class="annot"><a href="Elara.JVM.Lower.html#lowerPrimitiveBinding"><span class="hs-identifier hs-type">lowerPrimitiveBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><a href="Elara.JVM.Lower.Monad.html#Lower"><span class="hs-identifier hs-type">Lower</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177301"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="hs-comment">-- | The method name, i.e. the name of the binding</span></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><span class="hs-comment">-- | The type of the binding</span></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="Elara.Core.html#Type"><span class="hs-identifier hs-type">Core.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="hs-comment">-- | The body of the binding</span></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680177301"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Method"><span class="hs-identifier hs-type">IR.Method</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-182"></span><span id="lowerPrimitiveBinding"><span class="annot"><span class="annottext">lowerPrimitiveBinding :: forall (r :: [Effect]).
Lower r =&gt;
Text -&gt; Type -&gt; Expr Var -&gt; Eff r (Maybe Method)
</span><a href="Elara.JVM.Lower.html#lowerPrimitiveBinding"><span class="hs-identifier hs-var hs-var">lowerPrimitiveBinding</span></a></span></span><span> </span><span id="local-6989586621680177631"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680177631"><span class="hs-identifier hs-var">methodName</span></a></span></span><span> </span><span id="local-6989586621680177632"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680177632"><span class="hs-identifier hs-var">type_</span></a></span></span><span> </span><span id="local-6989586621680177633"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177633"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177633"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-184"></span><span>        </span><span class="annot"><a href="Elara.Core.html#App"><span class="hs-identifier hs-type">Core.App</span></a></span><span> </span><span id="local-6989586621680177635"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177635"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lit"><span class="hs-identifier hs-type">Core.Lit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#String"><span class="hs-identifier hs-type">Core.String</span></a></span><span> </span><span id="local-6989586621680177638"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680177638"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>            </span><span class="hs-comment">-- elaraPrimitive &quot;primName&quot;</span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr Var -&gt; Expr Var
</span><a href="Elara.JVM.Lower.html#stripTyApps"><span class="hs-identifier hs-var">stripTyApps</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177635"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-187"></span><span>                </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680177641"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680177641"><span class="hs-identifier hs-var">primName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified Text
VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680177641"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Qualified Text
forall c. c -&gt; Qualified c
</span><a href="Elara.Prim.html#mkPrimQual"><span class="hs-identifier hs-var">mkPrimQual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; Text
forall name. NameLike name =&gt; name -&gt; Text
</span><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-var">nameText</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="Elara.Prim.html#fetchPrimitiveName"><span class="hs-identifier hs-var">fetchPrimitiveName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680177642"><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621680177642"><span class="hs-keyword hs-var">prim</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe PrimOp
</span><a href="Elara.JVM.Lower.html#primitiveFromKey"><span class="hs-identifier hs-var">primitiveFromKey</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680177638"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-190"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177644"><span class="annot"><span class="annottext">argTys :: [Type]
</span><a href="#local-6989586621680177644"><span class="hs-identifier hs-var hs-var hs-var">argTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type]
</span><a href="Elara.Core.html#functionTypeArgs"><span class="hs-identifier hs-var">functionTypeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680177632"><span class="hs-identifier hs-var">type_</span></a></span><span>
</span><span id="line-191"></span><span>                            </span><span id="local-6989586621680177645"><span class="annot"><span class="annottext">jvmArgs :: [FieldType]
</span><a href="#local-6989586621680177645"><span class="hs-identifier hs-var hs-var hs-var">jvmArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; FieldType) -&gt; [Type] -&gt; [FieldType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; FieldType
</span><a href="Elara.JVM.Lower.Util.html#lowerType"><span class="hs-identifier hs-var">lowerType</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680177644"><span class="hs-identifier hs-var">argTys</span></a></span><span>
</span><span id="line-192"></span><span>                            </span><span id="local-6989586621680177646"><span class="annot"><span class="annottext">jvmRet :: FieldType
</span><a href="#local-6989586621680177646"><span class="hs-identifier hs-var hs-var hs-var">jvmRet</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; FieldType
</span><a href="Elara.JVM.Lower.Util.html#lowerType"><span class="hs-identifier hs-var">lowerType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="Elara.Core.html#functionTypeResult"><span class="hs-identifier hs-var">functionTypeResult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680177632"><span class="hs-identifier hs-var">type_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>                        </span><span id="local-6989586621680177647"><span class="annot"><a href="#local-6989586621680177647"><span class="hs-identifier hs-var">argNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Eff r (Unique Text) -&gt; Eff r [Unique Text]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><span class="hs-identifier hs-var">replicateM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621680177644"><span class="hs-identifier hs-var">argTys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Eff r (Unique Text)
forall (r :: [Effect]) a. (UniqueGen :&gt; r) =&gt; a -&gt; Eff r (Unique a)
</span><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier hs-var">makeUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;arg&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177649"><span class="annot"><a href="#local-6989586621680177649"><span class="hs-identifier hs-var hs-var">methodArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Unique Text] -&gt; [FieldType] -&gt; [(Unique Text, FieldType)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Unique Text]
</span><a href="#local-6989586621680177647"><span class="hs-identifier hs-var">argNames</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680177645"><span class="hs-identifier hs-var">jvmArgs</span></a></span><span>
</span><span id="line-196"></span><span>                            </span><span id="local-6989586621680177650"><span class="annot"><a href="#local-6989586621680177650"><span class="hs-identifier hs-var hs-var">argExprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique Text -&gt; FieldType -&gt; Expr
</span><a href="Elara.JVM.IR.html#LocalVar"><span class="hs-identifier hs-var">IR.LocalVar</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680177651"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680177652"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680177651"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680177651"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680177652"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680177652"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177649"><span class="hs-identifier hs-var">methodArgs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-197"></span><span>                            </span><span id="local-6989586621680177653"><span class="annot"><a href="#local-6989586621680177653"><span class="hs-identifier hs-var hs-var">primExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; [Expr] -&gt; Expr
</span><a href="Elara.JVM.IR.html#PrimOp"><span class="hs-identifier hs-var">IR.PrimOp</span></a></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621680177642"><span class="hs-keyword hs-var">prim</span></a></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621680177650"><span class="hs-identifier hs-var">argExprs</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>                        </span><span id="local-6989586621680177655"><span class="annot"><a href="#local-6989586621680177655"><span class="hs-identifier hs-var">entry</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier hs-type">makeUnique</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;prim_entry&quot;</span></span><span>
</span><span id="line-200"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177656"><span class="annot"><a href="#local-6989586621680177656"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique Text -&gt; [Instruction] -&gt; Block
</span><a href="Elara.JVM.IR.html#Block"><span class="hs-identifier hs-var">IR.Block</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680177655"><span class="hs-identifier hs-var">entry</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Maybe Expr -&gt; Instruction
</span><a href="Elara.JVM.IR.html#Return"><span class="hs-identifier hs-var">IR.Return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Maybe Expr
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680177653"><span class="hs-identifier hs-var">primExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-201"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.JVM.Lower.html#buildStaticMethod"><span class="hs-identifier hs-type">buildStaticMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177631"><span class="hs-identifier hs-type">methodName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177649"><span class="hs-identifier hs-type">methodArgs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177646"><span class="hs-identifier hs-type">jvmRet</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177656"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-202"></span><span>                </span><span class="annot"><a href="Elara.Core.html#Var"><span class="hs-identifier hs-type">Core.Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680177658"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680177658"><span class="hs-identifier hs-var">primName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified Text
VarRefImpl UnlocatedVarRefKind (Qualified Text)
</span><a href="#local-6989586621680177658"><span class="hs-identifier hs-var">primName</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; Qualified Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Qualified Text
forall c. c -&gt; Qualified c
</span><a href="Elara.Prim.html#mkPrimQual"><span class="hs-identifier hs-var">mkPrimQual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; Text
forall name. NameLike name =&gt; name -&gt; Text
</span><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-var">nameText</span></a></span><span> </span><span class="annot"><span class="annottext">VarName
</span><a href="Elara.Prim.html#fetchPrimitiveName"><span class="hs-identifier hs-var">fetchPrimitiveName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-204"></span><span>                        </span><span class="annot"><span class="annottext">Text -&gt; Eff r (Maybe Method)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Eff r (Maybe Method)) -&gt; Text -&gt; Eff r (Maybe Method)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Unknown primitive key in elaraPrimitive: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680177638"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-205"></span><span>                </span><span class="annot"><span class="annottext">Expr Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Method -&gt; Eff r (Maybe Method)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe Method
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-206"></span><span>        </span><span class="annot"><span class="annottext">Expr Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Method -&gt; Eff r (Maybe Method)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe Method
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="annot"><span class="hs-comment">-- | Flatten nested lambdas into a list of arguments and the final body expression</span></span><span>
</span><span id="line-209"></span><span id="local-6989586621680177302"><span class="annot"><a href="Elara.JVM.Lower.html#flattenLambda"><span class="hs-identifier hs-type">flattenLambda</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Monad.html#Lower"><span class="hs-identifier hs-type">Lower</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177302"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680177302"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JVM.FieldType</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-210"></span><span id="flattenLambda"><span class="annot"><span class="annottext">flattenLambda :: forall (r :: [Effect]).
Lower r =&gt;
Expr Var -&gt; Eff r ([(Unique Text, FieldType)], Expr Var)
</span><a href="Elara.JVM.Lower.html#flattenLambda"><span class="hs-identifier hs-var hs-var">flattenLambda</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#Lam"><span class="hs-identifier hs-type">Core.Lam</span></a></span><span> </span><span id="local-6989586621680177676"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680177676"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680177677"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177677"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680177678"><span class="annot"><a href="#local-6989586621680177678"><span class="hs-identifier hs-var">restArgs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680177679"><span class="annot"><a href="#local-6989586621680177679"><span class="hs-identifier hs-var">finalBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr Var -&gt; Eff r ([(Unique Text, FieldType)], Expr Var)
forall (r :: [Effect]).
Lower r =&gt;
Expr Var -&gt; Eff r ([(Unique Text, FieldType)], Expr Var)
</span><a href="Elara.JVM.Lower.html#flattenLambda"><span class="hs-identifier hs-var">flattenLambda</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177677"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680177676"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-213"></span><span>        </span><span class="annot"><a href="Elara.Core.html#Id"><span class="hs-identifier hs-type">Core.Id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span id="local-6989586621680177680"><span class="annot"><span class="annottext">VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680177680"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680177681"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680177681"><span class="hs-identifier hs-var">type_</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe DataCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-214"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177682"><span class="annot"><span class="annottext">argType :: FieldType
</span><a href="#local-6989586621680177682"><span class="hs-identifier hs-var hs-var">argType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; FieldType
</span><a href="Elara.JVM.Lower.Util.html#lowerType"><span class="hs-identifier hs-var">lowerType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621680177681"><span class="hs-identifier hs-var">type_</span></a></span><span>
</span><span id="line-215"></span><span>            </span><span class="annot"><span class="annottext">([(Unique Text, FieldType)], Expr Var)
-&gt; Eff r ([(Unique Text, FieldType)], Expr Var)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique Text
VarRefImpl UnlocatedVarRefKind (Unique Text)
</span><a href="#local-6989586621680177680"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680177682"><span class="hs-identifier hs-var">argType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Unique Text, FieldType)
-&gt; [(Unique Text, FieldType)] -&gt; [(Unique Text, FieldType)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680177678"><span class="hs-identifier hs-var">restArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177679"><span class="hs-identifier hs-var">finalBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>        </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r ([(Unique Text, FieldType)], Expr Var)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Eff r ([(Unique Text, FieldType)], Expr Var))
-&gt; Text -&gt; Eff r ([(Unique Text, FieldType)], Expr Var)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Lambda binder must be a Local ID, found: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Print.html#showPretty"><span class="hs-identifier hs-var">showPretty</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621680177676"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-217"></span><span class="annot"><a href="Elara.JVM.Lower.html#flattenLambda"><span class="hs-identifier hs-var">flattenLambda</span></a></span><span> </span><span id="local-6989586621680177683"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177683"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(Unique Text, FieldType)], Expr Var)
-&gt; Eff r ([(Unique Text, FieldType)], Expr Var)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177683"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span id="local-6989586621680177226"><span class="annot"><a href="Elara.JVM.Lower.html#lowerTypeDecl"><span class="hs-identifier hs-type">lowerTypeDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Lower.Monad.html#Lower"><span class="hs-identifier hs-type">Lower</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177226"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeDecl"><span class="hs-identifier hs-type">CoreTypeDecl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680177226"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.JVM.IR.html#Class"><span class="hs-identifier hs-type">IR.Class</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-220"></span><span id="lowerTypeDecl"><span class="annot"><span class="annottext">lowerTypeDecl :: forall (r :: [Effect]). Lower r =&gt; CoreTypeDecl -&gt; Eff r [Class]
</span><a href="Elara.JVM.Lower.html#lowerTypeDecl"><span class="hs-identifier hs-var hs-var">lowerTypeDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeDecl"><span class="hs-identifier hs-type">CoreTypeDecl</span></a></span><span> </span><span id="local-6989586621680177699"><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680177699"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">ElaraKind
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TypeVariable]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680177700"><span class="annot"><span class="annottext">CoreTypeDeclBody
</span><a href="#local-6989586621680177700"><span class="hs-identifier hs-var">typeBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreTypeDeclBody
</span><a href="#local-6989586621680177700"><span class="hs-identifier hs-var">typeBody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-222"></span><span>        </span><span class="annot"><a href="Elara.Core.Module.html#CoreTypeAlias"><span class="hs-identifier hs-type">CoreTypeAlias</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Class] -&gt; Eff r [Class]
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><a href="Elara.Core.Module.html#CoreDataDecl"><span class="hs-identifier hs-type">CoreDataDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680177703"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621680177703"><span class="hs-identifier hs-var">dataCons</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177704"><span class="annot"><span class="annottext">baseClassName :: QualifiedClassName
</span><a href="#local-6989586621680177704"><span class="hs-identifier hs-var hs-var">baseClassName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Qualified Text -&gt; QualifiedClassName
</span><a href="Elara.JVM.Lower.Util.html#qualifiedTextToClass"><span class="hs-identifier hs-var">qualifiedTextToClass</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified Text
</span><a href="#local-6989586621680177699"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621680177703"><span class="hs-identifier hs-var">dataCons</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-227"></span><span>                </span><span class="hs-comment">-- if there's only one constructor, we can skip the base class</span><span>
</span><span id="line-228"></span><span>                </span><span class="hs-special">[</span><span id="local-6989586621680177706"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680177706"><span class="hs-identifier hs-var">singleCon</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>                    </span><span class="hs-comment">-- so it extends Object directly</span><span>
</span><span id="line-230"></span><span>                    </span><span id="local-6989586621680177707"><span class="annot"><a href="#local-6989586621680177707"><span class="hs-identifier hs-var">conClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; DataCon -&gt; Eff r Class
forall (r :: [Effect]).
Lower r =&gt;
QualifiedClassName -&gt; DataCon -&gt; Eff r Class
</span><a href="Elara.JVM.Lower.ADT.html#lowerDataCon"><span class="hs-identifier hs-var">lowerDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-identifier hs-var">jloName</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680177706"><span class="hs-identifier hs-var">singleCon</span></a></span><span>
</span><span id="line-231"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680177707"><span class="hs-identifier hs-type">conClass</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>                </span><span class="hs-comment">-- otherwise we create a base class and have constructors extend it</span><span>
</span><span id="line-234"></span><span>                </span><span class="annot"><span class="annottext">[DataCon]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177709"><span class="annot"><span class="annottext">constructorCode :: [Instruction]
</span><a href="#local-6989586621680177709"><span class="hs-identifier hs-var hs-var hs-var">constructorCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; [Expr] -&gt; Instruction
</span><a href="Elara.JVM.IR.html#Super"><span class="hs-identifier hs-var">IR.Super</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-identifier hs-var">jloName</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-237"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Expr -&gt; Instruction
</span><a href="Elara.JVM.IR.html#Return"><span class="hs-identifier hs-var">IR.Return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-238"></span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-239"></span><span>                    </span><span id="local-6989586621680177711"><span class="annot"><a href="#local-6989586621680177711"><span class="hs-identifier hs-var">constructorLabel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r (Unique Text)
forall (r :: [Effect]) a. (UniqueGen :&gt; r) =&gt; a -&gt; Eff r (Unique a)
</span><a href="Elara.Data.Unique.Effect.html#makeUnique"><span class="hs-identifier hs-var">makeUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;base_constructor_entry&quot;</span></span><span>
</span><span id="line-240"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177712"><span class="annot"><a href="#local-6989586621680177712"><span class="hs-identifier hs-var hs-var">constructor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-241"></span><span>                            </span><span class="annot"><a href="Elara.JVM.IR.html#Constructor"><span class="hs-identifier hs-type">IR.Constructor</span></a></span><span>
</span><span id="line-242"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">constructorDesc :: MethodDescriptor
</span><a href="Elara.JVM.IR.html#constructorDesc"><span class="hs-identifier hs-var">IR.constructorDesc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">JVM.MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><span class="hs-identifier hs-var">JVM.VoidReturn</span></span><span>
</span><span id="line-243"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">constructorArgs :: [(Unique Text, FieldType)]
</span><a href="Elara.JVM.IR.html#constructorArgs"><span class="hs-identifier hs-var">IR.constructorArgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-244"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">constructorBody :: [Block]
</span><a href="Elara.JVM.IR.html#constructorBody"><span class="hs-identifier hs-var">IR.constructorBody</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-245"></span><span>                                    </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unique Text -&gt; [Instruction] -&gt; Block
</span><a href="Elara.JVM.IR.html#Block"><span class="hs-identifier hs-var">IR.Block</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680177711"><span class="hs-identifier hs-var">constructorLabel</span></a></span><span> </span><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680177709"><span class="hs-identifier hs-var">constructorCode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-246"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680177718"><span class="annot"><a href="#local-6989586621680177718"><span class="hs-identifier hs-var hs-var">baseClass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-249"></span><span>                            </span><span class="annot"><a href="Elara.JVM.IR.html#Class"><span class="hs-identifier hs-type">IR.Class</span></a></span><span>
</span><span id="line-250"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">className :: QualifiedClassName
</span><a href="Elara.JVM.IR.html#className"><span class="hs-identifier hs-var">IR.className</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680177704"><span class="hs-identifier hs-var">baseClassName</span></a></span><span>
</span><span id="line-251"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">classSuper :: QualifiedClassName
</span><a href="Elara.JVM.IR.html#classSuper"><span class="hs-identifier hs-var">IR.classSuper</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-identifier hs-var">jloName</span></span><span>
</span><span id="line-252"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">classFields :: [Field]
</span><a href="Elara.JVM.IR.html#classFields"><span class="hs-identifier hs-var">IR.classFields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-253"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">classMethods :: [Method]
</span><a href="Elara.JVM.IR.html#classMethods"><span class="hs-identifier hs-var">IR.classMethods</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-254"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">classConstructors :: [Constructor]
</span><a href="Elara.JVM.IR.html#classConstructors"><span class="hs-identifier hs-var">IR.classConstructors</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>                                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Constructor
</span><a href="#local-6989586621680177712"><span class="hs-identifier hs-var">constructor</span></a></span><span>
</span><span id="line-256"></span><span>                                    </span><span class="hs-special">]</span><span>
</span><span id="line-257"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>                    </span><span id="local-6989586621680177719"><span class="annot"><a href="#local-6989586621680177719"><span class="hs-identifier hs-var">conClasses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.Lower.ADT.html#lowerDataCon"><span class="hs-identifier hs-type">lowerDataCon</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680177704"><span class="hs-identifier hs-type">baseClassName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680177703"><span class="hs-identifier hs-type">dataCons</span></a></span><span>
</span><span id="line-260"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680177718"><span class="hs-identifier hs-type">baseClass</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621680177719"><span class="hs-identifier hs-type">conClasses</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="annot"><a href="Elara.JVM.Lower.html#primitiveFromKey"><span class="hs-identifier hs-type">primitiveFromKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#PrimOp"><span class="hs-identifier hs-type">IR.PrimOp</span></a></span><span>
</span><span id="line-263"></span><span id="primitiveFromKey"><span class="annot"><span class="annottext">primitiveFromKey :: Text -&gt; Maybe PrimOp
</span><a href="Elara.JVM.Lower.html#primitiveFromKey"><span class="hs-identifier hs-var hs-var">primitiveFromKey</span></a></span></span><span> </span><span id="local-6989586621680177750"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680177750"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680177750"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-265"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#IntAdd"><span class="hs-identifier hs-var">IR.IntAdd</span></a></span><span>
</span><span id="line-266"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#IntSubtract"><span class="hs-identifier hs-var">IR.IntSubtract</span></a></span><span>
</span><span id="line-267"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#IntMultiply"><span class="hs-identifier hs-var">IR.IntMultiply</span></a></span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;negate&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#IntNegate"><span class="hs-identifier hs-var">IR.IntNegate</span></a></span><span>
</span><span id="line-269"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;println&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#Println"><span class="hs-identifier hs-var">IR.Println</span></a></span><span>
</span><span id="line-270"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;stringCons&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#StringCons"><span class="hs-identifier hs-var">IR.StringCons</span></a></span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;stringHead&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#StringHead"><span class="hs-identifier hs-var">IR.StringHead</span></a></span><span>
</span><span id="line-272"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;stringIsEmpty&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#StringIsEmpty"><span class="hs-identifier hs-var">IR.StringIsEmpty</span></a></span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;stringTail&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#StringTail"><span class="hs-identifier hs-var">IR.StringTail</span></a></span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;toString&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#ToString"><span class="hs-identifier hs-var">IR.ToString</span></a></span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;==&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#PrimEquals"><span class="hs-identifier hs-var">IR.PrimEquals</span></a></span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;compare&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#PrimCompare"><span class="hs-identifier hs-var">IR.PrimCompare</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&gt;&gt;=&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#IOBind"><span class="hs-identifier hs-var">IR.IOBind</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;error&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#ThrowError"><span class="hs-identifier hs-var">IR.ThrowError</span></a></span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;debugWithMsg&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PrimOp -&gt; Maybe PrimOp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#DebugWithMsg"><span class="hs-identifier hs-var">IR.DebugWithMsg</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe PrimOp
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="annot"><a href="Elara.JVM.Lower.html#stripTyApps"><span class="hs-identifier hs-type">stripTyApps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span>
</span><span id="line-283"></span><span id="stripTyApps"><span class="annot"><span class="annottext">stripTyApps :: Expr Var -&gt; Expr Var
</span><a href="Elara.JVM.Lower.html#stripTyApps"><span class="hs-identifier hs-var hs-var">stripTyApps</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Core.html#TyApp"><span class="hs-identifier hs-type">Core.TyApp</span></a></span><span> </span><span id="local-6989586621680177767"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177767"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Var -&gt; Expr Var
</span><a href="Elara.JVM.Lower.html#stripTyApps"><span class="hs-identifier hs-var">stripTyApps</span></a></span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177767"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-284"></span><span class="annot"><a href="Elara.JVM.Lower.html#stripTyApps"><span class="hs-identifier hs-var">stripTyApps</span></a></span><span> </span><span id="local-6989586621680177768"><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177768"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr Var
</span><a href="#local-6989586621680177768"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-285"></span></pre></body></html>