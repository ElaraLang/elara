<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE QuantifiedConstraints #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- Modified version of the Rock (https://hackage.haskell.org/package/rock) library</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- with effectful support added</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Credit to https://gist.github.com/expipiplus1/cfd5c4fb4a5a40338ccf8642fb3d0f1e for the changes!</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Rock.html"><span class="hs-identifier">Rock</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.GADT.Compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">GEq</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">geq</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.GADT.Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">GShow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">gshowsPrec</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Some</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Dispatch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Static</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DispatchOf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Eff</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Effect</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">IOE</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Subset</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">inject</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(:&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.Dispatch.Static</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SideEffects</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoSideEffects</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StaticRep</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalStaticRep</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getStaticRep</span></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Logging.html"><span class="hs-identifier">Elara.Logging</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Show</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">showChar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">showParen</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">showString</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unsafe.Coerce</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafeCoerce</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">atomicModifyIORef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newIORef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readIORef</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="annot"><span class="hs-comment">-- * Types</span></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">type</span><span> </span><span id="Rules"><span class="annot"><a href="Rock.html#Rules"><span class="hs-identifier hs-var">Rules</span></a></span></span><span> </span><span id="local-6989586621680161242"><span class="annot"><a href="#local-6989586621680161242"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680161243"><span class="annot"><a href="#local-6989586621680161243"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680161244"><span class="annot"><a href="#local-6989586621680161244"><span class="hs-identifier hs-type">es</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680161244"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680161242"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161244"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161243"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680161244"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161243"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">data</span><span> </span><span id="Rock"><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-var">Rock</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680161245"><span class="annot"><a href="#local-6989586621680161245"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Effect</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Effect</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="DispatchOf"><span class="annot"><span class="hs-identifier hs-var">DispatchOf</span></span></span><span> </span><span id="local-6989586621680161246"><span class="hs-special">(</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161246"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Static</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoSideEffects</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">newtype</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="StaticRep"><span class="annot"><span class="hs-identifier hs-var">StaticRep</span></span></span><span> </span><span id="local-6989586621680161148"><span class="hs-special">(</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161148"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Rock"><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-var">Rock</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680161149"><span class="annot"><a href="#local-6989586621680161149"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680161146"><span class="annot"><a href="#local-6989586621680161146"><span class="hs-identifier hs-type">es</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680161146"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680161148"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161146"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161149"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680161146"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161149"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span id="local-6989586621680161121"><span id="local-6989586621680161124"><span id="local-6989586621680161125"><span class="annot"><a href="Rock.html#runRock"><span class="hs-identifier hs-type">runRock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Rock.html#Rules"><span class="hs-identifier hs-type">Rules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161121"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161121"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621680161124"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680161125"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680161124"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161125"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-32"></span><span id="runRock"><span class="annot"><span class="annottext">runRock :: forall (f :: [Effect] -&gt; * -&gt; *) (es :: [Effect]) a.
Rules f -&gt; Eff (Rock f : es) a -&gt; Eff es a
</span><a href="Rock.html#runRock"><span class="hs-identifier hs-var hs-var">runRock</span></a></span></span><span> </span><span id="local-6989586621680161255"><span class="annot"><span class="annottext">Rules f
</span><a href="#local-6989586621680161255"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StaticRep (Rock f) -&gt; Eff (Rock f : es) a -&gt; Eff es a
forall (e :: Effect) (sideEffects :: SideEffects) (es :: [Effect])
       a.
(HasCallStack, DispatchOf e ~ 'Static sideEffects,
 MaybeIOE sideEffects es) =&gt;
StaticRep e -&gt; Eff (e : es) a -&gt; Eff es a
</span><span class="hs-identifier hs-var">evalStaticRep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rules f -&gt; StaticRep (Rock f)
forall (f :: [Effect] -&gt; * -&gt; *).
(forall a (es :: [Effect]).
 (HasCallStack, StructuredDebug :&gt; es) =&gt;
 f es a -&gt; Eff es a)
-&gt; StaticRep (Rock f)
</span><a href="Rock.html#Rock"><span class="hs-identifier hs-var">Rock</span></a></span><span> </span><span class="annot"><span class="annottext">f es a -&gt; Eff es a
Rules f
</span><a href="#local-6989586621680161255"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span id="local-6989586621680161152"><span id="local-6989586621680161153"><span id="local-6989586621680161155"><span id="local-6989586621680161156"><span class="annot"><a href="Rock.html#fetch"><span class="hs-identifier hs-type">fetch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Subset</span></span><span> </span><span class="annot"><a href="#local-6989586621680161152"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161153"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161155"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680161153"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680161152"><span class="hs-identifier hs-type">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680161155"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161152"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161156"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680161153"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161156"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-35"></span><span id="fetch"><span class="annot"><span class="annottext">fetch :: forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack,
 StructuredDebug :&gt; xs) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var hs-var">fetch</span></a></span></span><span> </span><span id="local-6989586621680161277"><span class="annot"><span class="annottext">f xs a
</span><a href="#local-6989586621680161277"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock</span></a></span><span> </span><span id="local-6989586621680161278"><span class="annot"><a href="#local-6989586621680161278"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff es (StaticRep (Rock f))
forall (e :: Effect) (sideEffects :: SideEffects) (es :: [Effect]).
(HasCallStack, DispatchOf e ~ 'Static sideEffects, e :&gt; es) =&gt;
Eff es (StaticRep e)
</span><span class="hs-identifier hs-var">getStaticRep</span></span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">inject</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680161278"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161277"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="annot"><span class="hs-comment">-- * Running tasks</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-comment">-- data TimeoutQuery f es a where</span><span>
</span><span id="line-42"></span><span class="hs-comment">--     TimeoutQuery :: f es a -&gt; TimeoutQuery f (Timeout : es) (Maybe a)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">-- timeoutRules :: Rules f -&gt; Rules (TimeoutQuery f)</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- timeoutRules r (TimeoutQuery k) = do</span><span>
</span><span id="line-46"></span><span class="hs-comment">--     let a = r k</span><span>
</span><span id="line-47"></span><span class="hs-comment">--     timeout 1000000 (inject a)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="annot"><span class="hs-comment">-- * Task combinators</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-comment">--</span><span>
</span><span id="line-54"></span><span class="hs-keyword">data</span><span> </span><span id="IOQuery"><span class="annot"><a href="Rock.html#IOQuery"><span class="hs-identifier hs-var">IOQuery</span></a></span></span><span> </span><span id="local-6989586621680161280"><span class="annot"><a href="#local-6989586621680161280"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680161281"><span class="annot"><a href="#local-6989586621680161281"><span class="hs-identifier hs-type">es</span></a></span></span><span> </span><span id="local-6989586621680161282"><span class="annot"><a href="#local-6989586621680161282"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-55"></span><span>    </span><span id="local-6989586621680161283"><span id="local-6989586621680161284"><span id="local-6989586621680161285"><span id="IOQuery"><span class="annot"><a href="Rock.html#IOQuery"><span class="hs-identifier hs-var">IOQuery</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680161283"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161284"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161285"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Rock.html#IOQuery"><span class="hs-identifier hs-type">IOQuery</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161283"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IOE</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621680161284"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680161285"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="annot"><span class="hs-comment">{- | Track the query dependencies of a 'Task' in a 'DHashMap'.
track ::
    forall f es k g a.
    (GEq k, Hashable (Some k), IOE :&gt; es, Rock f :&gt; es) =&gt;
    (forall es' a'. f es' a' -&gt; a' -&gt; (k a', g a')) -&gt;
    Eff es a -&gt;
    Eff es (a, DHashMap k g)
track f = trackM $ \key value -&gt; pure (f key value)
-}</span></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- trackM ::</span><span>
</span><span id="line-68"></span><span class="hs-comment">--     forall f es k g a.</span><span>
</span><span id="line-69"></span><span class="hs-comment">--     (GEq k, Hashable (Some k), IOE :&gt; es, Rock f :&gt; es) =&gt;</span><span>
</span><span id="line-70"></span><span class="hs-comment">--     (forall es' a'. f es' a' -&gt; a' -&gt; Eff es' (k a', g a')) -&gt;</span><span>
</span><span id="line-71"></span><span class="hs-comment">--     Eff es a -&gt;</span><span>
</span><span id="line-72"></span><span class="hs-comment">--     Eff es (a, DHashMap k g)</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- trackM f task = do</span><span>
</span><span id="line-74"></span><span class="hs-comment">--     depsVar &lt;- newIORef mempty</span><span>
</span><span id="line-75"></span><span class="hs-comment">--     let</span><span>
</span><span id="line-76"></span><span class="hs-comment">--         record' ::</span><span>
</span><span id="line-77"></span><span class="hs-comment">--             ( (forall a' es'. f es' a' -&gt; Eff es' a') -&gt;</span><span>
</span><span id="line-78"></span><span class="hs-comment">--               (forall a' es'. (IOQuery f) es' a' -&gt; Eff es' a')</span><span>
</span><span id="line-79"></span><span class="hs-comment">--             )</span><span>
</span><span id="line-80"></span><span class="hs-comment">--         record' fetch' (IOQuery key) = do</span><span>
</span><span id="line-81"></span><span class="hs-comment">--             value &lt;- raise $ fetch' key</span><span>
</span><span id="line-82"></span><span class="hs-comment">--             (k, g) &lt;- raise $ f key value</span><span>
</span><span id="line-83"></span><span class="hs-comment">--             atomicModifyIORef depsVar $ (,()) . DHashMap.insert k g</span><span>
</span><span id="line-84"></span><span class="hs-comment">--             pure value</span><span>
</span><span id="line-85"></span><span class="hs-comment">--     result &lt;- transRock record' (raise task)</span><span>
</span><span id="line-86"></span><span class="hs-comment">--     deps &lt;- readIORef depsVar</span><span>
</span><span id="line-87"></span><span class="hs-comment">--     pure (result, deps)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- transRock ::</span><span>
</span><span id="line-90"></span><span class="hs-comment">--     forall f g es a.</span><span>
</span><span id="line-91"></span><span class="hs-comment">--     Rock f :&gt; es =&gt;</span><span>
</span><span id="line-92"></span><span class="hs-comment">--     ( (forall a' es'. f es' a' -&gt; Eff es' a') -&gt;</span><span>
</span><span id="line-93"></span><span class="hs-comment">--       (forall a' es'. g es' a' -&gt; Eff es' a')</span><span>
</span><span id="line-94"></span><span class="hs-comment">--     ) -&gt;</span><span>
</span><span id="line-95"></span><span class="hs-comment">--     Eff (Rock g : es) a -&gt;</span><span>
</span><span id="line-96"></span><span class="hs-comment">--     Eff es a</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- transRock f m = do</span><span>
</span><span id="line-98"></span><span class="hs-comment">--     Rock r &lt;- getStaticRep @(Rock f)</span><span>
</span><span id="line-99"></span><span class="hs-comment">--     evalStaticRep (Rock (f r)) m</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><span class="hs-comment">-- * Utils</span></span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="annot"><span class="hs-comment">{- | A GADT for forgetting the effects required for each key
The GEq and Eq instances will unsafeCoerce away information on the Effects,
please don't rely on it.

This is used for using query keys as map keys
-}</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Effect</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">data</span><span> </span><span id="HideEffects"><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-var">HideEffects</span></a></span></span><span> </span><span id="local-6989586621680161287"><span class="annot"><a href="#local-6989586621680161287"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680161288"><span class="annot"><a href="#local-6989586621680161288"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>    </span><span id="HideEffects"><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-var">HideEffects</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680161290"><span class="annot"><a href="#local-6989586621680161290"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621680161291"><span class="annot"><a href="#local-6989586621680161291"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621680161292"><span class="annot"><a href="#local-6989586621680161292"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621680161290"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161291"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161292"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161290"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161292"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680161178"><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680161176"><span class="annot"><a href="#local-6989586621680161176"><span class="hs-identifier hs-type">es</span></a></span></span><span> </span><span id="local-6989586621680161177"><span class="annot"><a href="#local-6989586621680161177"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680161178"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161176"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161177"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GShow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161178"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-114"></span><span>    </span><span id="local-6989586621680161297"><span class="annot"><span class="annottext">gshowsPrec :: forall a. Int -&gt; HideEffects f a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var">gshowsPrec</span></span></span><span> </span><span id="local-6989586621680161298"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680161298"><span class="hs-identifier hs-var">prec</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span id="local-6989586621680161304"><span class="annot"><span class="annottext">f b a
</span><a href="#local-6989586621680161304"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ShowS -&gt; ShowS
</span><span class="hs-identifier hs-var">showParen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680161298"><span class="hs-identifier hs-var">prec</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HideEffects&quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ShowS
</span><span class="hs-identifier hs-var">showChar</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; f b a -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><span class="hs-identifier hs-var">showsPrec</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">f b a
</span><a href="#local-6989586621680161304"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680161195"><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680161194"><span class="annot"><a href="#local-6989586621680161194"><span class="hs-identifier hs-type">es</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GEq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680161195"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161194"><span class="hs-identifier hs-type">es</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GEq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161195"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621680161312"><span class="annot"><span class="annottext">geq :: forall a b. HideEffects f a -&gt; HideEffects f b -&gt; Maybe (a :~: b)
</span><span class="hs-identifier hs-var hs-var hs-var">geq</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680161313"><span id="local-6989586621680161314"><span id="local-6989586621680161315"><span class="annot"><span class="annottext">f b a
</span><a href="#local-6989586621680161315"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680161195"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161313"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161314"><span class="hs-identifier hs-type">a</span></a></span></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680161317"><span id="local-6989586621680161318"><span id="local-6989586621680161319"><span class="annot"><span class="annottext">f b b
</span><a href="#local-6989586621680161319"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680161195"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161317"><span class="hs-identifier hs-type">fs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161318"><span class="hs-identifier hs-type">b</span></a></span></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">f b a -&gt; f b b -&gt; Maybe (a :~: b)
forall a b. f b a -&gt; f b b -&gt; Maybe (a :~: b)
forall k (f :: k -&gt; *) (a :: k) (b :: k).
GEq f =&gt;
f a -&gt; f b -&gt; Maybe (a :~: b)
</span><span class="hs-identifier hs-var">geq</span></span><span> </span><span class="annot"><span class="annottext">f b a
</span><a href="#local-6989586621680161315"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f b b -&gt; f b b
forall a b. a -&gt; b
</span><span class="hs-identifier hs-var">unsafeCoerce</span></span><span> </span><span class="annot"><span class="annottext">f b b
</span><a href="#local-6989586621680161319"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680161195"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161313"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161318"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-120"></span><span>            </span><span class="annot"><span class="annottext">Maybe (a :~: b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (a :~: b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-121"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">a :~: b
</span><span class="hs-identifier hs-var">Refl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a :~: b) -&gt; Maybe (a :~: b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a :~: a
a :~: b
forall {k} (a :: k). a :~: a
</span><span class="hs-identifier hs-var">Refl</span></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680161210"><span id="local-6989586621680161211"><span id="local-6989586621680161325"><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680161207"><span class="annot"><a href="#local-6989586621680161207"><span class="hs-identifier hs-type">es</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680161210"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161207"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161211"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161210"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161211"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>    </span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span id="local-6989586621680161332"><span class="annot"><span class="annottext">f b a
</span><a href="#local-6989586621680161332"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680161333"><span class="annot"><span class="annottext">== :: HideEffects f a -&gt; HideEffects f a -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span id="local-6989586621680161335"><span class="annot"><span class="annottext">f b a
</span><a href="#local-6989586621680161335"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">f b a
</span><a href="#local-6989586621680161332"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">f b a -&gt; f b a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">f b a -&gt; f b a
forall a b. a -&gt; b
</span><span class="hs-identifier hs-var">unsafeCoerce</span></span><span> </span><span class="annot"><span class="annottext">f b a
</span><a href="#local-6989586621680161335"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680161217"><span id="local-6989586621680161218"><span id="local-6989586621680161342"><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680161216"><span class="annot"><a href="#local-6989586621680161216"><span class="hs-identifier hs-type">es</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680161217"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161216"><span class="hs-identifier hs-type">es</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161218"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161217"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161218"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-127"></span><span>    </span><span id="local-6989586621680161347"><span class="annot"><span class="annottext">hashWithSalt :: Int -&gt; HideEffects f a -&gt; Int
</span><a href="#local-6989586621680161347"><span class="hs-identifier hs-var hs-var hs-var">hashWithSalt</span></a></span></span><span> </span><span id="local-6989586621680161349"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680161349"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#HideEffects"><span class="hs-identifier hs-type">HideEffects</span></a></span><span> </span><span id="local-6989586621680161351"><span class="annot"><span class="annottext">f b a
</span><a href="#local-6989586621680161351"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; f b a -&gt; Int
forall a. Hashable a =&gt; Int -&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">hashWithSalt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680161349"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">f b a
</span><a href="#local-6989586621680161351"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680161227"><span id="local-6989586621680161359"><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680161223"><span class="annot"><a href="#local-6989586621680161223"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680161227"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680161223"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GEq</span></span><span> </span><span class="annot"><a href="#local-6989586621680161227"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span class="annot"><a href="#local-6989586621680161227"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621680161363"><span class="annot"><span class="annottext">hashWithSalt :: Int -&gt; Some f -&gt; Int
</span><span class="hs-identifier hs-var hs-var hs-var">hashWithSalt</span></span></span><span> </span><span id="local-6989586621680161364"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680161364"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span id="local-6989586621680161367"><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621680161367"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; f a -&gt; Int
forall a. Hashable a =&gt; Int -&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">hashWithSalt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680161364"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">f a
</span><a href="#local-6989586621680161367"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-131"></span></pre></body></html>