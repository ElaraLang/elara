<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">{- | Emits JVM bytecode from the Core AST

The emitting process:
Every module is translated to a class file.
For each declaration, we turn it into a field if it is a value (i.e. a zero argument function, including IO actions),
or a method if it is a function.

*Translation of functions to methods:*

The emitter will eta expand declarations:
@ let id = \x -&gt; x@
will be translated to:
@ public static Object id(Object x) { return x; }@

however it does not do any complex analysis on the code:
@ let add x =
   if x == 0 then \y -&gt; y else \y -&gt; x + y
@
The higher order function here _can_ be avoided if we rearrange the code into:
@ let add = \x -&gt; \y -&gt;
   if x == 0 then y else x + y
@
but this responsibility is left to the CoreToCore pass, so the emitter will still produce inefficient code:

@ public static Func add(int x) {
   if (x == 0) {
       return (y) -&gt; y;
   } else {
       return (y) -&gt; x + y;
   }
}
@

What this means is that the emitted method's arity will always match the declared arity of the function
(i.e. how many directly nested lambdas there are)
-}</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html"><span class="hs-identifier">Elara.JVM.Emit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.Emit.html#emitIRModule"><span class="hs-identifier">emitIRModule</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.State.Static.Local</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html"><span class="hs-identifier">Elara.Data.Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Pretty.html#prettyToText"><span class="hs-identifier">prettyToText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Unique.html"><span class="hs-identifier">Elara.Data.Unique</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.Operator.html"><span class="hs-identifier">Elara.JVM.Emit.Operator</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.Emit.Operator.html#translateOperatorName"><span class="hs-identifier">translateOperatorName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.State.html"><span class="hs-identifier">Elara.JVM.Emit.State</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.Types.html"><span class="hs-identifier">Elara.JVM.Emit.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier">stringTypeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html"><span class="hs-identifier">Elara.JVM.IR</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IR</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Logging.html"><span class="hs-identifier">Elara.Logging</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.Builder</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ClassBuilder</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">addAccessFlag</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">addField</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">addMethod</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runClassBuilder</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">setName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">setSuperClass</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.Builder.Code</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CodeBuilder</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">emit</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newLabel</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runCodeBuilder</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.ClassFile</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.ClassFile.AccessFlags</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ClassAccessFlag</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">FieldAccessFlag</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FPublic</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MethodAccessFlag</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.ClassFile.Field</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ClassFileField</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ClassFileField</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.ClassFile.Method</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.ConstantPool</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BootstrapArgument</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">BootstrapMethod</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MethodHandleEntry</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MethodRef</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.Descriptor</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.Instruction</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">JVM</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.Name</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.Type</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Abstract.Type</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">JVM</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Analyse.StackMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">calculateStackMapFrames</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.JVMVersion</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">JVM.Data.Raw.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">U2</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="annot"><span class="hs-comment">-- | Emit an IR Module to a list of ClassFiles</span></span><span>
</span><span id="line-67"></span><span id="local-6989586621680068690"><span class="annot"><a href="Elara.JVM.Emit.html#emitIRModule"><span class="hs-identifier hs-type">emitIRModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068690"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Module"><span class="hs-identifier hs-type">IR.Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068690"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ClassFile</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-68"></span><span id="emitIRModule"><span class="annot"><span class="annottext">emitIRModule :: forall (r :: [Effect]).
(StructuredDebug :&gt; r) =&gt;
Module -&gt; Eff r [ClassFile]
</span><a href="Elara.JVM.Emit.html#emitIRModule"><span class="hs-identifier hs-var hs-var">emitIRModule</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.IR.html#Module"><span class="hs-identifier hs-type">IR.Module</span></a></span><span> </span><span id="local-6989586621680068911"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068911"><span class="hs-identifier hs-var">moduleName</span></a></span></span><span> </span><span id="local-6989586621680068912"><span class="annot"><span class="annottext">[Class]
</span><a href="#local-6989586621680068912"><span class="hs-identifier hs-var">classes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="annottext">[Class] -&gt; (Class -&gt; Eff r ClassFile) -&gt; Eff r [ClassFile]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">[Class]
</span><a href="#local-6989586621680068912"><span class="hs-identifier hs-var">classes</span></a></span><span> </span><span class="annot"><span class="annottext">((Class -&gt; Eff r ClassFile) -&gt; Eff r [ClassFile])
-&gt; (Class -&gt; Eff r ClassFile) -&gt; Eff r [ClassFile]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((ClassFile, ()) -&gt; ClassFile)
-&gt; Eff r (ClassFile, ()) -&gt; Eff r ClassFile
forall a b. (a -&gt; b) -&gt; Eff r a -&gt; Eff r b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(ClassFile, ()) -&gt; ClassFile
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Eff r (ClassFile, ()) -&gt; Eff r ClassFile)
-&gt; (Class -&gt; Eff r (ClassFile, ())) -&gt; Class -&gt; Eff r ClassFile
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
-&gt; JVMVersion -&gt; Eff (ClassBuilder : r) () -&gt; Eff r (ClassFile, ())
forall (r :: [Effect]) a.
QualifiedClassName
-&gt; JVMVersion -&gt; Eff (ClassBuilder : r) a -&gt; Eff r (ClassFile, a)
</span><span class="hs-identifier hs-var">runClassBuilder</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068911"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">JVMVersion
</span><span class="hs-identifier hs-var">java8</span></span><span> </span><span class="annot"><span class="annottext">(Eff (ClassBuilder : r) () -&gt; Eff r (ClassFile, ()))
-&gt; (Class -&gt; Eff (ClassBuilder : r) ())
-&gt; Class
-&gt; Eff r (ClassFile, ())
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Class -&gt; Eff (ClassBuilder : r) ()
forall (r :: [Effect]).
(StructuredDebug :&gt; r, ClassBuilder :&gt; r) =&gt;
Class -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitIRClass"><span class="hs-identifier hs-var">emitIRClass</span></a></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="annot"><span class="hs-comment">-- | Emit a single IR Class to a ClassFile</span></span><span>
</span><span id="line-72"></span><span id="local-6989586621680068725"><span class="annot"><a href="Elara.JVM.Emit.html#emitIRClass"><span class="hs-identifier hs-type">emitIRClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068725"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassBuilder</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068725"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Class"><span class="hs-identifier hs-type">IR.Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068725"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-73"></span><span id="emitIRClass"><span class="annot"><span class="annottext">emitIRClass :: forall (r :: [Effect]).
(StructuredDebug :&gt; r, ClassBuilder :&gt; r) =&gt;
Class -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitIRClass"><span class="hs-identifier hs-var hs-var">emitIRClass</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.IR.html#Class"><span class="hs-identifier hs-type">IR.Class</span></a></span><span> </span><span id="local-6989586621680068960"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068960"><span class="hs-identifier hs-var">className</span></a></span></span><span> </span><span id="local-6989586621680068961"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068961"><span class="hs-identifier hs-var">super</span></a></span></span><span> </span><span id="local-6989586621680068962"><span class="annot"><span class="annottext">[Field]
</span><a href="#local-6989586621680068962"><span class="hs-identifier hs-var">fields</span></a></span></span><span> </span><span id="local-6989586621680068963"><span class="annot"><span class="annottext">[Method]
</span><a href="#local-6989586621680068963"><span class="hs-identifier hs-var">methods</span></a></span></span><span> </span><span id="local-6989586621680068964"><span class="annot"><span class="annottext">[Constructor]
</span><a href="#local-6989586621680068964"><span class="hs-identifier hs-var">constructors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; Eff r ()
forall (r :: [Effect]).
(ClassBuilder :&gt; r) =&gt;
QualifiedClassName -&gt; Eff r ()
</span><span class="hs-identifier hs-var">setName</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068960"><span class="hs-identifier hs-var">className</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; Eff r ()
forall (r :: [Effect]).
(ClassBuilder :&gt; r) =&gt;
QualifiedClassName -&gt; Eff r ()
</span><span class="hs-identifier hs-var">setSuperClass</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068961"><span class="hs-identifier hs-var">super</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="annottext">ClassAccessFlag -&gt; Eff r ()
forall (r :: [Effect]).
(ClassBuilder :&gt; r) =&gt;
ClassAccessFlag -&gt; Eff r ()
</span><span class="hs-identifier hs-var">addAccessFlag</span></span><span> </span><span class="annot"><span class="annottext">ClassAccessFlag
</span><span class="hs-identifier hs-var">Public</span></span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="annottext">(Field -&gt; Eff r ()) -&gt; [Field] -&gt; Eff r ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Field -&gt; Eff r ()
forall (r :: [Effect]).
(StructuredDebug :&gt; r, ClassBuilder :&gt; r) =&gt;
Field -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitIRField"><span class="hs-identifier hs-var">emitIRField</span></a></span><span> </span><span class="annot"><span class="annottext">[Field]
</span><a href="#local-6989586621680068962"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="annottext">(Method -&gt; Eff r ()) -&gt; [Method] -&gt; Eff r ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; Method -&gt; Eff r ()
forall (r :: [Effect]).
(StructuredDebug :&gt; r, ClassBuilder :&gt; r, HasCallStack) =&gt;
QualifiedClassName -&gt; Method -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitIRMethod"><span class="hs-identifier hs-var">emitIRMethod</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068960"><span class="hs-identifier hs-var">className</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Method]
</span><a href="#local-6989586621680068963"><span class="hs-identifier hs-var">methods</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="annottext">(Constructor -&gt; Eff r ()) -&gt; [Constructor] -&gt; Eff r ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; Constructor -&gt; Eff r ()
forall (r :: [Effect]).
(StructuredDebug :&gt; r, ClassBuilder :&gt; r) =&gt;
QualifiedClassName -&gt; Constructor -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitConstructor"><span class="hs-identifier hs-var">emitConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068960"><span class="hs-identifier hs-var">className</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Constructor]
</span><a href="#local-6989586621680068964"><span class="hs-identifier hs-var">constructors</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Eff r () -&gt; Eff r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; [Method] -&gt; Bool
</span><a href="#local-6989586621680068971"><span class="hs-identifier hs-var">shouldAddMainMethod</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068960"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">[Method]
</span><a href="#local-6989586621680068963"><span class="hs-identifier hs-var">methods</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r () -&gt; Eff r ()) -&gt; Eff r () -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; Eff r ()
forall (r :: [Effect]).
(StructuredDebug :&gt; r, ClassBuilder :&gt; r) =&gt;
QualifiedClassName -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitJVMMainMethod"><span class="hs-identifier hs-var">emitJVMMainMethod</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068960"><span class="hs-identifier hs-var">className</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="#local-6989586621680068971"><span class="hs-identifier hs-type">shouldAddMainMethod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QualifiedClassName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.JVM.IR.html#Method"><span class="hs-identifier hs-type">IR.Method</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621680068971"><span class="annot"><span class="annottext">shouldAddMainMethod :: QualifiedClassName -&gt; [Method] -&gt; Bool
</span><a href="#local-6989586621680068971"><span class="hs-identifier hs-var hs-var">shouldAddMainMethod</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">QualifiedClassName</span></span><span> </span><span class="annot"><span class="annottext">PackageName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassName</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Main&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="annottext">(Method -&gt; Bool) -&gt; [Method] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Method -&gt; Bool
</span><a href="#local-6989586621680068976"><span class="hs-identifier hs-var">isElaraMain</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="#local-6989586621680068971"><span class="hs-identifier hs-var">shouldAddMainMethod</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [Method] -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="#local-6989586621680068976"><span class="hs-identifier hs-type">isElaraMain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Method"><span class="hs-identifier hs-type">IR.Method</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621680068976"><span class="annot"><span class="annottext">isElaraMain :: Method -&gt; Bool
</span><a href="#local-6989586621680068976"><span class="hs-identifier hs-var hs-var">isElaraMain</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.IR.html#Method"><span class="hs-identifier hs-type">IR.Method</span></a></span><span> </span><span id="local-6989586621680068979"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680068979"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MethodDescriptor</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReturn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ObjectFieldType</span></span><span> </span><span id="local-6989586621680068983"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068983"><span class="hs-identifier hs-var">ioCls</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Block]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680068979"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;main&quot;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680068983"><span class="hs-identifier hs-var">ioCls</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; QualifiedClassName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.IO&quot;</span></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="#local-6989586621680068976"><span class="hs-identifier hs-var">isElaraMain</span></a></span><span> </span><span class="annot"><span class="annottext">Method
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><span class="hs-comment">-- | Emit a field to the current class</span></span><span>
</span><span id="line-94"></span><span id="local-6989586621680068740"><span class="annot"><a href="Elara.JVM.Emit.html#emitIRField"><span class="hs-identifier hs-type">emitIRField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068740"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassBuilder</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068740"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Field"><span class="hs-identifier hs-type">IR.Field</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068740"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-95"></span><span id="emitIRField"><span class="annot"><span class="annottext">emitIRField :: forall (r :: [Effect]).
(StructuredDebug :&gt; r, ClassBuilder :&gt; r) =&gt;
Field -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitIRField"><span class="hs-identifier hs-var hs-var">emitIRField</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.IR.html#Field"><span class="hs-identifier hs-type">IR.Field</span></a></span><span> </span><span id="local-6989586621680068989"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680068989"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span id="local-6989586621680068990"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680068990"><span class="hs-identifier hs-var">fieldType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-97"></span><span>        </span><span id="local-6989586621680068991"><span class="annot"><span class="annottext">fieldInfo :: ClassFileField
</span><a href="#local-6989586621680068991"><span class="hs-identifier hs-var hs-var">fieldInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-98"></span><span>            </span><span class="annot"><span class="annottext">[FieldAccessFlag]
-&gt; Text -&gt; FieldType -&gt; [FieldAttribute] -&gt; ClassFileField
</span><span class="hs-identifier hs-var">ClassFileField</span></span><span>
</span><span id="line-99"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldAccessFlag
</span><span class="hs-identifier hs-var">FPublic</span></span><span class="hs-special">]</span><span>
</span><span id="line-100"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680068989"><span class="hs-identifier hs-var">fieldName</span></a></span><span>
</span><span id="line-101"></span><span>                </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680068990"><span class="hs-identifier hs-var">fieldType</span></a></span><span>
</span><span id="line-102"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><span class="annottext">ClassFileField -&gt; Eff r ()
forall (r :: [Effect]).
(ClassBuilder :&gt; r) =&gt;
ClassFileField -&gt; Eff r ()
</span><span class="hs-identifier hs-var">addField</span></span><span> </span><span class="annot"><span class="annottext">ClassFileField
</span><a href="#local-6989586621680068991"><span class="hs-identifier hs-var">fieldInfo</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span class="annot"><span class="hs-comment">-- | Emit a method to the current class</span></span><span>
</span><span id="line-106"></span><span id="local-6989586621680068741"><span class="annot"><a href="Elara.JVM.Emit.html#emitIRMethod"><span class="hs-identifier hs-type">emitIRMethod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068741"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassBuilder</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068741"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QualifiedClassName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Method"><span class="hs-identifier hs-type">IR.Method</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068741"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-107"></span><span id="emitIRMethod"><span class="annot"><span class="annottext">emitIRMethod :: forall (r :: [Effect]).
(StructuredDebug :&gt; r, ClassBuilder :&gt; r, HasCallStack) =&gt;
QualifiedClassName -&gt; Method -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitIRMethod"><span class="hs-identifier hs-var hs-var">emitIRMethod</span></a></span></span><span> </span><span id="local-6989586621680069014"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069014"><span class="hs-identifier hs-var">thisClassName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.IR.html#Method"><span class="hs-identifier hs-type">IR.Method</span></a></span><span> </span><span id="local-6989586621680069015"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069015"><span class="hs-identifier hs-var">methodName</span></a></span></span><span> </span><span id="local-6989586621680069016"><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069016"><span class="hs-identifier hs-var">methodDescriptor</span></a></span></span><span> </span><span id="local-6989586621680069017"><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680069017"><span class="hs-identifier hs-var">methodArgs</span></a></span></span><span> </span><span id="local-6989586621680069018"><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680069018"><span class="hs-identifier hs-var">methodCode</span></a></span></span><span> </span><span id="local-6989586621680069019"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680069019"><span class="hs-identifier hs-var">isStatic</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069020"><span class="annot"><span class="annottext">createState :: [Unique Text] -&gt; QualifiedClassName -&gt; MethodCreationState
</span><a href="#local-6989586621680069020"><span class="hs-identifier hs-var hs-var hs-var">createState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680069019"><span class="hs-identifier hs-var">isStatic</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Unique Text] -&gt; QualifiedClassName -&gt; MethodCreationState
</span><a href="Elara.JVM.Emit.State.html#createMethodCreationState"><span class="hs-identifier hs-var">createMethodCreationState</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Unique Text] -&gt; QualifiedClassName -&gt; MethodCreationState
</span><a href="Elara.JVM.Emit.html#createInstanceMethodCreationState"><span class="hs-identifier hs-var">createInstanceMethodCreationState</span></a></span><span>
</span><span id="line-109"></span><span>        </span><span id="local-6989586621680069023"><span class="annot"><span class="annottext">accessFlags :: [MethodAccessFlag]
</span><a href="#local-6989586621680069023"><span class="hs-identifier hs-var hs-var hs-var">accessFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680069019"><span class="hs-identifier hs-var">isStatic</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MethodAccessFlag
</span><span class="hs-identifier hs-var">MPublic</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MethodAccessFlag
</span><span class="hs-identifier hs-var">MStatic</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MethodAccessFlag
</span><span class="hs-identifier hs-var">MPublic</span></span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span>        </span><span id="local-6989586621680069026"><span class="annot"><span class="annottext">maxLocalsModifier :: U2
</span><a href="#local-6989586621680069026"><span class="hs-identifier hs-var hs-var hs-var">maxLocalsModifier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680069019"><span class="hs-identifier hs-var">isStatic</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">1</span></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680069027"><span class="annot"><a href="#local-6989586621680069027"><span class="hs-identifier hs-var">methodCreationState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069028"><span class="annot"><a href="#local-6989586621680069028"><span class="hs-identifier hs-var">codeAttributes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069029"><span class="annot"><a href="#local-6989586621680069029"><span class="hs-identifier hs-var">instructions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="annottext">Eff (CodeBuilder : r) MethodCreationState
-&gt; Eff r (MethodCreationState, [CodeAttribute], [Instruction])
forall (r :: [Effect]) a.
Eff (CodeBuilder : r) a
-&gt; Eff r (a, [CodeAttribute], [Instruction])
</span><span class="hs-identifier hs-var">runCodeBuilder</span></span><span> </span><span class="annot"><span class="annottext">(Eff (CodeBuilder : r) MethodCreationState
 -&gt; Eff r (MethodCreationState, [CodeAttribute], [Instruction]))
-&gt; Eff (CodeBuilder : r) MethodCreationState
-&gt; Eff r (MethodCreationState, [CodeAttribute], [Instruction])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-113"></span><span>            </span><span class="annot"><span class="annottext">MethodCreationState
-&gt; Eff (State MethodCreationState : CodeBuilder : r) [()]
-&gt; Eff (CodeBuilder : r) MethodCreationState
forall s (es :: [Effect]) a.
HasCallStack =&gt;
s -&gt; Eff (State s : es) a -&gt; Eff es s
</span><span class="hs-identifier hs-var">execState</span></span><span>
</span><span id="line-114"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Unique Text] -&gt; QualifiedClassName -&gt; MethodCreationState
</span><a href="#local-6989586621680069020"><span class="hs-identifier hs-var">createState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Unique Text, FieldType) -&gt; Unique Text
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Unique Text, FieldType) -&gt; Unique Text)
-&gt; [(Unique Text, FieldType)] -&gt; [Unique Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680069017"><span class="hs-identifier hs-var">methodArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069014"><span class="hs-identifier hs-var">thisClassName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Block -&gt; Eff (State MethodCreationState : CodeBuilder : r) ())
-&gt; [Block]
-&gt; Eff (State MethodCreationState : CodeBuilder : r) [()]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Block -&gt; Eff (State MethodCreationState : CodeBuilder : r) ()
forall (r :: [Effect]). EmitCode r =&gt; Block -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitIRBlock"><span class="hs-identifier hs-var">emitIRBlock</span></a></span><span> </span><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680069018"><span class="hs-identifier hs-var">methodCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069034"><span class="annot"><a href="#local-6989586621680069034"><span class="hs-identifier hs-var hs-var">maxLocals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">U2
</span><a href="#local-6989586621680069026"><span class="hs-identifier hs-var">maxLocalsModifier</span></a></span><span> </span><span class="annot"><span class="annottext">U2 -&gt; U2 -&gt; U2
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">MethodCreationState
</span><a href="#local-6989586621680069027"><span class="hs-identifier hs-var">methodCreationState</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">maxLocalVariables</span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">addMethod</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><a href="Elara.JVM.Emit.html#buildClassFileMethod"><span class="hs-identifier hs-type">buildClassFileMethod</span></a></span><span>
</span><span id="line-119"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.Emit.Operator.html#translateOperatorName"><span class="hs-identifier hs-type">translateOperatorName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069015"><span class="hs-identifier hs-type">methodName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>            </span><span class="annot"><a href="#local-6989586621680069023"><span class="hs-identifier hs-type">accessFlags</span></a></span><span>
</span><span id="line-121"></span><span>            </span><span class="annot"><a href="#local-6989586621680069016"><span class="hs-identifier hs-type">methodDescriptor</span></a></span><span>
</span><span id="line-122"></span><span>            </span><span class="annot"><a href="#local-6989586621680069034"><span class="hs-identifier hs-type">maxLocals</span></a></span><span>
</span><span id="line-123"></span><span>            </span><span class="annot"><a href="#local-6989586621680069014"><span class="hs-identifier hs-type">thisClassName</span></a></span><span>
</span><span id="line-124"></span><span>            </span><span class="annot"><a href="#local-6989586621680069028"><span class="hs-identifier hs-type">codeAttributes</span></a></span><span>
</span><span id="line-125"></span><span>            </span><span class="annot"><a href="#local-6989586621680069029"><span class="hs-identifier hs-type">instructions</span></a></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="annot"><span class="hs-comment">-- | Create method creation state for instance methods</span></span><span>
</span><span id="line-128"></span><span class="annot"><a href="Elara.JVM.Emit.html#createInstanceMethodCreationState"><span class="hs-identifier hs-type">createInstanceMethodCreationState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Argument names</span></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Name of the class containing the method</span></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">QualifiedClassName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><a href="Elara.JVM.Emit.State.html#MethodCreationState"><span class="hs-identifier hs-type">MethodCreationState</span></a></span><span>
</span><span id="line-134"></span><span id="createInstanceMethodCreationState"><span class="annot"><span class="annottext">createInstanceMethodCreationState :: [Unique Text] -&gt; QualifiedClassName -&gt; MethodCreationState
</span><a href="Elara.JVM.Emit.html#createInstanceMethodCreationState"><span class="hs-identifier hs-var hs-var">createInstanceMethodCreationState</span></a></span></span><span> </span><span id="local-6989586621680069057"><span class="annot"><span class="annottext">[Unique Text]
</span><a href="#local-6989586621680069057"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621680069058"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069058"><span class="hs-identifier hs-var">thisName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">Map LVKey U2
-&gt; U2
-&gt; QualifiedClassName
-&gt; Map (Unique Text) Label
-&gt; MethodCreationState
</span><a href="Elara.JVM.Emit.State.html#MethodCreationState"><span class="hs-identifier hs-var">MethodCreationState</span></a></span><span>
</span><span id="line-136"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Item (Map LVKey U2)] -&gt; Map LVKey U2
forall l. IsList l =&gt; [Item l] -&gt; l
</span><span class="hs-identifier hs-var">fromList</span></span><span> </span><span class="annot"><span class="annottext">([Item (Map LVKey U2)] -&gt; Map LVKey U2)
-&gt; [Item (Map LVKey U2)] -&gt; Map LVKey U2
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[LVKey] -&gt; [U2] -&gt; [(LVKey, U2)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique Text -&gt; LVKey
</span><a href="Elara.JVM.Emit.State.html#KnownName"><span class="hs-identifier hs-var">KnownName</span></a></span><span> </span><span class="annot"><span class="annottext">(Unique Text -&gt; LVKey) -&gt; [Unique Text] -&gt; [LVKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Unique Text]
</span><a href="#local-6989586621680069057"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; U2
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Unique Text] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Unique Text]
</span><a href="#local-6989586621680069057"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">U2 -&gt; U2 -&gt; U2
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069058"><span class="hs-identifier hs-var">thisName</span></a></span><span>
</span><span id="line-139"></span><span>        </span><span class="annot"><span class="annottext">Map (Unique Text) Label
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="annot"><span class="hs-comment">-- | Emit a constructor to the current class</span></span><span>
</span><span id="line-142"></span><span id="local-6989586621680068742"><span class="annot"><a href="Elara.JVM.Emit.html#emitConstructor"><span class="hs-identifier hs-type">emitConstructor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068742"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassBuilder</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068742"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QualifiedClassName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Constructor"><span class="hs-identifier hs-type">IR.Constructor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068742"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-143"></span><span id="emitConstructor"><span class="annot"><span class="annottext">emitConstructor :: forall (r :: [Effect]).
(StructuredDebug :&gt; r, ClassBuilder :&gt; r) =&gt;
QualifiedClassName -&gt; Constructor -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitConstructor"><span class="hs-identifier hs-var hs-var">emitConstructor</span></a></span></span><span> </span><span id="local-6989586621680069081"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069081"><span class="hs-identifier hs-var">className</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.IR.html#Constructor"><span class="hs-identifier hs-type">IR.Constructor</span></a></span><span> </span><span id="local-6989586621680069083"><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069083"><span class="hs-identifier hs-var">constructorDesc</span></a></span></span><span> </span><span id="local-6989586621680069084"><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680069084"><span class="hs-identifier hs-var">constructorArgs</span></a></span></span><span> </span><span id="local-6989586621680069085"><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680069085"><span class="hs-identifier hs-var">constructorCode</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680069086"><span class="annot"><a href="#local-6989586621680069086"><span class="hs-identifier hs-var">emitState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069087"><span class="annot"><a href="#local-6989586621680069087"><span class="hs-identifier hs-var">codeAttributes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069088"><span class="annot"><a href="#local-6989586621680069088"><span class="hs-identifier hs-var">instructions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><span class="annottext">Eff (CodeBuilder : r) MethodCreationState
-&gt; Eff r (MethodCreationState, [CodeAttribute], [Instruction])
forall (r :: [Effect]) a.
Eff (CodeBuilder : r) a
-&gt; Eff r (a, [CodeAttribute], [Instruction])
</span><span class="hs-identifier hs-var">runCodeBuilder</span></span><span> </span><span class="annot"><span class="annottext">(Eff (CodeBuilder : r) MethodCreationState
 -&gt; Eff r (MethodCreationState, [CodeAttribute], [Instruction]))
-&gt; Eff (CodeBuilder : r) MethodCreationState
-&gt; Eff r (MethodCreationState, [CodeAttribute], [Instruction])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-146"></span><span>            </span><span class="annot"><span class="annottext">MethodCreationState
-&gt; Eff (State MethodCreationState : CodeBuilder : r) [()]
-&gt; Eff (CodeBuilder : r) MethodCreationState
forall s (es :: [Effect]) a.
HasCallStack =&gt;
s -&gt; Eff (State s : es) a -&gt; Eff es s
</span><span class="hs-identifier hs-var">execState</span></span><span>
</span><span id="line-147"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Unique Text] -&gt; QualifiedClassName -&gt; MethodCreationState
</span><a href="Elara.JVM.Emit.html#createInstanceMethodCreationState"><span class="hs-identifier hs-var">createInstanceMethodCreationState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Unique Text, FieldType) -&gt; Unique Text
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Unique Text, FieldType) -&gt; Unique Text)
-&gt; [(Unique Text, FieldType)] -&gt; [Unique Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Unique Text, FieldType)]
</span><a href="#local-6989586621680069084"><span class="hs-identifier hs-var">constructorArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069081"><span class="hs-identifier hs-var">className</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Block -&gt; Eff (State MethodCreationState : CodeBuilder : r) ())
-&gt; [Block]
-&gt; Eff (State MethodCreationState : CodeBuilder : r) [()]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Block -&gt; Eff (State MethodCreationState : CodeBuilder : r) ()
forall (r :: [Effect]). EmitCode r =&gt; Block -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitIRBlock"><span class="hs-identifier hs-var">emitIRBlock</span></a></span><span> </span><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680069085"><span class="hs-identifier hs-var">constructorCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069089"><span class="annot"><a href="#local-6989586621680069089"><span class="hs-identifier hs-var hs-var">maxLocals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">U2 -&gt; U2 -&gt; U2
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">MethodCreationState
</span><a href="#local-6989586621680069086"><span class="hs-identifier hs-var">emitState</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">maxLocalVariables</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">addMethod</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#buildClassFileMethod"><span class="hs-identifier hs-type">buildClassFileMethod</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;&lt;init&gt;&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">MPublic</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621680069083"><span class="hs-identifier hs-type">constructorDesc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069089"><span class="hs-identifier hs-type">maxLocals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069081"><span class="hs-identifier hs-type">className</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069087"><span class="hs-identifier hs-type">codeAttributes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069088"><span class="hs-identifier hs-type">instructions</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><span class="hs-comment">-- | Build a ClassFileMethod with the standard Code attribute</span></span><span>
</span><span id="line-153"></span><span class="annot"><a href="Elara.JVM.Emit.html#buildClassFileMethod"><span class="hs-identifier hs-type">buildClassFileMethod</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Method name</span></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Access flags</span></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">MethodAccessFlag</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Method descriptor</span></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MethodDescriptor</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Max locals</span></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">U2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Class name (for stack map calculation)</span></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">QualifiedClassName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Additional code attributes</span></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">CodeAttribute</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Body of the method</span></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">JVM.Instruction</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ClassFileMethod</span></span><span>
</span><span id="line-169"></span><span id="buildClassFileMethod"><span class="annot"><span class="annottext">buildClassFileMethod :: Text
-&gt; [MethodAccessFlag]
-&gt; MethodDescriptor
-&gt; U2
-&gt; QualifiedClassName
-&gt; [CodeAttribute]
-&gt; [Instruction]
-&gt; ClassFileMethod
</span><a href="Elara.JVM.Emit.html#buildClassFileMethod"><span class="hs-identifier hs-var hs-var">buildClassFileMethod</span></a></span></span><span> </span><span id="local-6989586621680069097"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069097"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680069098"><span class="annot"><span class="annottext">[MethodAccessFlag]
</span><a href="#local-6989586621680069098"><span class="hs-identifier hs-var">accessFlags</span></a></span></span><span> </span><span id="local-6989586621680069099"><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069099"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span id="local-6989586621680069100"><span class="annot"><span class="annottext">U2
</span><a href="#local-6989586621680069100"><span class="hs-identifier hs-var">maxLocals</span></a></span></span><span> </span><span id="local-6989586621680069101"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069101"><span class="hs-identifier hs-var">className</span></a></span></span><span> </span><span id="local-6989586621680069102"><span class="annot"><span class="annottext">[CodeAttribute]
</span><a href="#local-6989586621680069102"><span class="hs-identifier hs-var">codeAttrs</span></a></span></span><span> </span><span id="local-6989586621680069103"><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680069103"><span class="hs-identifier hs-var">instructions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ClassFileMethod</span></span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">methodAccessFlags :: [MethodAccessFlag]
</span><span class="hs-identifier hs-var">methodAccessFlags</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MethodAccessFlag]
</span><a href="#local-6989586621680069098"><span class="hs-identifier hs-var">accessFlags</span></a></span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">methodName :: Text
</span><span class="hs-identifier hs-var">methodName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069097"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">methodDescriptor :: MethodDescriptor
</span><span class="hs-identifier hs-var">methodDescriptor</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069099"><span class="hs-identifier hs-var">desc</span></a></span><span>
</span><span id="line-174"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">methodAttributes :: TypeMergingList MethodAttribute
</span><span class="hs-identifier hs-var">methodAttributes</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-175"></span><span>            </span><span class="annot"><span class="annottext">[Item (TypeMergingList MethodAttribute)]
-&gt; TypeMergingList MethodAttribute
forall l. IsList l =&gt; [Item l] -&gt; l
</span><span class="hs-identifier hs-var">fromList</span></span><span>
</span><span id="line-176"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CodeAttributeData -&gt; MethodAttribute
</span><span class="hs-identifier hs-var">Code</span></span><span> </span><span class="annot"><span class="annottext">(CodeAttributeData -&gt; MethodAttribute)
-&gt; CodeAttributeData -&gt; MethodAttribute
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-177"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">CodeAttributeData</span></span><span>
</span><span id="line-178"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">maxStack :: U2
</span><span class="hs-identifier hs-var">maxStack</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">10</span></span><span> </span><span class="hs-comment">-- TODO: Calculate this properly</span><span>
</span><span id="line-179"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxLocals :: U2
</span><span class="hs-identifier hs-var">maxLocals</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">U2
</span><a href="#local-6989586621680069100"><span class="hs-identifier hs-var">maxLocals</span></a></span><span>
</span><span id="line-180"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">code :: [Instruction]
</span><span class="hs-identifier hs-var">code</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680069103"><span class="hs-identifier hs-var">instructions</span></a></span><span>
</span><span id="line-181"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">exceptionTable :: [ExceptionTableEntry]
</span><span class="hs-identifier hs-var">exceptionTable</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-182"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">codeAttributes :: [CodeAttribute]
</span><span class="hs-identifier hs-var">codeAttributes</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StackMapFrame] -&gt; CodeAttribute
</span><span class="hs-identifier hs-var">StackMapTable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt;
QualifiedClassName
-&gt; [MethodAccessFlag]
-&gt; MethodDescriptor
-&gt; [Instruction]
-&gt; [StackMapFrame]
QualifiedClassName
-&gt; [MethodAccessFlag]
-&gt; MethodDescriptor
-&gt; [Instruction]
-&gt; [StackMapFrame]
</span><span class="hs-identifier hs-var">calculateStackMapFrames</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069101"><span class="hs-identifier hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">[MethodAccessFlag]
</span><a href="#local-6989586621680069098"><span class="hs-identifier hs-var">accessFlags</span></a></span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069099"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680069103"><span class="hs-identifier hs-var">instructions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CodeAttribute -&gt; [CodeAttribute] -&gt; [CodeAttribute]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[CodeAttribute]
</span><a href="#local-6989586621680069102"><span class="hs-identifier hs-var">codeAttrs</span></a></span><span>
</span><span id="line-183"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-184"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-185"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="annot"><span class="hs-comment">-- | Effects needed to emit JVM code to a method</span></span><span>
</span><span id="line-188"></span><span class="hs-keyword">type</span><span> </span><span id="EmitCode"><span class="annot"><a href="Elara.JVM.Emit.html#EmitCode"><span class="hs-identifier hs-var">EmitCode</span></a></span></span><span> </span><span id="local-6989586621680069117"><span class="annot"><a href="#local-6989586621680069117"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680069117"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CodeBuilder</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680069117"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Elara.JVM.Emit.State.html#MethodCreationState"><span class="hs-identifier hs-type">MethodCreationState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680069117"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-comment">-- \| Emit a block of IR instructions</span><span>
</span><span id="line-191"></span><span id="local-6989586621680068788"><span class="annot"><a href="Elara.JVM.Emit.html#emitIRBlock"><span class="hs-identifier hs-type">emitIRBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#EmitCode"><span class="hs-identifier hs-type">EmitCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068788"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Block"><span class="hs-identifier hs-type">IR.Block</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068788"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-192"></span><span id="emitIRBlock"><span class="annot"><span class="annottext">emitIRBlock :: forall (r :: [Effect]). EmitCode r =&gt; Block -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitIRBlock"><span class="hs-identifier hs-var hs-var">emitIRBlock</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.JVM.IR.html#Block"><span class="hs-identifier hs-type">IR.Block</span></a></span><span> </span><span id="local-6989586621680069130"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069130"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span id="local-6989586621680069131"><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680069131"><span class="hs-identifier hs-var">instrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621680069132"><span class="annot"><a href="#local-6989586621680069132"><span class="hs-identifier hs-var">label'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; Eff r Label
forall (r :: [Effect]).
(State MethodCreationState :&gt; r, CodeBuilder :&gt; r) =&gt;
Unique Text -&gt; Eff r Label
</span><a href="Elara.JVM.Emit.State.html#getLabel"><span class="hs-identifier hs-var">getLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069130"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">JVM.Label</span></span><span> </span><span class="annot"><a href="#local-6989586621680069132"><span class="hs-identifier hs-type">label'</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#emitIRInstruction"><span class="hs-identifier hs-type">emitIRInstruction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069131"><span class="hs-identifier hs-type">instrs</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span class="annot"><span class="hs-comment">-- | Emit a single IR instruction to JVM instructions</span></span><span>
</span><span id="line-198"></span><span id="local-6989586621680068823"><span class="annot"><a href="Elara.JVM.Emit.html#emitIRInstruction"><span class="hs-identifier hs-type">emitIRInstruction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#EmitCode"><span class="hs-identifier hs-type">EmitCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068823"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Instruction"><span class="hs-identifier hs-type">IR.Instruction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068823"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-199"></span><span id="emitIRInstruction"><span class="annot"><span class="annottext">emitIRInstruction :: forall (r :: [Effect]). EmitCode r =&gt; Instruction -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitIRInstruction"><span class="hs-identifier hs-var hs-var">emitIRInstruction</span></a></span></span><span> </span><span id="local-6989586621680069227"><span class="annot"><span class="annottext">Instruction
</span><a href="#local-6989586621680069227"><span class="hs-identifier hs-var">instr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Instruction
</span><a href="#local-6989586621680069227"><span class="hs-identifier hs-var">instr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#Assign"><span class="hs-identifier hs-type">IR.Assign</span></a></span><span> </span><span id="local-6989586621680069229"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069229"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621680069230"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069230"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680069231"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069231"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069231"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">CheckCast</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069230"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ensure correct type, might not always be necessary</span><span>
</span><span id="line-203"></span><span>        </span><span id="local-6989586621680069235"><span class="annot"><a href="#local-6989586621680069235"><span class="hs-identifier hs-var">allocation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; Eff r U2
forall (r :: [Effect]).
(State MethodCreationState :&gt; r) =&gt;
Unique Text -&gt; Eff r U2
</span><a href="Elara.JVM.Emit.State.html#findLocalVariable"><span class="hs-identifier hs-var">findLocalVariable</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069229"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">AStore</span></span><span> </span><span class="annot"><a href="#local-6989586621680069235"><span class="hs-identifier hs-type">allocation</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#Return"><span class="hs-identifier hs-type">IR.Return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Expr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">Instruction
forall label. Instruction' label
</span><span class="hs-identifier hs-var">JVM.Return</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#Return"><span class="hs-identifier hs-type">IR.Return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680069240"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069240"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069240"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-208"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">Instruction
forall label. Instruction' label
</span><span class="hs-identifier hs-var">JVM.AReturn</span></span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#IReturn"><span class="hs-identifier hs-type">IR.IReturn</span></a></span><span> </span><span id="local-6989586621680069243"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069243"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-210"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069243"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">Instruction
forall label. Instruction' label
</span><span class="hs-identifier hs-var">JVM.IReturn</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#Jump"><span class="hs-identifier hs-type">IR.Jump</span></a></span><span> </span><span id="local-6989586621680069246"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069246"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>        </span><span id="local-6989586621680069247"><span class="annot"><a href="#local-6989586621680069247"><span class="hs-identifier hs-var">label'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; Eff r Label
forall (r :: [Effect]).
(State MethodCreationState :&gt; r, CodeBuilder :&gt; r) =&gt;
Unique Text -&gt; Eff r Label
</span><a href="Elara.JVM.Emit.State.html#getLabel"><span class="hs-identifier hs-var">getLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069246"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Goto</span></span><span> </span><span class="annot"><a href="#local-6989586621680069247"><span class="hs-identifier hs-type">label'</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#JumpIf"><span class="hs-identifier hs-type">IR.JumpIf</span></a></span><span> </span><span id="local-6989586621680069250"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069250"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621680069251"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069251"><span class="hs-identifier hs-var">trueLabel</span></a></span></span><span> </span><span id="local-6989586621680069252"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069252"><span class="hs-identifier hs-var">falseLabel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-216"></span><span>        </span><span id="local-6989586621680069253"><span class="annot"><a href="#local-6989586621680069253"><span class="hs-identifier hs-var">exprType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069250"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680069253"><span class="hs-identifier hs-type">exprType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-218"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrimitiveClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType
</span><span class="hs-identifier hs-var">JVM.Boolean</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>                </span><span id="local-6989586621680069256"><span class="annot"><a href="#local-6989586621680069256"><span class="hs-identifier hs-var">trueLabel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; Eff r Label
forall (r :: [Effect]).
(State MethodCreationState :&gt; r, CodeBuilder :&gt; r) =&gt;
Unique Text -&gt; Eff r Label
</span><a href="Elara.JVM.Emit.State.html#getLabel"><span class="hs-identifier hs-var">getLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069251"><span class="hs-identifier hs-var">trueLabel</span></a></span><span>
</span><span id="line-220"></span><span>                </span><span id="local-6989586621680069257"><span class="annot"><a href="#local-6989586621680069257"><span class="hs-identifier hs-var">falseLabel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.State.html#getLabel"><span class="hs-identifier hs-type">getLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069252"><span class="hs-identifier hs-type">falseLabel</span></a></span><span>
</span><span id="line-221"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IfEq</span></span><span> </span><span class="annot"><a href="#local-6989586621680069257"><span class="hs-identifier hs-type">falseLabel'</span></a></span><span>
</span><span id="line-222"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Goto</span></span><span> </span><span class="annot"><a href="#local-6989586621680069256"><span class="hs-identifier hs-type">trueLabel'</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Prim.Bool&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-224"></span><span>                </span><span id="local-6989586621680069260"><span class="annot"><a href="#local-6989586621680069260"><span class="hs-identifier hs-var">trueLabel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; Eff r Label
forall (r :: [Effect]).
(State MethodCreationState :&gt; r, CodeBuilder :&gt; r) =&gt;
Unique Text -&gt; Eff r Label
</span><a href="Elara.JVM.Emit.State.html#getLabel"><span class="hs-identifier hs-var">getLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069251"><span class="hs-identifier hs-var">trueLabel</span></a></span><span>
</span><span id="line-225"></span><span>                </span><span id="local-6989586621680069261"><span class="annot"><a href="#local-6989586621680069261"><span class="hs-identifier hs-var">falseLabel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.State.html#getLabel"><span class="hs-identifier hs-type">getLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069252"><span class="hs-identifier hs-type">falseLabel</span></a></span><span>
</span><span id="line-226"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Instanceof</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassInfoType</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Elara.Prim.True&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IfEq</span></span><span> </span><span class="annot"><a href="#local-6989586621680069261"><span class="hs-identifier hs-type">falseLabel'</span></a></span><span>
</span><span id="line-228"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Goto</span></span><span> </span><span class="annot"><a href="#local-6989586621680069260"><span class="hs-identifier hs-type">trueLabel'</span></a></span><span>
</span><span id="line-229"></span><span>            </span><span id="local-6989586621680069263"><span class="annot"><span class="annottext">Maybe ClassInfoType
</span><a href="#local-6989586621680069263"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r ()
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Eff r ()) -&gt; Text -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;emitIRInstruction: JumpIf condition has unsupported type: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Elara.Data.Pretty.html#prettyToText"><span class="hs-identifier hs-var">prettyToText</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ClassInfoType
</span><a href="#local-6989586621680069263"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#JumpIfPrimitiveBool"><span class="hs-identifier hs-type">IR.JumpIfPrimitiveBool</span></a></span><span> </span><span id="local-6989586621680069266"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069266"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621680069267"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069267"><span class="hs-identifier hs-var">trueLabel</span></a></span></span><span> </span><span id="local-6989586621680069268"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069268"><span class="hs-identifier hs-var">falseLabel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069266"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-232"></span><span>        </span><span id="local-6989586621680069269"><span class="annot"><a href="#local-6989586621680069269"><span class="hs-identifier hs-var">trueLabel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; Eff r Label
forall (r :: [Effect]).
(State MethodCreationState :&gt; r, CodeBuilder :&gt; r) =&gt;
Unique Text -&gt; Eff r Label
</span><a href="Elara.JVM.Emit.State.html#getLabel"><span class="hs-identifier hs-var">getLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069267"><span class="hs-identifier hs-var">trueLabel</span></a></span><span>
</span><span id="line-233"></span><span>        </span><span id="local-6989586621680069270"><span class="annot"><a href="#local-6989586621680069270"><span class="hs-identifier hs-var">falseLabel'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.State.html#getLabel"><span class="hs-identifier hs-type">getLabel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680069268"><span class="hs-identifier hs-type">falseLabel</span></a></span><span>
</span><span id="line-234"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IfEq</span></span><span> </span><span class="annot"><a href="#local-6989586621680069270"><span class="hs-identifier hs-type">falseLabel'</span></a></span><span> </span><span class="hs-comment">-- since 0 = false</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Goto</span></span><span> </span><span class="annot"><a href="#local-6989586621680069269"><span class="hs-identifier hs-type">trueLabel'</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#ExprStmt"><span class="hs-identifier hs-type">IR.ExprStmt</span></a></span><span> </span><span id="local-6989586621680069272"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069272"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Eff r (Maybe ClassInfoType) -&gt; Eff r ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069272"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#Super"><span class="hs-identifier hs-type">IR.Super</span></a></span><span> </span><span id="local-6989586621680069275"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069275"><span class="hs-identifier hs-var">superName</span></a></span></span><span> </span><span id="local-6989586621680069276"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621680069276"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-238"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">U2 -&gt; Instruction
forall label. U2 -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.ALoad</span></span><span> </span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">0</span></span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">[Expr] -&gt; (Expr -&gt; Eff r (Maybe ClassInfoType)) -&gt; Eff r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621680069276"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069279"><span class="annot"><span class="annottext">argTypes :: [FieldType]
</span><a href="#local-6989586621680069279"><span class="hs-identifier hs-var hs-var">argTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; FieldType -&gt; [FieldType]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Expr] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621680069276"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/Object&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: get proper types</span><span>
</span><span id="line-241"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-242"></span><span>            </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeSpecial</span></span><span>
</span><span id="line-243"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069275"><span class="hs-identifier hs-var">superName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&lt;init&gt;&quot;</span></span><span>
</span><span id="line-245"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069279"><span class="hs-identifier hs-var">argTypes</span></a></span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><span class="hs-identifier hs-var">VoidReturn</span></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#SetField"><span class="hs-identifier hs-type">IR.SetField</span></a></span><span> </span><span id="local-6989586621680069284"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069284"><span class="hs-identifier hs-var">fieldClass</span></a></span></span><span> </span><span id="local-6989586621680069285"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069285"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span id="local-6989586621680069286"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069286"><span class="hs-identifier hs-var">fieldType</span></a></span></span><span> </span><span id="local-6989586621680069287"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069287"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-247"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">U2 -&gt; Instruction
forall label. U2 -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.ALoad</span></span><span> </span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- load 'this'</span><span>
</span><span id="line-248"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069287"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.PutField</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069284"><span class="hs-identifier hs-var">fieldClass</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069285"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069286"><span class="hs-identifier hs-var">fieldType</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><span class="hs-comment">{- | Emit an expression onto the stack
Returns the type that will be on top of the stack after emitting the expression, if known
-}</span></span><span>
</span><span id="line-254"></span><span id="local-6989586621680068833"><span class="annot"><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-type">emitExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#EmitCode"><span class="hs-identifier hs-type">EmitCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068833"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Expr"><span class="hs-identifier hs-type">IR.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068833"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassInfoType</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-255"></span><span id="emitExpr"><span class="annot"><span class="annottext">emitExpr :: forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var hs-var">emitExpr</span></a></span></span><span> </span><span id="local-6989586621680069599"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069599"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069599"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#LitInt"><span class="hs-identifier hs-type">IR.LitInt</span></a></span><span> </span><span id="local-6989586621680069601"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680069601"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LDCEntry -&gt; Instruction
forall label. LDCEntry -&gt; Instruction' label
</span><span class="hs-identifier hs-var">LDC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; LDCEntry
</span><span class="hs-identifier hs-var">LDCInt</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; LDCEntry) -&gt; Int -&gt; LDCEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680069601"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: fromInteger bad</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Integer&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;valueOf&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PrimitiveType -&gt; FieldType
</span><span class="hs-identifier hs-var">PrimitiveFieldType</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType
</span><span class="hs-identifier hs-var">JVM.Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Integer&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Integer&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#LitString"><span class="hs-identifier hs-type">IR.LitString</span></a></span><span> </span><span id="local-6989586621680069608"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069608"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.New</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">Instruction
forall label. Instruction' label
</span><span class="hs-identifier hs-var">JVM.Dup</span></span><span>
</span><span id="line-263"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LDCEntry -&gt; Instruction
forall label. LDCEntry -&gt; Instruction' label
</span><span class="hs-identifier hs-var">LDC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; LDCEntry
</span><span class="hs-identifier hs-var">LDCString</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069608"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeSpecial</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&lt;init&gt;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.String&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><span class="hs-identifier hs-var">VoidReturn</span></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#LitChar"><span class="hs-identifier hs-type">IR.LitChar</span></a></span><span> </span><span id="local-6989586621680069613"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680069613"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-267"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LDCEntry -&gt; Instruction
forall label. LDCEntry -&gt; Instruction' label
</span><span class="hs-identifier hs-var">LDC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; LDCEntry
</span><span class="hs-identifier hs-var">LDCInt</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; LDCEntry) -&gt; Int -&gt; LDCEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680069613"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Character&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;valueOf&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PrimitiveType -&gt; FieldType
</span><span class="hs-identifier hs-var">PrimitiveFieldType</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType
</span><span class="hs-identifier hs-var">JVM.Char</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Character&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Character&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#LitBool"><span class="hs-identifier hs-type">IR.LitBool</span></a></span><span> </span><span id="local-6989586621680069617"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680069617"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Bool -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitElaraBool"><span class="hs-identifier hs-var">emitElaraBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680069617"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#PrimitiveLitBool"><span class="hs-identifier hs-type">IR.PrimitiveLitBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">Instruction
forall label. Instruction' label
</span><span class="hs-identifier hs-var">JVM.IConst1</span></span><span> </span><span class="annot"><span class="annottext">Eff r ()
-&gt; Eff r (Maybe ClassInfoType) -&gt; Eff r (Maybe ClassInfoType)
forall a b. Eff r a -&gt; Eff r b -&gt; Eff r b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimitiveType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">PrimitiveClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType
</span><span class="hs-identifier hs-var">JVM.Boolean</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#PrimitiveLitBool"><span class="hs-identifier hs-type">IR.PrimitiveLitBool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">Instruction
forall label. Instruction' label
</span><span class="hs-identifier hs-var">JVM.IConst0</span></span><span> </span><span class="annot"><span class="annottext">Eff r ()
-&gt; Eff r (Maybe ClassInfoType) -&gt; Eff r (Maybe ClassInfoType)
forall a b. Eff r a -&gt; Eff r b -&gt; Eff r b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimitiveType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">PrimitiveClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType
</span><span class="hs-identifier hs-var">JVM.Boolean</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">Expr
</span><a href="Elara.JVM.IR.html#LitUnit"><span class="hs-identifier hs-var">IR.LitUnit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.GetStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Unit&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unit&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Unit&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Unit&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#InstanceOf"><span class="hs-identifier hs-type">IR.InstanceOf</span></a></span><span> </span><span id="local-6989586621680069625"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069625"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680069626"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069626"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069625"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">Instanceof</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069626"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimitiveType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">PrimitiveClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType
</span><span class="hs-identifier hs-var">JVM.Boolean</span></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#FieldRef"><span class="hs-identifier hs-type">IR.FieldRef</span></a></span><span> </span><span id="local-6989586621680069628"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069628"><span class="hs-identifier hs-var">className</span></a></span></span><span> </span><span id="local-6989586621680069629"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069629"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span id="local-6989586621680069630"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069630"><span class="hs-identifier hs-var">fieldType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.GetStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069628"><span class="hs-identifier hs-var">className</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069629"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069630"><span class="hs-identifier hs-var">fieldType</span></a></span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069630"><span class="hs-identifier hs-var">fieldType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#LocalVar"><span class="hs-identifier hs-type">IR.LocalVar</span></a></span><span> </span><span id="local-6989586621680069632"><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069632"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621680069633"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069633"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>        </span><span id="local-6989586621680069634"><span class="annot"><a href="#local-6989586621680069634"><span class="hs-identifier hs-var">allocation</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unique Text -&gt; Eff r U2
forall (r :: [Effect]).
(State MethodCreationState :&gt; r) =&gt;
Unique Text -&gt; Eff r U2
</span><a href="Elara.JVM.Emit.State.html#findLocalVariable"><span class="hs-identifier hs-var">findLocalVariable</span></a></span><span> </span><span class="annot"><span class="annottext">Unique Text
</span><a href="#local-6989586621680069632"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-285"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ALoad</span></span><span> </span><span class="annot"><a href="#local-6989586621680069634"><span class="hs-identifier hs-type">allocation</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><a href="#local-6989586621680069633"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#This"><span class="hs-identifier hs-type">IR.This</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">U2 -&gt; Instruction
forall label. U2 -&gt; Instruction' label
</span><span class="hs-identifier hs-var">ALoad</span></span><span> </span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">0</span></span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe ClassInfoType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#GetField"><span class="hs-identifier hs-type">IR.GetField</span></a></span><span> </span><span id="local-6989586621680069637"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069637"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span id="local-6989586621680069638"><span class="annot"><span class="annottext">ClassInfoType
</span><a href="#local-6989586621680069638"><span class="hs-identifier hs-var">fieldClass</span></a></span></span><span> </span><span id="local-6989586621680069639"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069639"><span class="hs-identifier hs-var">fieldName</span></a></span></span><span> </span><span id="local-6989586621680069640"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069640"><span class="hs-identifier hs-var">fieldType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069637"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.CheckCast</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType
</span><a href="#local-6989586621680069638"><span class="hs-identifier hs-var">fieldClass</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.GetField</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType
</span><a href="#local-6989586621680069638"><span class="hs-identifier hs-var">fieldClass</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069639"><span class="hs-identifier hs-var">fieldName</span></a></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069640"><span class="hs-identifier hs-var">fieldType</span></a></span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069640"><span class="hs-identifier hs-var">fieldType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#Call"><span class="hs-identifier hs-type">IR.Call</span></a></span><span> </span><span id="local-6989586621680069643"><span class="annot"><span class="annottext">CallType
</span><a href="#local-6989586621680069643"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680069644"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621680069644"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-296"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CallType
</span><a href="#local-6989586621680069643"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-297"></span><span>            </span><span class="annot"><a href="Elara.JVM.IR.html#InvokeStatic"><span class="hs-identifier hs-type">IR.InvokeStatic</span></a></span><span> </span><span id="local-6989586621680069646"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069646"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621680069647"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069647"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680069648"><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069648"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-298"></span><span>                </span><span class="annot"><span class="annottext">[Expr] -&gt; (Expr -&gt; Eff r (Maybe ClassInfoType)) -&gt; Eff r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621680069644"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span>
</span><span id="line-299"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069646"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Elara.JVM.Emit.Operator.html#translateOperatorName"><span class="hs-identifier hs-var">translateOperatorName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069647"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069648"><span class="hs-identifier hs-var">desc</span></a></span><span>
</span><span id="line-300"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069648"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-301"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">MethodDescriptor</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeReturn</span></span><span> </span><span id="local-6989586621680069649"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069649"><span class="hs-identifier hs-var">retType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069649"><span class="hs-identifier hs-var">retType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>                    </span><span class="annot"><span class="annottext">MethodDescriptor
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ClassInfoType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-303"></span><span>            </span><span class="annot"><a href="Elara.JVM.IR.html#InvokeInterface"><span class="hs-identifier hs-type">IR.InvokeInterface</span></a></span><span> </span><span id="local-6989586621680069651"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069651"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621680069652"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069652"><span class="hs-identifier hs-var">targetType</span></a></span></span><span> </span><span id="local-6989586621680069653"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069653"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MethodDescriptor</span></span><span> </span><span id="local-6989586621680069654"><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069654"><span class="hs-identifier hs-var">argTys</span></a></span></span><span> </span><span id="local-6989586621680069655"><span class="annot"><span class="annottext">ReturnDescriptor
</span><a href="#local-6989586621680069655"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069651"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-305"></span><span>                </span><span class="annot"><span class="annottext">[Expr] -&gt; (Expr -&gt; Eff r (Maybe ClassInfoType)) -&gt; Eff r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621680069644"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span>
</span><span id="line-306"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069657"><span class="annot"><span class="annottext">obj :: FieldType
</span><a href="#local-6989586621680069657"><span class="hs-identifier hs-var hs-var hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Object&quot;</span></span><span>
</span><span id="line-307"></span><span>                    </span><span id="local-6989586621680069658"><span class="annot"><span class="annottext">argTypes :: [FieldType]
</span><a href="#local-6989586621680069658"><span class="hs-identifier hs-var hs-var hs-var">argTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; FieldType -&gt; [FieldType]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069654"><span class="hs-identifier hs-var">argTys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069657"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-308"></span><span>                    </span><span id="local-6989586621680069659"><span class="annot"><span class="annottext">retType :: FieldType
</span><a href="#local-6989586621680069659"><span class="hs-identifier hs-var hs-var hs-var">retType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069657"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-309"></span><span>                    </span><span id="local-6989586621680069660"><span class="annot"><span class="annottext">erasedDesc :: MethodDescriptor
</span><a href="#local-6989586621680069660"><span class="hs-identifier hs-var hs-var hs-var">erasedDesc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069658"><span class="hs-identifier hs-var">argTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069659"><span class="hs-identifier hs-var">retType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeInterface</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069652"><span class="hs-identifier hs-var">targetType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069653"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069660"><span class="hs-identifier hs-var">erasedDesc</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><a href="#local-6989586621680069655"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-313"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">TypeReturn</span></span><span> </span><span id="local-6989586621680069662"><span class="annot"><span class="annottext">ft :: FieldType
</span><a href="#local-6989586621680069662"><span class="hs-identifier hs-var">ft</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ObjectFieldType</span></span><span> </span><span id="local-6989586621680069663"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069663"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069663"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; QualifiedClassName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Object&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-315"></span><span>                            </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">CheckCast</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069662"><span class="hs-identifier hs-var">ft</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>                            </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069662"><span class="hs-identifier hs-var">ft</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>                    </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe ClassInfoType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-318"></span><span>            </span><span class="annot"><a href="Elara.JVM.IR.html#InvokeVirtual"><span class="hs-identifier hs-type">IR.InvokeVirtual</span></a></span><span> </span><span id="local-6989586621680069666"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069666"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621680069667"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069667"><span class="hs-identifier hs-var">targetType</span></a></span></span><span> </span><span id="local-6989586621680069668"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069668"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680069669"><span class="annot"><span class="annottext">desc :: MethodDescriptor
</span><a href="#local-6989586621680069669"><span class="hs-identifier hs-var">desc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MethodDescriptor</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680069670"><span class="annot"><span class="annottext">ReturnDescriptor
</span><a href="#local-6989586621680069670"><span class="hs-identifier hs-var">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069666"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-320"></span><span>                </span><span class="annot"><span class="annottext">[Expr] -&gt; (Expr -&gt; Eff r (Maybe ClassInfoType)) -&gt; Eff r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621680069644"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span>
</span><span id="line-321"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeVirtual</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069667"><span class="hs-identifier hs-var">targetType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069668"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069669"><span class="hs-identifier hs-var">desc</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><a href="#local-6989586621680069670"><span class="hs-identifier hs-var">ret</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-324"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">TypeReturn</span></span><span> </span><span id="local-6989586621680069672"><span class="annot"><span class="annottext">ft :: FieldType
</span><a href="#local-6989586621680069672"><span class="hs-identifier hs-var">ft</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ObjectFieldType</span></span><span> </span><span id="local-6989586621680069673"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069673"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069673"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; QualifiedClassName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Object&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-326"></span><span>                            </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">CheckCast</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069672"><span class="hs-identifier hs-var">ft</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>                            </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069672"><span class="hs-identifier hs-var">ft</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>                    </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe ClassInfoType
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-329"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#BinaryOp"><span class="hs-identifier hs-type">IR.BinaryOp</span></a></span><span> </span><span id="local-6989586621680069675"><span class="annot"><span class="annottext">BinOp
</span><a href="#local-6989586621680069675"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621680069676"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069676"><span class="hs-identifier hs-var">lhs</span></a></span></span><span> </span><span id="local-6989586621680069677"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069677"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069676"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069677"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="#local-6989586621680069675"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-333"></span><span>            </span><span class="annot"><span class="annottext">BinOp
</span><a href="Elara.JVM.IR.html#Equals"><span class="hs-identifier hs-var">IR.Equals</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-334"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-335"></span><span>                    </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span>
</span><span id="line-336"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.util.Objects&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>                        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;equals&quot;</span></span><span>
</span><span id="line-338"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span>
</span><span id="line-339"></span><span>                            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Object&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Object&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-340"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType -&gt; FieldType
</span><span class="hs-identifier hs-var">PrimitiveFieldType</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType
</span><span class="hs-identifier hs-var">JVM.Boolean</span></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>                </span><span class="annot"><span class="annottext">Eff r (Maybe ClassInfoType)
forall (r :: [Effect]). EmitCode r =&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#primitiveBooleanToElaraBoolean"><span class="hs-identifier hs-var">primitiveBooleanToElaraBoolean</span></a></span><span>
</span><span id="line-343"></span><span>            </span><span class="annot"><span class="annottext">BinOp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r (Maybe ClassInfoType)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Eff r (Maybe ClassInfoType))
-&gt; Text -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;emitExpr: Unhandled binary operator: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">BinOp -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Elara.Data.Pretty.html#prettyToText"><span class="hs-identifier hs-var">prettyToText</span></a></span><span> </span><span class="annot"><span class="annottext">BinOp
</span><a href="#local-6989586621680069675"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#MakeClosure"><span class="hs-identifier hs-type">IR.MakeClosure</span></a></span><span class="hs-special">{</span><span id="local-6989586621680069681"><span id="local-6989586621680069682"><span id="local-6989586621680069683"><span id="local-6989586621680069684"><span id="local-6989586621680069685"><span class="annot"><span class="annottext">[(Expr, FieldType)]
Text
QualifiedClassName
MethodDescriptor
closureTargetClass :: QualifiedClassName
closureTargetMethod :: Text
closureTarget :: MethodDescriptor
closureInterface :: QualifiedClassName
capturedValues :: [(Expr, FieldType)]
capturedValues :: Expr -&gt; [(Expr, FieldType)]
closureInterface :: Expr -&gt; QualifiedClassName
closureTarget :: Expr -&gt; MethodDescriptor
closureTargetMethod :: Expr -&gt; Text
closureTargetClass :: Expr -&gt; QualifiedClassName
</span><a href="#local-6989586621680069681"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>        </span><span class="hs-comment">-- Emit captured values onto the stack</span><span>
</span><span id="line-346"></span><span>        </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
-&gt; ((Expr, FieldType) -&gt; Eff r (Maybe ClassInfoType)) -&gt; Eff r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
</span><a href="#local-6989586621680069685"><span class="hs-identifier hs-var">capturedValues</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Eff r (Maybe ClassInfoType))
-&gt; ((Expr, FieldType) -&gt; Expr)
-&gt; (Expr, FieldType)
-&gt; Eff r (Maybe ClassInfoType)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Expr, FieldType) -&gt; Expr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069691"><span class="annot"><span class="annottext">capturedTypes :: [FieldType]
</span><a href="#local-6989586621680069691"><span class="hs-identifier hs-var hs-var hs-var">capturedTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Expr, FieldType) -&gt; FieldType)
-&gt; [(Expr, FieldType)] -&gt; [FieldType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Expr, FieldType) -&gt; FieldType
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
</span><a href="#local-6989586621680069685"><span class="hs-identifier hs-var">capturedValues</span></a></span><span>
</span><span id="line-349"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MethodDescriptor</span></span><span> </span><span id="local-6989586621680069693"><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069693"><span class="hs-identifier hs-var hs-var">originalArgTypes</span></a></span></span><span> </span><span id="local-6989586621680069694"><span class="annot"><span class="annottext">ReturnDescriptor
</span><a href="#local-6989586621680069694"><span class="hs-identifier hs-var hs-var">returnType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069683"><span class="hs-identifier hs-var">closureTarget</span></a></span><span>
</span><span id="line-350"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069695"><span class="annot"><span class="annottext">capturedCount :: Int
</span><a href="#local-6989586621680069695"><span class="hs-identifier hs-var hs-var hs-var">capturedCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Expr, FieldType)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
</span><a href="#local-6989586621680069685"><span class="hs-identifier hs-var">capturedValues</span></a></span><span>
</span><span id="line-351"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069696"><span class="annot"><span class="annottext">remainingArgTypes :: [FieldType]
</span><a href="#local-6989586621680069696"><span class="hs-identifier hs-var hs-var hs-var">remainingArgTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [FieldType] -&gt; [FieldType]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680069695"><span class="hs-identifier hs-var">capturedCount</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069693"><span class="hs-identifier hs-var">originalArgTypes</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069698"><span class="annot"><span class="annottext">implMethodHandle :: MethodHandleEntry
</span><a href="#local-6989586621680069698"><span class="hs-identifier hs-var hs-var">implMethodHandle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-354"></span><span>                </span><span class="annot"><span class="annottext">MethodRef -&gt; MethodHandleEntry
</span><span class="hs-identifier hs-var">MHInvokeStatic</span></span><span> </span><span class="annot"><span class="annottext">(MethodRef -&gt; MethodHandleEntry) -&gt; MethodRef -&gt; MethodHandleEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-355"></span><span>                    </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; MethodRef
</span><span class="hs-identifier hs-var">MethodRef</span></span><span>
</span><span id="line-356"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069681"><span class="hs-identifier hs-var">closureTargetClass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Elara.JVM.Emit.Operator.html#translateOperatorName"><span class="hs-identifier hs-var">translateOperatorName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069682"><span class="hs-identifier hs-var">closureTargetMethod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>                        </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069683"><span class="hs-identifier hs-var">closureTarget</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="annottext">[FieldType]
-&gt; [FieldType]
-&gt; ReturnDescriptor
-&gt; MethodHandleEntry
-&gt; QualifiedClassName
-&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
[FieldType]
-&gt; [FieldType]
-&gt; ReturnDescriptor
-&gt; MethodHandleEntry
-&gt; QualifiedClassName
-&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitInvokeDynamic"><span class="hs-identifier hs-var">emitInvokeDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069691"><span class="hs-identifier hs-var">capturedTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069696"><span class="hs-identifier hs-var">remainingArgTypes</span></a></span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><a href="#local-6989586621680069694"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="annot"><span class="annottext">MethodHandleEntry
</span><a href="#local-6989586621680069698"><span class="hs-identifier hs-var">implMethodHandle</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069684"><span class="hs-identifier hs-var">closureInterface</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#MakeConstructorClosure"><span class="hs-identifier hs-type">IR.MakeConstructorClosure</span></a></span><span class="hs-special">{</span><span id="local-6989586621680069703"><span id="local-6989586621680069704"><span id="local-6989586621680069705"><span id="local-6989586621680069706"><span class="annot"><span class="annottext">[(Expr, FieldType)]
QualifiedClassName
MethodDescriptor
ctorClosureClass :: QualifiedClassName
ctorClosureDesc :: MethodDescriptor
ctorClosureInterface :: QualifiedClassName
ctorCapturedValues :: [(Expr, FieldType)]
ctorCapturedValues :: Expr -&gt; [(Expr, FieldType)]
ctorClosureInterface :: Expr -&gt; QualifiedClassName
ctorClosureDesc :: Expr -&gt; MethodDescriptor
ctorClosureClass :: Expr -&gt; QualifiedClassName
</span><a href="#local-6989586621680069703"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-362"></span><span>        </span><span class="hs-comment">-- Emit captured values onto the stack</span><span>
</span><span id="line-363"></span><span>        </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
-&gt; ((Expr, FieldType) -&gt; Eff r (Maybe ClassInfoType)) -&gt; Eff r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
</span><a href="#local-6989586621680069706"><span class="hs-identifier hs-var">ctorCapturedValues</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Eff r (Maybe ClassInfoType))
-&gt; ((Expr, FieldType) -&gt; Expr)
-&gt; (Expr, FieldType)
-&gt; Eff r (Maybe ClassInfoType)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Expr, FieldType) -&gt; Expr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069711"><span class="annot"><span class="annottext">capturedTypes :: [FieldType]
</span><a href="#local-6989586621680069711"><span class="hs-identifier hs-var hs-var hs-var">capturedTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Expr, FieldType) -&gt; FieldType)
-&gt; [(Expr, FieldType)] -&gt; [FieldType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Expr, FieldType) -&gt; FieldType
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
</span><a href="#local-6989586621680069706"><span class="hs-identifier hs-var">ctorCapturedValues</span></a></span><span>
</span><span id="line-366"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MethodDescriptor</span></span><span> </span><span id="local-6989586621680069712"><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069712"><span class="hs-identifier hs-var hs-var">originalArgTypes</span></a></span></span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069704"><span class="hs-identifier hs-var">ctorClosureDesc</span></a></span><span>
</span><span id="line-367"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069713"><span class="annot"><span class="annottext">capturedCount :: Int
</span><a href="#local-6989586621680069713"><span class="hs-identifier hs-var hs-var hs-var">capturedCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Expr, FieldType)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
</span><a href="#local-6989586621680069706"><span class="hs-identifier hs-var">ctorCapturedValues</span></a></span><span>
</span><span id="line-368"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069714"><span class="annot"><span class="annottext">remainingArgTypes :: [FieldType]
</span><a href="#local-6989586621680069714"><span class="hs-identifier hs-var hs-var hs-var">remainingArgTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [FieldType] -&gt; [FieldType]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680069713"><span class="hs-identifier hs-var">capturedCount</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069712"><span class="hs-identifier hs-var">originalArgTypes</span></a></span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069715"><span class="annot"><span class="annottext">returnType :: ReturnDescriptor
</span><a href="#local-6989586621680069715"><span class="hs-identifier hs-var hs-var hs-var">returnType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069703"><span class="hs-identifier hs-var">ctorClosureClass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069716"><span class="annot"><span class="annottext">implMethodHandle :: MethodHandleEntry
</span><a href="#local-6989586621680069716"><span class="hs-identifier hs-var hs-var">implMethodHandle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-372"></span><span>                </span><span class="annot"><span class="annottext">MethodRef -&gt; MethodHandleEntry
</span><span class="hs-identifier hs-var">MHNewInvokeSpecial</span></span><span> </span><span class="annot"><span class="annottext">(MethodRef -&gt; MethodHandleEntry) -&gt; MethodRef -&gt; MethodHandleEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-373"></span><span>                    </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; MethodRef
</span><span class="hs-identifier hs-var">MethodRef</span></span><span>
</span><span id="line-374"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069703"><span class="hs-identifier hs-var">ctorClosureClass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>                        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&lt;init&gt;&quot;</span></span><span>
</span><span id="line-376"></span><span>                        </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069704"><span class="hs-identifier hs-var">ctorClosureDesc</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><span class="annottext">[FieldType]
-&gt; [FieldType]
-&gt; ReturnDescriptor
-&gt; MethodHandleEntry
-&gt; QualifiedClassName
-&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
[FieldType]
-&gt; [FieldType]
-&gt; ReturnDescriptor
-&gt; MethodHandleEntry
-&gt; QualifiedClassName
-&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitInvokeDynamic"><span class="hs-identifier hs-var">emitInvokeDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069711"><span class="hs-identifier hs-var">capturedTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069714"><span class="hs-identifier hs-var">remainingArgTypes</span></a></span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><a href="#local-6989586621680069715"><span class="hs-identifier hs-var">returnType</span></a></span><span> </span><span class="annot"><span class="annottext">MethodHandleEntry
</span><a href="#local-6989586621680069716"><span class="hs-identifier hs-var">implMethodHandle</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069705"><span class="hs-identifier hs-var">ctorClosureInterface</span></a></span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#PrimOp"><span class="hs-identifier hs-type">IR.PrimOp</span></a></span><span> </span><span id="local-6989586621680069719"><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621680069719"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621680069720"><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621680069720"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="#local-6989586621680069719"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Expr]
</span><a href="#local-6989586621680069720"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-381"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#UndefinedError"><span class="hs-identifier hs-var">IR.UndefinedError</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069722"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069722"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-382"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069722"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-383"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-384"></span><span>                    </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span>
</span><span id="line-385"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Error&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>                        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;undefined&quot;</span></span><span>
</span><span id="line-387"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/Object&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/Object&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#PatternMatchFailedError"><span class="hs-identifier hs-var">IR.PatternMatchFailedError</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-391"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-392"></span><span>                    </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span>
</span><span id="line-393"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Error&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-394"></span><span>                        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;patternMatchFail&quot;</span></span><span>
</span><span id="line-395"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/Object&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/Object&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#IntAdd"><span class="hs-identifier hs-var">IR.IntAdd</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069725"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069725"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069726"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069726"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Expr -&gt; Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Text -&gt; Expr -&gt; Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitBinaryIntOp"><span class="hs-identifier hs-var">emitBinaryIntOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;add&quot;</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069725"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069726"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-398"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#IntSubtract"><span class="hs-identifier hs-var">IR.IntSubtract</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069729"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069729"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069730"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069730"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Expr -&gt; Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Text -&gt; Expr -&gt; Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitBinaryIntOp"><span class="hs-identifier hs-var">emitBinaryIntOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;minus&quot;</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069729"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069730"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-399"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#IntMultiply"><span class="hs-identifier hs-var">IR.IntMultiply</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069732"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069732"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069733"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069733"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Expr -&gt; Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Text -&gt; Expr -&gt; Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitBinaryIntOp"><span class="hs-identifier hs-var">emitBinaryIntOp</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;times&quot;</span></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069732"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069733"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-400"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#IntNegate"><span class="hs-identifier hs-var">IR.IntNegate</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069735"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069735"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-401"></span><span>                </span><span class="hs-comment">-- Get the curried function: Prelude.negate : Int -&gt; Int</span><span>
</span><span id="line-402"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">GetStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Prelude&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;negate&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Func&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-403"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069735"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-404"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeInterface</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Func&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;run&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">CheckCast</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Integer&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Integer&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#Println"><span class="hs-identifier hs-var">IR.Println</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069738"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069738"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-408"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069738"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-409"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.IO&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;println&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Object&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.IO&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.IO&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#StringHead"><span class="hs-identifier hs-var">IR.StringHead</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069740"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069740"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr
-&gt; Text
-&gt; [FieldType]
-&gt; QualifiedClassName
-&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr
-&gt; Text
-&gt; [FieldType]
-&gt; QualifiedClassName
-&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitStringMethod"><span class="hs-identifier hs-var">emitStringMethod</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069740"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;head&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Character&quot;</span></span><span>
</span><span id="line-412"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#StringIsEmpty"><span class="hs-identifier hs-var">IR.StringIsEmpty</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069743"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069743"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-413"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069743"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-414"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeVirtual</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;isEmpty&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType -&gt; FieldType
</span><span class="hs-identifier hs-var">PrimitiveFieldType</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType
</span><span class="hs-identifier hs-var">JVM.Boolean</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>                </span><span class="annot"><span class="annottext">Eff r (Maybe ClassInfoType)
forall (r :: [Effect]). EmitCode r =&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#primitiveBooleanToElaraBoolean"><span class="hs-identifier hs-var">primitiveBooleanToElaraBoolean</span></a></span><span>
</span><span id="line-416"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#StringTail"><span class="hs-identifier hs-var">IR.StringTail</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069745"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069745"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Expr
-&gt; Text
-&gt; [FieldType]
-&gt; QualifiedClassName
-&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr
-&gt; Text
-&gt; [FieldType]
-&gt; QualifiedClassName
-&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitStringMethod"><span class="hs-identifier hs-var">emitStringMethod</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069745"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;tail&quot;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span>
</span><span id="line-417"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#StringCons"><span class="hs-identifier hs-var">IR.StringCons</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069747"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069747"><span class="hs-identifier hs-var">ch</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069748"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069748"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069748"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="hs-comment">-- receiver</span><span>
</span><span id="line-419"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069747"><span class="hs-identifier hs-var">ch</span></a></span><span> </span><span class="hs-comment">-- argument</span><span>
</span><span id="line-420"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeVirtual</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cons&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Character&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#ToString"><span class="hs-identifier hs-var">IR.ToString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069750"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069750"><span class="hs-identifier hs-var">obj</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-423"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069750"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-424"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.PrimOps&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;toString&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Object&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#PrimEquals"><span class="hs-identifier hs-var">IR.PrimEquals</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069752"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069752"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069753"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069753"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069752"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-428"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069753"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-429"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.util.Objects&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;equals&quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="Elara.JVM.Emit.html#objectsEqualsDesc"><span class="hs-identifier hs-var">objectsEqualsDesc</span></a></span><span>
</span><span id="line-430"></span><span>                </span><span class="annot"><span class="annottext">Eff r (Maybe ClassInfoType)
forall (r :: [Effect]). EmitCode r =&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#primitiveBooleanToElaraBoolean"><span class="hs-identifier hs-var">primitiveBooleanToElaraBoolean</span></a></span><span>
</span><span id="line-431"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#PrimCompare"><span class="hs-identifier hs-var">IR.PrimCompare</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069756"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069756"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069757"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069757"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-432"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069756"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-433"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069757"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-434"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.PrimOps&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;compare&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Integer&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Integer&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#IOBind"><span class="hs-identifier hs-var">IR.IOBind</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069759"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069759"><span class="hs-identifier hs-var">io</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069760"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069760"><span class="hs-identifier hs-var">func</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-437"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069759"><span class="hs-identifier hs-var">io</span></a></span><span>
</span><span id="line-438"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069760"><span class="hs-identifier hs-var">func</span></a></span><span>
</span><span id="line-439"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeVirtual</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.IO&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;bind&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Func&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.IO&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.IO&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#DebugWithMsg"><span class="hs-identifier hs-var">IR.DebugWithMsg</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069762"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069762"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069763"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069763"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-442"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069762"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-443"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069763"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-444"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.PrimOps&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;debugWithMsg&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Object&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrimOp
</span><a href="Elara.JVM.IR.html#ThrowError"><span class="hs-identifier hs-var">IR.ThrowError</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621680069765"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069765"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-447"></span><span>                </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069765"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-448"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.PrimOps&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;toString&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>                </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Error&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;throwError&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>                </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/Object&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>            </span><span id="local-6989586621680069766"><span class="annot"><span class="annottext">(PrimOp, [Expr])
</span><a href="#local-6989586621680069766"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r (Maybe ClassInfoType)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Eff r (Maybe ClassInfoType))
-&gt; Text -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;emitExpr: Unhandled primitive operation: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PrimOp, [Expr]) -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Elara.Data.Pretty.html#prettyToText"><span class="hs-identifier hs-var">prettyToText</span></a></span><span> </span><span class="annot"><span class="annottext">(PrimOp, [Expr])
</span><a href="#local-6989586621680069766"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-452"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#New"><span class="hs-identifier hs-type">IR.New</span></a></span><span> </span><span id="local-6989586621680069768"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069768"><span class="hs-identifier hs-var">className</span></a></span></span><span> </span><span id="local-6989586621680069769"><span class="annot"><span class="annottext">[(Expr, FieldType)]
</span><a href="#local-6989586621680069769"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-453"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.New</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069768"><span class="hs-identifier hs-var">className</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">Instruction
forall label. Instruction' label
</span><span class="hs-identifier hs-var">JVM.Dup</span></span><span>
</span><span id="line-455"></span><span>        </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
-&gt; ((Expr, FieldType) -&gt; Eff r (Maybe ClassInfoType)) -&gt; Eff r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
</span><a href="#local-6989586621680069769"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Eff r (Maybe ClassInfoType))
-&gt; ((Expr, FieldType) -&gt; Expr)
-&gt; (Expr, FieldType)
-&gt; Eff r (Maybe ClassInfoType)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Expr, FieldType) -&gt; Expr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069770"><span class="annot"><span class="annottext">argTypes :: [FieldType]
</span><a href="#local-6989586621680069770"><span class="hs-identifier hs-var hs-var hs-var">argTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Expr, FieldType) -&gt; FieldType)
-&gt; [(Expr, FieldType)] -&gt; [FieldType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Expr, FieldType) -&gt; FieldType
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Expr, FieldType)]
</span><a href="#local-6989586621680069769"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-457"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeSpecial</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069768"><span class="hs-identifier hs-var">className</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&lt;init&gt;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069770"><span class="hs-identifier hs-var">argTypes</span></a></span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><span class="hs-identifier hs-var">VoidReturn</span></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069768"><span class="hs-identifier hs-var">className</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>    </span><span class="annot"><a href="Elara.JVM.IR.html#Cast"><span class="hs-identifier hs-type">IR.Cast</span></a></span><span> </span><span id="local-6989586621680069772"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069772"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621680069773"><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069773"><span class="hs-identifier hs-var">targetType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-460"></span><span>        </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069772"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-461"></span><span>        </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.CheckCast</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069773"><span class="hs-identifier hs-var">targetType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>        </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">fieldTypeToClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="#local-6989586621680069773"><span class="hs-identifier hs-var">targetType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>    </span><span class="annot"><span class="annottext">Expr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r (Maybe ClassInfoType)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Eff r (Maybe ClassInfoType))
-&gt; Text -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;emitExpr: Unhandled expression: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Elara.Data.Pretty.html#prettyToText"><span class="hs-identifier hs-var">prettyToText</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069599"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span class="annot"><span class="hs-comment">-- | Common type aliases for Java types</span></span><span>
</span><span id="line-466"></span><span class="annot"><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-type">javaObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FieldType</span></span><span>
</span><span id="line-467"></span><span id="javaObject"><span class="annot"><span class="annottext">javaObject :: FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var hs-var">javaObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Object&quot;</span></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="annot"><a href="Elara.JVM.Emit.html#objectsEqualsDesc"><span class="hs-identifier hs-type">objectsEqualsDesc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MethodDescriptor</span></span><span>
</span><span id="line-470"></span><span id="objectsEqualsDesc"><span class="annot"><span class="annottext">objectsEqualsDesc :: MethodDescriptor
</span><a href="Elara.JVM.Emit.html#objectsEqualsDesc"><span class="hs-identifier hs-var hs-var">objectsEqualsDesc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType -&gt; FieldType
</span><span class="hs-identifier hs-var">PrimitiveFieldType</span></span><span> </span><span class="annot"><span class="annottext">PrimitiveType
</span><span class="hs-identifier hs-var">JVM.Boolean</span></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="annot"><span class="hs-comment">-- | Emit a binary integer operation using a curried Prelude function</span></span><span>
</span><span id="line-473"></span><span id="local-6989586621680068871"><span class="annot"><a href="Elara.JVM.Emit.html#emitBinaryIntOp"><span class="hs-identifier hs-type">emitBinaryIntOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#EmitCode"><span class="hs-identifier hs-type">EmitCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068871"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Expr"><span class="hs-identifier hs-type">IR.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Expr"><span class="hs-identifier hs-type">IR.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068871"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassInfoType</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-474"></span><span id="emitBinaryIntOp"><span class="annot"><span class="annottext">emitBinaryIntOp :: forall (r :: [Effect]).
EmitCode r =&gt;
Text -&gt; Expr -&gt; Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitBinaryIntOp"><span class="hs-identifier hs-var hs-var">emitBinaryIntOp</span></a></span></span><span> </span><span id="local-6989586621680069798"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069798"><span class="hs-identifier hs-var">funcName</span></a></span></span><span> </span><span id="local-6989586621680069799"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069799"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680069800"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069800"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-comment">-- Get the curried function: Prelude.funcName : Int -&gt; Int -&gt; Int</span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; FieldType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">GetStatic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Prelude&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069798"><span class="hs-identifier hs-var">funcName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Func&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-comment">-- Apply first argument: stack is [func], need [func, a] -&gt; [add_a]</span><span>
</span><span id="line-478"></span><span>    </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069799"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeInterface</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Func&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;run&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-comment">-- Apply second argument: stack is [add_a], need [add_a, b] -&gt; [result]</span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069800"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeInterface</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Func&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;run&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">CheckCast</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Integer&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java.lang.Integer&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="annot"><span class="hs-comment">-- | Emit a method call on Elara.String</span></span><span>
</span><span id="line-487"></span><span id="local-6989586621680068872"><span class="annot"><a href="Elara.JVM.Emit.html#emitStringMethod"><span class="hs-identifier hs-type">emitStringMethod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#EmitCode"><span class="hs-identifier hs-type">EmitCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068872"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.JVM.IR.html#Expr"><span class="hs-identifier hs-type">IR.Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FieldType</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QualifiedClassName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068872"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassInfoType</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-488"></span><span id="emitStringMethod"><span class="annot"><span class="annottext">emitStringMethod :: forall (r :: [Effect]).
EmitCode r =&gt;
Expr
-&gt; Text
-&gt; [FieldType]
-&gt; QualifiedClassName
-&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitStringMethod"><span class="hs-identifier hs-var hs-var">emitStringMethod</span></a></span></span><span> </span><span id="local-6989586621680069808"><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069808"><span class="hs-identifier hs-var">receiver</span></a></span></span><span> </span><span id="local-6989586621680069809"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069809"><span class="hs-identifier hs-var">methodName</span></a></span></span><span> </span><span id="local-6989586621680069810"><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069810"><span class="hs-identifier hs-var">argTypes</span></a></span></span><span> </span><span id="local-6989586621680069811"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069811"><span class="hs-identifier hs-var">retTypeName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><span class="annottext">Expr -&gt; Eff r (Maybe ClassInfoType)
forall (r :: [Effect]).
EmitCode r =&gt;
Expr -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitExpr"><span class="hs-identifier hs-var">emitExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr
</span><a href="#local-6989586621680069808"><span class="hs-identifier hs-var">receiver</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeVirtual</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="Elara.JVM.Emit.Types.html#stringTypeName"><span class="hs-identifier hs-var">stringTypeName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680069809"><span class="hs-identifier hs-var">methodName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069810"><span class="hs-identifier hs-var">argTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069811"><span class="hs-identifier hs-var">retTypeName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>    </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069811"><span class="hs-identifier hs-var">retTypeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="annot"><span class="hs-comment">-- | Emit invokedynamic for closure creation (shared between MakeClosure and MakeConstructorClosure)</span></span><span>
</span><span id="line-494"></span><span id="local-6989586621680068870"><span class="annot"><a href="Elara.JVM.Emit.html#emitInvokeDynamic"><span class="hs-identifier hs-type">emitInvokeDynamic</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><a href="Elara.JVM.Emit.html#EmitCode"><span class="hs-identifier hs-type">EmitCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068870"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-496"></span><span>    </span><span class="annot"><span class="hs-comment">-- | captured types</span></span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FieldType</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-498"></span><span>    </span><span class="annot"><span class="hs-comment">-- | remaining arg types</span></span><span>
</span><span id="line-499"></span><span>    </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FieldType</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-500"></span><span>    </span><span class="annot"><span class="hs-comment">-- | return type</span></span><span>
</span><span id="line-501"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ReturnDescriptor</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><span class="hs-comment">-- | implementation method handle</span></span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MethodHandleEntry</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-504"></span><span>    </span><span class="annot"><span class="hs-comment">-- | target interface</span></span><span>
</span><span id="line-505"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">QualifiedClassName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-506"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068870"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassInfoType</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-507"></span><span id="emitInvokeDynamic"><span class="annot"><span class="annottext">emitInvokeDynamic :: forall (r :: [Effect]).
EmitCode r =&gt;
[FieldType]
-&gt; [FieldType]
-&gt; ReturnDescriptor
-&gt; MethodHandleEntry
-&gt; QualifiedClassName
-&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitInvokeDynamic"><span class="hs-identifier hs-var hs-var">emitInvokeDynamic</span></a></span></span><span> </span><span id="local-6989586621680069819"><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069819"><span class="hs-identifier hs-var">capturedTypes</span></a></span></span><span> </span><span id="local-6989586621680069820"><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069820"><span class="hs-identifier hs-var">remainingArgTypes</span></a></span></span><span> </span><span id="local-6989586621680069821"><span class="annot"><span class="annottext">ReturnDescriptor
</span><a href="#local-6989586621680069821"><span class="hs-identifier hs-var">returnType</span></a></span></span><span> </span><span id="local-6989586621680069822"><span class="annot"><span class="annottext">MethodHandleEntry
</span><a href="#local-6989586621680069822"><span class="hs-identifier hs-var">implMethodHandle</span></a></span></span><span> </span><span id="local-6989586621680069823"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069823"><span class="hs-identifier hs-var">targetInterface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-508"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069824"><span class="annot"><span class="annottext">specializedDesc :: MethodDescriptor
</span><a href="#local-6989586621680069824"><span class="hs-identifier hs-var hs-var hs-var">specializedDesc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069820"><span class="hs-identifier hs-var">remainingArgTypes</span></a></span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><a href="#local-6989586621680069821"><span class="hs-identifier hs-var">returnType</span></a></span><span>
</span><span id="line-509"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069825"><span class="annot"><span class="annottext">erasedDesc :: MethodDescriptor
</span><a href="#local-6989586621680069825"><span class="hs-identifier hs-var hs-var hs-var">erasedDesc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; FieldType -&gt; [FieldType]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069820"><span class="hs-identifier hs-var">remainingArgTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">FieldType
</span><a href="Elara.JVM.Emit.html#javaObject"><span class="hs-identifier hs-var">javaObject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069835"><span class="annot"><span class="annottext">bootstrapMethodHandle :: MethodHandleEntry
</span><a href="#local-6989586621680069835"><span class="hs-identifier hs-var hs-var hs-var">bootstrapMethodHandle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-512"></span><span>            </span><span class="annot"><span class="annottext">MethodRef -&gt; MethodHandleEntry
</span><span class="hs-identifier hs-var">MHInvokeStatic</span></span><span> </span><span class="annot"><span class="annottext">(MethodRef -&gt; MethodHandleEntry) -&gt; MethodRef -&gt; MethodHandleEntry
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-513"></span><span>                </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; MethodRef
</span><span class="hs-identifier hs-var">MethodRef</span></span><span>
</span><span id="line-514"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/invoke/LambdaMetafactory&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>                    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;metafactory&quot;</span></span><span>
</span><span id="line-516"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span>
</span><span id="line-517"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/invoke/MethodHandles$Lookup&quot;</span></span><span>
</span><span id="line-518"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/String&quot;</span></span><span>
</span><span id="line-519"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/invoke/MethodType&quot;</span></span><span>
</span><span id="line-520"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/invoke/MethodType&quot;</span></span><span>
</span><span id="line-521"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/invoke/MethodHandle&quot;</span></span><span>
</span><span id="line-522"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/invoke/MethodType&quot;</span></span><span>
</span><span id="line-523"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-524"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="annot"><span class="annottext">(FieldType -&gt; ReturnDescriptor) -&gt; FieldType -&gt; ReturnDescriptor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/invoke/CallSite&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069836"><span class="annot"><span class="annottext">bootstrapMethod :: BootstrapMethod
</span><a href="#local-6989586621680069836"><span class="hs-identifier hs-var hs-var hs-var">bootstrapMethod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-528"></span><span>            </span><span class="annot"><span class="annottext">MethodHandleEntry -&gt; [BootstrapArgument] -&gt; BootstrapMethod
</span><span class="hs-identifier hs-var">BootstrapMethod</span></span><span>
</span><span id="line-529"></span><span>                </span><span class="annot"><span class="annottext">MethodHandleEntry
</span><a href="#local-6989586621680069835"><span class="hs-identifier hs-var">bootstrapMethodHandle</span></a></span><span>
</span><span id="line-530"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">MethodDescriptor -&gt; BootstrapArgument
</span><span class="hs-identifier hs-var">BMMethodArg</span></span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069825"><span class="hs-identifier hs-var">erasedDesc</span></a></span><span>
</span><span id="line-531"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MethodHandleEntry -&gt; BootstrapArgument
</span><span class="hs-identifier hs-var">BMMethodHandleArg</span></span><span> </span><span class="annot"><span class="annottext">MethodHandleEntry
</span><a href="#local-6989586621680069822"><span class="hs-identifier hs-var">implMethodHandle</span></a></span><span>
</span><span id="line-532"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MethodDescriptor -&gt; BootstrapArgument
</span><span class="hs-identifier hs-var">BMMethodArg</span></span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069824"><span class="hs-identifier hs-var">specializedDesc</span></a></span><span>
</span><span id="line-533"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069840"><span class="annot"><span class="annottext">invokedTypeDesc :: MethodDescriptor
</span><a href="#local-6989586621680069840"><span class="hs-identifier hs-var hs-var hs-var">invokedTypeDesc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="annot"><span class="annottext">[FieldType]
</span><a href="#local-6989586621680069819"><span class="hs-identifier hs-var">capturedTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069823"><span class="hs-identifier hs-var">targetInterface</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>    </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BootstrapMethod -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
BootstrapMethod -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">InvokeDynamic</span></span><span> </span><span class="annot"><span class="annottext">BootstrapMethod
</span><a href="#local-6989586621680069836"><span class="hs-identifier hs-var">bootstrapMethod</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;run&quot;</span></span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069840"><span class="hs-identifier hs-var">invokedTypeDesc</span></a></span><span>
</span><span id="line-537"></span><span>    </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069823"><span class="hs-identifier hs-var">targetInterface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span id="local-6989586621680068744"><span class="annot"><a href="Elara.JVM.Emit.html#emitJVMMainMethod"><span class="hs-identifier hs-type">emitJVMMainMethod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068744"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassBuilder</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680068744"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QualifiedClassName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068744"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-540"></span><span id="emitJVMMainMethod"><span class="annot"><span class="annottext">emitJVMMainMethod :: forall (r :: [Effect]).
(StructuredDebug :&gt; r, ClassBuilder :&gt; r) =&gt;
QualifiedClassName -&gt; Eff r ()
</span><a href="Elara.JVM.Emit.html#emitJVMMainMethod"><span class="hs-identifier hs-var hs-var">emitJVMMainMethod</span></a></span></span><span> </span><span id="local-6989586621680069861"><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069861"><span class="hs-identifier hs-var">thisClassName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-541"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680069862"><span class="hs-identifier hs-type">elaraIOClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QualifiedClassName</span></span><span>
</span><span id="line-542"></span><span>        </span><span id="local-6989586621680069862"><span class="annot"><span class="annottext">elaraIOClass :: QualifiedClassName
</span><a href="#local-6989586621680069862"><span class="hs-identifier hs-var hs-var hs-var">elaraIOClass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara/IO&quot;</span></span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span>        </span><span class="hs-comment">-- elara Main.main() : Elara.IO</span><span>
</span><span id="line-545"></span><span>        </span><span id="local-6989586621680069863"><span class="annot"><span class="annottext">elaraMainDesc :: MethodDescriptor
</span><a href="#local-6989586621680069863"><span class="hs-identifier hs-var hs-var hs-var">elaraMainDesc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-546"></span><span>            </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldType -&gt; ReturnDescriptor
</span><span class="hs-identifier hs-var">TypeReturn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069862"><span class="hs-identifier hs-var">elaraIOClass</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span>        </span><span id="local-6989586621680069865"><span class="annot"><span class="annottext">javaMainDesc :: MethodDescriptor
</span><a href="#local-6989586621680069865"><span class="hs-identifier hs-var hs-var hs-var">javaMainDesc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-549"></span><span>            </span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span>
</span><span id="line-550"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldType -&gt; FieldType
</span><span class="hs-identifier hs-var">ArrayFieldType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; FieldType
</span><span class="hs-identifier hs-var">ObjectFieldType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;java/lang/String&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-551"></span><span>                </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><span class="hs-identifier hs-var">VoidReturn</span></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069867"><span class="annot"><a href="#local-6989586621680069867"><span class="hs-identifier hs-var">codeAttributes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680069868"><span class="annot"><a href="#local-6989586621680069868"><span class="hs-identifier hs-var">instructions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-554"></span><span>        </span><span class="annot"><span class="annottext">Eff (CodeBuilder : r) ()
-&gt; Eff r ((), [CodeAttribute], [Instruction])
forall (r :: [Effect]) a.
Eff (CodeBuilder : r) a
-&gt; Eff r (a, [CodeAttribute], [Instruction])
</span><span class="hs-identifier hs-var">runCodeBuilder</span></span><span> </span><span class="annot"><span class="annottext">(Eff (CodeBuilder : r) ()
 -&gt; Eff r ((), [CodeAttribute], [Instruction]))
-&gt; Eff (CodeBuilder : r) ()
-&gt; Eff r ((), [CodeAttribute], [Instruction])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-555"></span><span>            </span><span class="hs-comment">-- Call Elara Main.main() : Elara.IO</span><span>
</span><span id="line-556"></span><span>            </span><span class="annot"><span class="annottext">Instruction -&gt; Eff (CodeBuilder : r) ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff (CodeBuilder : r) ())
-&gt; Instruction -&gt; Eff (CodeBuilder : r) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-557"></span><span>                </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeStatic</span></span><span>
</span><span id="line-558"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069861"><span class="hs-identifier hs-var">thisClassName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-559"></span><span>                    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;main&quot;</span></span><span>
</span><span id="line-560"></span><span>                    </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069863"><span class="hs-identifier hs-var">elaraMainDesc</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>            </span><span class="hs-comment">-- Call IO#run() : void</span><span>
</span><span id="line-563"></span><span>            </span><span class="annot"><span class="annottext">Instruction -&gt; Eff (CodeBuilder : r) ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff (CodeBuilder : r) ())
-&gt; Instruction -&gt; Eff (CodeBuilder : r) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-564"></span><span>                </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeVirtual</span></span><span>
</span><span id="line-565"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069862"><span class="hs-identifier hs-var">elaraIOClass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>                    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;run&quot;</span></span><span>
</span><span id="line-567"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><span class="hs-identifier hs-var">VoidReturn</span></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span>            </span><span class="annot"><span class="annottext">Instruction -&gt; Eff (CodeBuilder : r) ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">Instruction
forall label. Instruction' label
</span><span class="hs-identifier hs-var">JVM.Return</span></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069869"><span class="annot"><a href="#local-6989586621680069869"><span class="hs-identifier hs-var hs-var">methodInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-572"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">ClassFileMethod</span></span><span>
</span><span id="line-573"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">methodAccessFlags :: [MethodAccessFlag]
</span><span class="hs-identifier hs-var">methodAccessFlags</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MethodAccessFlag
</span><span class="hs-identifier hs-var">MPublic</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MethodAccessFlag
</span><span class="hs-identifier hs-var">MStatic</span></span><span class="hs-special">]</span><span>
</span><span id="line-574"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">methodName :: Text
</span><span class="hs-identifier hs-var">methodName</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;main&quot;</span></span><span>
</span><span id="line-575"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">methodDescriptor :: MethodDescriptor
</span><span class="hs-identifier hs-var">methodDescriptor</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069865"><span class="hs-identifier hs-var">javaMainDesc</span></a></span><span>
</span><span id="line-576"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">methodAttributes :: TypeMergingList MethodAttribute
</span><span class="hs-identifier hs-var">methodAttributes</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-577"></span><span>                    </span><span class="annot"><span class="annottext">[Item (TypeMergingList MethodAttribute)]
-&gt; TypeMergingList MethodAttribute
forall l. IsList l =&gt; [Item l] -&gt; l
</span><span class="hs-identifier hs-var">fromList</span></span><span>
</span><span id="line-578"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CodeAttributeData -&gt; MethodAttribute
</span><span class="hs-identifier hs-var">Code</span></span><span> </span><span class="annot"><span class="annottext">(CodeAttributeData -&gt; MethodAttribute)
-&gt; CodeAttributeData -&gt; MethodAttribute
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-579"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">CodeAttributeData</span></span><span>
</span><span id="line-580"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">maxStack :: U2
</span><span class="hs-identifier hs-var">maxStack</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">2</span></span><span> </span><span class="hs-comment">-- IO on stack, then call run</span><span>
</span><span id="line-581"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">maxLocals :: U2
</span><span class="hs-identifier hs-var">maxLocals</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">U2
</span><span class="hs-number">1</span></span><span> </span><span class="hs-comment">-- String[] args (unused)</span><span>
</span><span id="line-582"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">code :: [Instruction]
</span><span class="hs-identifier hs-var">code</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680069868"><span class="hs-identifier hs-var">instructions</span></a></span><span>
</span><span id="line-583"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">exceptionTable :: [ExceptionTableEntry]
</span><span class="hs-identifier hs-var">exceptionTable</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-584"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">codeAttributes :: [CodeAttribute]
</span><span class="hs-identifier hs-var">codeAttributes</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StackMapFrame] -&gt; CodeAttribute
</span><span class="hs-identifier hs-var">StackMapTable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt;
QualifiedClassName
-&gt; [MethodAccessFlag]
-&gt; MethodDescriptor
-&gt; [Instruction]
-&gt; [StackMapFrame]
QualifiedClassName
-&gt; [MethodAccessFlag]
-&gt; MethodDescriptor
-&gt; [Instruction]
-&gt; [StackMapFrame]
</span><span class="hs-identifier hs-var">calculateStackMapFrames</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069861"><span class="hs-identifier hs-var">thisClassName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">MethodAccessFlag
</span><span class="hs-identifier hs-var">MPublic</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MethodAccessFlag
</span><span class="hs-identifier hs-var">MStatic</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">MethodDescriptor
</span><a href="#local-6989586621680069865"><span class="hs-identifier hs-var">javaMainDesc</span></a></span><span> </span><span class="annot"><span class="annottext">[Instruction]
</span><a href="#local-6989586621680069868"><span class="hs-identifier hs-var">instructions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CodeAttribute -&gt; [CodeAttribute] -&gt; [CodeAttribute]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[CodeAttribute]
</span><a href="#local-6989586621680069867"><span class="hs-identifier hs-var">codeAttributes</span></a></span><span>
</span><span id="line-585"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-586"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-587"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-588"></span><span>
</span><span id="line-589"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">addMethod</span></span><span> </span><span class="annot"><a href="#local-6989586621680069869"><span class="hs-identifier hs-type">methodInfo</span></a></span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span class="annot"><span class="hs-comment">-- | Emit an Elara boolean (True or False) onto the stack</span></span><span>
</span><span id="line-592"></span><span id="local-6989586621680068857"><span class="annot"><a href="Elara.JVM.Emit.html#emitElaraBool"><span class="hs-identifier hs-type">emitElaraBool</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#EmitCode"><span class="hs-identifier hs-type">EmitCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068857"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068857"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassInfoType</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-593"></span><span id="emitElaraBool"><span class="annot"><span class="annottext">emitElaraBool :: forall (r :: [Effect]).
EmitCode r =&gt;
Bool -&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#emitElaraBool"><span class="hs-identifier hs-var hs-var">emitElaraBool</span></a></span></span><span> </span><span id="local-6989586621680069886"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680069886"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-594"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680069887"><span class="annot"><span class="annottext">className :: QualifiedClassName
</span><a href="#local-6989586621680069887"><span class="hs-identifier hs-var hs-var hs-var">className</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680069886"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Prim.True&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Prim.False&quot;</span></span><span>
</span><span id="line-595"></span><span>    </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.New</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069887"><span class="hs-identifier hs-var">className</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>    </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">Instruction
forall label. Instruction' label
</span><span class="hs-identifier hs-var">JVM.Dup</span></span><span>
</span><span id="line-597"></span><span>    </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction
forall label.
ClassInfoType -&gt; Text -&gt; MethodDescriptor -&gt; Instruction' label
</span><span class="hs-identifier hs-var">JVM.InvokeSpecial</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><a href="#local-6989586621680069887"><span class="hs-identifier hs-var">className</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&lt;init&gt;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldType] -&gt; ReturnDescriptor -&gt; MethodDescriptor
</span><span class="hs-identifier hs-var">MethodDescriptor</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ReturnDescriptor
</span><span class="hs-identifier hs-var">VoidReturn</span></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>    </span><span class="annot"><span class="annottext">Instruction -&gt; Eff r ()
forall (r :: [Effect]).
(CodeBuilder :&gt; r) =&gt;
Instruction -&gt; Eff r ()
</span><span class="hs-identifier hs-var">emit</span></span><span> </span><span class="annot"><span class="annottext">(Instruction -&gt; Eff r ()) -&gt; Instruction -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Instruction
forall label. ClassInfoType -&gt; Instruction' label
</span><span class="hs-identifier hs-var">CheckCast</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Prim.Bool&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>    </span><span class="annot"><span class="annottext">Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType))
-&gt; Maybe ClassInfoType -&gt; Eff r (Maybe ClassInfoType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClassInfoType -&gt; Maybe ClassInfoType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedClassName -&gt; ClassInfoType
</span><span class="hs-identifier hs-var">ClassInfoType</span></span><span> </span><span class="annot"><span class="annottext">QualifiedClassName
</span><span class="hs-string">&quot;Elara.Prim.Bool&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span class="annot"><span class="hs-comment">-- | Convert a primitive boolean (int 0 or 1) on the stack to an Elara.Prim.Bool</span></span><span>
</span><span id="line-602"></span><span id="local-6989586621680068862"><span class="annot"><a href="Elara.JVM.Emit.html#primitiveBooleanToElaraBoolean"><span class="hs-identifier hs-type">primitiveBooleanToElaraBoolean</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#EmitCode"><span class="hs-identifier hs-type">EmitCode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680068862"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680068862"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClassInfoType</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-603"></span><span id="primitiveBooleanToElaraBoolean"><span class="annot"><span class="annottext">primitiveBooleanToElaraBoolean :: forall (r :: [Effect]). EmitCode r =&gt; Eff r (Maybe ClassInfoType)
</span><a href="Elara.JVM.Emit.html#primitiveBooleanToElaraBoolean"><span class="hs-identifier hs-var hs-var">primitiveBooleanToElaraBoolean</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-604"></span><span>    </span><span id="local-6989586621680069914"><span class="annot"><a href="#local-6989586621680069914"><span class="hs-identifier hs-var">falseLabel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff r Label
forall {k} (es :: [Effect]).
(HasCallStack, CodeBuilder :&gt; es) =&gt;
Eff es Label
</span><span class="hs-identifier hs-var">newLabel</span></span><span>
</span><span id="line-605"></span><span>    </span><span id="local-6989586621680069915"><span class="annot"><a href="#local-6989586621680069915"><span class="hs-identifier hs-var">endLabel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newLabel</span></span><span>
</span><span id="line-606"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IfEq</span></span><span> </span><span class="annot"><a href="#local-6989586621680069914"><span class="hs-identifier hs-type">falseLabel</span></a></span><span>
</span><span id="line-607"></span><span>    </span><span class="hs-comment">-- true case</span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">void</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#emitElaraBool"><span class="hs-identifier hs-type">emitElaraBool</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-609"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Goto</span></span><span> </span><span class="annot"><a href="#local-6989586621680069915"><span class="hs-identifier hs-type">endLabel</span></a></span><span>
</span><span id="line-610"></span><span>    </span><span class="hs-comment">-- false case</span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">JVM.Label</span></span><span> </span><span class="annot"><a href="#local-6989586621680069914"><span class="hs-identifier hs-type">falseLabel</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">void</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.JVM.Emit.html#emitElaraBool"><span class="hs-identifier hs-type">emitElaraBool</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>
</span><span id="line-613"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">emit</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">JVM.Label</span></span><span> </span><span class="annot"><a href="#local-6989586621680069915"><span class="hs-identifier hs-type">endLabel</span></a></span><span>
</span><span id="line-614"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ClassInfoType</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Elara.Prim.Bool&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span></pre></body></html>