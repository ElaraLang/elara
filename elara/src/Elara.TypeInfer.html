<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BlockArguments #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Elara.TypeInfer.html"><span class="hs-identifier">Elara.TypeInfer</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Product</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Wrapped</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_Unwrapped</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Graph</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SCC</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">flattenSCC</span></span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.Error.Static</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.State.Static.Local</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.Writer.Static.Local</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runWriter</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.html"><span class="hs-identifier">Elara.AST.Generic</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Declaration"><span class="hs-identifier">Declaration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Declaration"><span class="hs-identifier">Declaration</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Declaration%27"><span class="hs-identifier">Declaration'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Declaration%27"><span class="hs-identifier">Declaration'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Elara.AST.Generic.Types.html#DeclarationBody"><span class="hs-identifier">DeclarationBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#DeclarationBody"><span class="hs-identifier">DeclarationBody</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.html"><span class="hs-identifier">Elara.AST.Generic</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Generic</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Common.html"><span class="hs-identifier">Elara.AST.Generic.Common</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html"><span class="hs-identifier">Elara.AST.Generic.Types</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Elara.AST.Generic.Types.html#DeclarationBody%27"><span class="hs-identifier">DeclarationBody'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Kinded.html"><span class="hs-identifier">Elara.AST.Kinded</span></a></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Module.html"><span class="hs-identifier">Elara.AST.Module</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Name.html"><span class="hs-identifier">Elara.AST.Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#LowerAlphaName"><span class="hs-identifier">LowerAlphaName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#ModuleName"><span class="hs-identifier">ModuleName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Name"><span class="hs-identifier">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#NameLike"><span class="hs-identifier">NameLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier">nameText</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier">Qualified</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier">TypeName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier">VarName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Region.html"><span class="hs-identifier">Elara.AST.Region</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#HasSourceRegion"><span class="hs-identifier">HasSourceRegion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier">Located</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier">Located</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier">SourceRegion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Select.html"><span class="hs-identifier">Elara.AST.Select</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Elara.AST.Select.html#LocatedAST"><span class="hs-identifier">LocatedAST</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="Elara.AST.Select.html#Shunted"><span class="hs-identifier">Shunted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="Elara.AST.Select.html#Typed"><span class="hs-identifier">Typed</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html"><span class="hs-identifier">Elara.AST.Shunted</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Shunted</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html"><span class="hs-identifier">Elara.AST.Typed</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Typed</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Kind.html"><span class="hs-identifier">Elara.Data.Kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Kind.html#ElaraKind"><span class="hs-identifier">ElaraKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Kind.html#KindVar"><span class="hs-identifier">KindVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html"><span class="hs-identifier">Elara.Data.Kind.Infer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Kind.Infer.html#KindInferError"><span class="hs-identifier">KindInferError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html#inferKind"><span class="hs-identifier">inferKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html#inferTypeKind"><span class="hs-identifier">inferTypeKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html#initialInferState"><span class="hs-identifier">initialInferState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html#lookupKindVarMaybe"><span class="hs-identifier">lookupKindVarMaybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html#lookupNameKindVar"><span class="hs-identifier">lookupNameKindVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html"><span class="hs-identifier">Elara.Data.Kind.Infer</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Kind</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html"><span class="hs-identifier">Elara.Data.Pretty</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Unique.html"><span class="hs-identifier">Elara.Data.Unique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier">Unique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html"><span class="hs-identifier">Elara.Data.Unique.Effect</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Error.html"><span class="hs-identifier">Elara.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier">runErrorOrReport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Logging.html"><span class="hs-identifier">Elara.Logging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier">StructuredDebug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier">debug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#debugWith"><span class="hs-identifier">debugWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier">debugWithResult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Query.html"><span class="hs-identifier">Elara.Query</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier">Query</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html"><span class="hs-identifier">Elara.Query.Effects</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.SCC.Type.html"><span class="hs-identifier">Elara.SCC.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.SCC.Type.html#SCCKey"><span class="hs-identifier">SCCKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.SCC.Type.html#sccKeyToSCC"><span class="hs-identifier">sccKeyToSCC</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Shunt.Error.html"><span class="hs-identifier">Elara.Shunt.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Shunt.Error.html#ShuntError"><span class="hs-identifier">ShuntError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html"><span class="hs-identifier">Elara.TypeInfer.ConstraintGeneration</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Convert.html"><span class="hs-identifier">Elara.TypeInfer.Convert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Convert.html#TypeConvertError"><span class="hs-identifier">TypeConvertError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Convert.html#astTypeToGeneralisedInferType"><span class="hs-identifier">astTypeToGeneralisedInferType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Convert.html#astTypeToInferType"><span class="hs-identifier">astTypeToInferType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Convert.html#astTypeToInferTypeWithKind"><span class="hs-identifier">astTypeToInferTypeWithKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html"><span class="hs-identifier">Elara.TypeInfer.Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#InferError"><span class="hs-identifier">InferError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TypeEnvKey"><span class="hs-identifier">TypeEnvKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TypeEnvironment"><span class="hs-identifier">TypeEnvironment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#addType%27"><span class="hs-identifier">addType'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#emptyLocalTypeEnvironment"><span class="hs-identifier">emptyLocalTypeEnvironment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#emptyTypeEnvironment"><span class="hs-identifier">emptyTypeEnvironment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Ftv.html"><span class="hs-identifier">Elara.TypeInfer.Ftv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Ftv.html#Fuv"><span class="hs-identifier">Fuv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Generalise.html"><span class="hs-identifier">Elara.TypeInfer.Generalise</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Monad.html"><span class="hs-identifier">Elara.TypeInfer.Monad</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html"><span class="hs-identifier">Elara.TypeInfer.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier">Constraint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier">Monotype</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier">Polytype</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitutable"><span class="hs-identifier">Substitutable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVariable"><span class="hs-identifier">TypeVariable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#monotypeLoc"><span class="hs-identifier">monotypeLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#typeLoc"><span class="hs-identifier">typeLoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html"><span class="hs-identifier">Elara.TypeInfer.Unique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier">UniqueTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier">makeUniqueTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Optics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forOf_</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Relude.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fmapToSnd</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Rock.html"><span class="hs-identifier">Rock</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="TODO.html"><span class="hs-identifier">TODO</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">type</span><span> </span><span id="InferPipelineEffects"><span class="annot"><a href="Elara.TypeInfer.html#InferPipelineEffects"><span class="hs-identifier hs-var">InferPipelineEffects</span></a></span></span><span> </span><span id="local-6989586621680076277"><span class="annot"><a href="#local-6989586621680076277"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680076277"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html#InferState"><span class="hs-identifier hs-type">Kind.InferState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680076277"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Unique.Effect.html#UniqueGen"><span class="hs-identifier hs-type">UniqueGen</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680076277"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680076277"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Convert.html#TypeConvertError"><span class="hs-identifier hs-type">TypeConvertError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680076277"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html#KindInferError"><span class="hs-identifier hs-type">KindInferError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680076277"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Monad.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680076277"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="annot"><a href="Elara.TypeInfer.html#runGetTypeCheckedModuleQuery"><span class="hs-identifier hs-type">runGetTypeCheckedModuleQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-71"></span><span>    </span><span class="annot"><a href="Elara.AST.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span>
</span><span id="line-73"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span>
</span><span id="line-74"></span><span>            </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span>
</span><span id="line-75"></span><span>             </span><span class="hs-special">]</span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Module.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Elara.AST.Select.html#Typed"><span class="hs-identifier hs-type">Typed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span id="runGetTypeCheckedModuleQuery"><span class="annot"><span class="annottext">runGetTypeCheckedModuleQuery :: ModuleName -&gt; Eff (ConsQueryEffects '[Rock Query]) (Module 'Typed)
</span><a href="Elara.TypeInfer.html#runGetTypeCheckedModuleQuery"><span class="hs-identifier hs-var hs-var">runGetTypeCheckedModuleQuery</span></a></span></span><span> </span><span id="local-6989586621680076499"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680076499"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621680076500"><span class="annot"><a href="#local-6989586621680076500"><span class="hs-identifier hs-var">shunted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Shunt.Error.html#ShuntError"><span class="hs-identifier hs-type">ShuntError</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (Error ShuntError : ConsQueryEffects '[Rock Query])
   (Module 'Shunted)
 -&gt; Eff (ConsQueryEffects '[Rock Query]) (Module 'Shunted))
-&gt; Eff
     (Error ShuntError : ConsQueryEffects '[Rock Query])
     (Module 'Shunted)
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Module 'Shunted)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Query
  (Rock Query : ConsQueryEffects '[Error ShuntError])
  (Module 'Shunted)
-&gt; Eff
     (Error ShuntError : ConsQueryEffects '[Rock Query])
     (Module 'Shunted)
forall (xs :: [(* -&gt; *) -&gt; * -&gt; *]) (es :: [(* -&gt; *) -&gt; * -&gt; *])
       (f :: [(* -&gt; *) -&gt; * -&gt; *] -&gt; * -&gt; *) a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="annot"><span class="annottext">(Query
   (Rock Query : ConsQueryEffects '[Error ShuntError])
   (Module 'Shunted)
 -&gt; Eff
      (Error ShuntError : ConsQueryEffects '[Rock Query])
      (Module 'Shunted))
-&gt; Query
     (Rock Query : ConsQueryEffects '[Error ShuntError])
     (Module 'Shunted)
-&gt; Eff
     (Error ShuntError : ConsQueryEffects '[Rock Query])
     (Module 'Shunted)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; Query
     (Rock Query : ConsQueryEffects '[Error ShuntError])
     (Module 'Shunted)
</span><a href="Elara.Query.html#ShuntedModule"><span class="hs-identifier hs-var">Elara.Query.ShuntedModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680076499"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span id="local-6989586621680076503"><span class="annot"><a href="#local-6989586621680076503"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.html#runInferEffects"><span class="hs-identifier hs-type">runInferEffects</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">evalState</span></span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html#initialInferState"><span class="hs-identifier hs-type">initialInferState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.html#inferModule"><span class="hs-identifier hs-type">inferModule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680076500"><span class="hs-identifier hs-type">shunted</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621680076503"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="annot"><a href="Elara.TypeInfer.html#runTypeOfQuery"><span class="hs-identifier hs-type">runTypeOfQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680075481"><span class="annot"><a href="#local-6989586621680075481"><span class="hs-identifier hs-type">loc</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="#local-6989586621680075481"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TypeEnvKey"><span class="hs-identifier hs-type">TypeEnvKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075481"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span>
</span><span id="line-89"></span><span>            </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075481"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span id="runTypeOfQuery"><span class="annot"><span class="annottext">runTypeOfQuery :: forall loc.
(loc ~ SourceRegion) =&gt;
TypeEnvKey loc -&gt; Eff (ConsQueryEffects '[Rock Query]) (Type loc)
</span><a href="Elara.TypeInfer.html#runTypeOfQuery"><span class="hs-identifier hs-var hs-var">runTypeOfQuery</span></a></span></span><span> </span><span id="local-6989586621680076767"><span class="annot"><span class="annottext">TypeEnvKey loc
</span><a href="#local-6989586621680076767"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#InferError"><span class="hs-identifier hs-type">InferError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075481"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff
   (Error (InferError loc) : ConsQueryEffects '[Rock Query])
   (Type loc)
 -&gt; Eff (ConsQueryEffects '[Rock Query]) (Type loc))
-&gt; Eff
     (Error (InferError loc) : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Type loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075481"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff
   (Error (UnifyError loc)
      : Error (InferError loc) : ConsQueryEffects '[Rock Query])
   (Type loc)
 -&gt; Eff
      (Error (InferError loc) : ConsQueryEffects '[Rock Query])
      (Type loc))
-&gt; Eff
     (Error (UnifyError loc)
        : Error (InferError loc) : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (Error (InferError loc) : ConsQueryEffects '[Rock Query])
     (Type loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-94"></span><span>        </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Data.Kind.Infer.html#KindInferError"><span class="hs-identifier hs-type">KindInferError</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (Error KindInferError
      : Error (UnifyError loc) : Error (InferError loc)
      : ConsQueryEffects '[Rock Query])
   (Type loc)
 -&gt; Eff
      (Error (UnifyError loc)
         : Error (InferError loc) : ConsQueryEffects '[Rock Query])
      (Type loc))
-&gt; Eff
     (Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (Error (UnifyError loc)
        : Error (InferError loc) : ConsQueryEffects '[Rock Query])
     (Type loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-95"></span><span>            </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.TypeInfer.Convert.html#TypeConvertError"><span class="hs-identifier hs-type">TypeConvertError</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (Error TypeConvertError
      : Error KindInferError : Error (UnifyError loc)
      : Error (InferError loc) : ConsQueryEffects '[Rock Query])
   (Type loc)
 -&gt; Eff
      (Error KindInferError
         : Error (UnifyError loc) : Error (InferError loc)
         : ConsQueryEffects '[Rock Query])
      (Type loc))
-&gt; Eff
     (Error TypeConvertError
        : Error KindInferError : Error (UnifyError loc)
        : Error (InferError loc) : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-96"></span><span>                </span><span class="annot"><span class="annottext">LocalTypeEnvironment SourceRegion
-&gt; Eff
     (State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (Error TypeConvertError
        : Error KindInferError : Error (UnifyError loc)
        : Error (InferError loc) : ConsQueryEffects '[Rock Query])
     (Type loc)
forall s (es :: [(* -&gt; *) -&gt; * -&gt; *]) a.
HasCallStack =&gt;
s -&gt; Eff (State s : es) a -&gt; Eff es a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="annot"><span class="annottext">LocalTypeEnvironment SourceRegion
forall loc. LocalTypeEnvironment loc
</span><a href="Elara.TypeInfer.Environment.html#emptyLocalTypeEnvironment"><span class="hs-identifier hs-var">emptyLocalTypeEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (State (LocalTypeEnvironment SourceRegion)
      : Error TypeConvertError : Error KindInferError
      : Error (UnifyError loc) : Error (InferError loc)
      : ConsQueryEffects '[Rock Query])
   (Type loc)
 -&gt; Eff
      (Error TypeConvertError
         : Error KindInferError : Error (UnifyError loc)
         : Error (InferError loc) : ConsQueryEffects '[Rock Query])
      (Type loc))
-&gt; Eff
     (State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (Error TypeConvertError
        : Error KindInferError : Error (UnifyError loc)
        : Error (InferError loc) : ConsQueryEffects '[Rock Query])
     (Type loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-97"></span><span>                    </span><span class="annot"><span class="annottext">InferState
-&gt; Eff
     (State InferState
        : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
forall s (es :: [(* -&gt; *) -&gt; * -&gt; *]) a.
HasCallStack =&gt;
s -&gt; Eff (State s : es) a -&gt; Eff es a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="annot"><span class="annottext">InferState
</span><a href="Elara.Data.Kind.Infer.html#initialInferState"><span class="hs-identifier hs-var">initialInferState</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (State InferState
      : State (LocalTypeEnvironment SourceRegion)
      : Error TypeConvertError : Error KindInferError
      : Error (UnifyError loc) : Error (InferError loc)
      : ConsQueryEffects '[Rock Query])
   (Type loc)
 -&gt; Eff
      (State (LocalTypeEnvironment SourceRegion)
         : Error TypeConvertError : Error KindInferError
         : Error (UnifyError loc) : Error (InferError loc)
         : ConsQueryEffects '[Rock Query])
      (Type loc))
-&gt; Eff
     (State InferState
        : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-98"></span><span>                        </span><span class="annot"><span class="annottext">TypeEnvironment SourceRegion
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : State InferState : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (State InferState
        : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
forall s (es :: [(* -&gt; *) -&gt; * -&gt; *]) a.
HasCallStack =&gt;
s -&gt; Eff (State s : es) a -&gt; Eff es a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="annot"><span class="annottext">TypeEnvironment SourceRegion
forall loc. TypeEnvironment loc
</span><a href="Elara.TypeInfer.Environment.html#emptyTypeEnvironment"><span class="hs-identifier hs-var">emptyTypeEnvironment</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (State (TypeEnvironment SourceRegion)
      : State InferState : State (LocalTypeEnvironment SourceRegion)
      : Error TypeConvertError : Error KindInferError
      : Error (UnifyError loc) : Error (InferError loc)
      : ConsQueryEffects '[Rock Query])
   (Type loc)
 -&gt; Eff
      (State InferState
         : State (LocalTypeEnvironment SourceRegion)
         : Error TypeConvertError : Error KindInferError
         : Error (UnifyError loc) : Error (InferError loc)
         : ConsQueryEffects '[Rock Query])
      (Type loc))
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : State InferState : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (State InferState
        : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-99"></span><span>                            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeEnvKey loc
</span><a href="#local-6989586621680076767"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-100"></span><span>                                </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TermVarKey"><span class="hs-identifier hs-type">TermVarKey</span></a></span><span> </span><span id="local-6989586621680076769"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680076769"><span class="hs-identifier hs-var">varName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : State InferState : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : State InferState : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;TypeOf: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680076769"><span class="hs-identifier hs-var">varName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff
   (State (TypeEnvironment SourceRegion)
      : State InferState : State (LocalTypeEnvironment SourceRegion)
      : Error TypeConvertError : Error KindInferError
      : Error (UnifyError loc) : Error (InferError loc)
      : ConsQueryEffects '[Rock Query])
   (Type loc)
 -&gt; Eff
      (State (TypeEnvironment SourceRegion)
         : State InferState : State (LocalTypeEnvironment SourceRegion)
         : Error TypeConvertError : Error KindInferError
         : Error (UnifyError loc) : Error (InferError loc)
         : ConsQueryEffects '[Rock Query])
      (Type loc))
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : State InferState : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : State InferState : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-101"></span><span>                                    </span><span id="local-6989586621680076771"><span class="annot"><a href="#local-6989586621680076771"><span class="hs-identifier hs-var">sccs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) [SCC (Qualified VarName)]
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : State InferState : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     [SCC (Qualified VarName)]
forall (xs :: [(* -&gt; *) -&gt; * -&gt; *]) (es :: [(* -&gt; *) -&gt; * -&gt; *])
       (f :: [(* -&gt; *) -&gt; * -&gt; *] -&gt; * -&gt; *) a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="annot"><span class="annottext">(Query
   (Rock Query : ConsQueryEffects '[]) [SCC (Qualified VarName)]
 -&gt; Eff
      (State (TypeEnvironment SourceRegion)
         : State InferState : State (LocalTypeEnvironment SourceRegion)
         : Error TypeConvertError : Error KindInferError
         : Error (UnifyError loc) : Error (InferError loc)
         : ConsQueryEffects '[Rock Query])
      [SCC (Qualified VarName)])
-&gt; Query
     (Rock Query : ConsQueryEffects '[]) [SCC (Qualified VarName)]
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : State InferState : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     [SCC (Qualified VarName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
-&gt; Query
     (Rock Query : ConsQueryEffects '[]) [SCC (Qualified VarName)]
</span><a href="Elara.Query.html#GetSCCsOf"><span class="hs-identifier hs-var">GetSCCsOf</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680076769"><span class="hs-identifier hs-var">varName</span></a></span><span>
</span><span id="line-102"></span><span>                                    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;SCCs for &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680076769"><span class="hs-identifier hs-type">varName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">flattenSCC</span></span><span> </span><span class="annot"><a href="#local-6989586621680076771"><span class="hs-identifier hs-type">sccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>                                    </span><span class="hs-comment">-- Infer dependencies first to populate the environment</span><span>
</span><span id="line-104"></span><span>                                    </span><span class="annot"><span class="hs-identifier hs-type">for_</span></span><span> </span><span class="annot"><a href="#local-6989586621680076771"><span class="hs-identifier hs-type">sccs</span></a></span><span> </span><span class="annot"><a href="Elara.TypeInfer.html#seedSCC"><span class="hs-identifier hs-type">seedSCC</span></a></span><span>
</span><span id="line-105"></span><span>                                    </span><span class="annot"><span class="hs-identifier hs-type">for_</span></span><span> </span><span class="annot"><a href="#local-6989586621680076771"><span class="hs-identifier hs-type">sccs</span></a></span><span> </span><span class="annot"><a href="Elara.TypeInfer.html#inferSCC"><span class="hs-identifier hs-type">inferSCC</span></a></span><span>
</span><span id="line-106"></span><span>                                    </span><span class="hs-comment">-- Read from the environment (now populated) without re-querying</span><span>
</span><span id="line-107"></span><span>                                    </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#lookupType"><span class="hs-identifier hs-type">lookupType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TermVarKey"><span class="hs-identifier hs-type">TermVarKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680076769"><span class="hs-identifier hs-type">varName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>                                </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#DataConKey"><span class="hs-identifier hs-type">DataConKey</span></a></span><span> </span><span id="local-6989586621680076778"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680076778"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>                                    </span><span class="annot"><span class="annottext">ModuleName
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : State InferState : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     ()
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(DiagnosticWriter (Doc AnsiStyle) :&gt; r, Rock Query :&gt; r,
 Error SomeReportableError :&gt; r, Error KindInferError :&gt; r,
 Error TypeConvertError :&gt; r,
 State (TypeEnvironment SourceRegion) :&gt; r, State InferState :&gt; r,
 StructuredDebug :&gt; r, FileSystem :&gt; r, UniqueGen :&gt; r,
 Memoise :&gt; r, Concurrent :&gt; r) =&gt;
ModuleName -&gt; Eff r ()
</span><a href="Elara.TypeInfer.html#seedConstructorsFor"><span class="hs-identifier hs-var">seedConstructorsFor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ModuleName
forall name. Qualified name -&gt; ModuleName
</span><a href="Elara.AST.Name.html#qualifier"><span class="hs-identifier hs-var">qualifier</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680076778"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>                                    </span><span class="hs-comment">-- Read from the environment (now populated) without re-querying</span><span>
</span><span id="line-111"></span><span>                                    </span><span class="annot"><span class="annottext">TypeEnvKey loc
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : State InferState : State (LocalTypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError loc) : Error (InferError loc)
        : ConsQueryEffects '[Rock Query])
     (Type loc)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) loc.
(QueryEffects r, loc ~ SourceRegion, Rock Query :&gt; r,
 State (TypeEnvironment loc) :&gt; r) =&gt;
TypeEnvKey loc -&gt; Eff r (Type loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TypeEnvKey loc
forall {k} (loc :: k). DataCon -&gt; TypeEnvKey loc
</span><a href="Elara.TypeInfer.Environment.html#DataConKey"><span class="hs-identifier hs-var">DataConKey</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680076778"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span id="local-6989586621680075520"><span class="annot"><a href="Elara.TypeInfer.html#runKindOfQuery"><span class="hs-identifier hs-type">runKindOfQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621680075520"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Elara.Data.Kind.html#KindVar"><span class="hs-identifier hs-type">KindVar</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-114"></span><span id="runKindOfQuery"><span class="annot"><span class="annottext">runKindOfQuery :: forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
DataCon -&gt; Eff (ConsQueryEffects (Rock Query : r)) (Maybe KindVar)
</span><a href="Elara.TypeInfer.html#runKindOfQuery"><span class="hs-identifier hs-var hs-var">runKindOfQuery</span></a></span></span><span> </span><span id="local-6989586621680076937"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680076937"><span class="hs-identifier hs-var">qtn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Maybe KindVar, Constraint SourceRegion) -&gt; Maybe KindVar)
-&gt; Eff
     (ConsQueryEffects (Rock Query : r))
     (Maybe KindVar, Constraint SourceRegion)
-&gt; Eff (ConsQueryEffects (Rock Query : r)) (Maybe KindVar)
forall a b.
(a -&gt; b)
-&gt; Eff (ConsQueryEffects (Rock Query : r)) a
-&gt; Eff (ConsQueryEffects (Rock Query : r)) b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Maybe KindVar, Constraint SourceRegion) -&gt; Maybe KindVar
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   (ConsQueryEffects (Rock Query : r))
   (Maybe KindVar, Constraint SourceRegion)
 -&gt; Eff (ConsQueryEffects (Rock Query : r)) (Maybe KindVar))
-&gt; Eff
     (ConsQueryEffects (Rock Query : r))
     (Maybe KindVar, Constraint SourceRegion)
-&gt; Eff (ConsQueryEffects (Rock Query : r)) (Maybe KindVar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Eff
  (InferEffectsCons
     SourceRegion
     (Error (UnifyError SourceRegion)
        : Error KindInferError : Error TypeConvertError
        : ConsQueryEffects (Rock Query : r)))
  (Maybe KindVar)
-&gt; Eff
     (ConsQueryEffects (Rock Query : r))
     (Maybe KindVar, Constraint SourceRegion)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) a loc.
(Pretty loc, QueryEffects r, Rock Query :&gt; r, Eq loc,
 loc ~ SourceRegion) =&gt;
Eff
  (InferEffectsCons
     loc
     (Error (UnifyError loc)
        : Error KindInferError : Error TypeConvertError : r))
  a
-&gt; Eff r (a, Constraint loc)
</span><a href="Elara.TypeInfer.html#runInferEffects"><span class="hs-identifier hs-var">runInferEffects</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (InferEffectsCons
      SourceRegion
      (Error (UnifyError SourceRegion)
         : Error KindInferError : Error TypeConvertError
         : ConsQueryEffects (Rock Query : r)))
   (Maybe KindVar)
 -&gt; Eff
      (ConsQueryEffects (Rock Query : r))
      (Maybe KindVar, Constraint SourceRegion))
-&gt; Eff
     (InferEffectsCons
        SourceRegion
        (Error (UnifyError SourceRegion)
           : Error KindInferError : Error TypeConvertError
           : ConsQueryEffects (Rock Query : r)))
     (Maybe KindVar)
-&gt; Eff
     (ConsQueryEffects (Rock Query : r))
     (Maybe KindVar, Constraint SourceRegion)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InferState
-&gt; Eff
     (State InferState
        : InferEffectsCons
            SourceRegion
            (Error (UnifyError SourceRegion)
               : Error KindInferError : Error TypeConvertError
               : ConsQueryEffects (Rock Query : r)))
     (Maybe KindVar)
-&gt; Eff
     (InferEffectsCons
        SourceRegion
        (Error (UnifyError SourceRegion)
           : Error KindInferError : Error TypeConvertError
           : ConsQueryEffects (Rock Query : r)))
     (Maybe KindVar)
forall s (es :: [(* -&gt; *) -&gt; * -&gt; *]) a.
HasCallStack =&gt;
s -&gt; Eff (State s : es) a -&gt; Eff es a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="annot"><span class="annottext">InferState
</span><a href="Elara.Data.Kind.Infer.html#initialInferState"><span class="hs-identifier hs-var">initialInferState</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (State InferState
      : InferEffectsCons
          SourceRegion
          (Error (UnifyError SourceRegion)
             : Error KindInferError : Error TypeConvertError
             : ConsQueryEffects (Rock Query : r)))
   (Maybe KindVar)
 -&gt; Eff
      (InferEffectsCons
         SourceRegion
         (Error (UnifyError SourceRegion)
            : Error KindInferError : Error TypeConvertError
            : ConsQueryEffects (Rock Query : r)))
      (Maybe KindVar))
-&gt; Eff
     (State InferState
        : InferEffectsCons
            SourceRegion
            (Error (UnifyError SourceRegion)
               : Error KindInferError : Error TypeConvertError
               : ConsQueryEffects (Rock Query : r)))
     (Maybe KindVar)
-&gt; Eff
     (InferEffectsCons
        SourceRegion
        (Error (UnifyError SourceRegion)
           : Error KindInferError : Error TypeConvertError
           : ConsQueryEffects (Rock Query : r)))
     (Maybe KindVar)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>    </span><span class="annot"><span class="annottext">ModuleName
-&gt; Eff
     (State InferState
        : InferEffectsCons
            SourceRegion
            (Error (UnifyError SourceRegion)
               : Error KindInferError : Error TypeConvertError
               : ConsQueryEffects (Rock Query : r)))
     ()
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(DiagnosticWriter (Doc AnsiStyle) :&gt; r, Rock Query :&gt; r,
 Error SomeReportableError :&gt; r, Error KindInferError :&gt; r,
 Error TypeConvertError :&gt; r,
 State (TypeEnvironment SourceRegion) :&gt; r, State InferState :&gt; r,
 StructuredDebug :&gt; r, FileSystem :&gt; r, UniqueGen :&gt; r,
 Memoise :&gt; r, Concurrent :&gt; r) =&gt;
ModuleName -&gt; Eff r ()
</span><a href="Elara.TypeInfer.html#seedConstructorsFor"><span class="hs-identifier hs-var">seedConstructorsFor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ModuleName
forall name. Qualified name -&gt; ModuleName
</span><a href="Elara.AST.Name.html#qualifier"><span class="hs-identifier hs-var">qualifier</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680076937"><span class="hs-identifier hs-var">qtn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-comment">-- in theory it should be here now...</span><span>
</span><span id="line-118"></span><span>    </span><span class="annot"><span class="annottext">Either DataCon TypeVar
-&gt; Eff
     (State InferState
        : InferEffectsCons
            SourceRegion
            (Error (UnifyError SourceRegion)
               : Error KindInferError : Error TypeConvertError
               : ConsQueryEffects (Rock Query : r)))
     (Maybe KindVar)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
KindInfer r =&gt;
Either DataCon TypeVar -&gt; Eff r (Maybe KindVar)
</span><a href="Elara.Data.Kind.Infer.html#lookupKindVarMaybe"><span class="hs-identifier hs-var">lookupKindVarMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Either DataCon TypeVar
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621680076937"><span class="hs-identifier hs-var">qtn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span id="local-6989586621680076938"><span class="annot"><a href="Elara.TypeInfer.html#seedConstructorsFor"><span class="hs-identifier hs-type">seedConstructorsFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680076938"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-121"></span><span id="seedConstructorsFor"><span class="annot"><span class="annottext">seedConstructorsFor :: ModuleName -&gt; Eff r ()
</span><a href="Elara.TypeInfer.html#seedConstructorsFor"><span class="hs-identifier hs-var hs-var">seedConstructorsFor</span></a></span></span><span> </span><span id="local-6989586621680077271"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680077271"><span class="hs-identifier hs-var">moduleName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r () -&gt; Eff r ()
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;seedConstructorsFor: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680077271"><span class="hs-identifier hs-var">moduleName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r () -&gt; Eff r ()) -&gt; Eff r () -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-comment">-- Fetch all declarations in the module</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621680077272"><span class="annot"><a href="#local-6989586621680077272"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Shunt.Error.html#ShuntError"><span class="hs-identifier hs-type">ShuntError</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff (Error ShuntError : r) (Module 'Shunted)
 -&gt; Eff r (Module 'Shunted))
-&gt; Eff (Error ShuntError : r) (Module 'Shunted)
-&gt; Eff r (Module 'Shunted)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Query
  (Rock Query : ConsQueryEffects '[Error ShuntError])
  (Module 'Shunted)
-&gt; Eff (Error ShuntError : r) (Module 'Shunted)
forall (xs :: [(* -&gt; *) -&gt; * -&gt; *]) (es :: [(* -&gt; *) -&gt; * -&gt; *])
       (f :: [(* -&gt; *) -&gt; * -&gt; *] -&gt; * -&gt; *) a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="annot"><span class="annottext">(Query
   (Rock Query : ConsQueryEffects '[Error ShuntError])
   (Module 'Shunted)
 -&gt; Eff (Error ShuntError : r) (Module 'Shunted))
-&gt; Query
     (Rock Query : ConsQueryEffects '[Error ShuntError])
     (Module 'Shunted)
-&gt; Eff (Error ShuntError : r) (Module 'Shunted)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; Query
     (Rock Query : ConsQueryEffects '[Error ShuntError])
     (Module 'Shunted)
</span><a href="Elara.Query.html#ShuntedModule"><span class="hs-identifier hs-var">Elara.Query.ShuntedModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680077271"><span class="hs-identifier hs-var">moduleName</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680077273"><span class="annot"><a href="#local-6989586621680077273"><span class="hs-identifier hs-var hs-var">declarations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-125"></span><span>            </span><span class="annot"><span class="annottext">Module 'Shunted
</span><a href="#local-6989586621680077272"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-126"></span><span>                </span><span class="annot"><span class="annottext">Module 'Shunted
-&gt; Optic'
     A_Traversal
     '[Int]
     (Module 'Shunted)
     (Located DataCon, [Located TypeVar],
      Located ShuntedTypeDeclaration, TypeDeclAnnotations 'Shunted)
-&gt; [(Located DataCon, [Located TypeVar],
     Located ShuntedTypeDeclaration, TypeDeclAnnotations 'Shunted)]
forall k s (is :: IxList) a.
Is k A_Fold =&gt;
s -&gt; Optic' k is s a -&gt; [a]
</span><span class="hs-operator hs-var">^..</span></span><span> </span><span class="annot"><span class="annottext">Iso
  (Module 'Shunted)
  (Module 'Shunted)
  (Located (Module' 'Shunted))
  (Located (Module' 'Shunted))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span>
</span><span id="line-127"></span><span>                </span><span class="annot"><span class="annottext">Iso
  (Module 'Shunted)
  (Module 'Shunted)
  (Located (Module' 'Shunted))
  (Located (Module' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (Module' 'Shunted))
     (Located (Module' 'Shunted))
     (Module' 'Shunted)
     (Module' 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     (Module 'Shunted)
     (Module 'Shunted)
     (Module' 'Shunted)
     (Module' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Module' 'Shunted))
  (Located (Module' 'Shunted))
  (Module' 'Shunted)
  (Module' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-128"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Module 'Shunted)
  (Module 'Shunted)
  (Module' 'Shunted)
  (Module' 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     (Module' 'Shunted)
     (Module' 'Shunted)
     [Declaration 'Shunted]
     [Declaration 'Shunted]
-&gt; Optic
     A_Lens
     '[]
     (Module 'Shunted)
     (Module 'Shunted)
     [Declaration 'Shunted]
     [Declaration 'Shunted]
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;declarations&quot;</span></span><span>
</span><span id="line-129"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Module 'Shunted)
  (Module 'Shunted)
  [Declaration 'Shunted]
  [Declaration 'Shunted]
-&gt; Optic
     A_Traversal
     '[Int]
     [Declaration 'Shunted]
     [Declaration 'Shunted]
     (Declaration 'Shunted)
     (Declaration 'Shunted)
-&gt; Optic
     A_Traversal
     '[Int]
     (Module 'Shunted)
     (Module 'Shunted)
     (Declaration 'Shunted)
     (Declaration 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  '[Int]
  [Declaration 'Shunted]
  [Declaration 'Shunted]
  (Declaration 'Shunted)
  (Declaration 'Shunted)
forall i s t a b. Each i s t a b =&gt; IxTraversal i s t a b
</span><span class="hs-identifier hs-var">each</span></span><span>
</span><span id="line-130"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  '[Int]
  (Module 'Shunted)
  (Module 'Shunted)
  (Declaration 'Shunted)
  (Declaration 'Shunted)
-&gt; Optic
     An_Iso
     '[]
     (Declaration 'Shunted)
     (Declaration 'Shunted)
     (Located (Declaration' 'Shunted))
     (Located (Declaration' 'Shunted))
-&gt; Optic
     A_Traversal
     '[Int]
     (Module 'Shunted)
     (Module 'Shunted)
     (Located (Declaration' 'Shunted))
     (Located (Declaration' 'Shunted))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  '[]
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span>
</span><span id="line-131"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  '[Int]
  (Module 'Shunted)
  (Module 'Shunted)
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (Declaration' 'Shunted))
     (Located (Declaration' 'Shunted))
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
-&gt; Optic
     A_Traversal
     '[Int]
     (Module 'Shunted)
     (Module 'Shunted)
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
  (Declaration' 'Shunted)
  (Declaration' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-132"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  '[Int]
  (Module 'Shunted)
  (Module 'Shunted)
  (Declaration' 'Shunted)
  (Declaration' 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
-&gt; Optic
     A_Traversal
     '[Int]
     (Module 'Shunted)
     (Module 'Shunted)
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span>
</span><span id="line-133"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  '[Int]
  (Module 'Shunted)
  (Module 'Shunted)
  (DeclarationBody 'Shunted)
  (DeclarationBody 'Shunted)
-&gt; Optic
     An_Iso
     '[]
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
-&gt; Optic
     A_Traversal
     '[Int]
     (Module 'Shunted)
     (Module 'Shunted)
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  '[]
  (DeclarationBody 'Shunted)
  (DeclarationBody 'Shunted)
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span>
</span><span id="line-134"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  '[Int]
  (Module 'Shunted)
  (Module 'Shunted)
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
     (DeclarationBody' 'Shunted)
     (DeclarationBody' 'Shunted)
-&gt; Optic
     A_Traversal
     '[Int]
     (Module 'Shunted)
     (Module 'Shunted)
     (DeclarationBody' 'Shunted)
     (DeclarationBody' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
  (DeclarationBody' 'Shunted)
  (DeclarationBody' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-135"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  '[Int]
  (Module 'Shunted)
  (Module 'Shunted)
  (DeclarationBody' 'Shunted)
  (DeclarationBody' 'Shunted)
-&gt; Optic
     A_Prism
     '[]
     (DeclarationBody' 'Shunted)
     (DeclarationBody' 'Shunted)
     (Located DataCon, [Located TypeVar],
      Located ShuntedTypeDeclaration, TypeDeclAnnotations 'Shunted)
     (Located DataCon, [Located TypeVar],
      Located ShuntedTypeDeclaration, TypeDeclAnnotations 'Shunted)
-&gt; Optic'
     A_Traversal
     '[Int]
     (Module 'Shunted)
     (Located DataCon, [Located TypeVar],
      Located ShuntedTypeDeclaration, TypeDeclAnnotations 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (ctor :: Symbol) s a.
AsConstructor' ctor s a =&gt;
Prism s s a a
</span><span class="hs-identifier hs-var">_Ctor'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;TypeDeclaration&quot;</span></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-comment">-- For each type declaration, add its constructors to the environment</span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">for_</span></span><span> </span><span class="annot"><a href="#local-6989586621680077273"><span class="hs-identifier hs-type">declarations</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680077279"><span class="annot"><span class="annottext">Located DataCon
</span><a href="#local-6989586621680077279"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680077280"><span class="annot"><span class="annottext">[Located TypeVar]
</span><a href="#local-6989586621680077280"><span class="hs-identifier hs-var">typeVars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680077281"><span class="annot"><span class="annottext">Located ShuntedTypeDeclaration
</span><a href="#local-6989586621680077281"><span class="hs-identifier hs-var">declBody</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypeDeclAnnotations 'Shunted
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r () -&gt; Eff r ()
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Seeding declaration: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Located DataCon -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Located DataCon
</span><a href="#local-6989586621680077279"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r () -&gt; Eff r ()) -&gt; Eff r () -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680077282"><span class="annot"><a href="#local-6989586621680077282"><span class="hs-identifier hs-var">decl'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; [Located TypeVar]
-&gt; ShuntedTypeDeclaration
-&gt; Eff r (ElaraKind, KindedTypeDeclaration)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(State InferState :&gt; r, Error KindInferError :&gt; r,
 Error SomeReportableError :&gt; r,
 DiagnosticWriter (Doc AnsiStyle) :&gt; r, Rock Query :&gt; r,
 UniqueGen :&gt; r, FileSystem :&gt; r, Memoise :&gt; r, Concurrent :&gt; r,
 StructuredDebug :&gt; r) =&gt;
DataCon
-&gt; [Located TypeVar]
-&gt; ShuntedTypeDeclaration
-&gt; Eff r (ElaraKind, KindedTypeDeclaration)
</span><a href="Elara.Data.Kind.Infer.html#inferKind"><span class="hs-identifier hs-var">inferKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located DataCon
</span><a href="#local-6989586621680077279"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Located DataCon
-&gt; Optic' A_Lens '[] (Located DataCon) DataCon -&gt; DataCon
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located DataCon) DataCon
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Located TypeVar]
</span><a href="#local-6989586621680077280"><span class="hs-identifier hs-var">typeVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located ShuntedTypeDeclaration
</span><a href="#local-6989586621680077281"><span class="hs-identifier hs-var">declBody</span></a></span><span> </span><span class="annot"><span class="annottext">Located ShuntedTypeDeclaration
-&gt; Optic'
     A_Lens '[] (Located ShuntedTypeDeclaration) ShuntedTypeDeclaration
-&gt; ShuntedTypeDeclaration
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  A_Lens '[] (Located ShuntedTypeDeclaration) ShuntedTypeDeclaration
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680077282"><span class="hs-identifier hs-type">decl'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-141"></span><span>            </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Alias"><span class="hs-identifier hs-type">Generic.Alias</span></a></span><span> </span><span id="local-6989586621680077285"><span class="annot"><span class="annottext">Select &quot;Alias&quot; 'Kinded
</span><a href="#local-6989586621680077285"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>                </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">KindedType -&gt; Eff r (Monotype SourceRegion)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(Error TypeConvertError :&gt; r) =&gt;
KindedType -&gt; Eff r (Monotype SourceRegion)
</span><a href="Elara.TypeInfer.Convert.html#astTypeToInferType"><span class="hs-identifier hs-var">astTypeToInferType</span></a></span><span> </span><span class="annot"><span class="annottext">KindedType
Select &quot;Alias&quot; 'Kinded
</span><a href="#local-6989586621680077285"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-143"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">pass</span></span><span> </span><span class="hs-comment">-- we don't need to do anything with an alias i think</span><span>
</span><span id="line-144"></span><span>            </span><span class="annot"><a href="Elara.AST.Generic.Types.html#ADT"><span class="hs-identifier hs-type">Generic.ADT</span></a></span><span> </span><span id="local-6989586621680077288"><span class="annot"><span class="annottext">NonEmpty
  (ASTLocate 'Kinded (Select &quot;ConstructorName&quot; 'Kinded),
   [Select &quot;ADTParam&quot; 'Kinded])
</span><a href="#local-6989586621680077288"><span class="hs-identifier hs-var">ctors</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-145"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680077289"><span class="annot"><span class="annottext">tyVars' :: [UniqueTyVar]
</span><a href="#local-6989586621680077289"><span class="hs-identifier hs-var hs-var hs-var">tyVars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Located TypeVar -&gt; UniqueTyVar)
-&gt; [Located TypeVar] -&gt; [UniqueTyVar]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Located TypeVar -&gt; UniqueTyVar
</span><a href="Elara.TypeInfer.html#createTypeVar"><span class="hs-identifier hs-var">createTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Located TypeVar]
</span><a href="#local-6989586621680077280"><span class="hs-identifier hs-var">typeVars</span></a></span><span>
</span><span id="line-146"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680077291"><span class="annot"><span class="annottext">typeConstructorType :: Monotype SourceRegion
</span><a href="#local-6989586621680077291"><span class="hs-identifier hs-var hs-var hs-var">typeConstructorType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceRegion
-&gt; DataCon -&gt; [Monotype SourceRegion] -&gt; Monotype SourceRegion
forall loc. loc -&gt; DataCon -&gt; [Monotype loc] -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeConstructor"><span class="hs-identifier hs-var">TypeConstructor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located DataCon
</span><a href="#local-6989586621680077279"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Located DataCon
-&gt; Optic' A_Lens '[] (Located DataCon) SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located DataCon) SourceRegion
forall a. HasSourceRegion a =&gt; Lens' a SourceRegion
</span><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-var">sourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located DataCon
</span><a href="#local-6989586621680077279"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Located DataCon
-&gt; Optic' A_Lens '[] (Located DataCon) DataCon -&gt; DataCon
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located DataCon) DataCon
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; Monotype SourceRegion)
-&gt; [UniqueTyVar] -&gt; [Monotype SourceRegion]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located DataCon
</span><a href="#local-6989586621680077279"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Located DataCon
-&gt; Optic' A_Lens '[] (Located DataCon) SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located DataCon) SourceRegion
forall a. HasSourceRegion a =&gt; Lens' a SourceRegion
</span><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-var">sourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeVariable -&gt; Monotype SourceRegion)
-&gt; (UniqueTyVar -&gt; TypeVariable)
-&gt; UniqueTyVar
-&gt; Monotype SourceRegion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-var">UnificationVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UniqueTyVar]
</span><a href="#local-6989586621680077289"><span class="hs-identifier hs-var">tyVars'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680077297"><span class="annot"><span class="annottext">inferCtor :: (Located DataCon, [KindedType])
-&gt; Eff r (Located DataCon, [(Monotype SourceRegion, ElaraKind)])
</span><a href="#local-6989586621680077297"><span class="hs-identifier hs-var hs-var">inferCtor</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680077298"><span class="annot"><span class="annottext">Located DataCon
</span><a href="#local-6989586621680077298"><span class="hs-identifier hs-var">ctorName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680077299"><span class="annot"><span class="annottext">[KindedType]
</span><a href="#local-6989586621680077299"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.AST.Kinded.html#KindedType"><span class="hs-identifier hs-type">KindedType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>                        </span><span id="local-6989586621680077300"><span class="annot"><a href="#local-6989586621680077300"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(KindedType -&gt; Eff r (Monotype SourceRegion, ElaraKind))
-&gt; [KindedType] -&gt; Eff r [(Monotype SourceRegion, ElaraKind)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">KindedType -&gt; Eff r (Monotype SourceRegion, ElaraKind)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(Error TypeConvertError :&gt; r) =&gt;
KindedType -&gt; Eff r (Monotype SourceRegion, ElaraKind)
</span><a href="Elara.TypeInfer.Convert.html#astTypeToInferTypeWithKind"><span class="hs-identifier hs-var">astTypeToInferTypeWithKind</span></a></span><span> </span><span class="annot"><span class="annottext">[KindedType]
</span><a href="#local-6989586621680077299"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-150"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680077302"><span class="annot"><a href="#local-6989586621680077302"><span class="hs-identifier hs-var hs-var">ctorType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>                                </span><span class="annot"><span class="annottext">((Monotype SourceRegion, ElaraKind)
 -&gt; Monotype SourceRegion -&gt; Monotype SourceRegion)
-&gt; Monotype SourceRegion
-&gt; [(Monotype SourceRegion, ElaraKind)]
-&gt; Monotype SourceRegion
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
forall loc. loc -&gt; Monotype loc -&gt; Monotype loc -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Function"><span class="hs-identifier hs-var">Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located DataCon
</span><a href="#local-6989586621680077279"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Located DataCon
-&gt; Optic' A_Lens '[] (Located DataCon) SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located DataCon) SourceRegion
forall a. HasSourceRegion a =&gt; Lens' a SourceRegion
</span><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-var">sourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Monotype SourceRegion
 -&gt; Monotype SourceRegion -&gt; Monotype SourceRegion)
-&gt; ((Monotype SourceRegion, ElaraKind) -&gt; Monotype SourceRegion)
-&gt; (Monotype SourceRegion, ElaraKind)
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Monotype SourceRegion, ElaraKind) -&gt; Monotype SourceRegion
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680077291"><span class="hs-identifier hs-var">typeConstructorType</span></a></span><span> </span><span class="annot"><span class="annottext">[(Monotype SourceRegion, ElaraKind)]
</span><a href="#local-6989586621680077300"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-152"></span><span>                        </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#addType%27"><span class="hs-identifier hs-type">addType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#DataConKey"><span class="hs-identifier hs-type">DataConKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680077298"><span class="hs-identifier hs-type">ctorName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-type">unlocated</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Forall"><span class="hs-identifier hs-type">Forall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680077279"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-type">sourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680077289"><span class="hs-identifier hs-type">tyVars'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#EmptyConstraint"><span class="hs-identifier hs-type">EmptyConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#monotypeLoc"><span class="hs-identifier hs-type">monotypeLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680077302"><span class="hs-identifier hs-type">ctorType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680077302"><span class="hs-identifier hs-type">ctorType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680077298"><span class="hs-identifier hs-type">ctorName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680077300"><span class="hs-identifier hs-type">t'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>                </span><span class="annot"><span class="annottext">NonEmpty (Located DataCon, [KindedType])
-&gt; ((Located DataCon, [KindedType])
    -&gt; Eff r (Located DataCon, [(Monotype SourceRegion, ElaraKind)]))
-&gt; Eff r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Located DataCon, [KindedType])
NonEmpty
  (ASTLocate 'Kinded (Select &quot;ConstructorName&quot; 'Kinded),
   [Select &quot;ADTParam&quot; 'Kinded])
</span><a href="#local-6989586621680077288"><span class="hs-identifier hs-var">ctors</span></a></span><span> </span><span class="annot"><span class="annottext">(Located DataCon, [KindedType])
-&gt; Eff r (Located DataCon, [(Monotype SourceRegion, ElaraKind)])
</span><a href="#local-6989586621680077297"><span class="hs-identifier hs-var">inferCtor</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="annot"><a href="Elara.TypeInfer.html#runInferEffects"><span class="hs-identifier hs-type">runInferEffects</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680075471"><span class="annot"><a href="#local-6989586621680075471"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680075472"><span class="annot"><a href="#local-6989586621680075472"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680075470"><span class="annot"><a href="#local-6989586621680075470"><span class="hs-identifier hs-type">loc</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075470"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="Elara.Query.Effects.html#QueryEffects"><span class="hs-identifier hs-type">QueryEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075471"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680075471"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680075470"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="#local-6989586621680075470"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Monad.html#InferEffectsCons"><span class="hs-identifier hs-type">InferEffectsCons</span></a></span><span>
</span><span id="line-167"></span><span>            </span><span class="annot"><a href="#local-6989586621680075470"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-168"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075470"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>                </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Elara.Data.Kind.Infer.html#KindInferError"><span class="hs-identifier hs-type">KindInferError</span></a></span><span>
</span><span id="line-170"></span><span>                </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Convert.html#TypeConvertError"><span class="hs-identifier hs-type">TypeConvertError</span></a></span><span>
</span><span id="line-171"></span><span>                </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680075471"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-172"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><a href="#local-6989586621680075472"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680075471"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680075472"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075470"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span id="runInferEffects"><span class="annot"><span class="annottext">runInferEffects :: forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) a loc.
(Pretty loc, QueryEffects r, Rock Query :&gt; r, Eq loc,
 loc ~ SourceRegion) =&gt;
Eff
  (InferEffectsCons
     loc
     (Error (UnifyError loc)
        : Error KindInferError : Error TypeConvertError : r))
  a
-&gt; Eff r (a, Constraint loc)
</span><a href="Elara.TypeInfer.html#runInferEffects"><span class="hs-identifier hs-var hs-var">runInferEffects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#InferError"><span class="hs-identifier hs-type">InferError</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>        </span><span class="annot"><span class="annottext">(Eff (Error (InferError SourceRegion) : r) (a, Constraint loc)
 -&gt; Eff r (a, Constraint loc))
-&gt; (Eff
      (InferEffectsCons
         loc
         (Error (UnifyError loc)
            : Error KindInferError : Error TypeConvertError : r))
      a
    -&gt; Eff (Error (InferError SourceRegion) : r) (a, Constraint loc))
-&gt; Eff
     (InferEffectsCons
        loc
        (Error (UnifyError loc)
           : Error KindInferError : Error TypeConvertError : r))
     a
-&gt; Eff r (a, Constraint loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (Error (UnifyError SourceRegion)
      : Error (InferError SourceRegion) : r)
   (a, Constraint loc)
 -&gt; Eff (Error (InferError SourceRegion) : r) (a, Constraint loc))
-&gt; (Eff
      (InferEffectsCons
         loc
         (Error (UnifyError loc)
            : Error KindInferError : Error TypeConvertError : r))
      a
    -&gt; Eff
         (Error (UnifyError SourceRegion)
            : Error (InferError SourceRegion) : r)
         (a, Constraint loc))
-&gt; Eff
     (InferEffectsCons
        loc
        (Error (UnifyError loc)
           : Error KindInferError : Error TypeConvertError : r))
     a
-&gt; Eff (Error (InferError SourceRegion) : r) (a, Constraint loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Data.Kind.Infer.html#KindInferError"><span class="hs-identifier hs-type">KindInferError</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (Error KindInferError
      : Error (UnifyError SourceRegion) : Error (InferError SourceRegion)
      : r)
   (a, Constraint loc)
 -&gt; Eff
      (Error (UnifyError SourceRegion)
         : Error (InferError SourceRegion) : r)
      (a, Constraint loc))
-&gt; (Eff
      (InferEffectsCons
         loc
         (Error (UnifyError loc)
            : Error KindInferError : Error TypeConvertError : r))
      a
    -&gt; Eff
         (Error KindInferError
            : Error (UnifyError SourceRegion) : Error (InferError SourceRegion)
            : r)
         (a, Constraint loc))
-&gt; Eff
     (InferEffectsCons
        loc
        (Error (UnifyError loc)
           : Error KindInferError : Error TypeConvertError : r))
     a
-&gt; Eff
     (Error (UnifyError SourceRegion)
        : Error (InferError SourceRegion) : r)
     (a, Constraint loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.TypeInfer.Convert.html#TypeConvertError"><span class="hs-identifier hs-type">TypeConvertError</span></a></span><span>
</span><span id="line-181"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (Error TypeConvertError
      : Error KindInferError : Error (UnifyError SourceRegion)
      : Error (InferError SourceRegion) : r)
   (a, Constraint loc)
 -&gt; Eff
      (Error KindInferError
         : Error (UnifyError SourceRegion) : Error (InferError SourceRegion)
         : r)
      (a, Constraint loc))
-&gt; (Eff
      (InferEffectsCons
         loc
         (Error (UnifyError loc)
            : Error KindInferError : Error TypeConvertError : r))
      a
    -&gt; Eff
         (Error TypeConvertError
            : Error KindInferError : Error (UnifyError SourceRegion)
            : Error (InferError SourceRegion) : r)
         (a, Constraint loc))
-&gt; Eff
     (InferEffectsCons
        loc
        (Error (UnifyError loc)
           : Error KindInferError : Error TypeConvertError : r))
     a
-&gt; Eff
     (Error KindInferError
        : Error (UnifyError SourceRegion) : Error (InferError SourceRegion)
        : r)
     (a, Constraint loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypeEnvironment SourceRegion
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError SourceRegion) : Error (InferError SourceRegion)
        : r)
     (a, Constraint loc)
-&gt; Eff
     (Error TypeConvertError
        : Error KindInferError : Error (UnifyError SourceRegion)
        : Error (InferError SourceRegion) : r)
     (a, Constraint loc)
forall s (es :: [(* -&gt; *) -&gt; * -&gt; *]) a.
HasCallStack =&gt;
s -&gt; Eff (State s : es) a -&gt; Eff es a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="annot"><span class="annottext">TypeEnvironment SourceRegion
forall loc. TypeEnvironment loc
</span><a href="Elara.TypeInfer.Environment.html#emptyTypeEnvironment"><span class="hs-identifier hs-var">emptyTypeEnvironment</span></a></span><span>
</span><span id="line-182"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (State (TypeEnvironment SourceRegion)
      : Error TypeConvertError : Error KindInferError
      : Error (UnifyError SourceRegion) : Error (InferError SourceRegion)
      : r)
   (a, Constraint loc)
 -&gt; Eff
      (Error TypeConvertError
         : Error KindInferError : Error (UnifyError SourceRegion)
         : Error (InferError SourceRegion) : r)
      (a, Constraint loc))
-&gt; (Eff
      (InferEffectsCons
         loc
         (Error (UnifyError loc)
            : Error KindInferError : Error TypeConvertError : r))
      a
    -&gt; Eff
         (State (TypeEnvironment SourceRegion)
            : Error TypeConvertError : Error KindInferError
            : Error (UnifyError SourceRegion) : Error (InferError SourceRegion)
            : r)
         (a, Constraint loc))
-&gt; Eff
     (InferEffectsCons
        loc
        (Error (UnifyError loc)
           : Error KindInferError : Error TypeConvertError : r))
     a
-&gt; Eff
     (Error TypeConvertError
        : Error KindInferError : Error (UnifyError SourceRegion)
        : Error (InferError SourceRegion) : r)
     (a, Constraint loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LocalTypeEnvironment SourceRegion
-&gt; Eff
     (State (LocalTypeEnvironment SourceRegion)
        : State (TypeEnvironment SourceRegion) : Error TypeConvertError
        : Error KindInferError : Error (UnifyError SourceRegion)
        : Error (InferError SourceRegion) : r)
     (a, Constraint loc)
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError SourceRegion) : Error (InferError SourceRegion)
        : r)
     (a, Constraint loc)
forall s (es :: [(* -&gt; *) -&gt; * -&gt; *]) a.
HasCallStack =&gt;
s -&gt; Eff (State s : es) a -&gt; Eff es a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="annot"><span class="annottext">LocalTypeEnvironment SourceRegion
forall loc. LocalTypeEnvironment loc
</span><a href="Elara.TypeInfer.Environment.html#emptyLocalTypeEnvironment"><span class="hs-identifier hs-var">emptyLocalTypeEnvironment</span></a></span><span>
</span><span id="line-183"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (State (LocalTypeEnvironment SourceRegion)
      : State (TypeEnvironment SourceRegion) : Error TypeConvertError
      : Error KindInferError : Error (UnifyError SourceRegion)
      : Error (InferError SourceRegion) : r)
   (a, Constraint loc)
 -&gt; Eff
      (State (TypeEnvironment SourceRegion)
         : Error TypeConvertError : Error KindInferError
         : Error (UnifyError SourceRegion) : Error (InferError SourceRegion)
         : r)
      (a, Constraint loc))
-&gt; (Eff
      (InferEffectsCons
         loc
         (Error (UnifyError loc)
            : Error KindInferError : Error TypeConvertError : r))
      a
    -&gt; Eff
         (State (LocalTypeEnvironment SourceRegion)
            : State (TypeEnvironment SourceRegion) : Error TypeConvertError
            : Error KindInferError : Error (UnifyError SourceRegion)
            : Error (InferError SourceRegion) : r)
         (a, Constraint loc))
-&gt; Eff
     (InferEffectsCons
        loc
        (Error (UnifyError loc)
           : Error KindInferError : Error TypeConvertError : r))
     a
-&gt; Eff
     (State (TypeEnvironment SourceRegion)
        : Error TypeConvertError : Error KindInferError
        : Error (UnifyError SourceRegion) : Error (InferError SourceRegion)
        : r)
     (a, Constraint loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall w (es :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(HasCallStack, Monoid w) =&gt;
Eff (Writer w : es) a -&gt; Eff es (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (Writer (Constraint loc)
      : State (LocalTypeEnvironment SourceRegion)
      : State (TypeEnvironment SourceRegion) : Error TypeConvertError
      : Error KindInferError : Error (UnifyError SourceRegion)
      : Error (InferError SourceRegion) : r)
   a
 -&gt; Eff
      (State (LocalTypeEnvironment SourceRegion)
         : State (TypeEnvironment SourceRegion) : Error TypeConvertError
         : Error KindInferError : Error (UnifyError SourceRegion)
         : Error (InferError SourceRegion) : r)
      (a, Constraint loc))
-&gt; (Eff
      (InferEffectsCons
         loc
         (Error (UnifyError loc)
            : Error KindInferError : Error TypeConvertError : r))
      a
    -&gt; Eff
         (Writer (Constraint loc)
            : State (LocalTypeEnvironment SourceRegion)
            : State (TypeEnvironment SourceRegion) : Error TypeConvertError
            : Error KindInferError : Error (UnifyError SourceRegion)
            : Error (InferError SourceRegion) : r)
         a)
-&gt; Eff
     (InferEffectsCons
        loc
        (Error (UnifyError loc)
           : Error KindInferError : Error TypeConvertError : r))
     a
-&gt; Eff
     (State (LocalTypeEnvironment SourceRegion)
        : State (TypeEnvironment SourceRegion) : Error TypeConvertError
        : Error KindInferError : Error (UnifyError SourceRegion)
        : Error (InferError SourceRegion) : r)
     (a, Constraint loc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Eff
  (InferEffectsCons
     loc
     (Error (UnifyError loc)
        : Error KindInferError : Error TypeConvertError : r))
  a
-&gt; Eff
     (Writer (Constraint loc)
        : State (LocalTypeEnvironment SourceRegion)
        : State (TypeEnvironment SourceRegion) : Error TypeConvertError
        : Error KindInferError : Error (UnifyError SourceRegion)
        : Error (InferError SourceRegion) : r)
     a
forall (subEs :: [(* -&gt; *) -&gt; * -&gt; *]) (es :: [(* -&gt; *) -&gt; * -&gt; *])
       a.
Subset subEs es =&gt;
Eff subEs a -&gt; Eff es a
</span><span class="hs-identifier hs-var">inject</span></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span id="local-6989586621680075831"><span class="annot"><a href="Elara.TypeInfer.html#runInferSCCQuery"><span class="hs-identifier hs-type">runInferSCCQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="Elara.SCC.Type.html#SCCKey"><span class="hs-identifier hs-type">SCCKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621680075831"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-191"></span><span id="runInferSCCQuery"><span class="annot"><span class="annottext">runInferSCCQuery :: forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
SCCKey
-&gt; Eff
     (ConsQueryEffects (Rock Query : r))
     (Map (Qualified VarName) (Polytype SourceRegion))
</span><a href="Elara.TypeInfer.html#runInferSCCQuery"><span class="hs-identifier hs-var hs-var">runInferSCCQuery</span></a></span></span><span> </span><span id="local-6989586621680077572"><span class="annot"><span class="annottext">SCCKey
</span><a href="#local-6989586621680077572"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="annottext">(Map (Qualified VarName) (Polytype SourceRegion),
 Constraint SourceRegion)
-&gt; Map (Qualified VarName) (Polytype SourceRegion)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Map (Qualified VarName) (Polytype SourceRegion),
  Constraint SourceRegion)
 -&gt; Map (Qualified VarName) (Polytype SourceRegion))
-&gt; Eff
     (ConsQueryEffects (Rock Query : r))
     (Map (Qualified VarName) (Polytype SourceRegion),
      Constraint SourceRegion)
-&gt; Eff
     (ConsQueryEffects (Rock Query : r))
     (Map (Qualified VarName) (Polytype SourceRegion))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Eff
  (InferEffectsCons
     SourceRegion
     (Error (UnifyError SourceRegion)
        : Error KindInferError : Error TypeConvertError
        : ConsQueryEffects (Rock Query : r)))
  (Map (Qualified VarName) (Polytype SourceRegion))
-&gt; Eff
     (ConsQueryEffects (Rock Query : r))
     (Map (Qualified VarName) (Polytype SourceRegion),
      Constraint SourceRegion)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) a loc.
(Pretty loc, QueryEffects r, Rock Query :&gt; r, Eq loc,
 loc ~ SourceRegion) =&gt;
Eff
  (InferEffectsCons
     loc
     (Error (UnifyError loc)
        : Error KindInferError : Error TypeConvertError : r))
  a
-&gt; Eff r (a, Constraint loc)
</span><a href="Elara.TypeInfer.html#runInferEffects"><span class="hs-identifier hs-var">runInferEffects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InferState
-&gt; Eff
     (State InferState
        : InferEffectsCons
            SourceRegion
            (Error (UnifyError SourceRegion)
               : Error KindInferError : Error TypeConvertError
               : ConsQueryEffects (Rock Query : r)))
     (Map (Qualified VarName) (Polytype SourceRegion))
-&gt; Eff
     (InferEffectsCons
        SourceRegion
        (Error (UnifyError SourceRegion)
           : Error KindInferError : Error TypeConvertError
           : ConsQueryEffects (Rock Query : r)))
     (Map (Qualified VarName) (Polytype SourceRegion))
forall s (es :: [(* -&gt; *) -&gt; * -&gt; *]) a.
HasCallStack =&gt;
s -&gt; Eff (State s : es) a -&gt; Eff es a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="annot"><span class="annottext">InferState
</span><a href="Elara.Data.Kind.Infer.html#initialInferState"><span class="hs-identifier hs-var">initialInferState</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (State InferState
      : InferEffectsCons
          SourceRegion
          (Error (UnifyError SourceRegion)
             : Error KindInferError : Error TypeConvertError
             : ConsQueryEffects (Rock Query : r)))
   (Map (Qualified VarName) (Polytype SourceRegion))
 -&gt; Eff
      (InferEffectsCons
         SourceRegion
         (Error (UnifyError SourceRegion)
            : Error KindInferError : Error TypeConvertError
            : ConsQueryEffects (Rock Query : r)))
      (Map (Qualified VarName) (Polytype SourceRegion)))
-&gt; Eff
     (State InferState
        : InferEffectsCons
            SourceRegion
            (Error (UnifyError SourceRegion)
               : Error KindInferError : Error TypeConvertError
               : ConsQueryEffects (Rock Query : r)))
     (Map (Qualified VarName) (Polytype SourceRegion))
-&gt; Eff
     (InferEffectsCons
        SourceRegion
        (Error (UnifyError SourceRegion)
           : Error KindInferError : Error TypeConvertError
           : ConsQueryEffects (Rock Query : r)))
     (Map (Qualified VarName) (Polytype SourceRegion))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SCC (Qualified VarName)
-&gt; Eff
     (State InferState
        : InferEffectsCons
            SourceRegion
            (Error (UnifyError SourceRegion)
               : Error KindInferError : Error TypeConvertError
               : ConsQueryEffects (Rock Query : r)))
     (Map (Qualified VarName) (Polytype SourceRegion))
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(DiagnosticWriter (Doc AnsiStyle) :&gt; r, Rock Query :&gt; r,
 Error (InferError SourceRegion) :&gt; r,
 Error (UnifyError SourceRegion) :&gt; r,
 Error SomeReportableError :&gt; r,
 State (TypeEnvironment SourceRegion) :&gt; r,
 State (LocalTypeEnvironment SourceRegion) :&gt; r,
 StructuredDebug :&gt; r, FileSystem :&gt; r, UniqueGen :&gt; r,
 Memoise :&gt; r, Concurrent :&gt; r) =&gt;
SCC (Qualified VarName)
-&gt; Eff r (Map (Qualified VarName) (Polytype SourceRegion))
</span><a href="Elara.TypeInfer.html#inferSCC"><span class="hs-identifier hs-var">inferSCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SCCKey -&gt; SCC (Qualified VarName)
</span><a href="Elara.SCC.Type.html#sccKeyToSCC"><span class="hs-identifier hs-var">sccKeyToSCC</span></a></span><span> </span><span class="annot"><span class="annottext">SCCKey
</span><a href="#local-6989586621680077572"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span id="local-6989586621680077574"><span class="annot"><a href="Elara.TypeInfer.html#seedSCC"><span class="hs-identifier hs-type">seedSCC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SCC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680077574"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-195"></span><span id="seedSCC"><span class="annot"><span class="annottext">seedSCC :: SCC (Qualified VarName) -&gt; Eff r ()
</span><a href="Elara.TypeInfer.html#seedSCC"><span class="hs-identifier hs-var hs-var">seedSCC</span></a></span></span><span> </span><span id="local-6989586621680077638"><span class="annot"><span class="annottext">SCC (Qualified VarName)
</span><a href="#local-6989586621680077638"><span class="hs-identifier hs-var">scc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="annottext">SCC (Qualified VarName)
-&gt; (Qualified VarName -&gt; Eff r ()) -&gt; Eff r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">SCC (Qualified VarName)
</span><a href="#local-6989586621680077638"><span class="hs-identifier hs-var">scc</span></a></span><span> </span><span class="annot"><span class="annottext">((Qualified VarName -&gt; Eff r ()) -&gt; Eff r ())
-&gt; (Qualified VarName -&gt; Eff r ()) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680077639"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680077639"><span class="hs-identifier hs-var">component</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>        </span><span id="local-6989586621680077640"><span class="annot"><a href="#local-6989586621680077640"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Shunt.Error.html#ShuntError"><span class="hs-identifier hs-type">ShuntError</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff (Error ShuntError : r) (Declaration 'Shunted)
 -&gt; Eff r (Declaration 'Shunted))
-&gt; Eff (Error ShuntError : r) (Declaration 'Shunted)
-&gt; Eff r (Declaration 'Shunted)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Query
  (Rock Query : ConsQueryEffects '[Error ShuntError])
  (Declaration 'Shunted)
-&gt; Eff (Error ShuntError : r) (Declaration 'Shunted)
forall (xs :: [(* -&gt; *) -&gt; * -&gt; *]) (es :: [(* -&gt; *) -&gt; * -&gt; *])
       (f :: [(* -&gt; *) -&gt; * -&gt; *] -&gt; * -&gt; *) a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="annot"><span class="annottext">(Query
   (Rock Query : ConsQueryEffects '[Error ShuntError])
   (Declaration 'Shunted)
 -&gt; Eff (Error ShuntError : r) (Declaration 'Shunted))
-&gt; Query
     (Rock Query : ConsQueryEffects '[Error ShuntError])
     (Declaration 'Shunted)
-&gt; Eff (Error ShuntError : r) (Declaration 'Shunted)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Qualified Name
-&gt; Query
     (Rock Query : ConsQueryEffects '[Error ShuntError])
     (Declaration 'Shunted)
</span><a href="Elara.Query.html#ShuntedDeclarationByName"><span class="hs-identifier hs-var">Elara.Query.ShuntedDeclarationByName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; Name
</span><a href="Elara.AST.Name.html#NVarName"><span class="hs-identifier hs-var">NVarName</span></a></span><span> </span><span class="annot"><span class="annottext">(VarName -&gt; Name) -&gt; Qualified VarName -&gt; Qualified Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680077639"><span class="hs-identifier hs-var">component</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><a href="Elara.TypeInfer.html#seedDeclaration"><span class="hs-identifier hs-type">seedDeclaration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680077640"><span class="hs-identifier hs-type">decl</span></a></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span id="local-6989586621680077644"><span class="annot"><a href="Elara.TypeInfer.html#inferSCC"><span class="hs-identifier hs-type">inferSCC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SCC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680077644"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-201"></span><span id="inferSCC"><span class="annot"><span class="annottext">inferSCC :: SCC (Qualified VarName)
-&gt; Eff r (Map (Qualified VarName) (Polytype SourceRegion))
</span><a href="Elara.TypeInfer.html#inferSCC"><span class="hs-identifier hs-var hs-var">inferSCC</span></a></span></span><span> </span><span id="local-6989586621680077731"><span class="annot"><span class="annottext">SCC (Qualified VarName)
</span><a href="#local-6989586621680077731"><span class="hs-identifier hs-var">scc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621680077732"><span class="annot"><a href="#local-6989586621680077732"><span class="hs-identifier hs-var">prettyState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnvironment SourceRegion -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeEnvironment SourceRegion -&gt; Doc AnsiStyle)
-&gt; Eff r (TypeEnvironment SourceRegion) -&gt; Eff r (Doc AnsiStyle)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall s (es :: [(* -&gt; *) -&gt; * -&gt; *]).
(HasCallStack, State s :&gt; es) =&gt;
Eff es s
</span><span class="hs-identifier hs-var">get</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TypeEnvironment"><span class="hs-identifier hs-type">TypeEnvironment</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Seeding SCC complete. Environment:\n&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680077732"><span class="hs-identifier hs-type">prettyState</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621680077734"><span class="annot"><a href="#local-6989586621680077734"><span class="hs-identifier hs-var">inferred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">for</span></span><span> </span><span class="annot"><a href="#local-6989586621680077731"><span class="hs-identifier hs-type">scc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680077736"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680077736"><span class="hs-identifier hs-var">component</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>        </span><span id="local-6989586621680077737"><span class="annot"><a href="#local-6989586621680077737"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Shunt.Error.html#ShuntError"><span class="hs-identifier hs-type">ShuntError</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff (Error ShuntError : r) (Declaration 'Shunted)
 -&gt; Eff r (Declaration 'Shunted))
-&gt; Eff (Error ShuntError : r) (Declaration 'Shunted)
-&gt; Eff r (Declaration 'Shunted)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Query
  (Rock Query : ConsQueryEffects '[Error ShuntError])
  (Declaration 'Shunted)
-&gt; Eff (Error ShuntError : r) (Declaration 'Shunted)
forall (xs :: [(* -&gt; *) -&gt; * -&gt; *]) (es :: [(* -&gt; *) -&gt; * -&gt; *])
       (f :: [(* -&gt; *) -&gt; * -&gt; *] -&gt; * -&gt; *) a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="annot"><span class="annottext">(Query
   (Rock Query : ConsQueryEffects '[Error ShuntError])
   (Declaration 'Shunted)
 -&gt; Eff (Error ShuntError : r) (Declaration 'Shunted))
-&gt; Query
     (Rock Query : ConsQueryEffects '[Error ShuntError])
     (Declaration 'Shunted)
-&gt; Eff (Error ShuntError : r) (Declaration 'Shunted)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Qualified Name
-&gt; Query
     (Rock Query : ConsQueryEffects '[Error ShuntError])
     (Declaration 'Shunted)
</span><a href="Elara.Query.html#ShuntedDeclarationByName"><span class="hs-identifier hs-var">Elara.Query.ShuntedDeclarationByName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; Name
</span><a href="Elara.AST.Name.html#NVarName"><span class="hs-identifier hs-var">NVarName</span></a></span><span> </span><span class="annot"><span class="annottext">(VarName -&gt; Name) -&gt; Qualified VarName -&gt; Qualified Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680077736"><span class="hs-identifier hs-var">component</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>        </span><span id="local-6989586621680077738"><span class="annot"><a href="#local-6989586621680077738"><span class="hs-identifier hs-var">inferred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.html#inferDeclarationScheme"><span class="hs-identifier hs-type">inferDeclarationScheme</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680077737"><span class="hs-identifier hs-type">decl</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680077736"><span class="hs-identifier hs-type">component</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680077738"><span class="hs-identifier hs-type">inferred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromList</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">toList</span></span><span> </span><span class="annot"><a href="#local-6989586621680077734"><span class="hs-identifier hs-type">inferred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span id="local-6989586621680075852"><span class="annot"><a href="Elara.TypeInfer.html#runTypeCheckedExprQuery"><span class="hs-identifier hs-type">runTypeCheckedExprQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Query</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621680075852"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span></span><span>
</span><span id="line-212"></span><span id="runTypeCheckedExprQuery"><span class="annot"><span class="annottext">runTypeCheckedExprQuery :: forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
Qualified VarName
-&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr
</span><a href="Elara.TypeInfer.html#runTypeCheckedExprQuery"><span class="hs-identifier hs-var hs-var">runTypeCheckedExprQuery</span></a></span></span><span> </span><span id="local-6989586621680078208"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680078208"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr
-&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(StructuredDebug :&gt; r, Pretty a) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier hs-var">debugWithResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;runTypeCheckedExprQuery: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680078208"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff (ConsQueryEffects (Rock Query : r)) TypedExpr
 -&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr)
-&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr
-&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621680078209"><span class="annot"><a href="#local-6989586621680078209"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) (Module 'Typed)
-&gt; Eff (ConsQueryEffects (Rock Query : r)) (Module 'Typed)
forall (xs :: [(* -&gt; *) -&gt; * -&gt; *]) (es :: [(* -&gt; *) -&gt; * -&gt; *])
       (f :: [(* -&gt; *) -&gt; * -&gt; *] -&gt; * -&gt; *) a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="annot"><span class="annottext">(Query (Rock Query : ConsQueryEffects '[]) (Module 'Typed)
 -&gt; Eff (ConsQueryEffects (Rock Query : r)) (Module 'Typed))
-&gt; Query (Rock Query : ConsQueryEffects '[]) (Module 'Typed)
-&gt; Eff (ConsQueryEffects (Rock Query : r)) (Module 'Typed)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
-&gt; Query (Rock Query : ConsQueryEffects '[]) (Module 'Typed)
</span><a href="Elara.Query.html#TypeCheckedModule"><span class="hs-identifier hs-var">TypeCheckedModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified VarName -&gt; ModuleName
forall name. Qualified name -&gt; ModuleName
</span><a href="Elara.AST.Name.html#qualifier"><span class="hs-identifier hs-var">qualifier</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680078208"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680078211"><span class="annot"><a href="#local-6989586621680078211"><span class="hs-identifier hs-var hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module 'Typed
</span><a href="#local-6989586621680078209"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module 'Typed
-&gt; Optic' A_Lens '[] (Module 'Typed) [Declaration 'Typed]
-&gt; [Declaration 'Typed]
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Iso
  (Module 'Typed)
  (Module 'Typed)
  (Located (Module' 'Typed))
  (Located (Module' 'Typed))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Iso
  (Module 'Typed)
  (Module 'Typed)
  (Located (Module' 'Typed))
  (Located (Module' 'Typed))
-&gt; Optic
     A_Lens
     '[]
     (Located (Module' 'Typed))
     (Located (Module' 'Typed))
     (Module' 'Typed)
     (Module' 'Typed)
-&gt; Optic
     A_Lens
     '[]
     (Module 'Typed)
     (Module 'Typed)
     (Module' 'Typed)
     (Module' 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Module' 'Typed))
  (Located (Module' 'Typed))
  (Module' 'Typed)
  (Module' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Module 'Typed)
  (Module 'Typed)
  (Module' 'Typed)
  (Module' 'Typed)
-&gt; Optic
     A_Lens
     '[]
     (Module' 'Typed)
     (Module' 'Typed)
     [Declaration 'Typed]
     [Declaration 'Typed]
-&gt; Optic' A_Lens '[] (Module 'Typed) [Declaration 'Typed]
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;declarations&quot;</span></span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Declarations in module:&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078211"><span class="hs-identifier hs-type">decls</span></a></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">find</span></span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Declaration"><span class="hs-identifier hs-type">Declaration</span></a></span><span> </span><span id="local-6989586621680078214"><span class="annot"><span class="annottext">ASTLocate 'Typed (Declaration' 'Typed)
</span><a href="#local-6989586621680078214"><span class="hs-identifier hs-var">ld</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located (Declaration' 'Typed)
ASTLocate 'Typed (Declaration' 'Typed)
</span><a href="#local-6989586621680078214"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Declaration' 'Typed)
-&gt; Optic'
     A_Lens
     '[]
     (Located (Declaration' 'Typed))
     (DeclarationBody' 'Typed)
-&gt; DeclarationBody' 'Typed
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Lens
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
  (Declaration' 'Typed)
  (Declaration' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Lens
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
  (Declaration' 'Typed)
  (Declaration' 'Typed)
-&gt; Optic
     A_Lens
     '[]
     (Declaration' 'Typed)
     (Declaration' 'Typed)
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
-&gt; Optic
     A_Lens
     '[]
     (Located (Declaration' 'Typed))
     (Located (Declaration' 'Typed))
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
  (DeclarationBody 'Typed)
  (DeclarationBody 'Typed)
-&gt; Optic
     An_Iso
     '[]
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
-&gt; Optic
     A_Lens
     '[]
     (Located (Declaration' 'Typed))
     (Located (Declaration' 'Typed))
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  '[]
  (DeclarationBody 'Typed)
  (DeclarationBody 'Typed)
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
-&gt; Optic
     A_Lens
     '[]
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
     (DeclarationBody' 'Typed)
     (DeclarationBody' 'Typed)
-&gt; Optic'
     A_Lens
     '[]
     (Located (Declaration' 'Typed))
     (DeclarationBody' 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
  (DeclarationBody' 'Typed)
  (DeclarationBody' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DeclarationBody' 'Typed
-&gt; Optic'
     An_AffineTraversal
     '[]
     (DeclarationBody' 'Typed)
     (Qualified VarName)
-&gt; Maybe (Qualified VarName)
forall k s (is :: IxList) a.
Is k An_AffineFold =&gt;
s -&gt; Optic' k is s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">forall (ctor :: Symbol) s a.
AsConstructor' ctor s a =&gt;
Prism s s a a
</span><span class="hs-identifier hs-var">_Ctor'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;Value&quot;</span></span><span> </span><span class="annot"><span class="annottext">Prism
  (DeclarationBody' 'Typed)
  (DeclarationBody' 'Typed)
  (Located (Qualified VarName), TypedExpr, NoFieldValue,
   Type SourceRegion, ValueDeclAnnotations 'Typed)
  (Located (Qualified VarName), TypedExpr, NoFieldValue,
   Type SourceRegion, ValueDeclAnnotations 'Typed)
-&gt; Optic
     A_Lens
     '[]
     (Located (Qualified VarName), TypedExpr, NoFieldValue,
      Type SourceRegion, ValueDeclAnnotations 'Typed)
     (Located (Qualified VarName), TypedExpr, NoFieldValue,
      Type SourceRegion, ValueDeclAnnotations 'Typed)
     (Located (Qualified VarName))
     (Located (Qualified VarName))
-&gt; Optic
     An_AffineTraversal
     '[]
     (DeclarationBody' 'Typed)
     (DeclarationBody' 'Typed)
     (Located (Qualified VarName))
     (Located (Qualified VarName))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Qualified VarName), TypedExpr, NoFieldValue,
   Type SourceRegion, ValueDeclAnnotations 'Typed)
  (Located (Qualified VarName), TypedExpr, NoFieldValue,
   Type SourceRegion, ValueDeclAnnotations 'Typed)
  (Located (Qualified VarName))
  (Located (Qualified VarName))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_AffineTraversal
  '[]
  (DeclarationBody' 'Typed)
  (DeclarationBody' 'Typed)
  (Located (Qualified VarName))
  (Located (Qualified VarName))
-&gt; Optic
     A_Lens
     '[]
     (Located (Qualified VarName))
     (Located (Qualified VarName))
     (Qualified VarName)
     (Qualified VarName)
-&gt; Optic'
     An_AffineTraversal
     '[]
     (DeclarationBody' 'Typed)
     (Qualified VarName)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Qualified VarName))
  (Located (Qualified VarName))
  (Qualified VarName)
  (Qualified VarName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Qualified VarName) -&gt; Maybe (Qualified VarName) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; Maybe (Qualified VarName)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680078208"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><a href="#local-6989586621680078211"><span class="hs-identifier hs-type">decls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-219"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Declaration"><span class="hs-identifier hs-type">Declaration</span></a></span><span> </span><span id="local-6989586621680078217"><span class="annot"><span class="annottext">ASTLocate 'Typed (Declaration' 'Typed)
</span><a href="#local-6989586621680078217"><span class="hs-identifier hs-var">ld</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Located (Declaration' 'Typed)
ASTLocate 'Typed (Declaration' 'Typed)
</span><a href="#local-6989586621680078217"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Declaration' 'Typed)
-&gt; Optic'
     A_Lens
     '[]
     (Located (Declaration' 'Typed))
     (DeclarationBody' 'Typed)
-&gt; DeclarationBody' 'Typed
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Lens
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
  (Declaration' 'Typed)
  (Declaration' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Lens
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
  (Declaration' 'Typed)
  (Declaration' 'Typed)
-&gt; Optic
     A_Lens
     '[]
     (Declaration' 'Typed)
     (Declaration' 'Typed)
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
-&gt; Optic
     A_Lens
     '[]
     (Located (Declaration' 'Typed))
     (Located (Declaration' 'Typed))
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
  (DeclarationBody 'Typed)
  (DeclarationBody 'Typed)
-&gt; Optic
     An_Iso
     '[]
     (DeclarationBody 'Typed)
     (DeclarationBody 'Typed)
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
-&gt; Optic
     A_Lens
     '[]
     (Located (Declaration' 'Typed))
     (Located (Declaration' 'Typed))
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  '[]
  (DeclarationBody 'Typed)
  (DeclarationBody 'Typed)
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Typed))
  (Located (Declaration' 'Typed))
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
-&gt; Optic
     A_Lens
     '[]
     (Located (DeclarationBody' 'Typed))
     (Located (DeclarationBody' 'Typed))
     (DeclarationBody' 'Typed)
     (DeclarationBody' 'Typed)
-&gt; Optic'
     A_Lens
     '[]
     (Located (Declaration' 'Typed))
     (DeclarationBody' 'Typed)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (DeclarationBody' 'Typed))
  (Located (DeclarationBody' 'Typed))
  (DeclarationBody' 'Typed)
  (DeclarationBody' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-220"></span><span>            </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><span class="annottext">ASTLocate 'Typed (Select &quot;ValueName&quot; 'Typed)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680078219"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680078219"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">Select &quot;ValuePatterns&quot; 'Typed
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Select &quot;ValueType&quot; 'Typed
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ValueDeclAnnotations 'Typed
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypedExpr -&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr
forall a. a -&gt; Eff (ConsQueryEffects (Rock Query : r)) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680078219"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-221"></span><span>            </span><span class="annot"><span class="annottext">DeclarationBody' 'Typed
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;expected value declaration&quot;</span></span><span>
</span><span id="line-222"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Declaration 'Typed)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr)
-&gt; Text -&gt; Eff (ConsQueryEffects (Rock Query : r)) TypedExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;could not find declaration for &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680078208"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><a href="Elara.TypeInfer.html#inferModule"><span class="hs-identifier hs-type">inferModule</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680075476"><span class="annot"><a href="#local-6989586621680075476"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.html#InferPipelineEffects"><span class="hs-identifier hs-type">InferPipelineEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075476"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Monad.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075476"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><a href="Elara.AST.Module.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Elara.AST.Select.html#Shunted"><span class="hs-identifier hs-type">Shunted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680075476"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Module.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Elara.AST.Select.html#Typed"><span class="hs-identifier hs-type">Typed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span id="inferModule"><span class="annot"><span class="annottext">inferModule :: forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(InferPipelineEffects r, Infer SourceRegion r) =&gt;
Module 'Shunted -&gt; Eff r (Module 'Typed)
</span><a href="Elara.TypeInfer.html#inferModule"><span class="hs-identifier hs-var hs-var">inferModule</span></a></span></span><span> </span><span id="local-6989586621680078322"><span class="annot"><span class="annottext">Module 'Shunted
</span><a href="#local-6989586621680078322"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><span class="annottext">(Declaration 'Shunted -&gt; Eff r (Declaration 'Typed))
-&gt; Module 'Shunted -&gt; Eff r (Module 'Typed)
forall {a1} {astK} {a2} a4 (f :: * -&gt; *) (ast :: a1) s1 t
       {ast2 :: astK} {ast3 :: a2} {s}.
(CleanupLocated (ASTLocate' ast2 (ASTQual ast2 OpName))
 ~ CleanupLocated (ASTLocate' ast (ASTQual ast OpName)),
 CleanupLocated (ASTLocate' ast2 (ASTQual ast2 VarName))
 ~ CleanupLocated (ASTLocate' ast (ASTQual ast VarName)),
 CleanupLocated (ASTLocate' ast2 (ASTQual ast2 TypeName))
 ~ CleanupLocated (ASTLocate' ast (ASTQual ast TypeName)),
 CleanupLocated (ASTLocate' ast2 (Import' ast))
 ~ CleanupLocated (ASTLocate' ast (Import' ast)),
 CleanupLocated (ASTLocate' ast2 ModuleName)
 ~ CleanupLocated (ASTLocate' ast ModuleName),
 CleanupLocated (ASTLocate' ast3 (ASTQual ast3 VarName))
 ~ CleanupLocated (ASTLocate' ast (ASTQual ast VarName)),
 CleanupLocated (ASTLocate' ast3 (ASTQual ast3 OpName))
 ~ CleanupLocated (ASTLocate' ast (ASTQual ast OpName)),
 CleanupLocated (ASTLocate' ast3 (ASTQual ast3 TypeName))
 ~ CleanupLocated (ASTLocate' ast (ASTQual ast TypeName)),
 ErrorUnlessOnlyOne s1 (Rep s1), Generic s1, Generic t,
 GWrapped (Rep s1) (Rep t) (Located s) (Located (Module' ast)),
 UnifyHead s1 t, UnifyHead t s1, RUnlocate ast2, Monad f,
 HasField' &quot;name&quot; s (CleanupLocated (ASTLocate' ast ModuleName)),
 HasField' &quot;exposing&quot; s (Exposing ast3),
 HasField' &quot;declarations&quot; s [a4],
 HasField' &quot;imports&quot; s [Import ast2]) =&gt;
(a4 -&gt; f (Declaration ast)) -&gt; s1 -&gt; f t
</span><a href="Elara.AST.Module.html#traverseModule"><span class="hs-identifier hs-var">traverseModule</span></a></span><span> </span><span class="annot"><span class="annottext">Declaration 'Shunted -&gt; Eff r (Declaration 'Typed)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(HasCallStack, InferPipelineEffects r, Infer SourceRegion r) =&gt;
Declaration 'Shunted -&gt; Eff r (Declaration 'Typed)
</span><a href="Elara.TypeInfer.html#inferDeclaration"><span class="hs-identifier hs-var">inferDeclaration</span></a></span><span> </span><span class="annot"><span class="annottext">Module 'Shunted
</span><a href="#local-6989586621680078322"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><span class="hs-comment">-- | Add's a declaration's name and expected type to the type environment</span></span><span>
</span><span id="line-233"></span><span id="local-6989586621680078325"><span class="annot"><a href="Elara.TypeInfer.html#seedDeclaration"><span class="hs-identifier hs-type">seedDeclaration</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedDeclaration"><span class="hs-identifier hs-type">ShuntedDeclaration</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680078325"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-236"></span><span id="seedDeclaration"><span class="annot"><span class="annottext">seedDeclaration :: Declaration 'Shunted -&gt; Eff r ()
</span><a href="Elara.TypeInfer.html#seedDeclaration"><span class="hs-identifier hs-var hs-var">seedDeclaration</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Declaration"><span class="hs-identifier hs-type">Declaration</span></a></span><span> </span><span id="local-6989586621680078441"><span class="annot"><span class="annottext">ASTLocate 'Shunted (Declaration' 'Shunted)
</span><a href="#local-6989586621680078441"><span class="hs-identifier hs-var">ld</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
  (Declaration' 'Shunted)
  (Declaration' 'Shunted)
-&gt; Located (Declaration' 'Shunted)
-&gt; (Declaration' 'Shunted -&gt; Eff r ())
-&gt; Eff r ()
forall k (f :: * -&gt; *) (is :: IxList) s a r.
(Is k A_Fold, Applicative f) =&gt;
Optic' k is s a -&gt; s -&gt; (a -&gt; f r) -&gt; f ()
</span><span class="hs-identifier hs-var">forOf_</span></span><span>
</span><span id="line-238"></span><span>        </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
  (Declaration' 'Shunted)
  (Declaration' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">Located (Declaration' 'Shunted)
ASTLocate 'Shunted (Declaration' 'Shunted)
</span><a href="#local-6989586621680078441"><span class="hs-identifier hs-var">ld</span></a></span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><span class="annottext">((Declaration' 'Shunted -&gt; Eff r ()) -&gt; Eff r ())
-&gt; (Declaration' 'Shunted -&gt; Eff r ()) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680078442"><span class="annot"><span class="annottext">Declaration' 'Shunted
</span><a href="#local-6989586621680078442"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Declaration' 'Shunted
</span><a href="#local-6989586621680078442"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">Declaration' 'Shunted
-&gt; Optic'
     A_Lens '[] (Declaration' 'Shunted) (DeclarationBody' 'Shunted)
-&gt; DeclarationBody' 'Shunted
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Declaration' 'Shunted)
  (Declaration' 'Shunted)
  (DeclarationBody 'Shunted)
  (DeclarationBody 'Shunted)
-&gt; Optic
     An_Iso
     '[]
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  '[]
  (DeclarationBody 'Shunted)
  (DeclarationBody 'Shunted)
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Declaration' 'Shunted)
  (Declaration' 'Shunted)
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
     (DeclarationBody' 'Shunted)
     (DeclarationBody' 'Shunted)
-&gt; Optic'
     A_Lens '[] (Declaration' 'Shunted) (DeclarationBody' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
  (DeclarationBody' 'Shunted)
  (DeclarationBody' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-241"></span><span>            </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621680078443"><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted))
</span><a href="#local-6989586621680078443"><span class="hs-identifier hs-var">valueName</span></a></span></span><span> </span><span class="annot"><span class="annottext">Expr 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NoFieldValue
Select &quot;ValuePatterns&quot; 'Shunted
</span><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier hs-var">NoFieldValue</span></a></span><span> </span><span id="local-6989586621680078445"><span class="annot"><span class="annottext">Select &quot;ValueType&quot; 'Shunted
</span><a href="#local-6989586621680078445"><span class="hs-identifier hs-var">valueType</span></a></span></span><span> </span><span class="annot"><span class="annottext">ValueDeclAnnotations 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r () -&gt; Eff r ()
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;seedDeclaration: Value &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted))
-&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted))
</span><a href="#local-6989586621680078443"><span class="hs-identifier hs-var">valueName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r () -&gt; Eff r ()) -&gt; Eff r () -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-242"></span><span>                </span><span id="local-6989586621680078446"><span class="annot"><a href="#local-6989586621680078446"><span class="hs-identifier hs-var">expectedType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ShuntedType -&gt; Eff r (Type SourceRegion))
-&gt; Maybe ShuntedType -&gt; Eff r (Maybe (Type SourceRegion))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Maybe a -&gt; f (Maybe b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShuntedType -&gt; Eff r KindedType
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
KindInfer r =&gt;
ShuntedType -&gt; Eff r KindedType
</span><a href="Elara.Data.Kind.Infer.html#inferTypeKind"><span class="hs-identifier hs-var">inferTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">(ShuntedType -&gt; Eff r KindedType)
-&gt; (KindedType -&gt; Eff r (Type SourceRegion))
-&gt; ShuntedType
-&gt; Eff r (Type SourceRegion)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">KindedType -&gt; Eff r (Type SourceRegion)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(Error TypeConvertError :&gt; r) =&gt;
KindedType -&gt; Eff r (Type SourceRegion)
</span><a href="Elara.TypeInfer.Convert.html#astTypeToGeneralisedInferType"><span class="hs-identifier hs-var">astTypeToGeneralisedInferType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ShuntedType
Select &quot;ValueType&quot; 'Shunted
</span><a href="#local-6989586621680078445"><span class="hs-identifier hs-var">valueType</span></a></span><span>
</span><span id="line-243"></span><span>                </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Expected type for &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078443"><span class="hs-identifier hs-type">valueName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078446"><span class="hs-identifier hs-type">expectedType</span></a></span><span>
</span><span id="line-244"></span><span>                </span><span id="local-6989586621680078448"><span class="annot"><a href="#local-6989586621680078448"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680078446"><span class="hs-identifier hs-type">expectedType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-245"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680078449"><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680078449"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type SourceRegion -&gt; Eff r (Type SourceRegion)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680078449"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-246"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (Type SourceRegion)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Type SourceRegion
forall loc. Monotype loc -&gt; Type loc
</span><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-var">Lifted</span></a></span><span> </span><span class="annot"><span class="annottext">(Monotype SourceRegion -&gt; Type SourceRegion)
-&gt; (UniqueTyVar -&gt; Monotype SourceRegion)
-&gt; UniqueTyVar
-&gt; Type SourceRegion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted))
</span><a href="#local-6989586621680078443"><span class="hs-identifier hs-var">valueName</span></a></span><span> </span><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted))
-&gt; Optic'
     A_Lens
     '[]
     (CleanupLocated
        (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted)))
     SourceRegion
-&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  A_Lens
  '[]
  (CleanupLocated
     (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted)))
  SourceRegion
forall a. HasSourceRegion a =&gt; Lens' a SourceRegion
</span><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-var">sourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeVariable -&gt; Monotype SourceRegion)
-&gt; (UniqueTyVar -&gt; TypeVariable)
-&gt; UniqueTyVar
-&gt; Monotype SourceRegion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-var">UnificationVar</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; Type SourceRegion)
-&gt; Eff r UniqueTyVar -&gt; Eff r (Type SourceRegion)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Eff r UniqueTyVar
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(UniqueGen :&gt; r) =&gt;
Eff r UniqueTyVar
</span><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier hs-var">makeUniqueTyVar</span></a></span><span>
</span><span id="line-247"></span><span>                </span><span class="hs-comment">-- When we have an expected type (e.g., from a user annotation), skolemise</span><span>
</span><span id="line-248"></span><span>                </span><span class="hs-comment">-- its quantified variables so they cannot unify with concrete types.</span><span>
</span><span id="line-249"></span><span>                </span><span id="local-6989586621680078451"><span class="annot"><a href="#local-6989586621680078451"><span class="hs-identifier hs-var">expectedAsMono</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.html#skolemise"><span class="hs-identifier hs-type">skolemise</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078448"><span class="hs-identifier hs-type">expected</span></a></span><span>
</span><span id="line-250"></span><span>                </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Skolemised expected type of&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078443"><span class="hs-identifier hs-type">valueName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078451"><span class="hs-identifier hs-type">expectedAsMono</span></a></span><span>
</span><span id="line-251"></span><span>                </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#addType%27"><span class="hs-identifier hs-type">addType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TermVarKey"><span class="hs-identifier hs-type">TermVarKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680078443"><span class="hs-identifier hs-type">valueName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-type">unlocated</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680078448"><span class="hs-identifier hs-type">expected</span></a></span><span>
</span><span id="line-252"></span><span>            </span><span class="annot"><span class="annottext">DeclarationBody' 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Eff r ()
forall (f :: * -&gt; *). Applicative f =&gt; f ()
</span><span class="hs-identifier hs-var">pass</span></span><span> </span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span id="local-6989586621680078453"><span class="annot"><a href="Elara.TypeInfer.html#inferDeclarationScheme"><span class="hs-identifier hs-type">inferDeclarationScheme</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedDeclaration"><span class="hs-identifier hs-type">ShuntedDeclaration</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680078453"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-255"></span><span id="inferDeclarationScheme"><span class="annot"><span class="annottext">inferDeclarationScheme :: Declaration 'Shunted -&gt; Eff r (Polytype SourceRegion)
</span><a href="Elara.TypeInfer.html#inferDeclarationScheme"><span class="hs-identifier hs-var hs-var">inferDeclarationScheme</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic'
  A_Lens '[] (Declaration 'Shunted) (DeclarationBody' 'Shunted)
-&gt; Declaration 'Shunted -&gt; DeclarationBody' 'Shunted
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic
  An_Iso
  '[]
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  '[]
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (Declaration' 'Shunted))
     (Located (Declaration' 'Shunted))
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     (Declaration 'Shunted)
     (Declaration 'Shunted)
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
  (Declaration' 'Shunted)
  (Declaration' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (Declaration' 'Shunted)
  (Declaration' 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     (Declaration 'Shunted)
     (Declaration 'Shunted)
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (DeclarationBody 'Shunted)
  (DeclarationBody 'Shunted)
-&gt; Optic
     An_Iso
     '[]
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Declaration 'Shunted)
     (Declaration 'Shunted)
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  '[]
  (DeclarationBody 'Shunted)
  (DeclarationBody 'Shunted)
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
     (DeclarationBody' 'Shunted)
     (DeclarationBody' 'Shunted)
-&gt; Optic'
     A_Lens '[] (Declaration 'Shunted) (DeclarationBody' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
  (DeclarationBody' 'Shunted)
  (DeclarationBody' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621680078585"><span class="annot"><span class="annottext">DeclarationBody' 'Shunted
</span><a href="#local-6989586621680078585"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DeclarationBody' 'Shunted
</span><a href="#local-6989586621680078585"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621680078586"><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted))
</span><a href="#local-6989586621680078586"><span class="hs-identifier hs-var">valueName</span></a></span></span><span> </span><span id="local-6989586621680078587"><span class="annot"><span class="annottext">Expr 'Shunted
</span><a href="#local-6989586621680078587"><span class="hs-identifier hs-var">valueExpr</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoFieldValue
Select &quot;ValuePatterns&quot; 'Shunted
</span><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier hs-var">NoFieldValue</span></a></span><span> </span><span class="annot"><span class="annottext">Select &quot;ValueType&quot; 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ValueDeclAnnotations 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (Polytype SourceRegion) -&gt; Eff r (Polytype SourceRegion)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;inferDeclarationScheme: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Located (Qualified VarName) -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Qualified VarName)
CleanupLocated (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted))
</span><a href="#local-6989586621680078586"><span class="hs-identifier hs-var">valueName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (Polytype SourceRegion) -&gt; Eff r (Polytype SourceRegion))
-&gt; Eff r (Polytype SourceRegion) -&gt; Eff r (Polytype SourceRegion)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-257"></span><span>        </span><span id="local-6989586621680078588"><span class="annot"><a href="#local-6989586621680078588"><span class="hs-identifier hs-var">expectedType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnvKey SourceRegion -&gt; Eff r (Type SourceRegion)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]) loc.
(QueryEffects r, loc ~ SourceRegion, Rock Query :&gt; r,
 State (TypeEnvironment loc) :&gt; r) =&gt;
TypeEnvKey loc -&gt; Eff r (Type loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified VarName -&gt; TypeEnvKey SourceRegion
forall {k} (loc :: k). Qualified VarName -&gt; TypeEnvKey loc
</span><a href="Elara.TypeInfer.Environment.html#TermVarKey"><span class="hs-identifier hs-var">TermVarKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located (Qualified VarName)
CleanupLocated (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted))
</span><a href="#local-6989586621680078586"><span class="hs-identifier hs-var">valueName</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Qualified VarName)
-&gt; Optic
     A_Lens
     '[]
     (Located (Qualified VarName))
     (Located (Qualified VarName))
     (Qualified VarName)
     (Qualified VarName)
-&gt; Qualified VarName
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Qualified VarName))
  (Located (Qualified VarName))
  (Qualified VarName)
  (Qualified VarName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680078589"><span class="annot"><a href="#local-6989586621680078589"><span class="hs-identifier hs-var">polytype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.html#inferValue"><span class="hs-identifier hs-type">inferValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680078586"><span class="hs-identifier hs-type">valueName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-type">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680078587"><span class="hs-identifier hs-type">valueExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621680078588"><span class="hs-identifier hs-type">expectedType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#addType%27"><span class="hs-identifier hs-type">addType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TermVarKey"><span class="hs-identifier hs-type">TermVarKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680078586"><span class="hs-identifier hs-type">valueName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-type">unlocated</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078589"><span class="hs-identifier hs-type">polytype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Inferred type for &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078586"><span class="hs-identifier hs-type">valueName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078589"><span class="hs-identifier hs-type">polytype</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680078589"><span class="hs-identifier hs-type">polytype</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="annottext">DeclarationBody' 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r (Polytype SourceRegion)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;only value declarations are supported currently&quot;</span></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="annot"><a href="Elara.TypeInfer.html#inferDeclaration"><span class="hs-identifier hs-type">inferDeclaration</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680075985"><span class="annot"><a href="#local-6989586621680075985"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.html#InferPipelineEffects"><span class="hs-identifier hs-type">InferPipelineEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075985"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Monad.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680075985"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedDeclaration"><span class="hs-identifier hs-type">ShuntedDeclaration</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680075985"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedDeclaration"><span class="hs-identifier hs-type">TypedDeclaration</span></a></span><span>
</span><span id="line-269"></span><span id="inferDeclaration"><span class="annot"><span class="annottext">inferDeclaration :: forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(HasCallStack, InferPipelineEffects r, Infer SourceRegion r) =&gt;
Declaration 'Shunted -&gt; Eff r (Declaration 'Typed)
</span><a href="Elara.TypeInfer.html#inferDeclaration"><span class="hs-identifier hs-var hs-var">inferDeclaration</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Declaration"><span class="hs-identifier hs-type">Declaration</span></a></span><span> </span><span id="local-6989586621680078648"><span class="annot"><span class="annottext">ASTLocate 'Shunted (Declaration' 'Shunted)
</span><a href="#local-6989586621680078648"><span class="hs-identifier hs-var">ld</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><span class="annottext">Located (Declaration' 'Typed) -&gt; Declaration 'Typed
ASTLocate 'Typed (Declaration' 'Typed) -&gt; Declaration 'Typed
forall {a} (ast :: a).
ASTLocate ast (Declaration' ast) -&gt; Declaration ast
</span><a href="Elara.AST.Generic.Types.html#Declaration"><span class="hs-identifier hs-var">Declaration</span></a></span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><span class="annottext">(Located (Declaration' 'Typed) -&gt; Declaration 'Typed)
-&gt; Eff r (Located (Declaration' 'Typed))
-&gt; Eff r (Declaration 'Typed)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Typed))
  (Declaration' 'Shunted)
  (Declaration' 'Typed)
-&gt; (Declaration' 'Shunted -&gt; Eff r (Declaration' 'Typed))
-&gt; Located (Declaration' 'Shunted)
-&gt; Eff r (Located (Declaration' 'Typed))
forall k (f :: * -&gt; *) (is :: IxList) s t a b.
(Is k A_Traversal, Applicative f) =&gt;
Optic k is s t a b -&gt; (a -&gt; f b) -&gt; s -&gt; f t
</span><span class="hs-identifier hs-var">traverseOf</span></span><span>
</span><span id="line-272"></span><span>            </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Typed))
  (Declaration' 'Shunted)
  (Declaration' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-273"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680078650"><span class="annot"><span class="annottext">Declaration' 'Shunted
</span><a href="#local-6989586621680078650"><span class="hs-identifier hs-var">d'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-274"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#DeclarationBody"><span class="hs-identifier hs-type">DeclarationBody</span></a></span><span> </span><span id="local-6989586621680078651"><span class="annot"><span class="annottext">ASTLocate 'Shunted (DeclarationBody' 'Shunted)
</span><a href="#local-6989586621680078651"><span class="hs-identifier hs-var hs-var">ldb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Declaration' 'Shunted
</span><a href="#local-6989586621680078650"><span class="hs-identifier hs-var">d'</span></a></span><span> </span><span class="annot"><span class="annottext">Declaration' 'Shunted
-&gt; Optic
     A_Lens
     '[]
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
-&gt; DeclarationBody 'Shunted
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span>
</span><span id="line-275"></span><span>                </span><span id="local-6989586621680078652"><span class="annot"><a href="#local-6989586621680078652"><span class="hs-identifier hs-var">db'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-276"></span><span>                    </span><span class="annot"><span class="annottext">Located (DeclarationBody' 'Typed) -&gt; DeclarationBody 'Typed
ASTLocate 'Typed (DeclarationBody' 'Typed)
-&gt; DeclarationBody 'Typed
forall a (ast :: a).
ASTLocate ast (DeclarationBody' ast) -&gt; DeclarationBody ast
</span><a href="Elara.AST.Generic.Types.html#DeclarationBody"><span class="hs-identifier hs-var">DeclarationBody</span></a></span><span>
</span><span id="line-277"></span><span>                        </span><span class="annot"><span class="annottext">(Located (DeclarationBody' 'Typed) -&gt; DeclarationBody 'Typed)
-&gt; Eff r (Located (DeclarationBody' 'Typed))
-&gt; Eff r (DeclarationBody 'Typed)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Typed))
  (DeclarationBody' 'Shunted)
  (DeclarationBody' 'Typed)
-&gt; (DeclarationBody' 'Shunted -&gt; Eff r (DeclarationBody' 'Typed))
-&gt; Located (DeclarationBody' 'Shunted)
-&gt; Eff r (Located (DeclarationBody' 'Typed))
forall k (f :: * -&gt; *) (is :: IxList) s t a b.
(Is k A_Traversal, Applicative f) =&gt;
Optic k is s t a b -&gt; (a -&gt; f b) -&gt; s -&gt; f t
</span><span class="hs-identifier hs-var">traverseOf</span></span><span>
</span><span id="line-278"></span><span>                            </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Typed))
  (DeclarationBody' 'Shunted)
  (DeclarationBody' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-279"></span><span>                            </span><span class="annot"><span class="annottext">HasCallStack =&gt;
DeclarationBody' 'Shunted -&gt; Eff r (DeclarationBody' 'Typed)
DeclarationBody' 'Shunted -&gt; Eff r (DeclarationBody' 'Typed)
</span><a href="#local-6989586621680078653"><span class="hs-identifier hs-var">inferDeclarationBody'</span></a></span><span>
</span><span id="line-280"></span><span>                            </span><span class="annot"><span class="annottext">Located (DeclarationBody' 'Shunted)
ASTLocate 'Shunted (DeclarationBody' 'Shunted)
</span><a href="#local-6989586621680078651"><span class="hs-identifier hs-var">ldb</span></a></span><span>
</span><span id="line-281"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Declaration%27"><span class="hs-identifier hs-type">Declaration'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680078650"><span class="hs-identifier hs-type">d'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;moduleName&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680078652"><span class="hs-identifier hs-type">db'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>            </span><span class="annot"><span class="annottext">Located (Declaration' 'Shunted)
ASTLocate 'Shunted (Declaration' 'Shunted)
</span><a href="#local-6989586621680078648"><span class="hs-identifier hs-var">ld</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><a href="#local-6989586621680078653"><span class="hs-identifier hs-type">inferDeclarationBody'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-286"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedDeclarationBody%27"><span class="hs-identifier hs-type">ShuntedDeclarationBody'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-288"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680075985"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedDeclarationBody%27"><span class="hs-identifier hs-type">TypedDeclarationBody'</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621680078653"><span class="annot"><span class="annottext">inferDeclarationBody' :: HasCallStack =&gt;
DeclarationBody' 'Shunted -&gt; Eff r (DeclarationBody' 'Typed)
</span><a href="#local-6989586621680078653"><span class="hs-identifier hs-var hs-var">inferDeclarationBody'</span></a></span></span><span> </span><span id="local-6989586621680078771"><span class="annot"><span class="annottext">DeclarationBody' 'Shunted
</span><a href="#local-6989586621680078771"><span class="hs-identifier hs-var">declBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DeclarationBody' 'Shunted
</span><a href="#local-6989586621680078771"><span class="hs-identifier hs-var">declBody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span id="local-6989586621680078772"><span class="annot"><span class="annottext">CleanupLocated (ASTLocate' 'Shunted (Select &quot;ValueName&quot; 'Shunted))
</span><a href="#local-6989586621680078772"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680078773"><span class="annot"><span class="annottext">Expr 'Shunted
</span><a href="#local-6989586621680078773"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoFieldValue
Select &quot;ValuePatterns&quot; 'Shunted
</span><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier hs-var">NoFieldValue</span></a></span><span> </span><span id="local-6989586621680078774"><span class="annot"><span class="annottext">Select &quot;ValueType&quot; 'Shunted
</span><a href="#local-6989586621680078774"><span class="hs-identifier hs-var">valueType</span></a></span></span><span> </span><span id="local-6989586621680078775"><span class="annot"><span class="annottext">ValueDeclAnnotations 'Shunted
</span><a href="#local-6989586621680078775"><span class="hs-identifier hs-var">annotations</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>            </span><span id="local-6989586621680078776"><span class="annot"><a href="#local-6989586621680078776"><span class="hs-identifier hs-var">expectedType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ShuntedType -&gt; Eff r (Type SourceRegion))
-&gt; Maybe ShuntedType -&gt; Eff r (Maybe (Type SourceRegion))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Maybe a -&gt; f (Maybe b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShuntedType -&gt; Eff r KindedType
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
KindInfer r =&gt;
ShuntedType -&gt; Eff r KindedType
</span><a href="Elara.Data.Kind.Infer.html#inferTypeKind"><span class="hs-identifier hs-var">inferTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">(ShuntedType -&gt; Eff r KindedType)
-&gt; (KindedType -&gt; Eff r (Type SourceRegion))
-&gt; ShuntedType
-&gt; Eff r (Type SourceRegion)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">KindedType -&gt; Eff r (Type SourceRegion)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(Error TypeConvertError :&gt; r) =&gt;
KindedType -&gt; Eff r (Type SourceRegion)
</span><a href="Elara.TypeInfer.Convert.html#astTypeToGeneralisedInferType"><span class="hs-identifier hs-var">astTypeToGeneralisedInferType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ShuntedType
Select &quot;ValueType&quot; 'Shunted
</span><a href="#local-6989586621680078774"><span class="hs-identifier hs-var">valueType</span></a></span><span>
</span><span id="line-292"></span><span>            </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Expected type for &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078772"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078776"><span class="hs-identifier hs-type">expectedType</span></a></span><span>
</span><span id="line-293"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680078777"><span class="annot"><a href="#local-6989586621680078777"><span class="hs-identifier hs-var">typedExpr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680078778"><span class="annot"><a href="#local-6989586621680078778"><span class="hs-identifier hs-var">polytype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.html#inferValue"><span class="hs-identifier hs-type">inferValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680078772"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-type">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680078773"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078776"><span class="hs-identifier hs-type">expectedType</span></a></span><span>
</span><span id="line-294"></span><span>            </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Inferred type for &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078772"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078778"><span class="hs-identifier hs-type">polytype</span></a></span><span>
</span><span id="line-295"></span><span>            </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#addType%27"><span class="hs-identifier hs-type">addType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TermVarKey"><span class="hs-identifier hs-type">TermVarKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680078772"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-type">unlocated</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078778"><span class="hs-identifier hs-type">polytype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078772"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078777"><span class="hs-identifier hs-type">typedExpr</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier hs-type">NoFieldValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078778"><span class="hs-identifier hs-type">polytype</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#coerceValueDeclAnnotations"><span class="hs-identifier hs-type">Generic.coerceValueDeclAnnotations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078775"><span class="hs-identifier hs-type">annotations</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>        </span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypeDeclaration"><span class="hs-identifier hs-type">TypeDeclaration</span></a></span><span> </span><span id="local-6989586621680078781"><span class="annot"><span class="annottext">ASTLocate 'Shunted (Select &quot;TypeName&quot; 'Shunted)
</span><a href="#local-6989586621680078781"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680078782"><span class="annot"><span class="annottext">[ASTLocate 'Shunted (Select &quot;TypeVar&quot; 'Shunted)]
</span><a href="#local-6989586621680078782"><span class="hs-identifier hs-var">tyVars</span></a></span></span><span> </span><span id="local-6989586621680078783"><span class="annot"><span class="annottext">ASTLocate 'Shunted ShuntedTypeDeclaration
</span><a href="#local-6989586621680078783"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621680078784"><span class="annot"><span class="annottext">TypeDeclAnnotations 'Shunted
</span><a href="#local-6989586621680078784"><span class="hs-identifier hs-var">anns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-298"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621680078785"><span class="annot"><a href="#local-6989586621680078785"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680078786"><span class="annot"><a href="#local-6989586621680078786"><span class="hs-identifier hs-var">decl'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; [Located TypeVar]
-&gt; ShuntedTypeDeclaration
-&gt; Eff r (ElaraKind, KindedTypeDeclaration)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(State InferState :&gt; r, Error KindInferError :&gt; r,
 Error SomeReportableError :&gt; r,
 DiagnosticWriter (Doc AnsiStyle) :&gt; r, Rock Query :&gt; r,
 UniqueGen :&gt; r, FileSystem :&gt; r, Memoise :&gt; r, Concurrent :&gt; r,
 StructuredDebug :&gt; r) =&gt;
DataCon
-&gt; [Located TypeVar]
-&gt; ShuntedTypeDeclaration
-&gt; Eff r (ElaraKind, KindedTypeDeclaration)
</span><a href="Elara.Data.Kind.Infer.html#inferKind"><span class="hs-identifier hs-var">inferKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located DataCon
ASTLocate 'Shunted (Select &quot;TypeName&quot; 'Shunted)
</span><a href="#local-6989586621680078781"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Located DataCon
-&gt; Optic' A_Lens '[] (Located DataCon) DataCon -&gt; DataCon
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located DataCon) DataCon
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Located TypeVar]
[ASTLocate 'Shunted (Select &quot;TypeVar&quot; 'Shunted)]
</span><a href="#local-6989586621680078782"><span class="hs-identifier hs-var">tyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located ShuntedTypeDeclaration
ASTLocate 'Shunted ShuntedTypeDeclaration
</span><a href="#local-6989586621680078783"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Located ShuntedTypeDeclaration
-&gt; Optic'
     A_Lens '[] (Located ShuntedTypeDeclaration) ShuntedTypeDeclaration
-&gt; ShuntedTypeDeclaration
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  A_Lens '[] (Located ShuntedTypeDeclaration) ShuntedTypeDeclaration
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680078786"><span class="hs-identifier hs-type">decl'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-300"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Alias"><span class="hs-identifier hs-type">Generic.Alias</span></a></span><span> </span><span id="local-6989586621680078787"><span class="annot"><span class="annottext">Select &quot;Alias&quot; 'Kinded
</span><a href="#local-6989586621680078787"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>                    </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">KindedType -&gt; Eff r (Monotype SourceRegion)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(Error TypeConvertError :&gt; r) =&gt;
KindedType -&gt; Eff r (Monotype SourceRegion)
</span><a href="Elara.TypeInfer.Convert.html#astTypeToInferType"><span class="hs-identifier hs-var">astTypeToInferType</span></a></span><span> </span><span class="annot"><span class="annottext">KindedType
Select &quot;Alias&quot; 'Kinded
</span><a href="#local-6989586621680078787"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-302"></span><span>                    </span><span class="hs-comment">-- addType' (TypeVarKey (name ^. unlocated)) t'</span><span>
</span><span id="line-303"></span><span>                    </span><span class="annot"><a href="TODO.html#todo"><span class="hs-identifier hs-type">todo</span></a></span><span>
</span><span id="line-304"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#ADT"><span class="hs-identifier hs-type">Generic.ADT</span></a></span><span> </span><span id="local-6989586621680078789"><span class="annot"><span class="annottext">NonEmpty
  (ASTLocate 'Kinded (Select &quot;ConstructorName&quot; 'Kinded),
   [Select &quot;ADTParam&quot; 'Kinded])
</span><a href="#local-6989586621680078789"><span class="hs-identifier hs-var">ctors</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-305"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680078790"><span class="annot"><span class="annottext">tyVars' :: [(Located TypeVar, UniqueTyVar)]
</span><a href="#local-6989586621680078790"><span class="hs-identifier hs-var hs-var hs-var">tyVars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Located TypeVar -&gt; UniqueTyVar)
-&gt; [Located TypeVar] -&gt; [(Located TypeVar, UniqueTyVar)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f (a, b)
</span><span class="hs-identifier hs-var">fmapToSnd</span></span><span> </span><span class="annot"><span class="annottext">Located TypeVar -&gt; UniqueTyVar
</span><a href="Elara.TypeInfer.html#createTypeVar"><span class="hs-identifier hs-var">createTypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Located TypeVar]
[ASTLocate 'Shunted (Select &quot;TypeVar&quot; 'Shunted)]
</span><a href="#local-6989586621680078782"><span class="hs-identifier hs-var">tyVars</span></a></span><span>
</span><span id="line-306"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680078791"><span class="annot"><span class="annottext">typeConstructorType :: Monotype SourceRegion
</span><a href="#local-6989586621680078791"><span class="hs-identifier hs-var hs-var hs-var">typeConstructorType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceRegion
-&gt; DataCon -&gt; [Monotype SourceRegion] -&gt; Monotype SourceRegion
forall loc. loc -&gt; DataCon -&gt; [Monotype loc] -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeConstructor"><span class="hs-identifier hs-var">TypeConstructor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located DataCon
ASTLocate 'Shunted (Select &quot;TypeName&quot; 'Shunted)
</span><a href="#local-6989586621680078781"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Located DataCon
-&gt; Optic' A_Lens '[] (Located DataCon) SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located DataCon) SourceRegion
forall a. HasSourceRegion a =&gt; Lens' a SourceRegion
</span><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-var">sourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located DataCon
ASTLocate 'Shunted (Select &quot;TypeName&quot; 'Shunted)
</span><a href="#local-6989586621680078781"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Located DataCon
-&gt; Optic' A_Lens '[] (Located DataCon) DataCon -&gt; DataCon
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located DataCon) DataCon
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Located TypeVar, UniqueTyVar) -&gt; Monotype SourceRegion)
-&gt; [(Located TypeVar, UniqueTyVar)] -&gt; [Monotype SourceRegion]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680078792"><span class="annot"><span class="annottext">Located TypeVar
</span><a href="#local-6989586621680078792"><span class="hs-identifier hs-var">tyVarLocation</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680078793"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680078793"><span class="hs-identifier hs-var">tyVar</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located TypeVar
</span><a href="#local-6989586621680078792"><span class="hs-identifier hs-var">tyVarLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Located TypeVar
-&gt; Optic' A_Lens '[] (Located TypeVar) SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located TypeVar) SourceRegion
forall a. HasSourceRegion a =&gt; Lens' a SourceRegion
</span><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-var">sourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeVariable -&gt; Monotype SourceRegion)
-&gt; TypeVariable -&gt; Monotype SourceRegion
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-var">UnificationVar</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680078793"><span class="hs-identifier hs-var">tyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Located TypeVar, UniqueTyVar)]
</span><a href="#local-6989586621680078790"><span class="hs-identifier hs-var">tyVars'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680078794"><span class="annot"><span class="annottext">inferCtor :: (Located DataCon, [KindedType])
-&gt; Eff r (Located DataCon, [(Monotype SourceRegion, ElaraKind)])
</span><a href="#local-6989586621680078794"><span class="hs-identifier hs-var hs-var hs-var">inferCtor</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680078795"><span class="annot"><span class="annottext">Located DataCon
</span><a href="#local-6989586621680078795"><span class="hs-identifier hs-var">ctorName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680078796"><span class="annot"><span class="annottext">[KindedType]
</span><a href="#local-6989586621680078796"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.AST.Kinded.html#KindedType"><span class="hs-identifier hs-type">KindedType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-309"></span><span>                            </span><span id="local-6989586621680078797"><span class="annot"><a href="#local-6989586621680078797"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(KindedType -&gt; Eff r (Monotype SourceRegion, ElaraKind))
-&gt; [KindedType] -&gt; Eff r [(Monotype SourceRegion, ElaraKind)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">KindedType -&gt; Eff r (Monotype SourceRegion, ElaraKind)
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(Error TypeConvertError :&gt; r) =&gt;
KindedType -&gt; Eff r (Monotype SourceRegion, ElaraKind)
</span><a href="Elara.TypeInfer.Convert.html#astTypeToInferTypeWithKind"><span class="hs-identifier hs-var">astTypeToInferTypeWithKind</span></a></span><span> </span><span class="annot"><span class="annottext">[KindedType]
</span><a href="#local-6989586621680078796"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-310"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680078798"><span class="annot"><a href="#local-6989586621680078798"><span class="hs-identifier hs-var hs-var">ctorType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-311"></span><span>                                    </span><span class="annot"><span class="annottext">((Monotype SourceRegion, ElaraKind)
 -&gt; Monotype SourceRegion -&gt; Monotype SourceRegion)
-&gt; Monotype SourceRegion
-&gt; [(Monotype SourceRegion, ElaraKind)]
-&gt; Monotype SourceRegion
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
forall loc. loc -&gt; Monotype loc -&gt; Monotype loc -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Function"><span class="hs-identifier hs-var">Function</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located DataCon
</span><a href="#local-6989586621680078795"><span class="hs-identifier hs-var">ctorName</span></a></span><span> </span><span class="annot"><span class="annottext">Located DataCon
-&gt; Optic' A_Lens '[] (Located DataCon) SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located DataCon) SourceRegion
forall a. HasSourceRegion a =&gt; Lens' a SourceRegion
</span><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-var">sourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Monotype SourceRegion
 -&gt; Monotype SourceRegion -&gt; Monotype SourceRegion)
-&gt; ((Monotype SourceRegion, ElaraKind) -&gt; Monotype SourceRegion)
-&gt; (Monotype SourceRegion, ElaraKind)
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Monotype SourceRegion, ElaraKind) -&gt; Monotype SourceRegion
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680078791"><span class="hs-identifier hs-var">typeConstructorType</span></a></span><span> </span><span class="annot"><span class="annottext">[(Monotype SourceRegion, ElaraKind)]
</span><a href="#local-6989586621680078797"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-312"></span><span>                            </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#addType%27"><span class="hs-identifier hs-type">addType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#DataConKey"><span class="hs-identifier hs-type">DataConKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680078795"><span class="hs-identifier hs-type">ctorName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-type">unlocated</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Forall"><span class="hs-identifier hs-type">Forall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680078795"><span class="hs-identifier hs-type">ctorName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#sourceRegion"><span class="hs-identifier hs-type">sourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680078790"><span class="hs-identifier hs-type">tyVars'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#EmptyConstraint"><span class="hs-identifier hs-type">EmptyConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#monotypeLoc"><span class="hs-identifier hs-type">monotypeLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078798"><span class="hs-identifier hs-type">ctorType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680078798"><span class="hs-identifier hs-type">ctorType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680078795"><span class="hs-identifier hs-type">ctorName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680078797"><span class="hs-identifier hs-type">t'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span>                    </span><span id="local-6989586621680078800"><span class="annot"><a href="#local-6989586621680078800"><span class="hs-identifier hs-var">ctors'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Located DataCon, [KindedType])
 -&gt; Eff r (Located DataCon, [(Monotype SourceRegion, ElaraKind)]))
-&gt; NonEmpty (Located DataCon, [KindedType])
-&gt; Eff
     r
     (NonEmpty (Located DataCon, [(Monotype SourceRegion, ElaraKind)]))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; NonEmpty a -&gt; f (NonEmpty b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">(Located DataCon, [KindedType])
-&gt; Eff r (Located DataCon, [(Monotype SourceRegion, ElaraKind)])
</span><a href="#local-6989586621680078794"><span class="hs-identifier hs-var">inferCtor</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Located DataCon, [KindedType])
NonEmpty
  (ASTLocate 'Kinded (Select &quot;ConstructorName&quot; 'Kinded),
   [Select &quot;ADTParam&quot; 'Kinded])
</span><a href="#local-6989586621680078789"><span class="hs-identifier hs-var">ctors</span></a></span><span>
</span><span id="line-317"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680078801"><span class="annot"><a href="#local-6989586621680078801"><span class="hs-identifier hs-var hs-var">ann'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>                            </span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypeDeclAnnotations"><span class="hs-identifier hs-type">Generic.TypeDeclAnnotations</span></a></span><span>
</span><span id="line-319"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">infixTypeDecl :: Maybe (InfixDeclaration 'Typed)
</span><a href="Elara.AST.Generic.Types.html#infixTypeDecl"><span class="hs-identifier hs-var">infixTypeDecl</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-320"></span><span>                                    </span><span class="annot"><span class="annottext">InfixDeclaration 'Shunted -&gt; InfixDeclaration 'Typed
forall {a1} {a2} (ast1 :: a1) (ast2 :: a2).
(CleanupLocated (ASTLocate' ast1 (Select &quot;AnyName&quot; ast1))
 ~ CleanupLocated (ASTLocate' ast2 (Select &quot;AnyName&quot; ast2)),
 CleanupLocated (ASTLocate' ast1 Int)
 ~ CleanupLocated (ASTLocate' ast2 Int),
 CleanupLocated (ASTLocate' ast1 AssociativityType)
 ~ CleanupLocated (ASTLocate' ast2 AssociativityType)) =&gt;
InfixDeclaration ast1 -&gt; InfixDeclaration ast2
</span><a href="Elara.AST.Generic.Types.html#coerceInfixDeclaration"><span class="hs-identifier hs-var">Generic.coerceInfixDeclaration</span></a></span><span>
</span><span id="line-321"></span><span>                                        </span><span class="annot"><span class="annottext">(InfixDeclaration 'Shunted -&gt; InfixDeclaration 'Typed)
-&gt; Maybe (InfixDeclaration 'Shunted)
-&gt; Maybe (InfixDeclaration 'Typed)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeDeclAnnotations 'Shunted
</span><a href="#local-6989586621680078784"><span class="hs-identifier hs-var">anns</span></a></span><span class="hs-operator">.</span><span class="hs-identifier">infixTypeDecl</span><span>
</span><span id="line-322"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">kindAnn :: Select &quot;KindAnnotation&quot; 'Typed
</span><a href="Elara.AST.Generic.Types.html#kindAnn"><span class="hs-identifier hs-var">kindAnn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ElaraKind
Select &quot;KindAnnotation&quot; 'Typed
</span><a href="#local-6989586621680078785"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-323"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-324"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-325"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypeDeclaration"><span class="hs-identifier hs-type">TypeDeclaration</span></a></span><span>
</span><span id="line-326"></span><span>                            </span><span class="annot"><a href="#local-6989586621680078781"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-327"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zipWith</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">(&lt;$)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">snd</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680078790"><span class="hs-identifier hs-type">tyVars'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680078782"><span class="hs-identifier hs-type">tyVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#ADT"><span class="hs-identifier hs-type">Generic.ADT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078800"><span class="hs-identifier hs-type">ctors'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$</span></span><span> </span><span class="annot"><a href="#local-6989586621680078783"><span class="hs-identifier hs-type">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>                            </span><span class="annot"><a href="#local-6989586621680078801"><span class="hs-identifier hs-type">ann'</span></a></span><span>
</span><span id="line-330"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="annot"><a href="Elara.TypeInfer.html#createTypeVar"><span class="hs-identifier hs-type">createTypeVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#LowerAlphaName"><span class="hs-identifier hs-type">LowerAlphaName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier hs-type">UniqueTyVar</span></a></span><span>
</span><span id="line-333"></span><span id="createTypeVar"><span class="annot"><span class="annottext">createTypeVar :: Located TypeVar -&gt; UniqueTyVar
</span><a href="Elara.TypeInfer.html#createTypeVar"><span class="hs-identifier hs-var hs-var">createTypeVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680078812"><span class="annot"><span class="annottext">TypeVar
</span><a href="#local-6989586621680078812"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LowerAlphaName -&gt; Maybe Text) -&gt; TypeVar -&gt; UniqueTyVar
forall a b. (a -&gt; b) -&gt; Unique a -&gt; Unique b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text)
-&gt; (LowerAlphaName -&gt; Text) -&gt; LowerAlphaName -&gt; Maybe Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">LowerAlphaName -&gt; Text
forall name. NameLike name =&gt; name -&gt; Text
</span><a href="Elara.AST.Name.html#nameText"><span class="hs-identifier hs-var">nameText</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeVar
</span><a href="#local-6989586621680078812"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="annot"><a href="Elara.TypeInfer.html#inferValue"><span class="hs-identifier hs-type">inferValue</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680078813"><span class="annot"><a href="#local-6989586621680078813"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680078813"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedExpr"><span class="hs-identifier hs-type">ShuntedExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680078813"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span id="inferValue"><span class="annot"><span class="annottext">inferValue :: Qualified VarName
-&gt; Expr 'Shunted
-&gt; Maybe (Type SourceRegion)
-&gt; Eff r (TypedExpr, Polytype SourceRegion)
</span><a href="Elara.TypeInfer.html#inferValue"><span class="hs-identifier hs-var hs-var">inferValue</span></a></span></span><span> </span><span id="local-6989586621680078963"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680078963"><span class="hs-identifier hs-var">valueName</span></a></span></span><span> </span><span id="local-6989586621680078964"><span class="annot"><span class="annottext">Expr 'Shunted
</span><a href="#local-6989586621680078964"><span class="hs-identifier hs-var">valueExpr</span></a></span></span><span> </span><span id="local-6989586621680078965"><span class="annot"><span class="annottext">Maybe (Type SourceRegion)
</span><a href="#local-6989586621680078965"><span class="hs-identifier hs-var">expectedType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">-- generate</span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680078966"><span class="annot"><span class="annottext">exprLoc :: SourceRegion
</span><a href="#local-6989586621680078966"><span class="hs-identifier hs-var hs-var hs-var">exprLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Expr 'Shunted
</span><a href="#local-6989586621680078964"><span class="hs-identifier hs-var">valueExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Expr 'Shunted
-&gt; Optic' A_Lens '[] (Expr 'Shunted) SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Expr 'Shunted) SourceRegion
forall {a} (ast :: a).
(ASTLocate' ast ~ Located) =&gt;
Lens' (Expr ast) SourceRegion
</span><a href="Elara.AST.Generic.Types.html#exprLocation"><span class="hs-identifier hs-var">Generic.exprLocation</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621680078968"><span class="annot"><a href="#local-6989586621680078968"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Type SourceRegion)
</span><a href="#local-6989586621680078965"><span class="hs-identifier hs-var">expectedType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-348"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680078969"><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680078969"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type SourceRegion -&gt; Eff r (Type SourceRegion)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680078969"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-349"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Type SourceRegion)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Type SourceRegion
forall loc. Monotype loc -&gt; Type loc
</span><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-var">Lifted</span></a></span><span> </span><span class="annot"><span class="annottext">(Monotype SourceRegion -&gt; Type SourceRegion)
-&gt; (UniqueTyVar -&gt; Monotype SourceRegion)
-&gt; UniqueTyVar
-&gt; Type SourceRegion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680078966"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeVariable -&gt; Monotype SourceRegion)
-&gt; (UniqueTyVar -&gt; TypeVariable)
-&gt; UniqueTyVar
-&gt; Monotype SourceRegion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-var">UnificationVar</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; Type SourceRegion)
-&gt; Eff r UniqueTyVar -&gt; Eff r (Type SourceRegion)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Eff r UniqueTyVar
forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
(UniqueGen :&gt; r) =&gt;
Eff r UniqueTyVar
</span><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier hs-var">makeUniqueTyVar</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-comment">-- When we have an expected type (e.g., from a user annotation), skolemise</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-comment">-- its quantified variables so they cannot unify with concrete types.</span><span>
</span><span id="line-352"></span><span>    </span><span id="local-6989586621680078970"><span class="annot"><a href="#local-6989586621680078970"><span class="hs-identifier hs-var">expectedAsMono</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.html#skolemise"><span class="hs-identifier hs-type">skolemise</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078968"><span class="hs-identifier hs-type">expected</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#addType%27"><span class="hs-identifier hs-type">addType'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TermVarKey"><span class="hs-identifier hs-type">TermVarKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078963"><span class="hs-identifier hs-type">valueName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680078968"><span class="hs-identifier hs-type">expected</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680078971"><span class="annot"><a href="#local-6989586621680078971"><span class="hs-identifier hs-var">typedExpr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680078972"><span class="annot"><a href="#local-6989586621680078972"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680078973"><span class="annot"><a href="#local-6989586621680078973"><span class="hs-identifier hs-var">constraint</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">runWriter</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-type">generateConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078964"><span class="hs-identifier hs-type">valueExpr</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680078975"><span class="annot"><a href="#local-6989586621680078975"><span class="hs-identifier hs-var hs-var">constraint'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constraint SourceRegion
</span><a href="#local-6989586621680078973"><span class="hs-identifier hs-var">constraint</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint SourceRegion
-&gt; Constraint SourceRegion -&gt; Constraint SourceRegion
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Constraint SourceRegion
forall loc. loc -&gt; Monotype loc -&gt; Monotype loc -&gt; Constraint loc
</span><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-var">Equality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type SourceRegion -&gt; SourceRegion
forall loc. Type loc -&gt; loc
</span><a href="Elara.TypeInfer.Type.html#typeLoc"><span class="hs-identifier hs-var">typeLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Type SourceRegion
</span><a href="#local-6989586621680078968"><span class="hs-identifier hs-var">expected</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680078970"><span class="hs-identifier hs-var">expectedAsMono</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680078972"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680078977"><span class="annot"><a href="#local-6989586621680078977"><span class="hs-identifier hs-var hs-var">tch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Set UniqueTyVar
forall a. Fuv a =&gt; a -&gt; Set UniqueTyVar
</span><a href="Elara.TypeInfer.Ftv.html#fuv"><span class="hs-identifier hs-var">fuv</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680078972"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Set UniqueTyVar -&gt; Set UniqueTyVar -&gt; Set UniqueTyVar
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constraint SourceRegion -&gt; Set UniqueTyVar
forall a. Fuv a =&gt; a -&gt; Set UniqueTyVar
</span><a href="Elara.TypeInfer.Ftv.html#fuv"><span class="hs-identifier hs-var">fuv</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint SourceRegion
</span><a href="#local-6989586621680078975"><span class="hs-identifier hs-var">constraint'</span></a></span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Generated constraints: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078975"><span class="hs-identifier hs-type">constraint'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; for &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078963"><span class="hs-identifier hs-type">valueName</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Type: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078972"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680078979"><span class="annot"><a href="#local-6989586621680078979"><span class="hs-identifier hs-var">finalConstraint</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680078980"><span class="annot"><a href="#local-6989586621680078980"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#solveConstraint"><span class="hs-identifier hs-type">solveConstraint</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span> </span><span class="annot"><a href="#local-6989586621680078977"><span class="hs-identifier hs-type">tch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078975"><span class="hs-identifier hs-type">constraint'</span></a></span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680078979"><span class="hs-identifier hs-type">finalConstraint</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><a href="Elara.TypeInfer.Type.html#EmptyConstraint"><span class="hs-identifier hs-type">EmptyConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Eff r ()
forall (f :: * -&gt; *). Applicative f =&gt; f ()
</span><span class="hs-identifier hs-var">pass</span></span><span>
</span><span id="line-365"></span><span>        </span><span class="annot"><span class="annottext">Constraint SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnifyError SourceRegion -&gt; Eff r ()
forall e (es :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(UnifyError SourceRegion -&gt; Eff r ())
-&gt; UnifyError SourceRegion -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
-&gt; Constraint SourceRegion -&gt; UnifyError SourceRegion
forall loc. Qualified VarName -&gt; Constraint loc -&gt; UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#UnresolvedConstraint"><span class="hs-identifier hs-var">UnresolvedConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680078963"><span class="hs-identifier hs-var">valueName</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint SourceRegion
</span><a href="#local-6989586621680078979"><span class="hs-identifier hs-var">finalConstraint</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680078984"><span class="annot"><a href="#local-6989586621680078984"><span class="hs-identifier hs-var hs-var">newType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution SourceRegion
-&gt; Monotype SourceRegion -&gt; Monotype SourceRegion
forall (a :: * -&gt; *) loc.
(Substitutable a loc, Eq (a loc)) =&gt;
Substitution loc -&gt; a loc -&gt; a loc
</span><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-var">substituteAll</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution SourceRegion
</span><a href="#local-6989586621680078980"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680078972"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Substituted type: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078984"><span class="hs-identifier hs-type">newType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; from &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078972"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; with &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078980"><span class="hs-identifier hs-type">subst</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621680078986"><span class="annot"><a href="#local-6989586621680078986"><span class="hs-identifier hs-var">generalized</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Generalise.html#generalise"><span class="hs-identifier hs-type">generalise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Generalise.html#removeSkolems"><span class="hs-identifier hs-type">removeSkolems</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078984"><span class="hs-identifier hs-type">newType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Generalized type: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078986"><span class="hs-identifier hs-type">generalized</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; from &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078984"><span class="hs-identifier hs-type">newType</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.html#getExpr"><span class="hs-identifier hs-var">getExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-type">substituteAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078980"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.html#SubstitutableExpr"><span class="hs-identifier hs-type">SubstitutableExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680078971"><span class="hs-identifier hs-type">typedExpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680078986"><span class="hs-identifier hs-type">generalized</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="hs-comment">-- Replace all quantified variables in a type scheme with rigid skolem variables.</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- This prevents ill-typed programs from unifying annotated polymorphic variables</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- with concrete types during checking.</span><span>
</span><span id="line-380"></span><span class="annot"><a href="Elara.TypeInfer.html#skolemise"><span class="hs-identifier hs-type">skolemise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680075999"><span class="annot"><a href="#local-6989586621680075999"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680075999"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span id="skolemise"><span class="annot"><span class="annottext">skolemise :: forall (r :: [(* -&gt; *) -&gt; * -&gt; *]).
Type SourceRegion -&gt; Eff r (Monotype SourceRegion)
</span><a href="Elara.TypeInfer.html#skolemise"><span class="hs-identifier hs-var hs-var">skolemise</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-382"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-type">Lifted</span></a></span><span> </span><span id="local-6989586621680079000"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680079000"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Eff r (Monotype SourceRegion)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680079000"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Forall"><span class="hs-identifier hs-type">Forall</span></a></span><span> </span><span id="local-6989586621680079001"><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680079001"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680079002"><span class="annot"><span class="annottext">[UniqueTyVar]
</span><a href="#local-6989586621680079002"><span class="hs-identifier hs-var">tyVars</span></a></span></span><span> </span><span class="annot"><span class="annottext">Constraint SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680079003"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680079003"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-384"></span><span>        </span><span class="hs-comment">-- Build a substitution mapping each quantified variable &#945; to a rigid skolem #&#945;</span><span>
</span><span id="line-385"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680079004"><span class="annot"><span class="annottext">pairs :: [(UniqueTyVar, Monotype SourceRegion)]
</span><a href="#local-6989586621680079004"><span class="hs-identifier hs-var hs-var">pairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UniqueTyVar]
-&gt; [Monotype SourceRegion]
-&gt; [(UniqueTyVar, Monotype SourceRegion)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; UniqueTyVar) -&gt; [UniqueTyVar] -&gt; [UniqueTyVar]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic' A_Lens '[] UniqueTyVar UniqueTyVar
-&gt; UniqueTyVar -&gt; UniqueTyVar
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] UniqueTyVar UniqueTyVar
forall a s. HasType a s =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">typed</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UniqueTyVar]
</span><a href="#local-6989586621680079002"><span class="hs-identifier hs-var">tyVars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680079001"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeVariable -&gt; Monotype SourceRegion)
-&gt; (UniqueTyVar -&gt; TypeVariable)
-&gt; UniqueTyVar
-&gt; Monotype SourceRegion
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#SkolemVar"><span class="hs-identifier hs-var">SkolemVar</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; Monotype SourceRegion)
-&gt; [UniqueTyVar] -&gt; [Monotype SourceRegion]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[UniqueTyVar]
</span><a href="#local-6989586621680079002"><span class="hs-identifier hs-var">tyVars</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>        </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Eff r (Monotype SourceRegion)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Monotype SourceRegion -&gt; Eff r (Monotype SourceRegion))
-&gt; Monotype SourceRegion -&gt; Eff r (Monotype SourceRegion)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Monotype SourceRegion
 -&gt; (UniqueTyVar, Monotype SourceRegion) -&gt; Monotype SourceRegion)
-&gt; Monotype SourceRegion
-&gt; [(UniqueTyVar, Monotype SourceRegion)]
-&gt; Monotype SourceRegion
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680079008"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680079008"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680079009"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680079009"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680079010"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680079010"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
forall (a :: * -&gt; *) loc.
Substitutable a loc =&gt;
UniqueTyVar -&gt; Monotype loc -&gt; a loc -&gt; a loc
</span><a href="Elara.TypeInfer.Type.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680079009"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680079010"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680079008"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680079003"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[(UniqueTyVar, Monotype SourceRegion)]
</span><a href="#local-6989586621680079004"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="hs-keyword">newtype</span><span> </span><span id="SubstitutableExpr"><span class="annot"><a href="Elara.TypeInfer.html#SubstitutableExpr"><span class="hs-identifier hs-var">SubstitutableExpr</span></a></span></span><span> </span><span id="local-6989586621680076084"><span class="annot"><a href="#local-6989586621680076084"><span class="hs-identifier hs-type">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SubstitutableExpr"><span class="annot"><a href="Elara.TypeInfer.html#SubstitutableExpr"><span class="hs-identifier hs-var">SubstitutableExpr</span></a></span></span><span> </span><span class="hs-special">{</span><span id="getExpr"><span class="annot"><span class="annottext">forall {k} (loc :: k). SubstitutableExpr loc -&gt; TypedExpr
</span><a href="Elara.TypeInfer.html#getExpr"><span class="hs-identifier hs-var hs-var">getExpr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680079013"><span id="local-6989586621680079021"><span id="local-6989586621680079025"><span class="annot"><span class="annottext">Int -&gt; SubstitutableExpr loc -&gt; ShowS
[SubstitutableExpr loc] -&gt; ShowS
SubstitutableExpr loc -&gt; String
(Int -&gt; SubstitutableExpr loc -&gt; ShowS)
-&gt; (SubstitutableExpr loc -&gt; String)
-&gt; ([SubstitutableExpr loc] -&gt; ShowS)
-&gt; Show (SubstitutableExpr loc)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall k (loc :: k). Int -&gt; SubstitutableExpr loc -&gt; ShowS
forall k (loc :: k). [SubstitutableExpr loc] -&gt; ShowS
forall k (loc :: k). SubstitutableExpr loc -&gt; String
$cshowsPrec :: forall k (loc :: k). Int -&gt; SubstitutableExpr loc -&gt; ShowS
showsPrec :: Int -&gt; SubstitutableExpr loc -&gt; ShowS
$cshow :: forall k (loc :: k). SubstitutableExpr loc -&gt; String
show :: SubstitutableExpr loc -&gt; String
$cshowList :: forall k (loc :: k). [SubstitutableExpr loc] -&gt; ShowS
showList :: [SubstitutableExpr loc] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680079123"><span id="local-6989586621680079130"><span class="annot"><span class="annottext">SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
(SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool)
-&gt; (SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool)
-&gt; Eq (SubstitutableExpr loc)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall k (loc :: k).
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
$c== :: forall k (loc :: k).
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
== :: SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
$c/= :: forall k (loc :: k).
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
/= :: SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680079306"><span id="local-6989586621680079313"><span id="local-6989586621680079319"><span id="local-6989586621680079325"><span id="local-6989586621680079331"><span id="local-6989586621680079337"><span id="local-6989586621680079343"><span class="annot"><span class="annottext">Eq (SubstitutableExpr loc)
Eq (SubstitutableExpr loc) =&gt;
(SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Ordering)
-&gt; (SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool)
-&gt; (SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool)
-&gt; (SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool)
-&gt; (SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool)
-&gt; (SubstitutableExpr loc
    -&gt; SubstitutableExpr loc -&gt; SubstitutableExpr loc)
-&gt; (SubstitutableExpr loc
    -&gt; SubstitutableExpr loc -&gt; SubstitutableExpr loc)
-&gt; Ord (SubstitutableExpr loc)
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Ordering
SubstitutableExpr loc
-&gt; SubstitutableExpr loc -&gt; SubstitutableExpr loc
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall k (loc :: k). Eq (SubstitutableExpr loc)
forall k (loc :: k).
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
forall k (loc :: k).
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Ordering
forall k (loc :: k).
SubstitutableExpr loc
-&gt; SubstitutableExpr loc -&gt; SubstitutableExpr loc
$ccompare :: forall k (loc :: k).
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Ordering
compare :: SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Ordering
$c&lt; :: forall k (loc :: k).
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
&lt; :: SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
$c&lt;= :: forall k (loc :: k).
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
&lt;= :: SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
$c&gt; :: forall k (loc :: k).
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
&gt; :: SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
$c&gt;= :: forall k (loc :: k).
SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
&gt;= :: SubstitutableExpr loc -&gt; SubstitutableExpr loc -&gt; Bool
$cmax :: forall k (loc :: k).
SubstitutableExpr loc
-&gt; SubstitutableExpr loc -&gt; SubstitutableExpr loc
max :: SubstitutableExpr loc
-&gt; SubstitutableExpr loc -&gt; SubstitutableExpr loc
$cmin :: forall k (loc :: k).
SubstitutableExpr loc
-&gt; SubstitutableExpr loc -&gt; SubstitutableExpr loc
min :: SubstitutableExpr loc
-&gt; SubstitutableExpr loc -&gt; SubstitutableExpr loc
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680079894"><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitutable"><span class="hs-identifier hs-type">Substitutable</span></a></span><span> </span><span class="annot"><a href="Elara.TypeInfer.html#SubstitutableExpr"><span class="hs-identifier hs-type">SubstitutableExpr</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>    </span><span id="local-6989586621680080454"><span class="annot"><span class="annottext">substitute :: UniqueTyVar
-&gt; Monotype SourceRegion
-&gt; SubstitutableExpr SourceRegion
-&gt; SubstitutableExpr SourceRegion
</span><a href="Elara.TypeInfer.Type.html#substitute"><span class="hs-identifier hs-var hs-var hs-var">substitute</span></a></span></span><span> </span><span id="local-6989586621680080455"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680080455"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621680080456"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680080456"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.html#SubstitutableExpr"><span class="hs-identifier hs-type">SubstitutableExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Expr"><span class="hs-identifier hs-type">Generic.Expr</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680080458"><span class="annot"><span class="annottext">ASTLocate 'Typed (Expr' 'Typed)
</span><a href="#local-6989586621680080458"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680080459"><span class="annot"><span class="annottext">Select &quot;ExprType&quot; 'Typed
</span><a href="#local-6989586621680080459"><span class="hs-identifier hs-var">exprType</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-392"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680080460"><span class="annot"><span class="annottext">exprType' :: Monotype SourceRegion
</span><a href="#local-6989586621680080460"><span class="hs-identifier hs-var hs-var hs-var">exprType'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
forall (a :: * -&gt; *) loc.
Substitutable a loc =&gt;
UniqueTyVar -&gt; Monotype loc -&gt; a loc -&gt; a loc
</span><a href="Elara.TypeInfer.Type.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680080455"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680080456"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
Select &quot;ExprType&quot; 'Typed
</span><a href="#local-6989586621680080459"><span class="hs-identifier hs-var">exprType</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680080461"><span class="annot"><span class="annottext">e' :: Expr' 'Typed
</span><a href="#local-6989586621680080461"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-394"></span><span>                </span><span class="hs-comment">-- recursively apply subst to the children</span><span>
</span><span id="line-395"></span><span>                </span><span class="annot"><span class="annottext">Optic
  A_Traversal
  '[]
  (Expr' 'Typed)
  (Expr' 'Typed)
  (Monotype SourceRegion)
  (Monotype SourceRegion)
-&gt; (Monotype SourceRegion -&gt; Monotype SourceRegion)
-&gt; Expr' 'Typed
-&gt; Expr' 'Typed
forall k (is :: IxList) s t a b.
Is k A_Setter =&gt;
Optic k is s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span>
</span><span id="line-396"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a s. GPlate a s =&gt; Traversal' s a
</span><span class="hs-identifier hs-var">gplate</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr%27"><span class="hs-identifier hs-type">TypedExpr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqueTyVar
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
forall (a :: * -&gt; *) loc.
Substitutable a loc =&gt;
UniqueTyVar -&gt; Monotype loc -&gt; a loc -&gt; a loc
</span><a href="Elara.TypeInfer.Type.html#substitute"><span class="hs-identifier hs-var">substitute</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680080455"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680080456"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located (Expr' 'Typed)
ASTLocate 'Typed (Expr' 'Typed)
</span><a href="#local-6989586621680080458"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Expr' 'Typed)
-&gt; Optic' A_Lens '[] (Located (Expr' 'Typed)) (Expr' 'Typed)
-&gt; Expr' 'Typed
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located (Expr' 'Typed)) (Expr' 'Typed)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span>        </span><span class="annot"><span class="annottext">TypedExpr -&gt; SubstitutableExpr SourceRegion
forall {k} (loc :: k). TypedExpr -&gt; SubstitutableExpr loc
</span><a href="Elara.TypeInfer.html#SubstitutableExpr"><span class="hs-identifier hs-var">SubstitutableExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ASTLocate 'Typed (Expr' 'Typed), Select &quot;ExprType&quot; 'Typed)
-&gt; TypedExpr
forall a (ast :: a).
(ASTLocate ast (Expr' ast), Select &quot;ExprType&quot; ast) -&gt; Expr ast
</span><a href="Elara.AST.Generic.Types.html#Expr"><span class="hs-identifier hs-var">Generic.Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Expr' 'Typed
</span><a href="#local-6989586621680080461"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Expr' 'Typed -&gt; Located (Expr' 'Typed) -&gt; Located (Expr' 'Typed)
forall a b. a -&gt; Located b -&gt; Located a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Located (Expr' 'Typed)
ASTLocate 'Typed (Expr' 'Typed)
</span><a href="#local-6989586621680080458"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
Select &quot;ExprType&quot; 'Typed
</span><a href="#local-6989586621680080460"><span class="hs-identifier hs-var">exprType'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-401"></span></pre></body></html>