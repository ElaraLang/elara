<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ImplicitParams #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE NoPatternSynonyms #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html"><span class="hs-identifier">Elara.TypeInfer.ConstraintGeneration</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldrM</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Product</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">typed</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Sum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AsAny</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_As</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Wrapped</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_Unwrapped</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">member</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.Error.Static</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.Reader.Static</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Effectful.State.Extra.html"><span class="hs-identifier">Effectful.State.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Effectful.State.Extra.html#scoped"><span class="hs-identifier">scoped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.State.Static.Local</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful.Writer.Static.Local</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.html"><span class="hs-identifier">Elara.AST.Generic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Expr"><span class="hs-identifier">Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Expr%27"><span class="hs-identifier">Expr'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Common.html"><span class="hs-identifier">Elara.AST.Generic.Common</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier">NoFieldValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier">NoFieldValue</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html"><span class="hs-identifier">Elara.AST.Generic.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Pattern"><span class="hs-identifier">Pattern</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Pattern%27"><span class="hs-identifier">Pattern'</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypedLambdaParam"><span class="hs-identifier">TypedLambdaParam</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html"><span class="hs-identifier">Elara.AST.Generic.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Syntax</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Name.html"><span class="hs-identifier">Elara.AST.Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier">Qualified</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier">TypeName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier">VarName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Region.html"><span class="hs-identifier">Elara.AST.Region</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier">Located</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier">Located</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier">SourceRegion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#sourceRegionToDiagnosePosition"><span class="hs-identifier">sourceRegionToDiagnosePosition</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html"><span class="hs-identifier">Elara.AST.Shunted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedExpr"><span class="hs-identifier">ShuntedExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedExpr%27"><span class="hs-identifier">ShuntedExpr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedPattern"><span class="hs-identifier">ShuntedPattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedPattern%27"><span class="hs-identifier">ShuntedPattern'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.StripLocation.html"><span class="hs-identifier">Elara.AST.StripLocation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.StripLocation.html#StripLocation"><span class="hs-identifier">StripLocation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.StripLocation.html#stripLocation"><span class="hs-identifier">stripLocation</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html"><span class="hs-identifier">Elara.AST.Typed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier">TypedExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr%27"><span class="hs-identifier">TypedExpr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedPattern"><span class="hs-identifier">TypedPattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedPattern%27"><span class="hs-identifier">TypedPattern'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html"><span class="hs-identifier">Elara.AST.VarRef</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html"><span class="hs-identifier">Elara.Data.Pretty</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Error.html"><span class="hs-identifier">Elara.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Error.html#ReportableError"><span class="hs-identifier">ReportableError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Error.html#defaultReport"><span class="hs-identifier">defaultReport</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier">writeReport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Logging.html"><span class="hs-identifier">Elara.Logging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier">StructuredDebug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier">debug</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#debugWith"><span class="hs-identifier">debugWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier">debugWithResult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Prim.html"><span class="hs-identifier">Elara.Prim</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Prim.html#boolName"><span class="hs-identifier">boolName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Prim.html#mkPrimQual"><span class="hs-identifier">mkPrimQual</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Query.html"><span class="hs-identifier">Elara.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html"><span class="hs-identifier">Elara.Query.Effects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#QueryEffects"><span class="hs-identifier">QueryEffects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html"><span class="hs-identifier">Elara.TypeInfer.Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#LocalTypeEnvironment"><span class="hs-identifier">LocalTypeEnvironment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TypeEnvKey"><span class="hs-identifier">TypeEnvKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TypeEnvironment"><span class="hs-identifier">TypeEnvironment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#addLocalType"><span class="hs-identifier">addLocalType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#lookupLocalVar"><span class="hs-identifier">lookupLocalVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#lookupTypeMaybe"><span class="hs-identifier">lookupTypeMaybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#withLocalType"><span class="hs-identifier">withLocalType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Ftv.html"><span class="hs-identifier">Elara.TypeInfer.Ftv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Ftv.html#Ftv"><span class="hs-identifier">Ftv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Ftv.html#Fuv"><span class="hs-identifier">Fuv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Ftv.html#fuv"><span class="hs-identifier">fuv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Generalise.html"><span class="hs-identifier">Elara.TypeInfer.Generalise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Generalise.html#generalise"><span class="hs-identifier">generalise</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Monad.html"><span class="hs-identifier">Elara.TypeInfer.Monad</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html"><span class="hs-identifier">Elara.TypeInfer.Type</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier">Constraint</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#DataCon"><span class="hs-identifier">DataCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier">Monotype</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier">Polytype</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier">Scalar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitutable"><span class="hs-identifier">Substitutable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier">Substitution</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVariable"><span class="hs-identifier">TypeVariable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#SkolemVar"><span class="hs-identifier">SkolemVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier">UnificationVar</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#constraintLoc"><span class="hs-identifier">constraintLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#functionMonotypeArgs"><span class="hs-identifier">functionMonotypeArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#functionMonotypeResult"><span class="hs-identifier">functionMonotypeResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#monotypeLoc"><span class="hs-identifier">monotypeLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#reduce"><span class="hs-identifier">reduce</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#substitution"><span class="hs-identifier">substitution</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html"><span class="hs-identifier">Elara.TypeInfer.Unique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier">UniqueTyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier">makeUniqueTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Error.Diagnose</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Optics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">anyOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Optics.Fold</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">universeOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Rock.html"><span class="hs-identifier">Rock</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span id="local-6989586621680057426"><span id="local-6989586621680057427"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-type">generateConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Monad.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057426"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057427"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057426"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057427"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680057426"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedExpr"><span class="hs-identifier hs-type">ShuntedExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680057427"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057426"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-45"></span><span id="generateConstraints"><span class="annot"><span class="annottext">generateConstraints :: forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
ShuntedExpr -&gt; Eff r (TypedExpr, Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-var hs-var">generateConstraints</span></a></span></span><span> </span><span id="local-6989586621680058169"><span class="annot"><span class="annottext">expr' :: ShuntedExpr
</span><a href="#local-6989586621680058169"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span id="local-6989586621680058171"><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680058171"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Expr' 'Shunted
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Select (ASTType ForExpr) 'Shunted
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680058172"><span class="annot"><a href="#local-6989586621680058172"><span class="hs-identifier hs-var">typedExpr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680058173"><span class="annot"><a href="#local-6989586621680058173"><span class="hs-identifier hs-var">monotype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr -&gt; Eff r (TypedExpr', Monotype loc)
forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
ShuntedExpr -&gt; Eff r (TypedExpr', Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints%27"><span class="hs-identifier hs-var">generateConstraints'</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680058169"><span class="hs-identifier hs-var">expr'</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058171"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058172"><span class="hs-identifier hs-type">typedExpr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680058173"><span class="hs-identifier hs-type">monotype</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680058173"><span class="hs-identifier hs-type">monotype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span id="local-6989586621680057462"><span id="local-6989586621680057464"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#lookupType"><span class="hs-identifier hs-type">lookupType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#QueryEffects"><span class="hs-identifier hs-type">QueryEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057462"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680057464"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057462"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TypeEnvironment"><span class="hs-identifier hs-type">TypeEnvironment</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057464"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057462"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#TypeEnvKey"><span class="hs-identifier hs-type">TypeEnvKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057464"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680057462"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057464"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-54"></span><span id="lookupType"><span class="annot"><span class="annottext">lookupType :: forall (r :: [Effect]) loc.
(QueryEffects r, loc ~ SourceRegion, Rock Query :&gt; r,
 State (TypeEnvironment loc) :&gt; r) =&gt;
TypeEnvKey loc -&gt; Eff r (Type loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#lookupType"><span class="hs-identifier hs-var hs-var">lookupType</span></a></span></span><span> </span><span id="local-6989586621680058221"><span class="annot"><span class="annottext">TypeEnvKey loc
</span><a href="#local-6989586621680058221"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-comment">-- try the local environment first to avoid unnecessary queries / infinite loops</span><span>
</span><span id="line-56"></span><span>    </span><span id="local-6989586621680058222"><span class="annot"><a href="#local-6989586621680058222"><span class="hs-identifier hs-var">inEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnvKey loc -&gt; Eff r (Maybe (Type loc))
forall loc (r :: [Effect]).
(State (TypeEnvironment loc) :&gt; r) =&gt;
TypeEnvKey loc -&gt; Eff r (Maybe (Type loc))
</span><a href="Elara.TypeInfer.Environment.html#lookupTypeMaybe"><span class="hs-identifier hs-var">lookupTypeMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnvKey loc
</span><a href="#local-6989586621680058221"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621680058222"><span class="hs-identifier hs-type">inEnv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-58"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680058223"><span class="annot"><span class="annottext">Type loc
</span><a href="#local-6989586621680058223"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type loc -&gt; Eff r (Type loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Type loc
</span><a href="#local-6989586621680058223"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-59"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Type loc)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-60"></span><span>            </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r ()
forall (r :: [Effect]).
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r ()
</span><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Type not found in environment, querying: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeEnvKey loc -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnvKey loc
</span><a href="#local-6989586621680058221"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>            </span><span class="annot"><span class="annottext">Query (Rock Query : ConsQueryEffects '[]) (Type loc)
-&gt; Eff r (Type loc)
forall (xs :: [Effect]) (es :: [Effect]) (f :: [Effect] -&gt; * -&gt; *)
       a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeEnvKey loc
-&gt; Query (Rock Query : ConsQueryEffects '[]) (Type loc)
forall loc.
(loc ~ SourceRegion) =&gt;
TypeEnvKey loc
-&gt; Query (Rock Query : ConsQueryEffects '[]) (Type loc)
</span><a href="Elara.Query.html#TypeOf"><span class="hs-identifier hs-var">Elara.Query.TypeOf</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnvKey loc
</span><a href="#local-6989586621680058221"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span id="local-6989586621680057453"><span id="local-6989586621680057454"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints%27"><span class="hs-identifier hs-type">generateConstraints'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Monad.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057453"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057454"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057453"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057454"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680057453"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedExpr"><span class="hs-identifier hs-type">ShuntedExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680057454"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr%27"><span class="hs-identifier hs-type">TypedExpr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057453"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-64"></span><span id="generateConstraints%27"><span class="annot"><span class="annottext">generateConstraints' :: forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
ShuntedExpr -&gt; Eff r (TypedExpr', Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints%27"><span class="hs-identifier hs-var hs-var">generateConstraints'</span></a></span></span><span> </span><span id="local-6989586621680059442"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059442"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (TypedExpr', Monotype loc)
-&gt; Eff r (TypedExpr', Monotype loc)
forall (r :: [Effect]) a.
(StructuredDebug :&gt; r, Pretty a) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier hs-var">debugWithResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;generateConstraints: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059442"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (TypedExpr', Monotype loc)
 -&gt; Eff r (TypedExpr', Monotype loc))
-&gt; Eff r (TypedExpr', Monotype loc)
-&gt; Eff r (TypedExpr', Monotype loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-66"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059443"><span class="annot"><span class="annottext">exprLoc :: SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var hs-var">exprLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059442"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
-&gt; Optic' A_Lens '[] ShuntedExpr SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] ShuntedExpr SourceRegion
forall {a} (ast :: a).
(ASTLocate' ast ~ Located) =&gt;
Lens' (Expr ast) SourceRegion
</span><a href="Elara.AST.Generic.Types.html#exprLocation"><span class="hs-identifier hs-var">Syntax.exprLocation</span></a></span><span>
</span><span id="line-67"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059442"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
-&gt; Optic' A_Lens '[] ShuntedExpr (Expr' 'Shunted) -&gt; Expr' 'Shunted
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Iso
  ShuntedExpr
  ShuntedExpr
  (Located (Expr' 'Shunted), Maybe ShuntedType)
  (Located (Expr' 'Shunted), Maybe ShuntedType)
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Iso
  ShuntedExpr
  ShuntedExpr
  (Located (Expr' 'Shunted), Maybe ShuntedType)
  (Located (Expr' 'Shunted), Maybe ShuntedType)
-&gt; Optic
     A_Lens
     '[]
     (Located (Expr' 'Shunted), Maybe ShuntedType)
     (Located (Expr' 'Shunted), Maybe ShuntedType)
     (Located (Expr' 'Shunted))
     (Located (Expr' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     ShuntedExpr
     ShuntedExpr
     (Located (Expr' 'Shunted))
     (Located (Expr' 'Shunted))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Expr' 'Shunted), Maybe ShuntedType)
  (Located (Expr' 'Shunted), Maybe ShuntedType)
  (Located (Expr' 'Shunted))
  (Located (Expr' 'Shunted))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  ShuntedExpr
  ShuntedExpr
  (Located (Expr' 'Shunted))
  (Located (Expr' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (Expr' 'Shunted))
     (Located (Expr' 'Shunted))
     (Expr' 'Shunted)
     (Expr' 'Shunted)
-&gt; Optic' A_Lens '[] ShuntedExpr (Expr' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Expr' 'Shunted))
  (Located (Expr' 'Shunted))
  (Expr' 'Shunted)
  (Expr' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-68"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span id="local-6989586621680059449"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680059449"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TypedExpr', Monotype loc) -&gt; Eff r (TypedExpr', Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; TypedExpr'
forall a (ast :: a). Integer -&gt; Expr' ast
</span><a href="Elara.AST.Generic.Types.html#Int"><span class="hs-identifier hs-var">Int</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680059449"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc -&gt; Scalar -&gt; Monotype loc
forall loc. loc -&gt; Scalar -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarInt"><span class="hs-identifier hs-var">ScalarInt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Float"><span class="hs-identifier hs-type">Float</span></a></span><span> </span><span id="local-6989586621680059453"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680059453"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TypedExpr', Monotype loc) -&gt; Eff r (TypedExpr', Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; TypedExpr'
forall a (ast :: a). Double -&gt; Expr' ast
</span><a href="Elara.AST.Generic.Types.html#Float"><span class="hs-identifier hs-var">Float</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680059453"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc -&gt; Scalar -&gt; Monotype loc
forall loc. loc -&gt; Scalar -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarFloat"><span class="hs-identifier hs-var">ScalarFloat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621680059456"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680059456"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TypedExpr', Monotype loc) -&gt; Eff r (TypedExpr', Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; TypedExpr'
forall a (ast :: a). Text -&gt; Expr' ast
</span><a href="Elara.AST.Generic.Types.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680059456"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc -&gt; Scalar -&gt; Monotype loc
forall loc. loc -&gt; Scalar -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarString"><span class="hs-identifier hs-var">ScalarString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Char"><span class="hs-identifier hs-type">Char</span></a></span><span> </span><span id="local-6989586621680059459"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680059459"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TypedExpr', Monotype loc) -&gt; Eff r (TypedExpr', Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; TypedExpr'
forall a (ast :: a). Char -&gt; Expr' ast
</span><a href="Elara.AST.Generic.Types.html#Char"><span class="hs-identifier hs-var">Char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680059459"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc -&gt; Scalar -&gt; Monotype loc
forall loc. loc -&gt; Scalar -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarChar"><span class="hs-identifier hs-var">ScalarChar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>                </span><span class="annot"><span class="annottext">Expr' 'Shunted
</span><a href="Elara.AST.Generic.Types.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TypedExpr', Monotype loc) -&gt; Eff r (TypedExpr', Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedExpr'
forall a (ast :: a). Expr' ast
</span><a href="Elara.AST.Generic.Types.html#Unit"><span class="hs-identifier hs-var">Unit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc -&gt; Scalar -&gt; Monotype loc
forall loc. loc -&gt; Scalar -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarUnit"><span class="hs-identifier hs-var">ScalarUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Constructor"><span class="hs-identifier hs-type">Constructor</span></a></span><span> </span><span id="local-6989586621680059464"><span class="annot"><span class="annottext">ctorValue :: ASTLocate 'Shunted (Select ConRef 'Shunted)
</span><a href="#local-6989586621680059464"><span class="hs-identifier hs-var">ctorValue</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span id="local-6989586621680059465"><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059465"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680059466"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680059466"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-74"></span><span>                    </span><span class="hs-comment">-- (&#957;:&#8704;a.Q1 &#8658; &#964;1) &#8712; &#915;</span><span>
</span><span id="line-75"></span><span>                    </span><span id="local-6989586621680059467"><span class="annot"><a href="#local-6989586621680059467"><span class="hs-identifier hs-var">varType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnvKey loc -&gt; Eff r (Type loc)
forall (r :: [Effect]) loc.
(QueryEffects r, loc ~ SourceRegion, Rock Query :&gt; r,
 State (TypeEnvironment loc) :&gt; r) =&gt;
TypeEnvKey loc -&gt; Eff r (Type loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified TypeName -&gt; TypeEnvKey loc
forall {k} (loc :: k). Qualified TypeName -&gt; TypeEnvKey loc
</span><a href="Elara.TypeInfer.Environment.html#DataConKey"><span class="hs-identifier hs-var">DataConKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Qualified TypeName -&gt; TypeEnvKey loc)
-&gt; Qualified TypeName -&gt; TypeEnvKey loc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName -&gt; Qualified TypeName
forall a b. StripLocation a b =&gt; a -&gt; b
</span><a href="Elara.AST.StripLocation.html#stripLocation"><span class="hs-identifier hs-var">stripLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680059466"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059469"><span class="annot"><a href="#local-6989586621680059469"><span class="hs-identifier hs-var">instantiated</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059470"><span class="annot"><a href="#local-6989586621680059470"><span class="hs-identifier hs-var">typeApps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#instantiate"><span class="hs-identifier hs-type">instantiate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059467"><span class="hs-identifier hs-type">varType</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059472"><span class="annot"><a href="#local-6989586621680059472"><span class="hs-identifier hs-var hs-var">ctor</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASTLocate 'Typed (Select ConRef 'Typed) -&gt; TypedExpr'
forall a (ast :: a). ASTLocate ast (Select ConRef ast) -&gt; Expr' ast
</span><a href="Elara.AST.Generic.Types.html#Constructor"><span class="hs-identifier hs-var">Constructor</span></a></span><span> </span><span class="annot"><span class="annottext">ASTLocate 'Shunted (Select ConRef 'Shunted)
ASTLocate 'Typed (Select ConRef 'Typed)
</span><a href="#local-6989586621680059464"><span class="hs-identifier hs-var">ctorValue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059469"><span class="hs-identifier hs-var">instantiated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059473"><span class="annot"><a href="#local-6989586621680059473"><span class="hs-identifier hs-var hs-var">withApps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>                            </span><span class="annot"><span class="annottext">((TypedExpr', Monotype loc)
 -&gt; TypeVariable -&gt; (TypedExpr', Monotype loc))
-&gt; (TypedExpr', Monotype loc)
-&gt; [TypeVariable]
-&gt; (TypedExpr', Monotype loc)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span>
</span><span id="line-83"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680059475"><span class="annot"><span class="annottext">TypedExpr'
</span><a href="#local-6989586621680059475"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr%27"><span class="hs-identifier hs-type">TypedExpr'</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059476"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059476"><span class="hs-identifier hs-var">exprType</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680059477"><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680059477"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-84"></span><span>                                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059478"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680059478"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ASTLocate 'Typed TypedExpr', Select (ASTType ForExpr) 'Typed)
-&gt; TypedExpr
forall a (ast :: a).
(ASTLocate ast (Expr' ast), Select (ASTType ForExpr) ast)
-&gt; Expr ast
</span><a href="Elara.AST.Generic.Types.html#Expr"><span class="hs-identifier hs-var">Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; TypedExpr' -&gt; Located TypedExpr'
forall a. SourceRegion -&gt; a -&gt; Located a
</span><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-var">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059465"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr'
</span><a href="#local-6989586621680059475"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
Select (ASTType ForExpr) 'Typed
</span><a href="#local-6989586621680059476"><span class="hs-identifier hs-var">exprType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>                                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedExpr -&gt; Select TypeApplication 'Typed -&gt; TypedExpr'
forall a (ast :: a).
Expr ast -&gt; Select TypeApplication ast -&gt; Expr' ast
</span><a href="Elara.AST.Generic.Types.html#TypeApplication"><span class="hs-identifier hs-var">TypeApplication</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680059478"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680059477"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059476"><span class="hs-identifier hs-var">exprType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>                                </span><span class="annot"><span class="annottext">(TypedExpr', Monotype loc)
</span><a href="#local-6989586621680059472"><span class="hs-identifier hs-var">ctor</span></a></span><span>
</span><span id="line-88"></span><span>                                </span><span class="annot"><span class="annottext">[TypeVariable]
</span><a href="#local-6989586621680059470"><span class="hs-identifier hs-var">typeApps</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680059473"><span class="hs-identifier hs-type">withApps</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>                </span><span class="hs-comment">-- VAR</span><span>
</span><span id="line-93"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680059482"><span class="annot"><span class="annottext">v' :: ASTLocate 'Shunted (Select ASTVarRef 'Shunted)
</span><a href="#local-6989586621680059482"><span class="hs-identifier hs-var">v'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span id="local-6989586621680059483"><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059483"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680059484"><span class="annot"><span class="annottext">VarRef' LocatedVarRefKind VarName
</span><a href="#local-6989586621680059484"><span class="hs-identifier hs-var">varName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-94"></span><span>                    </span><span id="local-6989586621680059485"><span class="annot"><a href="#local-6989586621680059485"><span class="hs-identifier hs-var">varType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarRef' LocatedVarRefKind VarName
</span><a href="#local-6989586621680059484"><span class="hs-identifier hs-var">varName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-95"></span><span>                        </span><span class="annot"><a href="Elara.AST.VarRef.html#Local"><span class="hs-identifier hs-type">Local</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680059487"><span class="annot"><span class="annottext">Unique VarName
</span><a href="#local-6989586621680059487"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Unique VarName -&gt; Eff r (Type loc)
forall loc (r :: [Effect]).
(State (LocalTypeEnvironment loc) :&gt; r,
 Error (InferError loc) :&gt; r, Show loc) =&gt;
Unique VarName -&gt; Eff r (Type loc)
</span><a href="Elara.TypeInfer.Environment.html#lookupLocalVar"><span class="hs-identifier hs-var">lookupLocalVar</span></a></span><span> </span><span class="annot"><span class="annottext">Unique VarName
</span><a href="#local-6989586621680059487"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-96"></span><span>                        </span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680059489"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680059489"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeEnvKey loc -&gt; Eff r (Type loc)
forall (r :: [Effect]) loc.
(QueryEffects r, loc ~ SourceRegion, Rock Query :&gt; r,
 State (TypeEnvironment loc) :&gt; r) =&gt;
TypeEnvKey loc -&gt; Eff r (Type loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified VarName -&gt; TypeEnvKey loc
forall {k} (loc :: k). Qualified VarName -&gt; TypeEnvKey loc
</span><a href="Elara.TypeInfer.Environment.html#TermVarKey"><span class="hs-identifier hs-var">TermVarKey</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680059489"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>                    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;Var: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059484"><span class="hs-identifier hs-type">varName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; : &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059485"><span class="hs-identifier hs-type">varType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>                    </span><span class="hs-comment">-- (&#957;:&#8704;a.Q1 &#8658; &#964;1) &#8712; &#915;</span><span>
</span><span id="line-99"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059491"><span class="annot"><a href="#local-6989586621680059491"><span class="hs-identifier hs-var">instantiated</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059492"><span class="annot"><a href="#local-6989586621680059492"><span class="hs-identifier hs-var">tyApps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#instantiate"><span class="hs-identifier hs-type">instantiate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059485"><span class="hs-identifier hs-type">varType</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059493"><span class="annot"><a href="#local-6989586621680059493"><span class="hs-identifier hs-var hs-var">instantiated'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASTLocate 'Typed (Select ASTVarRef 'Typed) -&gt; TypedExpr'
forall a (ast :: a).
ASTLocate ast (Select ASTVarRef ast) -&gt; Expr' ast
</span><a href="Elara.AST.Generic.Types.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion
-&gt; (VarRef' LocatedVarRefKind VarName, Type loc)
-&gt; Located (VarRef' LocatedVarRefKind VarName, Type loc)
forall a. SourceRegion -&gt; a -&gt; Located a
</span><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-var">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059483"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarRef' LocatedVarRefKind VarName
</span><a href="#local-6989586621680059484"><span class="hs-identifier hs-var">varName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type loc
</span><a href="#local-6989586621680059485"><span class="hs-identifier hs-var">varType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059491"><span class="hs-identifier hs-var">instantiated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059494"><span class="annot"><a href="#local-6989586621680059494"><span class="hs-identifier hs-var hs-var">withApps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>                            </span><span class="annot"><span class="annottext">((TypedExpr', Monotype loc)
 -&gt; TypeVariable -&gt; (TypedExpr', Monotype loc))
-&gt; (TypedExpr', Monotype loc)
-&gt; [TypeVariable]
-&gt; (TypedExpr', Monotype loc)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span>
</span><span id="line-105"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680059495"><span class="annot"><span class="annottext">TypedExpr'
</span><a href="#local-6989586621680059495"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr%27"><span class="hs-identifier hs-type">TypedExpr'</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059496"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059496"><span class="hs-identifier hs-var">exprType</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680059497"><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680059497"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>                                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059498"><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680059498"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Typed.html#TypedExpr"><span class="hs-identifier hs-type">TypedExpr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ASTLocate 'Typed TypedExpr', Select (ASTType ForExpr) 'Typed)
-&gt; TypedExpr
forall a (ast :: a).
(ASTLocate ast (Expr' ast), Select (ASTType ForExpr) ast)
-&gt; Expr ast
</span><a href="Elara.AST.Generic.Types.html#Expr"><span class="hs-identifier hs-var">Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; TypedExpr' -&gt; Located TypedExpr'
forall a. SourceRegion -&gt; a -&gt; Located a
</span><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-var">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059483"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr'
</span><a href="#local-6989586621680059495"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
Select (ASTType ForExpr) 'Typed
</span><a href="#local-6989586621680059496"><span class="hs-identifier hs-var">exprType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>                                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedExpr -&gt; Select TypeApplication 'Typed -&gt; TypedExpr'
forall a (ast :: a).
Expr ast -&gt; Select TypeApplication ast -&gt; Expr' ast
</span><a href="Elara.AST.Generic.Types.html#TypeApplication"><span class="hs-identifier hs-var">TypeApplication</span></a></span><span> </span><span class="annot"><span class="annottext">TypedExpr
</span><a href="#local-6989586621680059498"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680059497"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059496"><span class="hs-identifier hs-var">exprType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>                                </span><span class="annot"><span class="annottext">(TypedExpr', Monotype loc)
</span><a href="#local-6989586621680059493"><span class="hs-identifier hs-var">instantiated'</span></a></span><span>
</span><span id="line-110"></span><span>                                </span><span class="annot"><span class="annottext">[TypeVariable]
</span><a href="#local-6989586621680059492"><span class="hs-identifier hs-var">tyApps</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680059494"><span class="hs-identifier hs-type">withApps</span></a></span><span>
</span><span id="line-113"></span><span>                </span><span class="hs-comment">-- ABS</span><span>
</span><span id="line-114"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span id="local-6989586621680059500"><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059500"><span class="hs-identifier hs-var">paramLoc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypedLambdaParam"><span class="hs-identifier hs-type">TypedLambdaParam</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680059502"><span class="annot"><span class="annottext">Unique VarName
</span><a href="#local-6989586621680059502"><span class="hs-identifier hs-var">paramName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059503"><span class="annot"><span class="annottext">Select PatternType 'Shunted
</span><a href="#local-6989586621680059503"><span class="hs-identifier hs-var">expectedParamType</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680059504"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059504"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>                    </span><span id="local-6989586621680059505"><span class="annot"><a href="#local-6989586621680059505"><span class="hs-identifier hs-var">paramTyVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-var">UnificationVar</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; TypeVariable)
-&gt; Eff r UniqueTyVar -&gt; Eff r TypeVariable
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Eff r UniqueTyVar
forall (r :: [Effect]). (UniqueGen :&gt; r) =&gt; Eff r UniqueTyVar
</span><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier hs-var">makeUniqueTyVar</span></a></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059507"><span class="annot"><a href="#local-6989586621680059507"><span class="hs-identifier hs-var">typedBody</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059508"><span class="annot"><a href="#local-6989586621680059508"><span class="hs-identifier hs-var">bodyType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#withLocalType"><span class="hs-identifier hs-type">withLocalType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059502"><span class="hs-identifier hs-type">paramName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-type">Lifted</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059500"><span class="hs-identifier hs-type">paramLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059505"><span class="hs-identifier hs-type">paramTyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-type">generateConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059504"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059510"><span class="annot"><a href="#local-6989586621680059510"><span class="hs-identifier hs-var hs-var">functionType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
forall loc. loc -&gt; Monotype loc -&gt; Monotype loc -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Function"><span class="hs-identifier hs-var">Function</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059500"><span class="hs-identifier hs-var">paramLoc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680059505"><span class="hs-identifier hs-var">paramTyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680059508"><span class="hs-identifier hs-var">bodyType</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-122"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Lambda"><span class="hs-identifier hs-type">Lambda</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059500"><span class="hs-identifier hs-type">paramLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypedLambdaParam"><span class="hs-identifier hs-type">TypedLambdaParam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680059502"><span class="hs-identifier hs-type">paramName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059500"><span class="hs-identifier hs-type">paramLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059505"><span class="hs-identifier hs-type">paramTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680059507"><span class="hs-identifier hs-type">typedBody</span></a></span><span>
</span><span id="line-123"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680059510"><span class="hs-identifier hs-type">functionType</span></a></span><span>
</span><span id="line-124"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>                </span><span class="hs-comment">-- APP</span><span>
</span><span id="line-127"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#FunctionCall"><span class="hs-identifier hs-type">FunctionCall</span></a></span><span> </span><span id="local-6989586621680059513"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059513"><span class="hs-identifier hs-var">e1</span></a></span></span><span> </span><span id="local-6989586621680059514"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059514"><span class="hs-identifier hs-var">e2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059515"><span class="annot"><a href="#local-6989586621680059515"><span class="hs-identifier hs-var">e1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059516"><span class="annot"><a href="#local-6989586621680059516"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr -&gt; Eff r (TypedExpr, Monotype SourceRegion)
forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
ShuntedExpr -&gt; Eff r (TypedExpr, Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-var">generateConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059513"><span class="hs-identifier hs-var">e1</span></a></span><span>
</span><span id="line-129"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059517"><span class="annot"><a href="#local-6989586621680059517"><span class="hs-identifier hs-var">e2'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059518"><span class="annot"><a href="#local-6989586621680059518"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-type">generateConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059514"><span class="hs-identifier hs-type">e2</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>                    </span><span id="local-6989586621680059519"><span class="annot"><a href="#local-6989586621680059519"><span class="hs-identifier hs-var">resultTyVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-type">UnificationVar</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier hs-type">makeUniqueTyVar</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059520"><span class="annot"><a href="#local-6989586621680059520"><span class="hs-identifier hs-var hs-var">e1Loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059513"><span class="hs-identifier hs-var">e1</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
-&gt; Optic' A_Lens '[] ShuntedExpr SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] ShuntedExpr SourceRegion
forall {a} (ast :: a).
(ASTLocate' ast ~ Located) =&gt;
Lens' (Expr ast) SourceRegion
</span><a href="Elara.AST.Generic.Types.html#exprLocation"><span class="hs-identifier hs-var">Syntax.exprLocation</span></a></span><span>
</span><span id="line-134"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059521"><span class="annot"><a href="#local-6989586621680059521"><span class="hs-identifier hs-var hs-var">e2Loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059514"><span class="hs-identifier hs-var">e2</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
-&gt; Optic' A_Lens '[] ShuntedExpr SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] ShuntedExpr SourceRegion
forall {a} (ast :: a).
(ASTLocate' ast ~ Located) =&gt;
Lens' (Expr ast) SourceRegion
</span><a href="Elara.AST.Generic.Types.html#exprLocation"><span class="hs-identifier hs-var">Syntax.exprLocation</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059522"><span class="annot"><a href="#local-6989586621680059522"><span class="hs-identifier hs-var hs-var">equalityConstraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Constraint SourceRegion
forall loc. loc -&gt; Monotype loc -&gt; Monotype loc -&gt; Constraint loc
</span><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-var">Equality</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680059516"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
forall loc. loc -&gt; Monotype loc -&gt; Monotype loc -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Function"><span class="hs-identifier hs-var">Function</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059520"><span class="hs-identifier hs-var">e1Loc</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680059518"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059521"><span class="hs-identifier hs-var">e2Loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680059519"><span class="hs-identifier hs-var">resultTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>                    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059522"><span class="hs-identifier hs-type">equalityConstraint</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="annot"><a href="#local-6989586621680059522"><span class="hs-identifier hs-type">equalityConstraint</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#FunctionCall"><span class="hs-identifier hs-type">FunctionCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059515"><span class="hs-identifier hs-type">e1'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059517"><span class="hs-identifier hs-type">e2'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059521"><span class="hs-identifier hs-type">e2Loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059519"><span class="hs-identifier hs-type">resultTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>                </span><span class="hs-comment">-- LET</span><span>
</span><span id="line-143"></span><span>                </span><span class="hs-comment">{-
                    Q ; &#915; &#8866; e1 : &#964;1 Q ; &#915;, (x :&#964;1) &#8866; e2 : &#964;2
                    ----------------------------------------------
                            Q ; &#915; &#8866; let x = e1 in e2 : &#964;2

                    (except not quite because lets are recursive)
                    -}</span><span>
</span><span id="line-150"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#LetIn"><span class="hs-identifier hs-type">LetIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span id="local-6989586621680059526"><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059526"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680059527"><span class="annot"><span class="annottext">Unique VarName
</span><a href="#local-6989586621680059527"><span class="hs-identifier hs-var">varName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoFieldValue
Select LetPattern 'Shunted
</span><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier hs-var">NoFieldValue</span></a></span><span> </span><span id="local-6989586621680059528"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059528"><span class="hs-identifier hs-var">varExpr</span></a></span></span><span> </span><span id="local-6989586621680059529"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059529"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>                    </span><span id="local-6989586621680059530"><span class="annot"><a href="#local-6989586621680059530"><span class="hs-identifier hs-var">recursiveVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-var">UnificationVar</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; TypeVariable)
-&gt; Eff r UniqueTyVar -&gt; Eff r TypeVariable
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Eff r UniqueTyVar
forall (r :: [Effect]). (UniqueGen :&gt; r) =&gt; Eff r UniqueTyVar
</span><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier hs-var">makeUniqueTyVar</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>                    </span><span class="hs-comment">-- Q ; &#915; &#8866; e1 : &#964;1</span><span>
</span><span id="line-154"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059531"><span class="annot"><a href="#local-6989586621680059531"><span class="hs-identifier hs-var">typedVarExpr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059532"><span class="annot"><a href="#local-6989586621680059532"><span class="hs-identifier hs-var">varType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-155"></span><span>                        </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#withLocalType"><span class="hs-identifier hs-type">withLocalType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059527"><span class="hs-identifier hs-type">varName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-type">Lifted</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059526"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059530"><span class="hs-identifier hs-type">recursiveVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-156"></span><span>                            </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-type">generateConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059528"><span class="hs-identifier hs-type">varExpr</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059533"><span class="annot"><a href="#local-6989586621680059533"><span class="hs-identifier hs-var hs-var">recursiveConstraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Constraint SourceRegion
forall loc. loc -&gt; Monotype loc -&gt; Monotype loc -&gt; Constraint loc
</span><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-var">Equality</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059526"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680059530"><span class="hs-identifier hs-var">recursiveVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680059532"><span class="hs-identifier hs-var">varType</span></a></span><span>
</span><span id="line-159"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="annot"><a href="#local-6989586621680059533"><span class="hs-identifier hs-type">recursiveConstraint</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>                    </span><span class="hs-comment">-- TODO: we need to check if e1 is closed here before generalising _everything_</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059534"><span class="annot"><a href="#local-6989586621680059534"><span class="hs-identifier hs-var hs-var">isRecursive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>                            </span><span class="annot"><span class="annottext">Optic' A_Fold '[] ShuntedExpr (Unique VarName)
-&gt; (Unique VarName -&gt; Bool) -&gt; ShuntedExpr -&gt; Bool
forall k (is :: IxList) s a.
Is k A_Fold =&gt;
Optic' k is s a -&gt; (a -&gt; Bool) -&gt; s -&gt; Bool
</span><span class="hs-identifier hs-var">anyOf</span></span><span>
</span><span id="line-165"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic' A_Traversal '[] ShuntedExpr ShuntedExpr
-&gt; Fold ShuntedExpr ShuntedExpr
forall k (is :: IxList) a.
Is k A_Fold =&gt;
Optic' k is a a -&gt; Fold a a
</span><span class="hs-identifier hs-var">cosmosOf</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Traversal '[] ShuntedExpr ShuntedExpr
forall a s. GPlate a s =&gt; Traversal' s a
</span><span class="hs-identifier hs-var">gplate</span></span><span> </span><span class="annot"><span class="annottext">Fold ShuntedExpr ShuntedExpr
-&gt; Iso
     ShuntedExpr
     ShuntedExpr
     (Located (Expr' 'Shunted), Maybe ShuntedType)
     (Located (Expr' 'Shunted), Maybe ShuntedType)
-&gt; Optic
     A_Fold
     '[]
     ShuntedExpr
     ShuntedExpr
     (Located (Expr' 'Shunted), Maybe ShuntedType)
     (Located (Expr' 'Shunted), Maybe ShuntedType)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Iso
  ShuntedExpr
  ShuntedExpr
  (Located (Expr' 'Shunted), Maybe ShuntedType)
  (Located (Expr' 'Shunted), Maybe ShuntedType)
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Fold
  '[]
  ShuntedExpr
  ShuntedExpr
  (Located (Expr' 'Shunted), Maybe ShuntedType)
  (Located (Expr' 'Shunted), Maybe ShuntedType)
-&gt; Optic
     A_Lens
     '[]
     (Located (Expr' 'Shunted), Maybe ShuntedType)
     (Located (Expr' 'Shunted), Maybe ShuntedType)
     (Located (Expr' 'Shunted))
     (Located (Expr' 'Shunted))
-&gt; Optic
     A_Fold
     '[]
     ShuntedExpr
     ShuntedExpr
     (Located (Expr' 'Shunted))
     (Located (Expr' 'Shunted))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Expr' 'Shunted), Maybe ShuntedType)
  (Located (Expr' 'Shunted), Maybe ShuntedType)
  (Located (Expr' 'Shunted))
  (Located (Expr' 'Shunted))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Fold
  '[]
  ShuntedExpr
  ShuntedExpr
  (Located (Expr' 'Shunted))
  (Located (Expr' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (Expr' 'Shunted))
     (Located (Expr' 'Shunted))
     (Expr' 'Shunted)
     (Expr' 'Shunted)
-&gt; Optic
     A_Fold
     '[]
     ShuntedExpr
     ShuntedExpr
     (Expr' 'Shunted)
     (Expr' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Expr' 'Shunted))
  (Located (Expr' 'Shunted))
  (Expr' 'Shunted)
  (Expr' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Fold
  '[]
  ShuntedExpr
  ShuntedExpr
  (Expr' 'Shunted)
  (Expr' 'Shunted)
-&gt; Optic
     A_Prism
     '[]
     (Expr' 'Shunted)
     (Expr' 'Shunted)
     (Located (VarRef' LocatedVarRefKind VarName))
     (Located (VarRef' LocatedVarRefKind VarName))
-&gt; Optic
     A_Fold
     '[]
     ShuntedExpr
     ShuntedExpr
     (Located (VarRef' LocatedVarRefKind VarName))
     (Located (VarRef' LocatedVarRefKind VarName))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (ctor :: Symbol) s a.
AsConstructor' ctor s a =&gt;
Prism s s a a
</span><span class="hs-identifier hs-var">_Ctor'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;Var&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Fold
  '[]
  ShuntedExpr
  ShuntedExpr
  (Located (VarRef' LocatedVarRefKind VarName))
  (Located (VarRef' LocatedVarRefKind VarName))
-&gt; Optic
     A_Lens
     '[]
     (Located (VarRef' LocatedVarRefKind VarName))
     (Located (VarRef' LocatedVarRefKind VarName))
     (VarRef' LocatedVarRefKind VarName)
     (VarRef' LocatedVarRefKind VarName)
-&gt; Optic
     A_Fold
     '[]
     ShuntedExpr
     ShuntedExpr
     (VarRef' LocatedVarRefKind VarName)
     (VarRef' LocatedVarRefKind VarName)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (VarRef' LocatedVarRefKind VarName))
  (Located (VarRef' LocatedVarRefKind VarName))
  (VarRef' LocatedVarRefKind VarName)
  (VarRef' LocatedVarRefKind VarName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Fold
  '[]
  ShuntedExpr
  ShuntedExpr
  (VarRef' LocatedVarRefKind VarName)
  (VarRef' LocatedVarRefKind VarName)
-&gt; Optic
     A_Prism
     '[]
     (VarRef' LocatedVarRefKind VarName)
     (VarRef' LocatedVarRefKind VarName)
     (Located (Unique VarName))
     (Located (Unique VarName))
-&gt; Optic
     A_Fold
     '[]
     ShuntedExpr
     ShuntedExpr
     (Located (Unique VarName))
     (Located (Unique VarName))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (ctor :: Symbol) s a.
AsConstructor' ctor s a =&gt;
Prism s s a a
</span><span class="hs-identifier hs-var">_Ctor'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;Local&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Fold
  '[]
  ShuntedExpr
  ShuntedExpr
  (Located (Unique VarName))
  (Located (Unique VarName))
-&gt; Optic
     A_Lens
     '[]
     (Located (Unique VarName))
     (Located (Unique VarName))
     (Unique VarName)
     (Unique VarName)
-&gt; Optic' A_Fold '[] ShuntedExpr (Unique VarName)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Unique VarName))
  (Located (Unique VarName))
  (Unique VarName)
  (Unique VarName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique VarName -&gt; Unique VarName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Unique VarName
</span><a href="#local-6989586621680059527"><span class="hs-identifier hs-var">varName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>                                </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059528"><span class="hs-identifier hs-var">varExpr</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span>                    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;isRecursive?: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059534"><span class="hs-identifier hs-type">isRecursive</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>                    </span><span id="local-6989586621680059538"><span class="annot"><a href="#local-6989586621680059538"><span class="hs-identifier hs-var">maybeGeneralised</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-171"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="annot"><a href="#local-6989586621680059534"><span class="hs-identifier hs-type">isRecursive</span></a></span><span>
</span><span id="line-172"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>                                </span><span id="local-6989586621680059540"><span class="annot"><a href="#local-6989586621680059540"><span class="hs-identifier hs-var">generalised</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Generalise.html#generalise"><span class="hs-identifier hs-type">generalise</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059532"><span class="hs-identifier hs-type">varType</span></a></span><span>
</span><span id="line-174"></span><span>                                </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059532"><span class="hs-identifier hs-type">varType</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; -&gt; generalised: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059540"><span class="hs-identifier hs-type">generalised</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>                                </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059540"><span class="hs-identifier hs-type">generalised</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-type">Lifted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059532"><span class="hs-identifier hs-type">varType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059542"><span class="annot"><a href="#local-6989586621680059542"><span class="hs-identifier hs-var">typedBody</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059543"><span class="annot"><a href="#local-6989586621680059543"><span class="hs-identifier hs-var">bodyType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-179"></span><span>                        </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#withLocalType"><span class="hs-identifier hs-type">withLocalType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059527"><span class="hs-identifier hs-type">varName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059538"><span class="hs-identifier hs-type">maybeGeneralised</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-180"></span><span>                            </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-type">generateConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059529"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#LetIn"><span class="hs-identifier hs-type">LetIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059526"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059527"><span class="hs-identifier hs-type">varName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier hs-type">NoFieldValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059531"><span class="hs-identifier hs-type">typedVarExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059542"><span class="hs-identifier hs-type">typedBody</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680059543"><span class="hs-identifier hs-type">bodyType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>                </span><span class="hs-comment">-- IF</span><span>
</span><span id="line-185"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span id="local-6989586621680059545"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059545"><span class="hs-identifier hs-var">cond</span></a></span></span><span> </span><span id="local-6989586621680059546"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059546"><span class="hs-identifier hs-var">then'</span></a></span></span><span> </span><span id="local-6989586621680059547"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059547"><span class="hs-identifier hs-var">else'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059548"><span class="annot"><a href="#local-6989586621680059548"><span class="hs-identifier hs-var">typedCond</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059549"><span class="annot"><a href="#local-6989586621680059549"><span class="hs-identifier hs-var">condType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr -&gt; Eff r (TypedExpr, Monotype SourceRegion)
forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
ShuntedExpr -&gt; Eff r (TypedExpr, Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-var">generateConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059545"><span class="hs-identifier hs-var">cond</span></a></span><span>
</span><span id="line-187"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059550"><span class="annot"><a href="#local-6989586621680059550"><span class="hs-identifier hs-var">typedThen</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059551"><span class="annot"><a href="#local-6989586621680059551"><span class="hs-identifier hs-var">thenType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-type">generateConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059546"><span class="hs-identifier hs-type">then'</span></a></span><span>
</span><span id="line-188"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059552"><span class="annot"><a href="#local-6989586621680059552"><span class="hs-identifier hs-var">typedElse</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059553"><span class="annot"><a href="#local-6989586621680059553"><span class="hs-identifier hs-var">elseType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-type">generateConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059547"><span class="hs-identifier hs-type">else'</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059554"><span class="annot"><a href="#local-6989586621680059554"><span class="hs-identifier hs-var hs-var">condLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059545"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
-&gt; Optic' A_Lens '[] ShuntedExpr SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] ShuntedExpr SourceRegion
forall {a} (ast :: a).
(ASTLocate' ast ~ Located) =&gt;
Lens' (Expr ast) SourceRegion
</span><a href="Elara.AST.Generic.Types.html#exprLocation"><span class="hs-identifier hs-var">Syntax.exprLocation</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059555"><span class="annot"><a href="#local-6989586621680059555"><span class="hs-identifier hs-var hs-var">equalityConstraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Constraint SourceRegion
forall loc. loc -&gt; Monotype loc -&gt; Monotype loc -&gt; Constraint loc
</span><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-var">Equality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059545"><span class="hs-identifier hs-var">cond</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
-&gt; Optic' A_Lens '[] ShuntedExpr SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] ShuntedExpr SourceRegion
forall {a} (ast :: a).
(ASTLocate' ast ~ Located) =&gt;
Lens' (Expr ast) SourceRegion
</span><a href="Elara.AST.Generic.Types.html#exprLocation"><span class="hs-identifier hs-var">Syntax.exprLocation</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680059549"><span class="hs-identifier hs-var">condType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion
-&gt; Qualified TypeName
-&gt; [Monotype SourceRegion]
-&gt; Monotype SourceRegion
forall loc.
loc -&gt; Qualified TypeName -&gt; [Monotype loc] -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeConstructor"><span class="hs-identifier hs-var">TypeConstructor</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059554"><span class="hs-identifier hs-var">condLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeName -&gt; Qualified TypeName
forall c. c -&gt; Qualified c
</span><a href="Elara.Prim.html#mkPrimQual"><span class="hs-identifier hs-var">mkPrimQual</span></a></span><span> </span><span class="annot"><span class="annottext">TypeName
</span><a href="Elara.Prim.html#boolName"><span class="hs-identifier hs-var">boolName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="annot"><a href="#local-6989586621680059555"><span class="hs-identifier hs-type">equalityConstraint</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059557"><span class="annot"><a href="#local-6989586621680059557"><span class="hs-identifier hs-var hs-var">equalityConstraint1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Constraint SourceRegion
forall loc. loc -&gt; Monotype loc -&gt; Monotype loc -&gt; Constraint loc
</span><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-var">Equality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059546"><span class="hs-identifier hs-var">then'</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
-&gt; Optic' A_Lens '[] ShuntedExpr SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] ShuntedExpr SourceRegion
forall {a} (ast :: a).
(ASTLocate' ast ~ Located) =&gt;
Lens' (Expr ast) SourceRegion
</span><a href="Elara.AST.Generic.Types.html#exprLocation"><span class="hs-identifier hs-var">Syntax.exprLocation</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680059551"><span class="hs-identifier hs-var">thenType</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680059553"><span class="hs-identifier hs-var">elseType</span></a></span><span>
</span><span id="line-196"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="annot"><a href="#local-6989586621680059557"><span class="hs-identifier hs-type">equalityConstraint1</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#If"><span class="hs-identifier hs-type">If</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059548"><span class="hs-identifier hs-type">typedCond</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059550"><span class="hs-identifier hs-type">typedThen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059552"><span class="hs-identifier hs-type">typedElse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680059551"><span class="hs-identifier hs-type">thenType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#TypeApplication"><span class="hs-identifier hs-type">TypeApplication</span></a></span><span> </span><span id="local-6989586621680059558"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059558"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680059559"><span class="annot"><span class="annottext">Select TypeApplication 'Shunted
</span><a href="#local-6989586621680059559"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Eff r (TypedExpr', Monotype loc)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;i dont know what to do with type applications yet sorry&quot;</span></span><span>
</span><span id="line-200"></span><span>                </span><span class="hs-comment">-- MATCH</span><span>
</span><span id="line-201"></span><span>                </span><span class="hs-comment">-- (match (e: &#964;) with { p1 -&gt; e1; ...; pn -&gt; en }) : &#964;r</span><span>
</span><span id="line-202"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span id="local-6989586621680059562"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059562"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621680059563"><span class="annot"><span class="annottext">[(Pattern 'Shunted, ShuntedExpr)]
</span><a href="#local-6989586621680059563"><span class="hs-identifier hs-var">cases</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>                    </span><span class="hs-comment">-- Q ; &#915; &#8866; e : &#964;</span><span>
</span><span id="line-204"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059564"><span class="annot"><a href="#local-6989586621680059564"><span class="hs-identifier hs-var">typedE</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059565"><span class="annot"><a href="#local-6989586621680059565"><span class="hs-identifier hs-var">eType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr -&gt; Eff r (TypedExpr, Monotype SourceRegion)
forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
ShuntedExpr -&gt; Eff r (TypedExpr, Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-var">generateConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059562"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>                    </span><span class="hs-comment">-- &#964;r</span><span>
</span><span id="line-207"></span><span>                    </span><span id="local-6989586621680059566"><span class="annot"><a href="#local-6989586621680059566"><span class="hs-identifier hs-var">resultTyVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-type">UnificationVar</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier hs-type">makeUniqueTyVar</span></a></span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059567"><span class="annot"><a href="#local-6989586621680059567"><span class="hs-identifier hs-var hs-var">eLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059562"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
-&gt; Optic' A_Lens '[] ShuntedExpr SourceRegion -&gt; SourceRegion
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] ShuntedExpr SourceRegion
forall {a} (ast :: a).
(ASTLocate' ast ~ Located) =&gt;
Lens' (Expr ast) SourceRegion
</span><a href="Elara.AST.Generic.Types.html#exprLocation"><span class="hs-identifier hs-var">Syntax.exprLocation</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>                    </span><span id="local-6989586621680059568"><span class="annot"><a href="#local-6989586621680059568"><span class="hs-identifier hs-var">cases'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">for</span></span><span> </span><span class="annot"><a href="#local-6989586621680059563"><span class="hs-identifier hs-type">cases</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680059570"><span class="annot"><span class="annottext">Pattern 'Shunted
</span><a href="#local-6989586621680059570"><span class="hs-identifier hs-var">pattern</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059571"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059571"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s (r :: [Effect]) a. (State s :&gt; r) =&gt; Eff r a -&gt; Eff r a
</span><a href="Effectful.State.Extra.html#scoped"><span class="hs-identifier hs-var">scoped</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#LocalTypeEnvironment"><span class="hs-identifier hs-type">LocalTypeEnvironment</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (Pattern 'Typed, TypedExpr)
 -&gt; Eff r (Pattern 'Typed, TypedExpr))
-&gt; Eff r (Pattern 'Typed, TypedExpr)
-&gt; Eff r (Pattern 'Typed, TypedExpr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>                        </span><span class="hs-comment">-- Q ; &#915; &#8866; p1 : &#964;1</span><span>
</span><span id="line-213"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621680059572"><span class="annot"><a href="#local-6989586621680059572"><span class="hs-identifier hs-var">typedPattern</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059573"><span class="annot"><a href="#local-6989586621680059573"><span class="hs-identifier hs-var">patternType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pattern 'Shunted
-&gt; Monotype SourceRegion
-&gt; Eff r (Pattern 'Typed, Monotype SourceRegion)
forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
Pattern 'Shunted
-&gt; Monotype loc -&gt; Eff r (Pattern 'Typed, Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generatePatternConstraints"><span class="hs-identifier hs-var">generatePatternConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern 'Shunted
</span><a href="#local-6989586621680059570"><span class="hs-identifier hs-var">pattern</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680059565"><span class="hs-identifier hs-var">eType</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>                        </span><span class="hs-comment">-- &#964;1 ~ &#964;</span><span>
</span><span id="line-216"></span><span>                        </span><span class="hs-comment">-- let equalityConstraint = Equality (pattern ^. Syntax.patternLocation) eType patternType</span><span>
</span><span id="line-217"></span><span>                        </span><span class="hs-comment">-- tell equalityConstraint</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>                        </span><span class="hs-comment">-- Q ; &#915; &#8866; e1 : &#964;2</span><span>
</span><span id="line-220"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621680059575"><span class="annot"><a href="#local-6989586621680059575"><span class="hs-identifier hs-var">typedBody</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059576"><span class="annot"><a href="#local-6989586621680059576"><span class="hs-identifier hs-var">bodyType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-type">generateConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059571"><span class="hs-identifier hs-type">body</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>                        </span><span class="hs-comment">-- &#964;2 ~ &#964;r</span><span>
</span><span id="line-223"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-type">Equality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680059571"><span class="hs-identifier hs-type">body</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html#exprLocation"><span class="hs-identifier hs-type">Syntax.exprLocation</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680059576"><span class="hs-identifier hs-type">bodyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059567"><span class="hs-identifier hs-type">eLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059566"><span class="hs-identifier hs-type">resultTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680059572"><span class="hs-identifier hs-type">typedPattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680059575"><span class="hs-identifier hs-type">typedBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Match"><span class="hs-identifier hs-type">Match</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059564"><span class="hs-identifier hs-type">typedE</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059568"><span class="hs-identifier hs-type">cases'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059567"><span class="hs-identifier hs-type">eLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059566"><span class="hs-identifier hs-type">resultTyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span id="local-6989586621680059578"><span class="annot"><span class="annottext">NonEmpty ShuntedExpr
</span><a href="#local-6989586621680059578"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>                    </span><span id="local-6989586621680059579"><span class="annot"><a href="#local-6989586621680059579"><span class="hs-identifier hs-var">vals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonEmpty ShuntedExpr
-&gt; (ShuntedExpr -&gt; Eff r (TypedExpr, Monotype loc))
-&gt; Eff r (NonEmpty (TypedExpr, Monotype loc))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ShuntedExpr
</span><a href="#local-6989586621680059578"><span class="hs-identifier hs-var">exprs</span></a></span><span> </span><span class="annot"><span class="annottext">((ShuntedExpr -&gt; Eff r (TypedExpr, Monotype loc))
 -&gt; Eff r (NonEmpty (TypedExpr, Monotype loc)))
-&gt; (ShuntedExpr -&gt; Eff r (TypedExpr, Monotype loc))
-&gt; Eff r (NonEmpty (TypedExpr, Monotype loc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680059580"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059580"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr -&gt; Eff r (TypedExpr, Monotype loc)
forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
ShuntedExpr -&gt; Eff r (TypedExpr, Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-var">generateConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059580"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059581"><span class="annot"><a href="#local-6989586621680059581"><span class="hs-identifier hs-var hs-var">exprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TypedExpr, Monotype loc) -&gt; TypedExpr)
-&gt; NonEmpty (TypedExpr, Monotype loc) -&gt; NonEmpty TypedExpr
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(TypedExpr, Monotype loc) -&gt; TypedExpr
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (TypedExpr, Monotype loc)
</span><a href="#local-6989586621680059579"><span class="hs-identifier hs-var">vals</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059583"><span class="annot"><a href="#local-6989586621680059583"><span class="hs-identifier hs-var hs-var">exprTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TypedExpr, Monotype loc) -&gt; Monotype loc)
-&gt; NonEmpty (TypedExpr, Monotype loc) -&gt; NonEmpty (Monotype loc)
forall a b. (a -&gt; b) -&gt; NonEmpty a -&gt; NonEmpty b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(TypedExpr, Monotype loc) -&gt; Monotype loc
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (TypedExpr, Monotype loc)
</span><a href="#local-6989586621680059579"><span class="hs-identifier hs-var">vals</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Block"><span class="hs-identifier hs-type">Syntax.Block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059581"><span class="hs-identifier hs-type">exprs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">last</span></span><span> </span><span class="annot"><a href="#local-6989586621680059583"><span class="hs-identifier hs-type">exprTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span id="local-6989586621680059587"><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059587"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680059588"><span class="annot"><span class="annottext">Unique VarName
</span><a href="#local-6989586621680059588"><span class="hs-identifier hs-var">varName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NoFieldValue
Select LetPattern 'Shunted
</span><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier hs-var">NoFieldValue</span></a></span><span> </span><span id="local-6989586621680059589"><span class="annot"><span class="annottext">ShuntedExpr
</span><a href="#local-6989586621680059589"><span class="hs-identifier hs-var">varExpr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>                    </span><span id="local-6989586621680059590"><span class="annot"><a href="#local-6989586621680059590"><span class="hs-identifier hs-var">recursiveVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-var">UnificationVar</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; TypeVariable)
-&gt; Eff r UniqueTyVar -&gt; Eff r TypeVariable
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Eff r UniqueTyVar
forall (r :: [Effect]). (UniqueGen :&gt; r) =&gt; Eff r UniqueTyVar
</span><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier hs-var">makeUniqueTyVar</span></a></span><span>
</span><span id="line-238"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059591"><span class="annot"><a href="#local-6989586621680059591"><span class="hs-identifier hs-var">typedVarExpr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059592"><span class="annot"><a href="#local-6989586621680059592"><span class="hs-identifier hs-var">varType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Environment.html#withLocalType"><span class="hs-identifier hs-type">withLocalType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059588"><span class="hs-identifier hs-type">varName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-type">Lifted</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059587"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059590"><span class="hs-identifier hs-type">recursiveVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generateConstraints"><span class="hs-identifier hs-type">generateConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059589"><span class="hs-identifier hs-type">varExpr</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059593"><span class="annot"><a href="#local-6989586621680059593"><span class="hs-identifier hs-var hs-var">recursiveConstraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceRegion
-&gt; Monotype SourceRegion
-&gt; Monotype SourceRegion
-&gt; Constraint SourceRegion
forall loc. loc -&gt; Monotype loc -&gt; Monotype loc -&gt; Constraint loc
</span><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-var">Equality</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059443"><span class="hs-identifier hs-var">exprLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; TypeVariable -&gt; Monotype SourceRegion
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059587"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680059590"><span class="hs-identifier hs-var">recursiveVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680059592"><span class="hs-identifier hs-var">varType</span></a></span><span>
</span><span id="line-241"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="annot"><a href="#local-6989586621680059593"><span class="hs-identifier hs-type">recursiveConstraint</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#addLocalType"><span class="hs-identifier hs-type">addLocalType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059588"><span class="hs-identifier hs-type">varName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-type">Lifted</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059592"><span class="hs-identifier hs-type">varType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059587"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059588"><span class="hs-identifier hs-type">varName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier hs-type">NoFieldValue</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059591"><span class="hs-identifier hs-type">typedVarExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680059592"><span class="hs-identifier hs-type">varType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="annot"><span class="hs-comment">{- | Generate constraints for a pattern, returning the typed pattern and the type of the pattern, and generating constraints for the pattern
We define the type of a pattern as the type of values it can match against, rather than its &quot;signature&quot;

For example, in the case of a simple option type @type Option a = Some a | None@,
we say that the pattern `Some x` has type `Option a` rather than @a -&gt; Option a@
-}</span></span><span>
</span><span id="line-253"></span><span id="local-6989586621680057895"><span id="local-6989586621680057896"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generatePatternConstraints"><span class="hs-identifier hs-type">generatePatternConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Monad.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057895"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057896"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057895"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057896"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680057895"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedPattern"><span class="hs-identifier hs-type">ShuntedPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057895"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680057896"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Typed.html#TypedPattern"><span class="hs-identifier hs-type">TypedPattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057895"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-254"></span><span id="generatePatternConstraints"><span class="annot"><span class="annottext">generatePatternConstraints :: forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
Pattern 'Shunted
-&gt; Monotype loc -&gt; Eff r (Pattern 'Typed, Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generatePatternConstraints"><span class="hs-identifier hs-var hs-var">generatePatternConstraints</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span id="local-6989586621680059684"><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059684"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680059685"><span class="annot"><span class="annottext">Pattern' 'Shunted
</span><a href="#local-6989586621680059685"><span class="hs-identifier hs-var">pattern'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059686"><span class="annot"><span class="annottext">Select PatternType 'Shunted
</span><a href="#local-6989586621680059686"><span class="hs-identifier hs-var">expectedType</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680059687"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059687"><span class="hs-identifier hs-var">over</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (Pattern 'Typed, Monotype loc)
-&gt; Eff r (Pattern 'Typed, Monotype loc)
forall (r :: [Effect]) a.
(StructuredDebug :&gt; r, Pretty a) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier hs-var">debugWithResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;generatePatternConstraints: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pattern' 'Shunted -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' 'Shunted
</span><a href="#local-6989586621680059685"><span class="hs-identifier hs-var">pattern'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (Pattern 'Typed, Monotype loc)
 -&gt; Eff r (Pattern 'Typed, Monotype loc))
-&gt; Eff r (Pattern 'Typed, Monotype loc)
-&gt; Eff r (Pattern 'Typed, Monotype loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680059688"><span class="annot"><a href="#local-6989586621680059688"><span class="hs-identifier hs-var">typedPattern'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059689"><span class="annot"><a href="#local-6989586621680059689"><span class="hs-identifier hs-var">monotype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Pattern' 'Shunted
-&gt; Monotype loc -&gt; Eff r (Pattern' 'Typed, Monotype loc)
forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
Pattern' 'Shunted
-&gt; Monotype loc -&gt; Eff r (Pattern' 'Typed, Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generatePatternConstraints%27"><span class="hs-identifier hs-var">generatePatternConstraints'</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' 'Shunted
</span><a href="#local-6989586621680059685"><span class="hs-identifier hs-var">pattern'</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059687"><span class="hs-identifier hs-var">over</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-type">Equality</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059684"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059689"><span class="hs-identifier hs-type">monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059687"><span class="hs-identifier hs-type">over</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Pattern"><span class="hs-identifier hs-type">Pattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059684"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059688"><span class="hs-identifier hs-type">typedPattern'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680059689"><span class="hs-identifier hs-type">monotype</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680059689"><span class="hs-identifier hs-type">monotype</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span id="local-6989586621680057914"><span id="local-6989586621680057915"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#generatePatternConstraints%27"><span class="hs-identifier hs-type">generatePatternConstraints'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Monad.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057914"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057915"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057914"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057915"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680057914"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedPattern%27"><span class="hs-identifier hs-type">ShuntedPattern'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="hs-comment">{- | the type of the pattern we are matching against
    For example if we have `match (x : Option Int) with { Some y -&gt; y }` then `over` would be `Option Int`
    This is necessary for `WildcardPattern` and `VarPattern` to know what type they should be
    -}</span></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057914"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680057915"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Typed.html#TypedPattern%27"><span class="hs-identifier hs-type">TypedPattern'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057914"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-268"></span><span id="generatePatternConstraints%27"><span class="annot"><span class="annottext">generatePatternConstraints' :: forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
Pattern' 'Shunted
-&gt; Monotype loc -&gt; Eff r (Pattern' 'Typed, Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generatePatternConstraints%27"><span class="hs-identifier hs-var hs-var">generatePatternConstraints'</span></a></span></span><span> </span><span id="local-6989586621680059868"><span class="annot"><span class="annottext">Pattern' 'Shunted
</span><a href="#local-6989586621680059868"><span class="hs-identifier hs-var">pattern'</span></a></span></span><span> </span><span id="local-6989586621680059869"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059869"><span class="hs-identifier hs-var">over</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (Pattern' 'Typed, Monotype loc)
-&gt; Eff r (Pattern' 'Typed, Monotype loc)
forall (r :: [Effect]) a.
(StructuredDebug :&gt; r, Pretty a) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier hs-var">debugWithResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;generatePatternConstraints: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pattern' 'Shunted -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern' 'Shunted
</span><a href="#local-6989586621680059868"><span class="hs-identifier hs-var">pattern'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (Pattern' 'Typed, Monotype loc)
 -&gt; Eff r (Pattern' 'Typed, Monotype loc))
-&gt; Eff r (Pattern' 'Typed, Monotype loc)
-&gt; Eff r (Pattern' 'Typed, Monotype loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059870"><span class="annot"><span class="annottext">patternLoc :: loc
</span><a href="#local-6989586621680059870"><span class="hs-identifier hs-var hs-var">patternLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Monotype loc -&gt; loc
forall loc. Monotype loc -&gt; loc
</span><a href="Elara.TypeInfer.Type.html#monotypeLoc"><span class="hs-identifier hs-var">monotypeLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059869"><span class="hs-identifier hs-var">over</span></a></span><span>
</span><span id="line-271"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Pattern' 'Shunted
</span><a href="#local-6989586621680059868"><span class="hs-identifier hs-var">pattern'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-272"></span><span>                </span><span class="annot"><span class="annottext">Pattern' 'Shunted
</span><a href="Elara.AST.Generic.Types.html#WildcardPattern"><span class="hs-identifier hs-var">WildcardPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Pattern' 'Typed, Monotype loc)
-&gt; Eff r (Pattern' 'Typed, Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern' 'Typed
forall {a} (ast :: a). Pattern' ast
</span><a href="Elara.AST.Generic.Types.html#WildcardPattern"><span class="hs-identifier hs-var">WildcardPattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059869"><span class="hs-identifier hs-var">over</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>                </span><span class="annot"><span class="annottext">Pattern' 'Shunted
</span><a href="Elara.AST.Generic.Types.html#UnitPattern"><span class="hs-identifier hs-var">UnitPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Pattern' 'Typed, Monotype loc)
-&gt; Eff r (Pattern' 'Typed, Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pattern' 'Typed
forall {a} (ast :: a). Pattern' ast
</span><a href="Elara.AST.Generic.Types.html#UnitPattern"><span class="hs-identifier hs-var">UnitPattern</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc -&gt; Scalar -&gt; Monotype loc
forall loc. loc -&gt; Scalar -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680059870"><span class="hs-identifier hs-var">patternLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarUnit"><span class="hs-identifier hs-var">ScalarUnit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#IntegerPattern"><span class="hs-identifier hs-type">IntegerPattern</span></a></span><span> </span><span id="local-6989586621680059873"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680059873"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Pattern' 'Typed, Monotype loc)
-&gt; Eff r (Pattern' 'Typed, Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Pattern' 'Typed
forall {a} (ast :: a). Integer -&gt; Pattern' ast
</span><a href="Elara.AST.Generic.Types.html#IntegerPattern"><span class="hs-identifier hs-var">IntegerPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680059873"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc -&gt; Scalar -&gt; Monotype loc
forall loc. loc -&gt; Scalar -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680059870"><span class="hs-identifier hs-var">patternLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarInt"><span class="hs-identifier hs-var">ScalarInt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#FloatPattern"><span class="hs-identifier hs-type">FloatPattern</span></a></span><span> </span><span id="local-6989586621680059875"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680059875"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Pattern' 'Typed, Monotype loc)
-&gt; Eff r (Pattern' 'Typed, Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Pattern' 'Typed
forall {a} (ast :: a). Double -&gt; Pattern' ast
</span><a href="Elara.AST.Generic.Types.html#FloatPattern"><span class="hs-identifier hs-var">FloatPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680059875"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc -&gt; Scalar -&gt; Monotype loc
forall loc. loc -&gt; Scalar -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680059870"><span class="hs-identifier hs-var">patternLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarFloat"><span class="hs-identifier hs-var">ScalarFloat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#StringPattern"><span class="hs-identifier hs-type">StringPattern</span></a></span><span> </span><span id="local-6989586621680059877"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680059877"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Pattern' 'Typed, Monotype loc)
-&gt; Eff r (Pattern' 'Typed, Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Pattern' 'Typed
forall {a} (ast :: a). Text -&gt; Pattern' ast
</span><a href="Elara.AST.Generic.Types.html#StringPattern"><span class="hs-identifier hs-var">StringPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680059877"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc -&gt; Scalar -&gt; Monotype loc
forall loc. loc -&gt; Scalar -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680059870"><span class="hs-identifier hs-var">patternLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarString"><span class="hs-identifier hs-var">ScalarString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#CharPattern"><span class="hs-identifier hs-type">CharPattern</span></a></span><span> </span><span id="local-6989586621680059879"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680059879"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Pattern' 'Typed, Monotype loc)
-&gt; Eff r (Pattern' 'Typed, Monotype loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Pattern' 'Typed
forall {a} (ast :: a). Char -&gt; Pattern' ast
</span><a href="Elara.AST.Generic.Types.html#CharPattern"><span class="hs-identifier hs-var">CharPattern</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621680059879"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc -&gt; Scalar -&gt; Monotype loc
forall loc. loc -&gt; Scalar -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-var">Scalar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680059870"><span class="hs-identifier hs-var">patternLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="Elara.TypeInfer.Type.html#ScalarChar"><span class="hs-identifier hs-var">ScalarChar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#VarPattern"><span class="hs-identifier hs-type">VarPattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span id="local-6989586621680059880"><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059880"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680059881"><span class="annot"><span class="annottext">Unique LowerAlphaName
</span><a href="#local-6989586621680059881"><span class="hs-identifier hs-var">varName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>                    </span><span id="local-6989586621680059882"><span class="annot"><a href="#local-6989586621680059882"><span class="hs-identifier hs-var">varType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-var">UnificationVar</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; TypeVariable)
-&gt; Eff r UniqueTyVar -&gt; Eff r TypeVariable
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Eff r UniqueTyVar
forall (r :: [Effect]). (UniqueGen :&gt; r) =&gt; Eff r UniqueTyVar
</span><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier hs-var">makeUniqueTyVar</span></a></span><span>
</span><span id="line-280"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Environment.html#addLocalType"><span class="hs-identifier hs-type">addLocalType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#NormalVarName"><span class="hs-identifier hs-type">NormalVarName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680059881"><span class="hs-identifier hs-type">varName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-type">Lifted</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059880"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059882"><span class="hs-identifier hs-type">varType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>                    </span><span class="hs-comment">-- tell (Equality loc over (TypeVar loc varType))</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#VarPattern"><span class="hs-identifier hs-type">VarPattern</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059880"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#NormalVarName"><span class="hs-identifier hs-type">NormalVarName</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680059881"><span class="hs-identifier hs-type">varName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059880"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059882"><span class="hs-identifier hs-type">varType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>                </span><span class="annot"><a href="Elara.AST.Generic.Types.html#ConstructorPattern"><span class="hs-identifier hs-type">ConstructorPattern</span></a></span><span> </span><span id="local-6989586621680059885"><span class="annot"><span class="annottext">ctor' :: CleanupLocated (ASTLocate' 'Shunted (Select ConPat 'Shunted))
</span><a href="#local-6989586621680059885"><span class="hs-identifier hs-var">ctor'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span id="local-6989586621680059886"><span class="annot"><span class="annottext">SourceRegion
</span><a href="#local-6989586621680059886"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680059887"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680059887"><span class="hs-identifier hs-var">ctor</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680059888"><span class="annot"><span class="annottext">[Pattern 'Shunted]
</span><a href="#local-6989586621680059888"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>                    </span><span class="hs-comment">-- lookup the signature of the constructor</span><span>
</span><span id="line-286"></span><span>                    </span><span id="local-6989586621680059889"><span class="annot"><a href="#local-6989586621680059889"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnvKey loc -&gt; Eff r (Type loc)
forall (r :: [Effect]) loc.
(QueryEffects r, loc ~ SourceRegion, Rock Query :&gt; r,
 State (TypeEnvironment loc) :&gt; r) =&gt;
TypeEnvKey loc -&gt; Eff r (Type loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified TypeName -&gt; TypeEnvKey loc
forall {k} (loc :: k). Qualified TypeName -&gt; TypeEnvKey loc
</span><a href="Elara.TypeInfer.Environment.html#DataConKey"><span class="hs-identifier hs-var">DataConKey</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680059887"><span class="hs-identifier hs-var">ctor</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>                    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;generatePatternConstraints (ConstructorPattern): &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059887"><span class="hs-identifier hs-type">ctor</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; :: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059889"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>                    </span><span class="hs-comment">-- if we have a constructor @Ctor : x -&gt; y -&gt; Z@</span><span>
</span><span id="line-290"></span><span>                    </span><span class="hs-comment">-- and pattern @Ctor a b@</span><span>
</span><span id="line-291"></span><span>                    </span><span class="hs-comment">-- we need to generate @a : x@ and @b : y@</span><span>
</span><span id="line-292"></span><span>                    </span><span class="hs-comment">-- we do this by making one big constraint out of fresh type variables @a_1 -&gt; @b_1 -&gt; ... -&gt; Z@</span><span>
</span><span id="line-293"></span><span>                    </span><span class="hs-comment">-- and emitting a single equality constraint @x -&gt; y -&gt; Z = a_1 -&gt; b_1 -&gt; ... -&gt; Z@</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680059890"><span class="annot"><a href="#local-6989586621680059890"><span class="hs-identifier hs-var">instantiatedT</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059891"><span class="annot"><a href="#local-6989586621680059891"><span class="hs-identifier hs-var">typeApps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#instantiate"><span class="hs-identifier hs-type">instantiate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059889"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-296"></span><span>                    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;instantiatedT: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059890"><span class="hs-identifier hs-type">instantiatedT</span></a></span><span>
</span><span id="line-297"></span><span>                    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;tyApps: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059891"><span class="hs-identifier hs-type">typeApps</span></a></span><span>
</span><span id="line-298"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059892"><span class="annot"><a href="#local-6989586621680059892"><span class="hs-identifier hs-var hs-var">argTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Monotype loc -&gt; [Monotype loc]
forall loc. Monotype loc -&gt; [Monotype loc]
</span><a href="Elara.TypeInfer.Type.html#functionMonotypeArgs"><span class="hs-identifier hs-var">functionMonotypeArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059890"><span class="hs-identifier hs-var">instantiatedT</span></a></span><span>
</span><span id="line-299"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059893"><span class="annot"><a href="#local-6989586621680059893"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Monotype loc -&gt; Monotype loc
forall loc. Monotype loc -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#functionMonotypeResult"><span class="hs-identifier hs-var">functionMonotypeResult</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059890"><span class="hs-identifier hs-var">instantiatedT</span></a></span><span>
</span><span id="line-300"></span><span>                    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;argTys: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059892"><span class="hs-identifier hs-type">argTys</span></a></span><span>
</span><span id="line-301"></span><span>                    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;res: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059893"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>                    </span><span class="hs-comment">-- tell (Equality patternLoc over res)</span><span>
</span><span id="line-304"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621680059892"><span class="hs-identifier hs-type">argTys</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">/=</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621680059888"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-305"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">throwError</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-306"></span><span>                            </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#PatternConstructorArityMismatch"><span class="hs-identifier hs-type">PatternConstructorArityMismatch</span></a></span><span>
</span><span id="line-307"></span><span>                                </span><span class="annot"><a href="#local-6989586621680059887"><span class="hs-identifier hs-type">ctor</span></a></span><span>
</span><span id="line-308"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621680059892"><span class="hs-identifier hs-type">argTys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">length</span></span><span> </span><span class="annot"><a href="#local-6989586621680059888"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>                                </span><span class="annot"><a href="#local-6989586621680059870"><span class="hs-identifier hs-type">patternLoc</span></a></span><span>
</span><span id="line-311"></span><span>                    </span><span id="local-6989586621680059899"><span class="annot"><a href="#local-6989586621680059899"><span class="hs-identifier hs-var">argPats</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">zip</span></span><span> </span><span class="annot"><a href="#local-6989586621680059888"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059892"><span class="hs-identifier hs-type">argTys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680059900"><span class="annot"><span class="annottext">Pattern 'Shunted
</span><a href="#local-6989586621680059900"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059901"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059901"><span class="hs-identifier hs-var">argTy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-312"></span><span>                        </span><span class="annot"><span class="annottext">Pattern 'Shunted
-&gt; Monotype loc -&gt; Eff r (Pattern 'Typed, Monotype loc)
forall loc (r :: [Effect]).
(Infer loc r, Error (UnifyError loc) :&gt; r, loc ~ SourceRegion) =&gt;
Pattern 'Shunted
-&gt; Monotype loc -&gt; Eff r (Pattern 'Typed, Monotype loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#generatePatternConstraints"><span class="hs-identifier hs-var">generatePatternConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">Pattern 'Shunted
</span><a href="#local-6989586621680059900"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059901"><span class="hs-identifier hs-var">argTy</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#ConstructorPattern"><span class="hs-identifier hs-type">ConstructorPattern</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059885"><span class="hs-identifier hs-type">ctor'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">fst</span></span><span> </span><span class="annot"><a href="#local-6989586621680059899"><span class="hs-identifier hs-type">argPats</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680059893"><span class="hs-identifier hs-type">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#instantiate"><span class="hs-identifier hs-type">instantiate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680057845"><span class="annot"><a href="#local-6989586621680057845"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621680057844"><span class="annot"><a href="#local-6989586621680057844"><span class="hs-identifier hs-type">loc</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057844"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680057844"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057844"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Monad.html#Infer"><span class="hs-identifier hs-type">Infer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057844"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057845"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057844"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680057845"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057844"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVariable"><span class="hs-identifier hs-type">TypeVariable</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span id="instantiate"><span class="annot"><span class="annottext">instantiate :: forall (r :: [Effect]) loc.
(Pretty loc, Eq loc, Monoid (Constraint loc), Infer loc r) =&gt;
Type loc -&gt; Eff r (Monotype loc, [TypeVariable])
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#instantiate"><span class="hs-identifier hs-var hs-var">instantiate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Lifted"><span class="hs-identifier hs-type">Lifted</span></a></span><span> </span><span id="local-6989586621680059949"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059949"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Monotype loc, [TypeVariable])
-&gt; Eff r (Monotype loc, [TypeVariable])
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059949"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#instantiate"><span class="hs-identifier hs-var">instantiate</span></a></span><span> </span><span id="local-6989586621680059950"><span class="annot"><span class="annottext">pt :: Type loc
</span><a href="#local-6989586621680059950"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Polytype"><span class="hs-identifier hs-type">Polytype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Forall"><span class="hs-identifier hs-type">Forall</span></a></span><span> </span><span id="local-6989586621680059952"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680059952"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621680059953"><span class="annot"><span class="annottext">[UniqueTyVar]
</span><a href="#local-6989586621680059953"><span class="hs-identifier hs-var">tyVars</span></a></span></span><span> </span><span id="local-6989586621680059954"><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680059954"><span class="hs-identifier hs-var">constraint</span></a></span></span><span> </span><span id="local-6989586621680059955"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059955"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (Monotype loc, [TypeVariable])
-&gt; Eff r (Monotype loc, [TypeVariable])
forall (r :: [Effect]) a.
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWith"><span class="hs-identifier hs-var">debugWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;instantiate: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type loc -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Type loc
</span><a href="#local-6989586621680059950"><span class="hs-identifier hs-var">pt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (Monotype loc, [TypeVariable])
 -&gt; Eff r (Monotype loc, [TypeVariable]))
-&gt; Eff r (Monotype loc, [TypeVariable])
-&gt; Eff r (Monotype loc, [TypeVariable])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621680059956"><span class="annot"><a href="#local-6989586621680059956"><span class="hs-identifier hs-var">fresh</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; Eff r TypeVariable)
-&gt; [UniqueTyVar] -&gt; Eff r [TypeVariable]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Eff r TypeVariable -&gt; UniqueTyVar -&gt; Eff r TypeVariable
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-var">UnificationVar</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; TypeVariable)
-&gt; Eff r UniqueTyVar -&gt; Eff r TypeVariable
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Eff r UniqueTyVar
forall (r :: [Effect]). (UniqueGen :&gt; r) =&gt; Eff r UniqueTyVar
</span><a href="Elara.TypeInfer.Unique.html#makeUniqueTyVar"><span class="hs-identifier hs-var">makeUniqueTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UniqueTyVar]
</span><a href="#local-6989586621680059953"><span class="hs-identifier hs-var">tyVars</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059959"><span class="annot"><a href="#local-6989586621680059959"><span class="hs-identifier hs-var hs-var">substitution</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map UniqueTyVar (Monotype loc) -&gt; Substitution loc
forall loc. Map UniqueTyVar (Monotype loc) -&gt; Substitution loc
</span><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-var">Substitution</span></a></span><span> </span><span class="annot"><span class="annottext">(Map UniqueTyVar (Monotype loc) -&gt; Substitution loc)
-&gt; Map UniqueTyVar (Monotype loc) -&gt; Substitution loc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Item (Map UniqueTyVar (Monotype loc))]
-&gt; Map UniqueTyVar (Monotype loc)
forall l. IsList l =&gt; [Item l] -&gt; l
</span><span class="hs-identifier hs-var">fromList</span></span><span> </span><span class="annot"><span class="annottext">([Item (Map UniqueTyVar (Monotype loc))]
 -&gt; Map UniqueTyVar (Monotype loc))
-&gt; [Item (Map UniqueTyVar (Monotype loc))]
-&gt; Map UniqueTyVar (Monotype loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[UniqueTyVar] -&gt; [Monotype loc] -&gt; [(UniqueTyVar, Monotype loc)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UniqueTyVar -&gt; UniqueTyVar) -&gt; [UniqueTyVar] -&gt; [UniqueTyVar]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic' A_Lens '[] UniqueTyVar UniqueTyVar
-&gt; UniqueTyVar -&gt; UniqueTyVar
forall k (is :: IxList) s a.
Is k A_Getter =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] UniqueTyVar UniqueTyVar
forall a s. HasType a s =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">typed</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UniqueTyVar]
</span><a href="#local-6989586621680059953"><span class="hs-identifier hs-var">tyVars</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeVariable -&gt; Monotype loc) -&gt; [TypeVariable] -&gt; [Monotype loc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc -&gt; TypeVariable -&gt; Monotype loc
forall loc. loc -&gt; TypeVariable -&gt; Monotype loc
</span><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-var">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680059952"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TypeVariable]
</span><a href="#local-6989586621680059956"><span class="hs-identifier hs-var">fresh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059962"><span class="annot"><a href="#local-6989586621680059962"><span class="hs-identifier hs-var hs-var">instantiatedConstraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-322"></span><span>            </span><span class="annot"><span class="annottext">Substitution loc -&gt; Constraint loc -&gt; Constraint loc
forall (a :: * -&gt; *) loc.
(Substitutable a loc, Eq (a loc)) =&gt;
Substitution loc -&gt; a loc -&gt; a loc
</span><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-var">substituteAll</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution loc
</span><a href="#local-6989586621680059959"><span class="hs-identifier hs-var">substitution</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680059954"><span class="hs-identifier hs-var">constraint</span></a></span><span>
</span><span id="line-323"></span><span>        </span><span id="local-6989586621680059964"><span class="annot"><a href="#local-6989586621680059964"><span class="hs-identifier hs-var hs-var">instantiatedMonotype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-324"></span><span>            </span><span class="annot"><span class="annottext">Substitution loc -&gt; Monotype loc -&gt; Monotype loc
forall (a :: * -&gt; *) loc.
(Substitutable a loc, Eq (a loc)) =&gt;
Substitution loc -&gt; a loc -&gt; a loc
</span><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-var">substituteAll</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution loc
</span><a href="#local-6989586621680059959"><span class="hs-identifier hs-var">substitution</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680059955"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="annot"><a href="#local-6989586621680059962"><span class="hs-identifier hs-type">instantiatedConstraint</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680059964"><span class="hs-identifier hs-type">instantiatedMonotype</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680059956"><span class="hs-identifier hs-type">fresh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span id="local-6989586621680057969"><span id="local-6989586621680057970"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#solveConstraint"><span class="hs-identifier hs-type">solveConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057969"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057970"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057970"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057969"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680057969"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680057969"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057969"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621680057969"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057969"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier hs-type">UniqueTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057969"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680057970"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057969"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057969"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-340"></span><span id="solveConstraint"><span class="annot"><span class="annottext">solveConstraint :: forall a (r :: [Effect]).
(Error (UnifyError a) :&gt; r, StructuredDebug :&gt; r, Pretty a, Eq a,
 Show a, HasCallStack, Monoid (Constraint a), Semigroup a) =&gt;
Constraint a
-&gt; Set UniqueTyVar
-&gt; Constraint a
-&gt; Eff r (Constraint a, Substitution a)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#solveConstraint"><span class="hs-identifier hs-var hs-var">solveConstraint</span></a></span></span><span> </span><span id="local-6989586621680059985"><span class="annot"><span class="annottext">Constraint a
</span><a href="#local-6989586621680059985"><span class="hs-identifier hs-var">given</span></a></span></span><span> </span><span id="local-6989586621680059986"><span class="annot"><span class="annottext">Set UniqueTyVar
</span><a href="#local-6989586621680059986"><span class="hs-identifier hs-var">tch</span></a></span></span><span> </span><span id="local-6989586621680059987"><span class="annot"><span class="annottext">Constraint a
</span><a href="#local-6989586621680059987"><span class="hs-identifier hs-var">wanted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680059988"><span class="annot"><a href="#local-6989586621680059988"><span class="hs-identifier hs-var">residual</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680059989"><span class="annot"><a href="#local-6989586621680059989"><span class="hs-identifier hs-var">unifier</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Constraint a
-&gt; Set UniqueTyVar
-&gt; Constraint a
-&gt; Eff r (Constraint a, Substitution a)
forall a (r :: [Effect]).
(Error (UnifyError a) :&gt; r, StructuredDebug :&gt; r, Pretty a, Eq a,
 Show a, HasCallStack, Monoid (Constraint a), Semigroup a) =&gt;
Constraint a
-&gt; Set UniqueTyVar
-&gt; Constraint a
-&gt; Eff r (Constraint a, Substitution a)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#simplifyConstraint"><span class="hs-identifier hs-var">simplifyConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint a
</span><a href="#local-6989586621680059985"><span class="hs-identifier hs-var">given</span></a></span><span> </span><span class="annot"><span class="annottext">Set UniqueTyVar
</span><a href="#local-6989586621680059986"><span class="hs-identifier hs-var">tch</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint a
</span><a href="#local-6989586621680059987"><span class="hs-identifier hs-var">wanted</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680059991"><span class="annot"><a href="#local-6989586621680059991"><span class="hs-identifier hs-var hs-var">residual'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constraint a -&gt; Constraint a
forall a. Constraint a -&gt; Constraint a
</span><a href="Elara.TypeInfer.Type.html#reduce"><span class="hs-identifier hs-var">reduce</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint a
</span><a href="#local-6989586621680059988"><span class="hs-identifier hs-var">residual</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680059991"><span class="hs-identifier hs-type">residual'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680059989"><span class="hs-identifier hs-type">unifier</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span id="local-6989586621680059992"><span id="local-6989586621680059993"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#simplifyConstraint"><span class="hs-identifier hs-type">simplifyConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059992"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680059993"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680059993"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059992"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680059992"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680059992"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059992"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621680059992"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-357"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059992"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier hs-type">UniqueTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059992"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680059993"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059992"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680059992"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-358"></span><span id="simplifyConstraint"><span class="annot"><span class="annottext">simplifyConstraint :: forall a (r :: [Effect]).
(Error (UnifyError a) :&gt; r, StructuredDebug :&gt; r, Pretty a, Eq a,
 Show a, HasCallStack, Monoid (Constraint a), Semigroup a) =&gt;
Constraint a
-&gt; Set UniqueTyVar
-&gt; Constraint a
-&gt; Eff r (Constraint a, Substitution a)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#simplifyConstraint"><span class="hs-identifier hs-var hs-var">simplifyConstraint</span></a></span></span><span> </span><span id="local-6989586621680060041"><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">given</span></a></span></span><span> </span><span id="local-6989586621680060042"><span class="annot"><span class="annottext">Set UniqueTyVar
</span><a href="#local-6989586621680060042"><span class="hs-identifier hs-var">tch</span></a></span></span><span> </span><span id="local-6989586621680060043"><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060043"><span class="hs-identifier hs-var">wanted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (Constraint loc, Substitution loc)
-&gt; Eff r (Constraint loc, Substitution loc)
forall (r :: [Effect]) a.
(StructuredDebug :&gt; r, Pretty a) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier hs-var">debugWithResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;simplifyConstraint: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Constraint loc, Constraint loc) -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">given</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060043"><span class="hs-identifier hs-var">wanted</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (Constraint loc, Substitution loc)
 -&gt; Eff r (Constraint loc, Substitution loc))
-&gt; Eff r (Constraint loc, Substitution loc)
-&gt; Eff r (Constraint loc, Substitution loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621680060044"><span class="annot"><a href="#local-6989586621680060044"><span class="hs-identifier hs-var">givenSubst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Constraint loc -&gt; Eff r (Substitution loc)
forall loc (r :: [Effect]).
(Pretty loc, Error (UnifyError loc) :&gt; r, StructuredDebug :&gt; r,
 Eq loc, Show loc, HasCallStack) =&gt;
Constraint loc -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#reduceGiven"><span class="hs-identifier hs-var">reduceGiven</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060041"><span class="hs-identifier hs-var">given</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;simplifyConstraint: givenSubst: &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060044"><span class="hs-identifier hs-type">givenSubst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">runReader</span></span><span> </span><span class="annot"><a href="#local-6989586621680060042"><span class="hs-identifier hs-type">tch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#solve"><span class="hs-identifier hs-type">solve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-type">substituteAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060044"><span class="hs-identifier hs-type">givenSubst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060043"><span class="hs-identifier hs-type">wanted</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span id="local-6989586621680057984"><span id="local-6989586621680057985"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#reduceGiven"><span class="hs-identifier hs-type">reduceGiven</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057984"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057984"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057985"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057985"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680057984"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680057984"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057984"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680057985"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057984"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-364"></span><span id="reduceGiven"><span class="annot"><span class="annottext">reduceGiven :: forall loc (r :: [Effect]).
(Pretty loc, Error (UnifyError loc) :&gt; r, StructuredDebug :&gt; r,
 Eq loc, Show loc, HasCallStack) =&gt;
Constraint loc -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#reduceGiven"><span class="hs-identifier hs-var hs-var">reduceGiven</span></a></span></span><span> </span><span id="local-6989586621680060093"><span class="annot"><span class="annottext">eq :: Constraint loc
</span><a href="#local-6989586621680060093"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-type">Equality</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060094"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060095"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060095"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (Substitution loc) -&gt; Eff r (Substitution loc)
forall (r :: [Effect]) a.
(StructuredDebug :&gt; r, Pretty a) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier hs-var">debugWithResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;reduceGiven: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constraint loc -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060093"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (Substitution loc) -&gt; Eff r (Substitution loc))
-&gt; Eff r (Substitution loc) -&gt; Eff r (Substitution loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
-&gt; Monotype loc -&gt; Monotype loc -&gt; Eff r (Substitution loc)
forall loc (r :: [Effect]).
(Pretty loc, Error (UnifyError loc) :&gt; r, StructuredDebug :&gt; r,
 Show loc, Eq loc) =&gt;
Maybe (Constraint loc)
-&gt; Monotype loc -&gt; Monotype loc -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGiven"><span class="hs-identifier hs-var">unifyGiven</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constraint loc -&gt; Maybe (Constraint loc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060093"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060094"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060095"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-365"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#reduceGiven"><span class="hs-identifier hs-var">reduceGiven</span></a></span><span> </span><span id="local-6989586621680060097"><span class="annot"><span class="annottext">conj :: Constraint loc
</span><a href="#local-6989586621680060097"><span class="hs-identifier hs-var">conj</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Conjunction"><span class="hs-identifier hs-type">Conjunction</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060099"><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060100"><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060100"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
-&gt; Eff r (Substitution loc) -&gt; Eff r (Substitution loc)
forall (r :: [Effect]) a.
(StructuredDebug :&gt; r, Pretty a) =&gt;
Doc AnsiStyle -&gt; Eff r a -&gt; Eff r a
</span><a href="Elara.Logging.html#debugWithResult"><span class="hs-identifier hs-var">debugWithResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;reduceGiven: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constraint loc -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060097"><span class="hs-identifier hs-var">conj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff r (Substitution loc) -&gt; Eff r (Substitution loc))
-&gt; Eff r (Substitution loc) -&gt; Eff r (Substitution loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-366"></span><span>    </span><span id="local-6989586621680060101"><span class="annot"><a href="#local-6989586621680060101"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Constraint loc -&gt; Eff r (Substitution loc)
forall loc (r :: [Effect]).
(Pretty loc, Error (UnifyError loc) :&gt; r, StructuredDebug :&gt; r,
 Eq loc, Show loc, HasCallStack) =&gt;
Constraint loc -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#reduceGiven"><span class="hs-identifier hs-var">reduceGiven</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060099"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span id="local-6989586621680060102"><span class="annot"><a href="#local-6989586621680060102"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#reduceGiven"><span class="hs-identifier hs-type">reduceGiven</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-type">substituteAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060101"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060100"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680060101"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680060102"><span class="hs-identifier hs-type">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#reduceGiven"><span class="hs-identifier hs-var">reduceGiven</span></a></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#EmptyConstraint"><span class="hs-identifier hs-type">EmptyConstraint</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Substitution loc -&gt; Eff r (Substitution loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Substitution loc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span id="local-6989586621680057989"><span id="local-6989586621680057990"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#solve"><span class="hs-identifier hs-type">solve</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057989"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057990"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057990"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier hs-type">UniqueTyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057990"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680057989"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680057989"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057989"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621680057989"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-381"></span><span>    </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057989"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-382"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057989"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680057990"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057989"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057989"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-384"></span><span id="solve"><span class="annot"><span class="annottext">solve :: forall loc (r :: [Effect]).
(Error (UnifyError loc) :&gt; r, StructuredDebug :&gt; r,
 Reader (Set UniqueTyVar) :&gt; r, Eq loc, Show loc, HasCallStack,
 Monoid (Constraint loc), Semigroup loc, Pretty loc) =&gt;
Constraint loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#solve"><span class="hs-identifier hs-var hs-var">solve</span></a></span></span><span> </span><span id="local-6989586621680060146"><span class="annot"><span class="annottext">constraint :: Constraint loc
</span><a href="#local-6989586621680060146"><span class="hs-identifier hs-var">constraint</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-type">Equality</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060147"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060147"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060148"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060148"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="">?constraint</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Constraint loc -&gt; Maybe (Constraint loc)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060146"><span class="hs-identifier hs-var">constraint</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Monotype loc
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
forall loc (r :: [Effect]).
(HasCallStack, StructuredDebug :&gt; r, Error (UnifyError loc) :&gt; r,
 Reader (Set UniqueTyVar) :&gt; r, Pretty loc, Pretty (Constraint loc),
 Eq loc, Show loc, ?constraint::Maybe (Constraint loc),
 Monoid (Constraint loc), Semigroup loc) =&gt;
Monotype loc
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060147"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060148"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-386"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#solve"><span class="hs-identifier hs-var">solve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Conjunction"><span class="hs-identifier hs-type">Conjunction</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060163"><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060163"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060164"><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060164"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-comment">-- a lot of this is duplicated from unifyMany which is a bit annoying</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680060165"><span class="annot"><a href="#local-6989586621680060165"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680060166"><span class="annot"><a href="#local-6989586621680060166"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Constraint loc -&gt; Eff r (Constraint loc, Substitution loc)
forall loc (r :: [Effect]).
(Error (UnifyError loc) :&gt; r, StructuredDebug :&gt; r,
 Reader (Set UniqueTyVar) :&gt; r, Eq loc, Show loc, HasCallStack,
 Monoid (Constraint loc), Semigroup loc, Pretty loc) =&gt;
Constraint loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#solve"><span class="hs-identifier hs-var">solve</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint loc
</span><a href="#local-6989586621680060163"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-comment">-- apply s1 to b before unifying</span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680060167"><span class="annot"><a href="#local-6989586621680060167"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680060168"><span class="annot"><a href="#local-6989586621680060168"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#solve"><span class="hs-identifier hs-type">solve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-type">substituteAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060166"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060164"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680060165"><span class="hs-identifier hs-type">c1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680060167"><span class="hs-identifier hs-type">c2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680060166"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680060168"><span class="hs-identifier hs-type">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#solve"><span class="hs-identifier hs-var">solve</span></a></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#EmptyConstraint"><span class="hs-identifier hs-type">EmptyConstraint</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Constraint loc, Substitution loc)
-&gt; Eff r (Constraint loc, Substitution loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Constraint loc, Substitution loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span id="local-6989586621680057995"><span id="local-6989586621680057996"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGiven"><span class="hs-identifier hs-type">unifyGiven</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057995"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057995"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057996"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680057996"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680057995"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680057995"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-396"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057995"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057995"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057995"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680057996"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057995"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-397"></span><span id="unifyGiven"><span class="annot"><span class="annottext">unifyGiven :: forall loc (r :: [Effect]).
(Pretty loc, Error (UnifyError loc) :&gt; r, StructuredDebug :&gt; r,
 Show loc, Eq loc) =&gt;
Maybe (Constraint loc)
-&gt; Monotype loc -&gt; Monotype loc -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGiven"><span class="hs-identifier hs-var hs-var">unifyGiven</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060218"><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060218"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680060219"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060219"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeVariable -&gt; Monotype loc -&gt; Eff r (Substitution loc)
forall (r :: [Effect]) loc.
(StructuredDebug :&gt; r, Error (UnifyError loc) :&gt; r, Show loc) =&gt;
TypeVariable -&gt; Monotype loc -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#bindGiven"><span class="hs-identifier hs-var">bindGiven</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060218"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060219"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-398"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGiven"><span class="hs-identifier hs-var">unifyGiven</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060221"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060221"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060222"><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060222"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeVariable -&gt; Monotype loc -&gt; Eff r (Substitution loc)
forall (r :: [Effect]) loc.
(StructuredDebug :&gt; r, Error (UnifyError loc) :&gt; r, Show loc) =&gt;
TypeVariable -&gt; Monotype loc -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#bindGiven"><span class="hs-identifier hs-var">bindGiven</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060222"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060221"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-399"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGiven"><span class="hs-identifier hs-var">unifyGiven</span></a></span><span> </span><span id="local-6989586621680060223"><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><a href="#local-6989586621680060223"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeConstructor"><span class="hs-identifier hs-type">TypeConstructor</span></a></span><span> </span><span id="local-6989586621680060224"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060224"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621680060225"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060225"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060226"><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060226"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeConstructor"><span class="hs-identifier hs-type">TypeConstructor</span></a></span><span> </span><span id="local-6989586621680060227"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060227"><span class="hs-identifier hs-var">l2</span></a></span></span><span> </span><span id="local-6989586621680060228"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060228"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680060229"><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060229"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060225"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName -&gt; Qualified TypeName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060228"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(UnifyError loc -&gt; Eff r (Substitution loc))
-&gt; UnifyError loc -&gt; Eff r (Substitution loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(loc, Qualified TypeName)
-&gt; (loc, Qualified TypeName) -&gt; UnifyError loc
forall loc.
(loc, Qualified TypeName)
-&gt; (loc, Qualified TypeName) -&gt; UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#TypeConstructorMismatch"><span class="hs-identifier hs-var">TypeConstructorMismatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060224"><span class="hs-identifier hs-var">l1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060225"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060227"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060228"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Monotype loc] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060226"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">[Monotype loc] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060229"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">UnifyError loc
forall loc. UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#ArityMismatch"><span class="hs-identifier hs-var">ArityMismatch</span></a></span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
-&gt; [Monotype loc] -&gt; [Monotype loc] -&gt; Eff r (Substitution loc)
forall {loc} {r :: [Effect]}.
(Pretty loc, Error (UnifyError loc) :&gt; r, StructuredDebug :&gt; r,
 Show loc, Eq loc) =&gt;
Maybe (Constraint loc)
-&gt; [Monotype loc] -&gt; [Monotype loc] -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGivenMany"><span class="hs-identifier hs-var">unifyGivenMany</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><a href="#local-6989586621680060223"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060226"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060229"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-403"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGiven"><span class="hs-identifier hs-var">unifyGiven</span></a></span><span> </span><span id="local-6989586621680060233"><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><a href="#local-6989586621680060233"><span class="hs-identifier hs-var">constraint</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060234"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060234"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060235"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060235"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060236"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060236"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680060237"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060237"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
-&gt; [Monotype loc] -&gt; [Monotype loc] -&gt; Eff r (Substitution loc)
forall {loc} {r :: [Effect]}.
(Pretty loc, Error (UnifyError loc) :&gt; r, StructuredDebug :&gt; r,
 Show loc, Eq loc) =&gt;
Maybe (Constraint loc)
-&gt; [Monotype loc] -&gt; [Monotype loc] -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGivenMany"><span class="hs-identifier hs-var">unifyGivenMany</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><a href="#local-6989586621680060233"><span class="hs-identifier hs-var">constraint</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060234"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060235"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060236"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060237"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-404"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGiven"><span class="hs-identifier hs-var">unifyGiven</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span id="local-6989586621680060238"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060238"><span class="hs-identifier hs-var">locA</span></a></span></span><span> </span><span id="local-6989586621680060239"><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060239"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span id="local-6989586621680060240"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060240"><span class="hs-identifier hs-var">locB</span></a></span></span><span> </span><span id="local-6989586621680060241"><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060241"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060239"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar -&gt; Scalar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060241"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-406"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Substitution loc -&gt; Eff r (Substitution loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Substitution loc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-407"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(UnifyError loc -&gt; Eff r (Substitution loc))
-&gt; UnifyError loc -&gt; Eff r (Substitution loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(loc, Scalar) -&gt; (loc, Scalar) -&gt; UnifyError loc
forall loc. (loc, Scalar) -&gt; (loc, Scalar) -&gt; UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#ScalarMismatch"><span class="hs-identifier hs-var">ScalarMismatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060238"><span class="hs-identifier hs-var">locA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060239"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060240"><span class="hs-identifier hs-var">locB</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060241"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGiven"><span class="hs-identifier hs-var">unifyGiven</span></a></span><span> </span><span id="local-6989586621680060243"><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><a href="#local-6989586621680060243"><span class="hs-identifier hs-var">constraint</span></a></span></span><span> </span><span id="local-6989586621680060244"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060244"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060245"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060245"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(UnifyError loc -&gt; Eff r (Substitution loc))
-&gt; UnifyError loc -&gt; Eff r (Substitution loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
-&gt; (Monotype loc, Monotype loc) -&gt; UnifyError loc
forall loc.
Maybe (Constraint loc)
-&gt; (Monotype loc, Monotype loc) -&gt; UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#UnificationFailed"><span class="hs-identifier hs-var">UnificationFailed</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><a href="#local-6989586621680060243"><span class="hs-identifier hs-var">constraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060244"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060245"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span id="unifyGivenMany"><span class="annot"><span class="annottext">unifyGivenMany :: Maybe (Constraint loc)
-&gt; [Monotype loc] -&gt; [Monotype loc] -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGivenMany"><span class="hs-identifier hs-var hs-var">unifyGivenMany</span></a></span></span><span> </span><span id="local-6989586621680060267"><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><a href="#local-6989586621680060267"><span class="hs-identifier hs-var">constraint</span></a></span></span><span> </span><span id="local-6989586621680060268"><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060268"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span id="local-6989586621680060269"><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060269"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Monotype loc, Monotype loc)
 -&gt; Substitution loc -&gt; Eff r (Substitution loc))
-&gt; Substitution loc
-&gt; [(Monotype loc, Monotype loc)]
-&gt; Eff r (Substitution loc)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; b -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldrM</span></span><span> </span><span class="annot"><span class="annottext">(Monotype loc, Monotype loc)
-&gt; Substitution loc -&gt; Eff r (Substitution loc)
</span><a href="#local-6989586621680060270"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution loc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Monotype loc] -&gt; [Monotype loc] -&gt; [(Monotype loc, Monotype loc)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060268"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060269"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-412"></span><span>    </span><span id="local-6989586621680060270"><span class="annot"><span class="annottext">go :: (Monotype loc, Monotype loc)
-&gt; Substitution loc -&gt; Eff r (Substitution loc)
</span><a href="#local-6989586621680060270"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680060271"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060271"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680060272"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060272"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680060273"><span class="annot"><span class="annottext">Substitution loc
</span><a href="#local-6989586621680060273"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-413"></span><span>        </span><span id="local-6989586621680060274"><span class="annot"><a href="#local-6989586621680060274"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
-&gt; Monotype loc -&gt; Monotype loc -&gt; Eff r (Substitution loc)
forall loc (r :: [Effect]).
(Pretty loc, Error (UnifyError loc) :&gt; r, StructuredDebug :&gt; r,
 Show loc, Eq loc) =&gt;
Maybe (Constraint loc)
-&gt; Monotype loc -&gt; Monotype loc -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyGiven"><span class="hs-identifier hs-var">unifyGiven</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
</span><a href="#local-6989586621680060267"><span class="hs-identifier hs-var">constraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution loc -&gt; Monotype loc -&gt; Monotype loc
forall (a :: * -&gt; *) loc.
(Substitutable a loc, Eq (a loc)) =&gt;
Substitution loc -&gt; a loc -&gt; a loc
</span><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-var">substituteAll</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution loc
</span><a href="#local-6989586621680060273"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060271"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Substitution loc -&gt; Monotype loc -&gt; Monotype loc
forall (a :: * -&gt; *) loc.
(Substitutable a loc, Eq (a loc)) =&gt;
Substitution loc -&gt; a loc -&gt; a loc
</span><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-var">substituteAll</span></a></span><span> </span><span class="annot"><span class="annottext">Substitution loc
</span><a href="#local-6989586621680060273"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060272"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680060273"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680060274"><span class="hs-identifier hs-type">s'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unify"><span class="hs-identifier hs-type">unify</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680058003"><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span></span><span> </span><span id="local-6989586621680058002"><span class="annot"><a href="#local-6989586621680058002"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058002"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058002"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier hs-type">UniqueTyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058002"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-423"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">?constraint</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680058002"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span id="unify"><span class="annot"><span class="annottext">unify :: forall loc (r :: [Effect]).
(HasCallStack, StructuredDebug :&gt; r, Error (UnifyError loc) :&gt; r,
 Reader (Set UniqueTyVar) :&gt; r, Pretty loc, Pretty (Constraint loc),
 Eq loc, Show loc, ?constraint::Maybe (Constraint loc),
 Monoid (Constraint loc), Semigroup loc) =&gt;
Monotype loc
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unify"><span class="hs-identifier hs-var hs-var">unify</span></a></span></span><span> </span><span id="local-6989586621680060349"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060349"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060350"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060350"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-434"></span><span>    </span><span class="annot"><span class="annottext">Monotype loc
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="#local-6989586621680060351"><span class="hs-identifier hs-var">unify'</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060349"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060350"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-436"></span><span>    </span><span class="annot"><a href="#local-6989586621680060351"><span class="hs-identifier hs-type">unify'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-437"></span><span>        </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680058002"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058003"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>    </span><span id="local-6989586621680060351"><span class="annot"><span class="annottext">unify' :: Monotype loc
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="#local-6989586621680060351"><span class="hs-identifier hs-var hs-var">unify'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060352"><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060352"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060353"><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060353"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060352"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable -&gt; TypeVariable -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060353"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Constraint loc, Substitution loc)
-&gt; Eff r (Constraint loc, Substitution loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constraint loc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Substitution loc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><a href="#local-6989586621680060351"><span class="hs-identifier hs-var">unify'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-type">UnificationVar</span></a></span><span> </span><span id="local-6989586621680060354"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060354"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680060355"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060355"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
forall loc (r :: [Effect]).
(StructuredDebug :&gt; r, Error (UnifyError loc) :&gt; r,
 Reader (Set UniqueTyVar) :&gt; r, Show loc, Eq loc) =&gt;
UniqueTyVar
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyVar"><span class="hs-identifier hs-var">unifyVar</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060354"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060355"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><a href="#local-6989586621680060351"><span class="hs-identifier hs-var">unify'</span></a></span><span> </span><span id="local-6989586621680060357"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060357"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-type">UnificationVar</span></a></span><span> </span><span id="local-6989586621680060358"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060358"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
forall loc (r :: [Effect]).
(StructuredDebug :&gt; r, Error (UnifyError loc) :&gt; r,
 Reader (Set UniqueTyVar) :&gt; r, Show loc, Eq loc) =&gt;
UniqueTyVar
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyVar"><span class="hs-identifier hs-var">unifyVar</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060358"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060357"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><a href="#local-6989586621680060351"><span class="hs-identifier hs-var">unify'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span id="local-6989586621680060359"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060359"><span class="hs-identifier hs-var">locA</span></a></span></span><span> </span><span id="local-6989586621680060360"><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060360"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span> </span><span id="local-6989586621680060361"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060361"><span class="hs-identifier hs-var">locB</span></a></span></span><span> </span><span id="local-6989586621680060362"><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060362"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-443"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060360"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Scalar -&gt; Scalar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060362"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-444"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Constraint loc, Substitution loc)
-&gt; Eff r (Constraint loc, Substitution loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Constraint loc, Substitution loc)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-445"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc))
-&gt; UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(loc, Scalar) -&gt; (loc, Scalar) -&gt; UnifyError loc
forall loc. (loc, Scalar) -&gt; (loc, Scalar) -&gt; UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#ScalarMismatch"><span class="hs-identifier hs-var">ScalarMismatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060359"><span class="hs-identifier hs-var">locA</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060360"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060361"><span class="hs-identifier hs-var">locB</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scalar
</span><a href="#local-6989586621680060362"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>    </span><span class="annot"><a href="#local-6989586621680060351"><span class="hs-identifier hs-var">unify'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeConstructor"><span class="hs-identifier hs-type">TypeConstructor</span></a></span><span> </span><span id="local-6989586621680060363"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060363"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621680060364"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060364"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060365"><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060365"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeConstructor"><span class="hs-identifier hs-type">TypeConstructor</span></a></span><span> </span><span id="local-6989586621680060366"><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060366"><span class="hs-identifier hs-var">l2</span></a></span></span><span> </span><span id="local-6989586621680060367"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060367"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680060368"><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060368"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060364"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName -&gt; Qualified TypeName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060367"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc))
-&gt; UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(loc, Qualified TypeName)
-&gt; (loc, Qualified TypeName) -&gt; UnifyError loc
forall loc.
(loc, Qualified TypeName)
-&gt; (loc, Qualified TypeName) -&gt; UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#TypeConstructorMismatch"><span class="hs-identifier hs-var">TypeConstructorMismatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060363"><span class="hs-identifier hs-var">l1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060364"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">loc
</span><a href="#local-6989586621680060366"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680060367"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Monotype loc] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060365"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">[Monotype loc] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060368"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">UnifyError loc
forall loc. UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#ArityMismatch"><span class="hs-identifier hs-var">ArityMismatch</span></a></span><span>
</span><span id="line-449"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
-&gt; [Monotype loc] -&gt; Eff r (Constraint loc, Substitution loc)
forall (r :: [Effect]) loc.
(HasCallStack, StructuredDebug :&gt; r, Pretty loc,
 Reader (Set UniqueTyVar) :&gt; r, Eq loc, Show loc, Semigroup loc,
 Monoid (Constraint loc), ?constraint::Maybe (Constraint loc),
 Error (UnifyError loc) :&gt; r) =&gt;
[Monotype loc]
-&gt; [Monotype loc] -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyMany"><span class="hs-identifier hs-var">unifyMany</span></a></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060365"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060368"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-450"></span><span>    </span><span class="annot"><a href="#local-6989586621680060351"><span class="hs-identifier hs-var">unify'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060370"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060370"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060371"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060371"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Function"><span class="hs-identifier hs-type">Function</span></a></span><span> </span><span class="annot"><span class="annottext">loc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680060372"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060372"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621680060373"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060373"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
-&gt; [Monotype loc] -&gt; Eff r (Constraint loc, Substitution loc)
forall (r :: [Effect]) loc.
(HasCallStack, StructuredDebug :&gt; r, Pretty loc,
 Reader (Set UniqueTyVar) :&gt; r, Eq loc, Show loc, Semigroup loc,
 Monoid (Constraint loc), ?constraint::Maybe (Constraint loc),
 Error (UnifyError loc) :&gt; r) =&gt;
[Monotype loc]
-&gt; [Monotype loc] -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyMany"><span class="hs-identifier hs-var">unifyMany</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060370"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060371"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060372"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060373"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-451"></span><span>    </span><span class="annot"><a href="#local-6989586621680060351"><span class="hs-identifier hs-var">unify'</span></a></span><span> </span><span id="local-6989586621680060374"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060374"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060375"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060375"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc))
-&gt; UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint loc)
-&gt; (Monotype loc, Monotype loc) -&gt; UnifyError loc
forall loc.
Maybe (Constraint loc)
-&gt; (Monotype loc, Monotype loc) -&gt; UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#UnificationFailed"><span class="hs-identifier hs-var">UnificationFailed</span></a></span><span> </span><span class="annot"><span class="annottext">?constraint::Maybe (Constraint loc)
Maybe (Constraint loc)
</span><a href="#local-6989586621680060348"><span class="hs-var">?constraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060374"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060375"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span id="local-6989586621680058007"><span id="local-6989586621680058008"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#bindGiven"><span class="hs-identifier hs-type">bindGiven</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058007"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058008"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058007"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680058008"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-455"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVariable"><span class="hs-identifier hs-type">TypeVariable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058008"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680058007"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058008"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-456"></span><span id="bindGiven"><span class="annot"><span class="annottext">bindGiven :: forall (r :: [Effect]) loc.
(StructuredDebug :&gt; r, Error (UnifyError loc) :&gt; r, Show loc) =&gt;
TypeVariable -&gt; Monotype loc -&gt; Eff r (Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#bindGiven"><span class="hs-identifier hs-var hs-var">bindGiven</span></a></span></span><span> </span><span id="local-6989586621680060388"><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060388"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060389"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060389"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TypeVariable -&gt; Set TypeVariable -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">member</span></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060388"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Monotype loc -&gt; Set TypeVariable
forall a. Ftv a =&gt; a -&gt; Set TypeVariable
</span><a href="Elara.TypeInfer.Ftv.html#ftv"><span class="hs-identifier hs-var">ftv</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060389"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeVariable -&gt; Monotype loc -&gt; UnifyError loc
forall loc. TypeVariable -&gt; Monotype loc -&gt; UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#OccursCheckFailed"><span class="hs-identifier hs-var">OccursCheckFailed</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060388"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060389"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Substitution loc -&gt; Eff r (Substitution loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(UniqueTyVar, Monotype loc) -&gt; Substitution loc
forall loc. (UniqueTyVar, Monotype loc) -&gt; Substitution loc
</span><a href="Elara.TypeInfer.Type.html#substitution"><span class="hs-identifier hs-var">substitution</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeVariable -&gt; UniqueTyVar
</span><a href="#local-6989586621680060392"><span class="hs-identifier hs-var">tvValue</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060388"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060389"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-461"></span><span>    </span><span id="local-6989586621680060392"><span class="annot"><span class="annottext">tvValue :: TypeVariable -&gt; UniqueTyVar
</span><a href="#local-6989586621680060392"><span class="hs-identifier hs-var hs-var">tvValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-type">UnificationVar</span></a></span><span> </span><span id="local-6989586621680060393"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060393"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060393"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-462"></span><span>    </span><span class="annot"><a href="#local-6989586621680060392"><span class="hs-identifier hs-var">tvValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#SkolemVar"><span class="hs-identifier hs-type">SkolemVar</span></a></span><span> </span><span id="local-6989586621680060394"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060394"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060394"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyVar"><span class="hs-identifier hs-type">unifyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680058018"><span class="annot"><a href="#local-6989586621680058018"><span class="hs-identifier hs-type">loc</span></a></span></span><span> </span><span id="local-6989586621680058017"><span class="annot"><a href="#local-6989586621680058017"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058017"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058018"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058017"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier hs-type">UniqueTyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058017"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-469"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680058018"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-470"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680058018"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier hs-type">UniqueTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058018"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-474"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680058017"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058018"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058018"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span id="unifyVar"><span class="annot"><span class="annottext">unifyVar :: forall loc (r :: [Effect]).
(StructuredDebug :&gt; r, Error (UnifyError loc) :&gt; r,
 Reader (Set UniqueTyVar) :&gt; r, Show loc, Eq loc) =&gt;
UniqueTyVar
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyVar"><span class="hs-identifier hs-var hs-var">unifyVar</span></a></span></span><span> </span><span id="local-6989586621680060442"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060442"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060443"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060443"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Eff r ()
forall (r :: [Effect]).
(HasCallStack, StructuredDebug :&gt; r) =&gt;
Doc AnsiStyle -&gt; Eff r ()
</span><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-var">debug</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; Eff r ()) -&gt; Doc AnsiStyle -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;bind &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060442"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot; to &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Monotype loc -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060443"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-477"></span><span>    </span><span class="annot"><span class="annottext">UniqueTyVar
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="#local-6989586621680060444"><span class="hs-identifier hs-var">bindVar</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060442"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060443"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><a href="#local-6989586621680060444"><span class="hs-identifier hs-type">bindVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier hs-type">UniqueTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058018"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680058017"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058018"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058018"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>    </span><span id="local-6989586621680060444"><span class="annot"><span class="annottext">bindVar :: UniqueTyVar
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="#local-6989586621680060444"><span class="hs-identifier hs-var hs-var">bindVar</span></a></span></span><span> </span><span id="local-6989586621680060445"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060445"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621680060446"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060446"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UniqueTyVar -&gt; Set UniqueTyVar -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">member</span></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060445"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Monotype loc -&gt; Set UniqueTyVar
forall a. Fuv a =&gt; a -&gt; Set UniqueTyVar
</span><a href="Elara.TypeInfer.Ftv.html#fuv"><span class="hs-identifier hs-var">fuv</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060446"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeVariable -&gt; Monotype loc -&gt; UnifyError loc
forall loc. TypeVariable -&gt; Monotype loc -&gt; UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#OccursCheckFailed"><span class="hs-identifier hs-var">OccursCheckFailed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqueTyVar -&gt; TypeVariable
</span><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-var">UnificationVar</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060445"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060446"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><a href="#local-6989586621680060444"><span class="hs-identifier hs-var">bindVar</span></a></span><span> </span><span id="local-6989586621680060447"><span class="annot"><span class="annottext">UniqueTyVar
</span><a href="#local-6989586621680060447"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621680060448"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060448"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-482"></span><span>        </span><span id="local-6989586621680060449"><span class="annot"><a href="#local-6989586621680060449"><span class="hs-identifier hs-var">tch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff r (Set UniqueTyVar)
forall r (es :: [Effect]).
(HasCallStack, Reader r :&gt; es) =&gt;
Eff es r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-483"></span><span>        </span><span class="annot"><a href="Elara.Logging.html#debug"><span class="hs-identifier hs-type">debug</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;bindVar &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060447"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot; to &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-type">pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060448"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">member</span></span><span> </span><span class="annot"><a href="#local-6989586621680060447"><span class="hs-identifier hs-type">tv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060449"><span class="hs-identifier hs-type">tch</span></a></span><span>
</span><span id="line-485"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#EmptyConstraint"><span class="hs-identifier hs-type">EmptyConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#monotypeLoc"><span class="hs-identifier hs-type">monotypeLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060448"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#substitution"><span class="hs-identifier hs-type">substitution</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680060447"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680060448"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Equality"><span class="hs-identifier hs-type">Equality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#monotypeLoc"><span class="hs-identifier hs-type">monotypeLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060448"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVar"><span class="hs-identifier hs-type">TypeVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#monotypeLoc"><span class="hs-identifier hs-type">monotypeLoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060448"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#UnificationVar"><span class="hs-identifier hs-type">UnificationVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060447"><span class="hs-identifier hs-type">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680060448"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span id="local-6989586621680058019"><span id="local-6989586621680058020"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyMany"><span class="hs-identifier hs-type">unifyMany</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Logging.html#StructuredDebug"><span class="hs-identifier hs-type">StructuredDebug</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058019"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-492"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Unique.html#UniqueTyVar"><span class="hs-identifier hs-type">UniqueTyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058019"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-493"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-494"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-496"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="">?constraint</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-499"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680058019"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680058019"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058020"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-503"></span><span id="unifyMany"><span class="annot"><span class="annottext">unifyMany :: forall (r :: [Effect]) loc.
(HasCallStack, StructuredDebug :&gt; r, Pretty loc,
 Reader (Set UniqueTyVar) :&gt; r, Eq loc, Show loc, Semigroup loc,
 Monoid (Constraint loc), ?constraint::Maybe (Constraint loc),
 Error (UnifyError loc) :&gt; r) =&gt;
[Monotype loc]
-&gt; [Monotype loc] -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyMany"><span class="hs-identifier hs-var hs-var">unifyMany</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Constraint loc, Substitution loc)
-&gt; Eff r (Constraint loc, Substitution loc)
forall a. a -&gt; Eff r a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constraint loc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Substitution loc
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyMany"><span class="hs-identifier hs-var">unifyMany</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">UnifyError loc
forall loc. UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyMismatch"><span class="hs-identifier hs-var">UnifyMismatch</span></a></span><span>
</span><span id="line-505"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyMany"><span class="hs-identifier hs-var">unifyMany</span></a></span><span> </span><span class="annot"><span class="annottext">[Monotype loc]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r (Constraint loc, Substitution loc)
forall e (es :: [Effect]) a.
(HasCallStack, Error e :&gt; es, Show e) =&gt;
e -&gt; Eff es a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">UnifyError loc
forall loc. UnifyError loc
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyMismatch"><span class="hs-identifier hs-var">UnifyMismatch</span></a></span><span>
</span><span id="line-506"></span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyMany"><span class="hs-identifier hs-var">unifyMany</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680060510"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060510"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680060511"><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060511"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680060512"><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060512"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680060513"><span class="annot"><span class="annottext">[Monotype loc]
</span><a href="#local-6989586621680060513"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-507"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680060514"><span class="annot"><a href="#local-6989586621680060514"><span class="hs-identifier hs-var">c1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680060515"><span class="annot"><a href="#local-6989586621680060515"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Monotype loc
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
forall loc (r :: [Effect]).
(HasCallStack, StructuredDebug :&gt; r, Error (UnifyError loc) :&gt; r,
 Reader (Set UniqueTyVar) :&gt; r, Pretty loc, Pretty (Constraint loc),
 Eq loc, Show loc, ?constraint::Maybe (Constraint loc),
 Monoid (Constraint loc), Semigroup loc) =&gt;
Monotype loc
-&gt; Monotype loc -&gt; Eff r (Constraint loc, Substitution loc)
</span><a href="Elara.TypeInfer.ConstraintGeneration.html#unify"><span class="hs-identifier hs-var">unify</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060510"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype loc
</span><a href="#local-6989586621680060512"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-508"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680060516"><span class="annot"><a href="#local-6989586621680060516"><span class="hs-identifier hs-var">c2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680060517"><span class="annot"><a href="#local-6989586621680060517"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#unifyMany"><span class="hs-identifier hs-type">unifyMany</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-type">substituteAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060515"><span class="hs-identifier hs-type">s1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680060511"><span class="hs-keyword hs-type">as</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#substituteAll"><span class="hs-identifier hs-type">substituteAll</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680060515"><span class="hs-identifier hs-type">s1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680060513"><span class="hs-identifier hs-type">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680060514"><span class="hs-identifier hs-type">c1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680060516"><span class="hs-identifier hs-type">c2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680060515"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621680060517"><span class="hs-identifier hs-type">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>
</span><span id="line-511"></span><span class="hs-keyword">data</span><span> </span><span id="UnifyError"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-var">UnifyError</span></a></span></span><span> </span><span id="local-6989586621680057932"><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span></span><span>
</span><span id="line-512"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="OccursCheckFailed"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#OccursCheckFailed"><span class="hs-identifier hs-var">OccursCheckFailed</span></a></span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#TypeVariable"><span class="hs-identifier hs-type">TypeVariable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ScalarMismatch"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#ScalarMismatch"><span class="hs-identifier hs-var">ScalarMismatch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Scalar"><span class="hs-identifier hs-type">Scalar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TypeConstructorMismatch"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#TypeConstructorMismatch"><span class="hs-identifier hs-var">TypeConstructorMismatch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#TypeName"><span class="hs-identifier hs-type">TypeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ArityMismatch"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#ArityMismatch"><span class="hs-identifier hs-var">ArityMismatch</span></a></span></span><span>
</span><span id="line-516"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnificationFailed"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnificationFailed"><span class="hs-identifier hs-var">UnificationFailed</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#Monotype"><span class="hs-identifier hs-type">Monotype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnifyMismatch"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyMismatch"><span class="hs-identifier hs-var">UnifyMismatch</span></a></span></span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="UnresolvedConstraint"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnresolvedConstraint"><span class="hs-identifier hs-var">UnresolvedConstraint</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.Type.html#Constraint"><span class="hs-identifier hs-type">Constraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="PatternConstructorArityMismatch"><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#PatternConstructorArityMismatch"><span class="hs-identifier hs-var">PatternConstructorArityMismatch</span></a></span></span><span> </span><span class="annot"><a href="Elara.TypeInfer.Type.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="#local-6989586621680057932"><span class="hs-identifier hs-type">loc</span></a></span><span>
</span><span id="line-520"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680060520"><span id="local-6989586621680060522"><span class="annot"><span class="annottext">(forall x. UnifyError loc -&gt; Rep (UnifyError loc) x)
-&gt; (forall x. Rep (UnifyError loc) x -&gt; UnifyError loc)
-&gt; Generic (UnifyError loc)
forall x. Rep (UnifyError loc) x -&gt; UnifyError loc
forall x. UnifyError loc -&gt; Rep (UnifyError loc) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall loc x. Rep (UnifyError loc) x -&gt; UnifyError loc
forall loc x. UnifyError loc -&gt; Rep (UnifyError loc) x
$cfrom :: forall loc x. UnifyError loc -&gt; Rep (UnifyError loc) x
from :: forall x. UnifyError loc -&gt; Rep (UnifyError loc) x
$cto :: forall loc x. Rep (UnifyError loc) x -&gt; UnifyError loc
to :: forall x. Rep (UnifyError loc) x -&gt; UnifyError loc
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680060529"><span id="local-6989586621680060562"><span id="local-6989586621680060565"><span class="annot"><span class="annottext">Int -&gt; UnifyError loc -&gt; ShowS
[UnifyError loc] -&gt; ShowS
UnifyError loc -&gt; String
(Int -&gt; UnifyError loc -&gt; ShowS)
-&gt; (UnifyError loc -&gt; String)
-&gt; ([UnifyError loc] -&gt; ShowS)
-&gt; Show (UnifyError loc)
forall loc. Show loc =&gt; Int -&gt; UnifyError loc -&gt; ShowS
forall loc. Show loc =&gt; [UnifyError loc] -&gt; ShowS
forall loc. Show loc =&gt; UnifyError loc -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall loc. Show loc =&gt; Int -&gt; UnifyError loc -&gt; ShowS
showsPrec :: Int -&gt; UnifyError loc -&gt; ShowS
$cshow :: forall loc. Show loc =&gt; UnifyError loc -&gt; String
show :: UnifyError loc -&gt; String
$cshowList :: forall loc. Show loc =&gt; [UnifyError loc] -&gt; ShowS
showList :: [UnifyError loc] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680058084"><span id="local-6989586621680060576"><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058084"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058084"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680058091"><span id="local-6989586621680060686"><span id="local-6989586621680060690"><span class="annot"><a href="Elara.Data.Pretty.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058091"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Elara.Error.html#ReportableError"><span class="hs-identifier hs-type">ReportableError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680058091"><span class="hs-identifier hs-type">loc</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-525"></span><span>    </span><span id="local-6989586621680060698"><span class="annot"><span class="annottext">report :: forall (r :: [Effect]).
(DiagnosticWriter (Doc AnsiStyle) :&gt; r) =&gt;
UnifyError loc -&gt; Eff r ()
</span><a href="#local-6989586621680060698"><span class="hs-identifier hs-var hs-var hs-var">report</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError loc -&gt; Eff r ()
forall e (r :: [Effect]).
(ReportableError e, Pretty e,
 DiagnosticWriter (Doc AnsiStyle) :&gt; r) =&gt;
e -&gt; Eff r ()
</span><a href="Elara.Error.html#defaultReport"><span class="hs-identifier hs-var">defaultReport</span></a></span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPING</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span id="local-6989586621680060701"><span id="local-6989586621680060705"><span class="annot"><a href="Elara.Error.html#ReportableError"><span class="hs-identifier hs-type">ReportableError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnifyError"><span class="hs-identifier hs-type">UnifyError</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Region.html#SourceRegion"><span class="hs-identifier hs-type">SourceRegion</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-528"></span><span>    </span><span id="local-6989586621680060744"><span class="annot"><span class="annottext">report :: forall (r :: [Effect]).
(DiagnosticWriter (Doc AnsiStyle) :&gt; r) =&gt;
UnifyError SourceRegion -&gt; Eff r ()
</span><a href="Elara.Error.html#report"><span class="hs-identifier hs-var hs-var hs-var">report</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#OccursCheckFailed"><span class="hs-identifier hs-type">OccursCheckFailed</span></a></span><span> </span><span id="local-6989586621680060745"><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060745"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621680060746"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680060746"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-529"></span><span>        </span><span class="annot"><span class="annottext">Report (Doc AnsiStyle) -&gt; Eff r ()
forall t (es :: [Effect]).
(HasCallStack, DiagnosticWriter t :&gt; es) =&gt;
Report t -&gt; Eff es ()
</span><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier hs-var">writeReport</span></a></span><span> </span><span class="annot"><span class="annottext">(Report (Doc AnsiStyle) -&gt; Eff r ())
-&gt; Report (Doc AnsiStyle) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-530"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
-&gt; Doc AnsiStyle
-&gt; [(Position, Marker (Doc AnsiStyle))]
-&gt; [Note (Doc AnsiStyle)]
-&gt; Report (Doc AnsiStyle)
forall msg.
Maybe msg
-&gt; msg -&gt; [(Position, Marker msg)] -&gt; [Note msg] -&gt; Report msg
</span><span class="hs-identifier hs-var">Err</span></span><span>
</span><span id="line-531"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-532"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Occurs check failed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeVariable -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">TypeVariable
</span><a href="#local-6989586621680060745"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot; in &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680060746"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-534"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><a href="Elara.Error.html#report"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.TypeInfer.ConstraintGeneration.html#UnificationFailed"><span class="hs-identifier hs-type">UnificationFailed</span></a></span><span> </span><span id="local-6989586621680060748"><span class="annot"><span class="annottext">Maybe (Constraint SourceRegion)
</span><a href="#local-6989586621680060748"><span class="hs-identifier hs-var">constraint</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680060749"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680060749"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680060750"><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680060750"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-536"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680060751"><span class="annot"><span class="annottext">aRegion :: Position
</span><a href="#local-6989586621680060751"><span class="hs-identifier hs-var hs-var hs-var">aRegion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceRegion -&gt; Position
</span><a href="Elara.AST.Region.html#sourceRegionToDiagnosePosition"><span class="hs-identifier hs-var">sourceRegionToDiagnosePosition</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceRegion -&gt; Position) -&gt; SourceRegion -&gt; Position
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; SourceRegion
forall loc. Monotype loc -&gt; loc
</span><a href="Elara.TypeInfer.Type.html#monotypeLoc"><span class="hs-identifier hs-var">monotypeLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680060749"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-537"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680060752"><span class="annot"><span class="annottext">bRegion :: Position
</span><a href="#local-6989586621680060752"><span class="hs-identifier hs-var hs-var hs-var">bRegion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceRegion -&gt; Position
</span><a href="Elara.AST.Region.html#sourceRegionToDiagnosePosition"><span class="hs-identifier hs-var">sourceRegionToDiagnosePosition</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceRegion -&gt; Position) -&gt; SourceRegion -&gt; Position
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; SourceRegion
forall loc. Monotype loc -&gt; loc
</span><a href="Elara.TypeInfer.Type.html#monotypeLoc"><span class="hs-identifier hs-var">monotypeLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680060750"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-538"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680060753"><span class="annot"><span class="annottext">constraints :: [Constraint SourceRegion]
</span><a href="#local-6989586621680060753"><span class="hs-identifier hs-var hs-var">constraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Constraint SourceRegion -&gt; [Constraint SourceRegion])
-&gt; Maybe (Constraint SourceRegion)
-&gt; Maybe [Constraint SourceRegion]
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic'
  A_Traversal '[] (Constraint SourceRegion) (Constraint SourceRegion)
-&gt; Constraint SourceRegion -&gt; [Constraint SourceRegion]
forall k (is :: IxList) a.
Is k A_Fold =&gt;
Optic' k is a a -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">universeOf</span></span><span> </span><span class="annot"><span class="annottext">Optic'
  A_Traversal '[] (Constraint SourceRegion) (Constraint SourceRegion)
forall a. Plated a =&gt; Traversal' a a
</span><a href="Prelude.html#plate"><span class="hs-identifier hs-var">plate</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Constraint SourceRegion)
</span><a href="#local-6989586621680060748"><span class="hs-identifier hs-var">constraint</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Constraint SourceRegion]
-&gt; [Constraint SourceRegion] -&gt; [Constraint SourceRegion]
forall a. Maybe a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">?:</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-539"></span><span>        </span><span class="annot"><span class="annottext">Report (Doc AnsiStyle) -&gt; Eff r ()
forall t (es :: [Effect]).
(HasCallStack, DiagnosticWriter t :&gt; es) =&gt;
Report t -&gt; Eff es ()
</span><a href="Elara.Error.Effect.html#writeReport"><span class="hs-identifier hs-var">writeReport</span></a></span><span> </span><span class="annot"><span class="annottext">(Report (Doc AnsiStyle) -&gt; Eff r ())
-&gt; Report (Doc AnsiStyle) -&gt; Eff r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-540"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
-&gt; Doc AnsiStyle
-&gt; [(Position, Marker (Doc AnsiStyle))]
-&gt; [Note (Doc AnsiStyle)]
-&gt; Report (Doc AnsiStyle)
forall msg.
Maybe msg
-&gt; msg -&gt; [(Position, Marker msg)] -&gt; [Note msg] -&gt; Report msg
</span><span class="hs-identifier hs-var">Err</span></span><span>
</span><span id="line-541"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Doc AnsiStyle)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-542"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Could not unify types: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680060749"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot; and &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680060750"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680060751"><span class="hs-identifier hs-var">aRegion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Marker (Doc AnsiStyle)
forall msg. msg -&gt; Marker msg
</span><span class="hs-identifier hs-var">This</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680060749"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621680060752"><span class="hs-identifier hs-var">bRegion</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Marker (Doc AnsiStyle)
forall msg. msg -&gt; Marker msg
</span><span class="hs-identifier hs-var">This</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Monotype SourceRegion -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Monotype SourceRegion
</span><a href="#local-6989586621680060750"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-546"></span><span>                    </span><span class="annot"><span class="annottext">[(Position, Marker (Doc AnsiStyle))]
-&gt; [(Position, Marker (Doc AnsiStyle))]
-&gt; [(Position, Marker (Doc AnsiStyle))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Constraint SourceRegion -&gt; (Position, Marker (Doc AnsiStyle)))
-&gt; [Constraint SourceRegion]
-&gt; [(Position, Marker (Doc AnsiStyle))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680060757"><span class="annot"><span class="annottext">Constraint SourceRegion
</span><a href="#local-6989586621680060757"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceRegion -&gt; Position
</span><a href="Elara.AST.Region.html#sourceRegionToDiagnosePosition"><span class="hs-identifier hs-var">sourceRegionToDiagnosePosition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Constraint SourceRegion -&gt; SourceRegion
forall loc. Constraint loc -&gt; loc
</span><a href="Elara.TypeInfer.Type.html#constraintLoc"><span class="hs-identifier hs-var">constraintLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint SourceRegion
</span><a href="#local-6989586621680060757"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Marker (Doc AnsiStyle)
forall msg. msg -&gt; Marker msg
</span><span class="hs-identifier hs-var">This</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Constraint: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Constraint SourceRegion -&gt; Doc AnsiStyle
forall a. Pretty a =&gt; a -&gt; Doc AnsiStyle
</span><a href="Elara.Data.Pretty.html#pretty"><span class="hs-identifier hs-var">pretty</span></a></span><span> </span><span class="annot"><span class="annottext">Constraint SourceRegion
</span><a href="#local-6989586621680060757"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Constraint SourceRegion]
</span><a href="#local-6989586621680060753"><span class="hs-identifier hs-var">constraints</span></a></span><span>
</span><span id="line-547"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-549"></span><span>    </span><span class="annot"><a href="Elara.Error.html#report"><span class="hs-identifier hs-var">report</span></a></span><span> </span><span id="local-6989586621680060758"><span class="annot"><span class="annottext">UnifyError SourceRegion
</span><a href="#local-6989586621680060758"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnifyError SourceRegion -&gt; Eff r ()
forall e (r :: [Effect]).
(ReportableError e, Pretty e,
 DiagnosticWriter (Doc AnsiStyle) :&gt; r) =&gt;
e -&gt; Eff r ()
</span><a href="Elara.Error.html#defaultReport"><span class="hs-identifier hs-var">defaultReport</span></a></span><span> </span><span class="annot"><span class="annottext">UnifyError SourceRegion
</span><a href="#local-6989586621680060758"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-550"></span></pre></body></html>