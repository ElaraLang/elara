<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Elara.SCC.html"><span class="hs-identifier">Elara.SCC</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Product</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasField'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">field'</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Generics.Wrapped</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_Unwrapped</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Graph</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SCC</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stronglyConnComp</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HS</span></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Effectful</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Common.html"><span class="hs-identifier">Elara.AST.Generic.Common</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Generic.Types.html"><span class="hs-identifier">Elara.AST.Generic.Types</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Name.html"><span class="hs-identifier">Elara.AST.Name</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Region.html"><span class="hs-identifier">Elara.AST.Region</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier">Located</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html"><span class="hs-identifier">Elara.AST.Shunted</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.AST.VarRef.html"><span class="hs-identifier">Elara.AST.VarRef</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Error.html"><span class="hs-identifier">Elara.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier">runErrorOrReport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Query.html"><span class="hs-identifier">Elara.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Query.Effects.html"><span class="hs-identifier">Elara.Query.Effects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier">ConsQueryEffects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.SCC.Type.html"><span class="hs-identifier">Elara.SCC.Type</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elara.Shunt.Error.html"><span class="hs-identifier">Elara.Shunt.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Shunt.Error.html#ShuntError"><span class="hs-identifier">ShuntError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Optics</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Rock.html"><span class="hs-identifier">Rock</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="annot"><a href="Elara.SCC.html#runFreeVarsQuery"><span class="hs-identifier hs-type">runFreeVarsQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span>
</span><span id="line-28"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span id="runFreeVarsQuery"><span class="annot"><span class="annottext">runFreeVarsQuery :: Qualified VarName
-&gt; Eff
     (ConsQueryEffects '[Rock Query]) (HashSet (Qualified VarName))
</span><a href="Elara.SCC.html#runFreeVarsQuery"><span class="hs-identifier hs-var hs-var">runFreeVarsQuery</span></a></span></span><span> </span><span id="local-6989586621680057605"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057605"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-31"></span><span>    </span><span id="local-6989586621680057606"><span class="annot"><a href="#local-6989586621680057606"><span class="hs-identifier hs-var">declaration</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e (r :: [(* -&gt; *) -&gt; * -&gt; *]) a.
(DiagnosticWriter (Doc AnsiStyle) :&gt; r,
 Error SomeReportableError :&gt; r, ReportableError e) =&gt;
Eff (Error e : r) a -&gt; Eff r a
</span><a href="Elara.Error.html#runErrorOrReport"><span class="hs-identifier hs-var">runErrorOrReport</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.Shunt.Error.html#ShuntError"><span class="hs-identifier hs-type">ShuntError</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (Error ShuntError : ConsQueryEffects '[Rock Query])
   (Declaration 'Shunted)
 -&gt; Eff (ConsQueryEffects '[Rock Query]) (Declaration 'Shunted))
-&gt; Eff
     (Error ShuntError : ConsQueryEffects '[Rock Query])
     (Declaration 'Shunted)
-&gt; Eff (ConsQueryEffects '[Rock Query]) (Declaration 'Shunted)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Query
  (Rock Query : ConsQueryEffects '[Error ShuntError])
  (Declaration 'Shunted)
-&gt; Eff
     (Error ShuntError : ConsQueryEffects '[Rock Query])
     (Declaration 'Shunted)
forall (xs :: [(* -&gt; *) -&gt; * -&gt; *]) (es :: [(* -&gt; *) -&gt; * -&gt; *])
       (f :: [(* -&gt; *) -&gt; * -&gt; *] -&gt; * -&gt; *) a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified Name
-&gt; Query
     (Rock Query : ConsQueryEffects '[Error ShuntError])
     (Declaration 'Shunted)
</span><a href="Elara.Query.html#ShuntedDeclarationByName"><span class="hs-identifier hs-var">Elara.Query.ShuntedDeclarationByName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarName -&gt; Name
</span><a href="Elara.AST.Name.html#NVarName"><span class="hs-identifier hs-var">NVarName</span></a></span><span> </span><span class="annot"><span class="annottext">(VarName -&gt; Name) -&gt; Qualified VarName -&gt; Qualified Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057605"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057611"><span class="annot"><a href="#local-6989586621680057611"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Declaration 'Shunted
</span><a href="#local-6989586621680057606"><span class="hs-identifier hs-var">declaration</span></a></span><span> </span><span class="annot"><span class="annottext">Declaration 'Shunted
-&gt; Optic'
     A_Lens '[] (Declaration 'Shunted) (DeclarationBody' 'Shunted)
-&gt; DeclarationBody' 'Shunted
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Iso
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Iso
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (Declaration' 'Shunted))
     (Located (Declaration' 'Shunted))
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     (Declaration 'Shunted)
     (Declaration 'Shunted)
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Declaration' 'Shunted))
  (Located (Declaration' 'Shunted))
  (Declaration' 'Shunted)
  (Declaration' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (Declaration' 'Shunted)
  (Declaration' 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     (Declaration' 'Shunted)
     (Declaration' 'Shunted)
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     (Declaration 'Shunted)
     (Declaration 'Shunted)
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">forall (field :: Symbol) s a. HasField' field s a =&gt; Lens s s a a
</span><span class="hs-identifier hs-var">field'</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (DeclarationBody 'Shunted)
  (DeclarationBody 'Shunted)
-&gt; Optic
     An_Iso
     '[]
     (DeclarationBody 'Shunted)
     (DeclarationBody 'Shunted)
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Declaration 'Shunted)
     (Declaration 'Shunted)
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  An_Iso
  '[]
  (DeclarationBody 'Shunted)
  (DeclarationBody 'Shunted)
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Declaration 'Shunted)
  (Declaration 'Shunted)
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (DeclarationBody' 'Shunted))
     (Located (DeclarationBody' 'Shunted))
     (DeclarationBody' 'Shunted)
     (DeclarationBody' 'Shunted)
-&gt; Optic'
     A_Lens '[] (Declaration 'Shunted) (DeclarationBody' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (DeclarationBody' 'Shunted))
  (Located (DeclarationBody' 'Shunted))
  (DeclarationBody' 'Shunted)
  (DeclarationBody' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057614"><span class="annot"><a href="#local-6989586621680057614"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DeclarationBody' 'Shunted
</span><a href="#local-6989586621680057611"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-36"></span><span>            </span><span class="annot"><a href="Elara.AST.Generic.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><span class="annottext">ASTLocate 'Shunted (Select &quot;ValueName&quot; 'Shunted)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680057616"><span class="annot"><span class="annottext">Expr 'Shunted
</span><a href="#local-6989586621680057616"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="annot"><span class="annottext">NoFieldValue
Select &quot;ValuePatterns&quot; 'Shunted
</span><a href="Elara.AST.Generic.Common.html#NoFieldValue"><span class="hs-identifier hs-var">NoFieldValue</span></a></span><span> </span><span class="annot"><span class="annottext">Select &quot;ValueType&quot; 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ValueDeclAnnotations 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-37"></span><span>                </span><span class="annot"><span class="annottext">Expr 'Shunted -&gt; HashSet (Qualified VarName)
</span><a href="Elara.SCC.html#patternDependencies"><span class="hs-identifier hs-var">patternDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">Expr 'Shunted
</span><a href="#local-6989586621680057616"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-38"></span><span>                    </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
-&gt; HashSet (Qualified VarName) -&gt; HashSet (Qualified VarName)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Expr 'Shunted -&gt; HashSet (Qualified VarName)
</span><a href="Elara.SCC.html#valueDependencies"><span class="hs-identifier hs-var">valueDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">Expr 'Shunted
</span><a href="#local-6989586621680057616"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-39"></span><span>            </span><span class="annot"><span class="annottext">DeclarationBody' 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621680057614"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="annot"><a href="Elara.SCC.html#runReachableSubgraphQuery"><span class="hs-identifier hs-type">runReachableSubgraphQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Elara.SCC.Type.html#ReachableSubgraph"><span class="hs-identifier hs-type">ReachableSubgraph</span></a></span><span>
</span><span id="line-44"></span><span id="runReachableSubgraphQuery"><span class="annot"><span class="annottext">runReachableSubgraphQuery :: Qualified VarName
-&gt; Eff (ConsQueryEffects '[Rock Query]) ReachableSubgraph
</span><a href="Elara.SCC.html#runReachableSubgraphQuery"><span class="hs-identifier hs-var hs-var">runReachableSubgraphQuery</span></a></span></span><span> </span><span id="local-6989586621680057694"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057694"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057695"><span class="annot"><span class="annottext">moduleOf :: Qualified name -&gt; ModuleName
</span><a href="#local-6989586621680057695"><span class="hs-identifier hs-var hs-var hs-var">moduleOf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Qualified name -&gt; ModuleName
forall name. Qualified name -&gt; ModuleName
</span><a href="Elara.AST.Name.html#qualifier"><span class="hs-identifier hs-var">qualifier</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057697"><span class="annot"><span class="annottext">rootMod :: ModuleName
</span><a href="#local-6989586621680057697"><span class="hs-identifier hs-var hs-var hs-var">rootMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; ModuleName
forall name. Qualified name -&gt; ModuleName
</span><a href="#local-6989586621680057695"><span class="hs-identifier hs-var">moduleOf</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057694"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680057698"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-49"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- discovered (seen) nodes</span><span>
</span><span id="line-50"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-51"></span><span>            </span><span class="hs-special">[</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- worklist</span><span>
</span><span id="line-52"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.Query.Effects.html#ConsQueryEffects"><span class="hs-identifier hs-type">ConsQueryEffects</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="Rock.html#Rock"><span class="hs-identifier hs-type">Rock.Rock</span></a></span><span> </span><span class="annot"><a href="Elara.Query.html#Query"><span class="hs-identifier hs-type">Elara.Query.Query</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HS.HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>        </span><span id="local-6989586621680057698"><span class="annot"><span class="annottext">go :: HashSet (Qualified VarName)
-&gt; HashMap (Qualified VarName) (HashSet (Qualified VarName))
-&gt; [Qualified VarName]
-&gt; Eff
     (ConsQueryEffects '[Rock Query])
     (HashSet (Qualified VarName),
      HashMap (Qualified VarName) (HashSet (Qualified VarName)))
</span><a href="#local-6989586621680057698"><span class="hs-identifier hs-var hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621680057699"><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057699"><span class="hs-identifier hs-var">seen</span></a></span></span><span> </span><span id="local-6989586621680057700"><span class="annot"><span class="annottext">HashMap (Qualified VarName) (HashSet (Qualified VarName))
</span><a href="#local-6989586621680057700"><span class="hs-identifier hs-var">edges</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashSet (Qualified VarName),
 HashMap (Qualified VarName) (HashSet (Qualified VarName)))
-&gt; Eff
     (ConsQueryEffects '[Rock Query])
     (HashSet (Qualified VarName),
      HashMap (Qualified VarName) (HashSet (Qualified VarName)))
forall a. a -&gt; Eff (ConsQueryEffects '[Rock Query]) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057699"><span class="hs-identifier hs-var">seen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap (Qualified VarName) (HashSet (Qualified VarName))
</span><a href="#local-6989586621680057700"><span class="hs-identifier hs-var">edges</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>        </span><span class="annot"><a href="#local-6989586621680057698"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621680057701"><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057701"><span class="hs-identifier hs-var">seen</span></a></span></span><span> </span><span id="local-6989586621680057702"><span class="annot"><span class="annottext">HashMap (Qualified VarName) (HashSet (Qualified VarName))
</span><a href="#local-6989586621680057702"><span class="hs-identifier hs-var">edges</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680057703"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057703"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680057704"><span class="annot"><span class="annottext">[Qualified VarName]
</span><a href="#local-6989586621680057704"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-55"></span><span>            </span><span id="local-6989586621680057705"><span class="annot"><a href="#local-6989586621680057705"><span class="hs-identifier hs-var">depsAll</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Query
  (Rock Query : ConsQueryEffects '[]) (HashSet (Qualified VarName))
-&gt; Eff
     (ConsQueryEffects '[Rock Query]) (HashSet (Qualified VarName))
forall (xs :: [(* -&gt; *) -&gt; * -&gt; *]) (es :: [(* -&gt; *) -&gt; * -&gt; *])
       (f :: [(* -&gt; *) -&gt; * -&gt; *] -&gt; * -&gt; *) a.
(Subset xs es, Rock f :&gt; es, HasCallStack) =&gt;
f xs a -&gt; Eff es a
</span><a href="Rock.html#fetch"><span class="hs-identifier hs-var">Rock.fetch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified VarName
-&gt; Query
     (Rock Query : ConsQueryEffects '[]) (HashSet (Qualified VarName))
</span><a href="Elara.Query.html#FreeVarsOf"><span class="hs-identifier hs-var">Elara.Query.FreeVarsOf</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057703"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057707"><span class="annot"><a href="#local-6989586621680057707"><span class="hs-identifier hs-var hs-var">depsSame</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Qualified VarName -&gt; Bool)
-&gt; HashSet (Qualified VarName) -&gt; HashSet (Qualified VarName)
forall a. (a -&gt; Bool) -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621680057697"><span class="hs-identifier hs-var">rootMod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; Bool)
-&gt; (Qualified VarName -&gt; ModuleName) -&gt; Qualified VarName -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; ModuleName
forall name. Qualified name -&gt; ModuleName
</span><a href="#local-6989586621680057695"><span class="hs-identifier hs-var">moduleOf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057705"><span class="hs-identifier hs-var">depsAll</span></a></span><span>
</span><span id="line-57"></span><span>            </span><span class="hs-comment">-- only enqueue deps we haven&#8217;t seen yet</span><span>
</span><span id="line-58"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057710"><span class="annot"><a href="#local-6989586621680057710"><span class="hs-identifier hs-var hs-var">newDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
-&gt; HashSet (Qualified VarName) -&gt; HashSet (Qualified VarName)
forall a. (Eq a, Hashable a) =&gt; HashSet a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.difference</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057707"><span class="hs-identifier hs-var">depsSame</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057701"><span class="hs-identifier hs-var">seen</span></a></span><span>
</span><span id="line-59"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057712"><span class="annot"><a href="#local-6989586621680057712"><span class="hs-identifier hs-var hs-var">seen'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Qualified VarName
-&gt; HashSet (Qualified VarName) -&gt; HashSet (Qualified VarName)
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.insert</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057703"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
-&gt; HashSet (Qualified VarName) -&gt; HashSet (Qualified VarName)
forall a. Eq a =&gt; HashSet a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.union</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057701"><span class="hs-identifier hs-var">seen</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057710"><span class="hs-identifier hs-var">newDeps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057715"><span class="annot"><a href="#local-6989586621680057715"><span class="hs-identifier hs-var hs-var">edges'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashSet (Qualified VarName)
 -&gt; HashSet (Qualified VarName) -&gt; HashSet (Qualified VarName))
-&gt; Qualified VarName
-&gt; HashSet (Qualified VarName)
-&gt; HashMap (Qualified VarName) (HashSet (Qualified VarName))
-&gt; HashMap (Qualified VarName) (HashSet (Qualified VarName))
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
-&gt; HashSet (Qualified VarName) -&gt; HashSet (Qualified VarName)
forall a. Eq a =&gt; HashSet a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HS.union</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057703"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057707"><span class="hs-identifier hs-var">depsSame</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Qualified VarName) (HashSet (Qualified VarName))
</span><a href="#local-6989586621680057702"><span class="hs-identifier hs-var">edges</span></a></span><span>
</span><span id="line-61"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057717"><span class="annot"><a href="#local-6989586621680057717"><span class="hs-identifier hs-var hs-var">bs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName) -&gt; [Qualified VarName]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">HS.toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057710"><span class="hs-identifier hs-var">newDeps</span></a></span><span> </span><span class="annot"><span class="annottext">[Qualified VarName] -&gt; [Qualified VarName] -&gt; [Qualified VarName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Qualified VarName]
</span><a href="#local-6989586621680057704"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-62"></span><span>            </span><span class="annot"><a href="#local-6989586621680057698"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057712"><span class="hs-identifier hs-type">seen'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057715"><span class="hs-identifier hs-type">edges'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057717"><span class="hs-identifier hs-type">bs'</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680057719"><span class="annot"><a href="#local-6989586621680057719"><span class="hs-identifier hs-var">nodes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680057720"><span class="annot"><a href="#local-6989586621680057720"><span class="hs-identifier hs-var">edges</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
-&gt; HashMap (Qualified VarName) (HashSet (Qualified VarName))
-&gt; [Qualified VarName]
-&gt; Eff
     (ConsQueryEffects '[Rock Query])
     (HashSet (Qualified VarName),
      HashMap (Qualified VarName) (HashSet (Qualified VarName)))
</span><a href="#local-6989586621680057698"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
forall a. HashSet a
</span><span class="hs-identifier hs-var">HS.empty</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Qualified VarName) (HashSet (Qualified VarName))
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057694"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-65"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="Elara.SCC.Type.html#ReachableSubgraph"><span class="hs-identifier hs-type">ReachableSubgraph</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Elara.SCC.Type.html#root"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680057694"><span class="hs-identifier hs-type">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680057719"><span class="hs-identifier hs-type hs-var">nodes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680057720"><span class="hs-identifier hs-type hs-var">edges</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- Build topologically ordered SCCs from a reachable subgraph</span><span>
</span><span id="line-68"></span><span class="annot"><a href="Elara.SCC.html#buildSCCs"><span class="hs-identifier hs-type">buildSCCs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.SCC.Type.html#ReachableSubgraph"><span class="hs-identifier hs-type">ReachableSubgraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SCC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-69"></span><span id="buildSCCs"><span class="annot"><span class="annottext">buildSCCs :: ReachableSubgraph -&gt; [SCC (Qualified VarName)]
</span><a href="Elara.SCC.html#buildSCCs"><span class="hs-identifier hs-var hs-var">buildSCCs</span></a></span></span><span> </span><span class="annot"><a href="Elara.SCC.Type.html#ReachableSubgraph"><span class="hs-identifier hs-type">ReachableSubgraph</span></a></span><span class="hs-special">{</span><span id="local-6989586621680057738"><span class="annot"><span class="annottext">HashSet (Qualified VarName)
nodes :: ReachableSubgraph -&gt; HashSet (Qualified VarName)
nodes :: HashSet (Qualified VarName)
</span><a href="Elara.SCC.Type.html#nodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680057739"><span class="annot"><span class="annottext">HashMap (Qualified VarName) (HashSet (Qualified VarName))
edges :: ReachableSubgraph
-&gt; HashMap (Qualified VarName) (HashSet (Qualified VarName))
edges :: HashMap (Qualified VarName) (HashSet (Qualified VarName))
</span><a href="Elara.SCC.Type.html#edges"><span class="hs-identifier hs-var hs-var">edges</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057740"><span class="annot"><span class="annottext">triples :: [(Qualified VarName, Qualified VarName, [Qualified VarName])]
</span><a href="#local-6989586621680057740"><span class="hs-identifier hs-var hs-var">triples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057741"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057741"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Qualified VarName -&gt; Bool)
-&gt; [Qualified VarName] -&gt; [Qualified VarName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified VarName -&gt; HashSet (Qualified VarName) -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><span class="hs-operator hs-var">`HS.member`</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057738"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Qualified VarName]
-&gt; (HashSet (Qualified VarName) -&gt; [Qualified VarName])
-&gt; Maybe (HashSet (Qualified VarName))
-&gt; [Qualified VarName]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName) -&gt; [Qualified VarName]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">HS.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qualified VarName
-&gt; HashMap (Qualified VarName) (HashSet (Qualified VarName))
-&gt; Maybe (HashSet (Qualified VarName))
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057741"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Qualified VarName) (HashSet (Qualified VarName))
</span><a href="#local-6989586621680057739"><span class="hs-identifier hs-var">edges</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680057741"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057741"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName) -&gt; [Qualified VarName]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">HS.toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
</span><a href="#local-6989586621680057738"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-73"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-74"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Qualified VarName, Qualified VarName, [Qualified VarName])]
-&gt; [SCC (Qualified VarName)]
forall key node. Ord key =&gt; [(node, key, [key])] -&gt; [SCC node]
</span><span class="hs-identifier hs-var">stronglyConnComp</span></span><span> </span><span class="annot"><span class="annottext">[(Qualified VarName, Qualified VarName, [Qualified VarName])]
</span><a href="#local-6989586621680057740"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- Find the SCC that contains the root binder</span><span>
</span><span id="line-77"></span><span class="annot"><a href="Elara.SCC.html#sccContainingRoot"><span class="hs-identifier hs-type">sccContainingRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.SCC.Type.html#ReachableSubgraph"><span class="hs-identifier hs-type">ReachableSubgraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SCC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span id="sccContainingRoot"><span class="annot"><span class="annottext">sccContainingRoot :: ReachableSubgraph -&gt; SCC (Qualified VarName)
</span><a href="Elara.SCC.html#sccContainingRoot"><span class="hs-identifier hs-var hs-var">sccContainingRoot</span></a></span></span><span> </span><span id="local-6989586621680057754"><span class="annot"><span class="annottext">g :: ReachableSubgraph
</span><a href="#local-6989586621680057754"><span class="hs-identifier hs-var">g</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Elara.SCC.Type.html#ReachableSubgraph"><span class="hs-identifier hs-type">ReachableSubgraph</span></a></span><span class="hs-special">{</span><span id="local-6989586621680057755"><span class="annot"><span class="annottext">Qualified VarName
root :: ReachableSubgraph -&gt; Qualified VarName
root :: Qualified VarName
</span><a href="Elara.SCC.Type.html#root"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(SCC (Qualified VarName) -&gt; Bool)
-&gt; [SCC (Qualified VarName)] -&gt; Maybe (SCC (Qualified VarName))
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="annot"><span class="annottext">SCC (Qualified VarName) -&gt; Bool
</span><a href="#local-6989586621680057757"><span class="hs-identifier hs-var">containsRoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReachableSubgraph -&gt; [SCC (Qualified VarName)]
</span><a href="Elara.SCC.html#buildSCCs"><span class="hs-identifier hs-var">buildSCCs</span></a></span><span> </span><span class="annot"><span class="annottext">ReachableSubgraph
</span><a href="#local-6989586621680057754"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680057758"><span class="annot"><span class="annottext">SCC (Qualified VarName)
</span><a href="#local-6989586621680057758"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SCC (Qualified VarName)
</span><a href="#local-6989586621680057758"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><span class="annottext">Maybe (SCC (Qualified VarName))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; SCC (Qualified VarName)
forall vertex. vertex -&gt; SCC vertex
</span><span class="hs-identifier hs-var">AcyclicSCC</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057755"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621680057757"><span class="annot"><span class="annottext">containsRoot :: SCC (Qualified VarName) -&gt; Bool
</span><a href="#local-6989586621680057757"><span class="hs-identifier hs-var hs-var">containsRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">AcyclicSCC</span></span><span> </span><span id="local-6989586621680057760"><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057760"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057760"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; Qualified VarName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057755"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-85"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">CyclicSCC</span></span><span> </span><span id="local-6989586621680057762"><span class="annot"><span class="annottext">[Qualified VarName]
</span><a href="#local-6989586621680057762"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Qualified VarName
</span><a href="#local-6989586621680057755"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">Qualified VarName -&gt; [Qualified VarName] -&gt; Bool
forall (f :: * -&gt; *) a.
(Foldable f, DisallowElem f, Eq a) =&gt;
a -&gt; f a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Qualified VarName]
</span><a href="#local-6989586621680057762"><span class="hs-identifier hs-var">vs</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="Elara.SCC.html#concatHashSetOf"><span class="hs-identifier hs-type">concatHashSetOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680057280"><span class="annot"><a href="#local-6989586621680057280"><span class="hs-identifier hs-type">k</span></a></span></span><span> </span><span id="local-6989586621680057283"><span class="annot"><a href="#local-6989586621680057283"><span class="hs-identifier hs-type">is</span></a></span></span><span> </span><span id="local-6989586621680057284"><span class="annot"><a href="#local-6989586621680057284"><span class="hs-identifier hs-type">a1</span></a></span></span><span> </span><span id="local-6989586621680057285"><span class="annot"><a href="#local-6989586621680057285"><span class="hs-identifier hs-type">a2</span></a></span></span><span> </span><span id="local-6989586621680057282"><span class="annot"><a href="#local-6989586621680057282"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Is</span></span><span> </span><span class="annot"><a href="#local-6989586621680057280"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">A_Fold</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621680057282"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Optic'</span></span><span> </span><span class="annot"><a href="#local-6989586621680057280"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057283"><span class="hs-identifier hs-type">is</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057284"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680057285"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680057285"><span class="hs-identifier hs-type">a2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="annot"><a href="#local-6989586621680057282"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680057284"><span class="hs-identifier hs-type">a1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="annot"><a href="#local-6989586621680057282"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-88"></span><span id="concatHashSetOf"><span class="annot"><span class="annottext">concatHashSetOf :: forall k (is :: IxList) a1 a2 b.
(Is k A_Fold, Hashable b) =&gt;
Optic' k is a1 a2 -&gt; (a2 -&gt; HashSet b) -&gt; a1 -&gt; HashSet b
</span><a href="Elara.SCC.html#concatHashSetOf"><span class="hs-identifier hs-var hs-var">concatHashSetOf</span></a></span></span><span> </span><span id="local-6989586621680057772"><span class="annot"><span class="annottext">Optic' k is a1 a2
</span><a href="#local-6989586621680057772"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680057773"><span class="annot"><span class="annottext">a2 -&gt; HashSet b
</span><a href="#local-6989586621680057773"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680057774"><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621680057774"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680057775"><span class="annot"><span class="annottext">folded :: [a2]
</span><a href="#local-6989586621680057775"><span class="hs-identifier hs-var hs-var">folded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Optic' k is a1 a2 -&gt; a1 -&gt; [a2]
forall k (is :: IxList) s a.
Is k A_Fold =&gt;
Optic' k is s a -&gt; s -&gt; [a]
</span><span class="hs-identifier hs-var">toListOf</span></span><span> </span><span class="annot"><span class="annottext">Optic' k is a1 a2
</span><a href="#local-6989586621680057772"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a1
</span><a href="#local-6989586621680057774"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-comment">-- we do this so we don't need a2 to be hashable</span><span>
</span><span id="line-90"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(a2 -&gt; HashSet b) -&gt; [a2] -&gt; HashSet b
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">a2 -&gt; HashSet b
</span><a href="#local-6989586621680057773"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[a2]
</span><a href="#local-6989586621680057775"><span class="hs-identifier hs-var">folded</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="annot"><a href="Elara.SCC.html#valueDependencies"><span class="hs-identifier hs-type">valueDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedExpr"><span class="hs-identifier hs-type">ShuntedExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span id="valueDependencies"><span class="annot"><span class="annottext">valueDependencies :: Expr 'Shunted -&gt; HashSet (Qualified VarName)
</span><a href="Elara.SCC.html#valueDependencies"><span class="hs-identifier hs-var hs-var">valueDependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">Optic' A_Fold '[] (Expr 'Shunted) ShuntedExpr'
-&gt; (ShuntedExpr' -&gt; HashSet (Qualified VarName))
-&gt; Expr 'Shunted
-&gt; HashSet (Qualified VarName)
forall k (is :: IxList) a1 a2 b.
(Is k A_Fold, Hashable b) =&gt;
Optic' k is a1 a2 -&gt; (a2 -&gt; HashSet b) -&gt; a1 -&gt; HashSet b
</span><a href="Elara.SCC.html#concatHashSetOf"><span class="hs-identifier hs-var">concatHashSetOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Expr 'Shunted)
  (Expr 'Shunted)
  ShuntedExpr'
  ShuntedExpr'
-&gt; Optic' A_Fold '[] (Expr 'Shunted) ShuntedExpr'
forall {k} {m} {b} {ks :: IxList} {s} {t}.
(JoinKinds k A_Fold m, Plated b) =&gt;
Optic k ks s t b b -&gt; Optic m ks s t b b
</span><a href="Prelude.html#cosmosOn"><span class="hs-identifier hs-var">cosmosOn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Iso
  (Expr 'Shunted)
  (Expr 'Shunted)
  (Located ShuntedExpr', Maybe ShuntedType)
  (Located ShuntedExpr', Maybe ShuntedType)
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Iso
  (Expr 'Shunted)
  (Expr 'Shunted)
  (Located ShuntedExpr', Maybe ShuntedType)
  (Located ShuntedExpr', Maybe ShuntedType)
-&gt; Optic
     A_Lens
     '[]
     (Located ShuntedExpr', Maybe ShuntedType)
     (Located ShuntedExpr', Maybe ShuntedType)
     (Located ShuntedExpr')
     (Located ShuntedExpr')
-&gt; Optic
     A_Lens
     '[]
     (Expr 'Shunted)
     (Expr 'Shunted)
     (Located ShuntedExpr')
     (Located ShuntedExpr')
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located ShuntedExpr', Maybe ShuntedType)
  (Located ShuntedExpr', Maybe ShuntedType)
  (Located ShuntedExpr')
  (Located ShuntedExpr')
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Expr 'Shunted)
  (Expr 'Shunted)
  (Located ShuntedExpr')
  (Located ShuntedExpr')
-&gt; Optic
     A_Lens
     '[]
     (Located ShuntedExpr')
     (Located ShuntedExpr')
     ShuntedExpr'
     ShuntedExpr'
-&gt; Optic
     A_Lens
     '[]
     (Expr 'Shunted)
     (Expr 'Shunted)
     ShuntedExpr'
     ShuntedExpr'
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located ShuntedExpr')
  (Located ShuntedExpr')
  ShuntedExpr'
  ShuntedExpr'
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShuntedExpr' -&gt; HashSet (Qualified VarName)
</span><a href="#local-6989586621680057838"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="#local-6989586621680057838"><span class="hs-identifier hs-type">names</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedExpr%27"><span class="hs-identifier hs-type">ShuntedExpr'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621680057838"><span class="annot"><span class="annottext">names :: ShuntedExpr' -&gt; HashSet (Qualified VarName)
</span><a href="#local-6989586621680057838"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.VarRef.html#Global"><span class="hs-identifier hs-type">Global</span></a></span><span> </span><span id="local-6989586621680057842"><span class="annot"><span class="annottext">VarRefImpl LocatedVarRefKind (Qualified VarName)
</span><a href="#local-6989586621680057842"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OneItem (HashSet (Qualified VarName))
-&gt; HashSet (Qualified VarName)
forall x. One x =&gt; OneItem x -&gt; x
</span><span class="hs-identifier hs-var">one</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located (Qualified VarName)
VarRefImpl LocatedVarRefKind (Qualified VarName)
</span><a href="#local-6989586621680057842"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Qualified VarName)
-&gt; Optic'
     A_Lens '[] (Located (Qualified VarName)) (Qualified VarName)
-&gt; Qualified VarName
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens '[] (Located (Qualified VarName)) (Qualified VarName)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="#local-6989586621680057838"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">ShuntedExpr'
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="Elara.SCC.html#patternDependencies"><span class="hs-identifier hs-type">patternDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedExpr"><span class="hs-identifier hs-type">ShuntedExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span id="patternDependencies"><span class="annot"><span class="annottext">patternDependencies :: Expr 'Shunted -&gt; HashSet (Qualified VarName)
</span><a href="Elara.SCC.html#patternDependencies"><span class="hs-identifier hs-var hs-var">patternDependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="annottext">Optic' A_Fold '[] (Expr 'Shunted) (HashSet (Qualified VarName))
-&gt; Expr 'Shunted -&gt; HashSet (Qualified VarName)
forall k a (is :: IxList) s.
(Is k A_Fold, Monoid a) =&gt;
Optic' k is s a -&gt; s -&gt; a
</span><span class="hs-identifier hs-var">foldOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Traversal' (Expr 'Shunted) ShuntedPattern
forall a s. GPlate a s =&gt; Traversal' s a
</span><span class="hs-identifier hs-var">gplate</span></span><span> </span><span class="annot"><span class="annottext">Traversal' (Expr 'Shunted) ShuntedPattern
-&gt; Optic
     A_Getter
     '[]
     ShuntedPattern
     ShuntedPattern
     (HashSet (Qualified VarName))
     (HashSet (Qualified VarName))
-&gt; Optic' A_Fold '[] (Expr 'Shunted) (HashSet (Qualified VarName))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">(ShuntedPattern -&gt; HashSet (Qualified VarName))
-&gt; Optic
     A_Getter
     '[]
     ShuntedPattern
     ShuntedPattern
     (HashSet (Qualified VarName))
     (HashSet (Qualified VarName))
forall s a. (s -&gt; a) -&gt; Getter s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">ShuntedPattern -&gt; HashSet (Qualified VarName)
</span><a href="#local-6989586621680058743"><span class="hs-identifier hs-var">patternDependencies'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="#local-6989586621680058743"><span class="hs-identifier hs-type">patternDependencies'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedPattern"><span class="hs-identifier hs-type">ShuntedPattern</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621680058743"><span class="annot"><span class="annottext">patternDependencies' :: ShuntedPattern -&gt; HashSet (Qualified VarName)
</span><a href="#local-6989586621680058743"><span class="hs-identifier hs-var hs-var">patternDependencies'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Optic' A_Fold '[] ShuntedPattern (Pattern' 'Shunted)
-&gt; (Pattern' 'Shunted -&gt; HashSet (Qualified VarName))
-&gt; ShuntedPattern
-&gt; HashSet (Qualified VarName)
forall k (is :: IxList) a1 a2 b.
(Is k A_Fold, Hashable b) =&gt;
Optic' k is a1 a2 -&gt; (a2 -&gt; HashSet b) -&gt; a1 -&gt; HashSet b
</span><a href="Elara.SCC.html#concatHashSetOf"><span class="hs-identifier hs-var">concatHashSetOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  ShuntedPattern
  ShuntedPattern
  (Pattern' 'Shunted)
  (Pattern' 'Shunted)
-&gt; Optic' A_Traversal '[] (Pattern' 'Shunted) (Pattern' 'Shunted)
-&gt; Optic' A_Fold '[] ShuntedPattern (Pattern' 'Shunted)
forall {k1} {m} {k2} {ks :: IxList} {s} {t} {b} {is :: IxList}.
(JoinKinds k1 A_Fold m, Is k2 A_Fold) =&gt;
Optic k1 ks s t b b -&gt; Optic' k2 is b b -&gt; Optic m ks s t b b
</span><a href="Prelude.html#cosmosOnOf"><span class="hs-identifier hs-var">cosmosOnOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Iso
  ShuntedPattern
  ShuntedPattern
  (Located (Pattern' 'Shunted), Maybe ShuntedType)
  (Located (Pattern' 'Shunted), Maybe ShuntedType)
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Iso
  ShuntedPattern
  ShuntedPattern
  (Located (Pattern' 'Shunted), Maybe ShuntedType)
  (Located (Pattern' 'Shunted), Maybe ShuntedType)
-&gt; Optic
     A_Lens
     '[]
     (Located (Pattern' 'Shunted), Maybe ShuntedType)
     (Located (Pattern' 'Shunted), Maybe ShuntedType)
     (Located (Pattern' 'Shunted))
     (Located (Pattern' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     ShuntedPattern
     ShuntedPattern
     (Located (Pattern' 'Shunted))
     (Located (Pattern' 'Shunted))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Pattern' 'Shunted), Maybe ShuntedType)
  (Located (Pattern' 'Shunted), Maybe ShuntedType)
  (Located (Pattern' 'Shunted))
  (Located (Pattern' 'Shunted))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  ShuntedPattern
  ShuntedPattern
  (Located (Pattern' 'Shunted))
  (Located (Pattern' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (Pattern' 'Shunted))
     (Located (Pattern' 'Shunted))
     (Pattern' 'Shunted)
     (Pattern' 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     ShuntedPattern
     ShuntedPattern
     (Pattern' 'Shunted)
     (Pattern' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Pattern' 'Shunted))
  (Located (Pattern' 'Shunted))
  (Pattern' 'Shunted)
  (Pattern' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Optic' A_Traversal '[] (Pattern' 'Shunted) (Pattern' 'Shunted)
forall a s. GPlate a s =&gt; Traversal' s a
</span><span class="hs-identifier hs-var">gplate</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pattern' 'Shunted -&gt; HashSet (Qualified VarName)
</span><a href="#local-6989586621680058745"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="#local-6989586621680058745"><span class="hs-identifier hs-type">names</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedPattern%27"><span class="hs-identifier hs-type">ShuntedPattern'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#VarName"><span class="hs-identifier hs-type">VarName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-comment">-- i think this will always be empty but just in case</span><span>
</span><span id="line-108"></span><span>    </span><span id="local-6989586621680058745"><span class="annot"><span class="annottext">names :: Pattern' 'Shunted -&gt; HashSet (Qualified VarName)
</span><a href="#local-6989586621680058745"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="annot"><span class="annottext">Pattern' 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified VarName)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="annot"><a href="Elara.SCC.html#typeDependencies"><span class="hs-identifier hs-type">typeDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedType"><span class="hs-identifier hs-type">ShuntedType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span id="typeDependencies"><span class="annot"><span class="annottext">typeDependencies :: ShuntedType -&gt; HashSet (Qualified Name)
</span><a href="Elara.SCC.html#typeDependencies"><span class="hs-identifier hs-var hs-var">typeDependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="annottext">Optic' A_Fold '[] ShuntedType (Type' 'Shunted)
-&gt; (Type' 'Shunted -&gt; HashSet (Qualified Name))
-&gt; ShuntedType
-&gt; HashSet (Qualified Name)
forall k (is :: IxList) a1 a2 b.
(Is k A_Fold, Hashable b) =&gt;
Optic' k is a1 a2 -&gt; (a2 -&gt; HashSet b) -&gt; a1 -&gt; HashSet b
</span><a href="Elara.SCC.html#concatHashSetOf"><span class="hs-identifier hs-var">concatHashSetOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  ShuntedType
  ShuntedType
  (Type' 'Shunted)
  (Type' 'Shunted)
-&gt; Optic' A_Traversal '[] (Type' 'Shunted) (Type' 'Shunted)
-&gt; Optic' A_Fold '[] ShuntedType (Type' 'Shunted)
forall {k1} {m} {k2} {ks :: IxList} {s} {t} {b} {is :: IxList}.
(JoinKinds k1 A_Fold m, Is k2 A_Fold) =&gt;
Optic k1 ks s t b b -&gt; Optic' k2 is b b -&gt; Optic m ks s t b b
</span><a href="Prelude.html#cosmosOnOf"><span class="hs-identifier hs-var">cosmosOnOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Iso
  ShuntedType
  ShuntedType
  (Located (Type' 'Shunted), NoFieldValue)
  (Located (Type' 'Shunted), NoFieldValue)
forall s t a b. Wrapped s t a b =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">_Unwrapped</span></span><span> </span><span class="annot"><span class="annottext">Iso
  ShuntedType
  ShuntedType
  (Located (Type' 'Shunted), NoFieldValue)
  (Located (Type' 'Shunted), NoFieldValue)
-&gt; Optic
     A_Lens
     '[]
     (Located (Type' 'Shunted), NoFieldValue)
     (Located (Type' 'Shunted), NoFieldValue)
     (Located (Type' 'Shunted))
     (Located (Type' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     ShuntedType
     ShuntedType
     (Located (Type' 'Shunted))
     (Located (Type' 'Shunted))
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Type' 'Shunted), NoFieldValue)
  (Located (Type' 'Shunted), NoFieldValue)
  (Located (Type' 'Shunted))
  (Located (Type' 'Shunted))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  ShuntedType
  ShuntedType
  (Located (Type' 'Shunted))
  (Located (Type' 'Shunted))
-&gt; Optic
     A_Lens
     '[]
     (Located (Type' 'Shunted))
     (Located (Type' 'Shunted))
     (Type' 'Shunted)
     (Type' 'Shunted)
-&gt; Optic
     A_Lens
     '[]
     ShuntedType
     ShuntedType
     (Type' 'Shunted)
     (Type' 'Shunted)
forall k l m (is :: IxList) (js :: IxList) (ks :: IxList) s t u v a
       b.
(JoinKinds k l m, AppendIndices is js ks) =&gt;
Optic k is s t u v -&gt; Optic l js u v a b -&gt; Optic m ks s t a b
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Optic
  A_Lens
  '[]
  (Located (Type' 'Shunted))
  (Located (Type' 'Shunted))
  (Type' 'Shunted)
  (Type' 'Shunted)
forall a b. Lens (Located a) (Located b) a b
</span><a href="Elara.AST.Region.html#unlocated"><span class="hs-identifier hs-var">unlocated</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Optic' A_Traversal '[] (Type' 'Shunted) (Type' 'Shunted)
forall a s. GPlate a s =&gt; Traversal' s a
</span><span class="hs-identifier hs-var">gplate</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type' 'Shunted -&gt; HashSet (Qualified Name)
</span><a href="#local-6989586621680059042"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-114"></span><span>    </span><span class="annot"><a href="#local-6989586621680059042"><span class="hs-identifier hs-type">names</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elara.AST.Shunted.html#ShuntedType%27"><span class="hs-identifier hs-type">ShuntedType'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Name.html#Qualified"><span class="hs-identifier hs-type">Qualified</span></a></span><span> </span><span class="annot"><a href="Elara.AST.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621680059042"><span class="annot"><span class="annottext">names :: Type' 'Shunted -&gt; HashSet (Qualified Name)
</span><a href="#local-6989586621680059042"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Generic.Types.html#UserDefinedType"><span class="hs-identifier hs-type">UserDefinedType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elara.AST.Region.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><span class="annottext">SourceRegion
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680059045"><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680059045"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OneItem (HashSet (Qualified Name)) -&gt; HashSet (Qualified Name)
forall x. One x =&gt; OneItem x -&gt; x
</span><span class="hs-identifier hs-var">one</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeName -&gt; Name
</span><a href="Elara.AST.Name.html#NTypeName"><span class="hs-identifier hs-var">NTypeName</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeName -&gt; Name) -&gt; Qualified TypeName -&gt; Qualified Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Qualified TypeName
</span><a href="#local-6989586621680059045"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><a href="#local-6989586621680059042"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">Type' 'Shunted
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Qualified Name)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-117"></span></pre></body></html>